<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Quiz'Ops</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
 
  <!-- Manifest pour PWA -->
<link rel="manifest" href="manifest.json">
 
  <!-- Couleur de la barre de statut -->
<meta name="theme-color" content="#004aad">
 
  <!-- Pour iOS : rendre l'app installable -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
 
  <!-- Ic√¥nes iOS -->
<link rel="apple-touch-icon" href="icons/icon-192.png">
 
  <!-- Si tu veux changer l'ic√¥ne pour diff√©rents formats -->
<link rel="apple-touch-icon" sizes="152x152" href="icons/icon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="icons/icon-512.png">
  
 <style>
  :root {
    --bg:#f4f7fa; --text:#333; --card:#fff; --primary:#1a5276;
    --muted:#ecf0f1; --border:#d0d7de; --good:#28a745; --bad:#dc3545;
    --energy:#ff6b00; /* couleur √©nergie (orange vif) */
  }

  * { box-sizing: border-box; }

  body {
    font-family: Arial, Helvetica, sans-serif;
    background: var(--bg) url("https://images.unsplash.com/photo-1581094651181-3592e59b95a0?auto=format&fit=crop&w=1400&q=80") no-repeat center center fixed;
    background-size: cover;
    color: var(--text);
    margin: 0;
    padding: 0;
  }

  .overlay {
    background: rgba(255,255,255,0.95);
    min-height: 100vh;
    padding: 32px;
  }

  .container {
    max-width: 980px;
    margin: auto;
    background: var(--card);
    padding: 28px;
    border-radius: 16px;
    box-shadow: 0 6px 24px rgba(0,0,0,.12);
    animation: fadeIn 0.45s ease;
  }

  h1,h2 {
    color: var(--primary);
    text-align: center;
    margin: 0 0 12px;
  }

  .themes {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
    gap: 16px;
    margin-top: 20px;
  }

  .theme-button {
    background: var(--muted);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    text-align: center;
    transition: transform 0.18s, box-shadow 0.18s;
    user-select: none;
    min-height:110px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
  }

  .theme-button img {
    width: 48px;
    height: 48px;
    margin-bottom: 8px;
  }

  .theme-button:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.12);
  }

  .question {
    font-size: 1.2rem;
    margin: 14px 0;
    font-weight: 600;
  }

  .choice {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 14px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    border-radius: 10px;
    background: #fff;
    cursor: pointer;
    transition: background 0.12s, transform 0.12s;
  }

  .choice:hover {
    background: #f4f6f8;
    transform: translateY(-2px);
  }

  .choice.correct {
    background-color: #d4edda !important;
    border-color: var(--good) !important;
  }

  .choice.wrong {
    background-color: #f8d7da !important;
    border-color: var(--bad) !important;
  }

  .submit-btn {
    display: inline-block;
    margin-top: 12px;
    background: var(--primary);
    color: white;
    padding: 10px 16px;
    border: none;
    border-radius: 10px;
    font-size: 0.98rem;
    cursor: pointer;
    transition: background 0.12s, transform 0.12s;
  }

  .submit-btn:hover {
    background: #154360;
    transform: scale(1.02);
  }

  .result {
    margin-top: 8px;
    font-weight: 700;
  }

  .explanation {
    margin-top: 10px;
    padding: 12px;
    border-left: 4px solid var(--primary);
    background: #f3f6f8;
    border-radius: 6px;
    line-height: 1.4;
  }

  .row {
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:center;
  }

  #nextBtn, #prevBtn, #backBtn {
    display: none;
    margin-top: 14px;
    padding: 10px 16px;
    border-radius: 10px;
  }

  #nextBtn {
    border: 1px solid var(--primary);
    background: var(--primary);
    color: #fff;
  }

  #prevBtn, #backBtn {
    border: 1px solid var(--border);
    background: var(--muted);
  }

  .score {
    margin-top: 6px;
    text-align: center;
    color: #555;
  }

  .footer-note {
    margin-top: 18px;
    font-size: 12px;
    color: #666;
    text-align: center;
  }

  .progress-bar {
    margin: 12px 0;
    height: 20px;
    width: 100%;
    background: #eee;
    border-radius: 12px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    width: 0%;
    background: var(--primary);
    text-align: center;
    color: #fff;
    font-size: 12px;
    line-height: 20px;
    transition: width 0.3s ease;
  }

  #login-container {
    text-align:center;
  }

  #login-container input {
    padding: 12px;
    width: 70%;
    max-width: 320px;
    margin-bottom: 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
  }

  #login-container button {
    background: var(--primary);
    color: #fff;
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  #logoutBtn {
    margin-top: 8px;
    background: transparent;
    color: #666;
    border: none;
    cursor: pointer;
    text-decoration: underline;
  }

  #progress-overview {
    margin-top: 24px;
  }

  .progress-card {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    margin-top: 10px;
    background: #fff;
  }

  .progress-mini {
    height: 10px;
    background:#eee;
    border-radius: 8px;
    overflow:hidden;
  }

  .progress-mini-fill {
    height: 100%;
    width: 0%;
    background: var(--primary);
    transition: width .3s;
  }

  .mini-row {
    display:flex;
    justify-content:space-between;
    font-size: 12px;
    color:#555;
    margin-top:6px;
  }

  /* === Section d√©fis mise en valeur === */
  #challenge-section {
    background: linear-gradient(135deg, #ffffff, #fdf4ec);
    border: 2px solid #ffe1c4;
    border-radius: 18px;
    padding: 24px;
    margin-top: 40px;
    box-shadow: 0 6px 20px rgba(255, 107, 0, 0.15);
    text-align: center;
    animation: fadeIn 0.5s ease;
  }

  #challenge-section h2 {
    color: var(--energy);
    margin-bottom: 20px;
  }

  .challenge-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  .challenge-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 12px 26px;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.25s ease;
    border: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  /* Bouton "Lancer un d√©fi" */
  #showChallengeBtn {
    background: linear-gradient(90deg, var(--primary), #2471a3);
    color: #fff;
  }

  #showChallengeBtn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(26,82,118,0.4);
  }

  /* Bouton "D√©fis re√ßus" */
  #showReceivedChallengesBtn {
    background: linear-gradient(90deg, var(--energy), #ff8c3a);
    color: #fff;
  }

  #showReceivedChallengesBtn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(255,107,0,0.4);
  }

  /* Badge compteur */
  .challenge-btn .badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: var(--bad);
    color: #fff;
    border-radius: 50%;
    padding: 3px 7px;
    font-size: 11px;
    font-weight: bold;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* petites am√©liorations responsive */
  @media (max-width:520px){
    .theme-button img { width: 40px; height: 40px; }
    #login-container input { width: 90%; }
  }
</style>
</head>
<body>
  <div class="overlay">
    <div class="container">

     <!-- === LOGIN PAGE === -->
      <div id="login-container">
        <h1>üîë Login to Quiz'Ops</h1>
        <p><button onclick="showSignup()" style="background:none;border:none;color:var(--primary);cursor:pointer;text-decoration:underline;font-size:0.9rem;">First connexion ? Subscribe</button></p>
        <p>Enter your email and password to start</p>
        <input type="email" id="emailInput" placeholder="your@email.com" />
        <br>
        <input type="password" id="passwordInput" placeholder="Password" />
        <br>
        <button onclick="login()">Login</button>
        <!-- Bouton mot de passe oubli√© -->
        <div style="margin-top:8px;">
          <button id="forgotID">Password forgot ?</button>
        </div>
        <div id="forgotIDForm" style="display:none;margin-top:10px">
          <input type="email" id="forgotEmail" placeholder="Your email" required />
          <button id="sendID">Send ID</button>
          <p id="forgotMessage"></p>
        </div>
      </div>

      <!-- SIGNUP PAGE -->
      <div id="signup-container" style="display:none; text-align:center;">
        <h1>üÜï First connexion ?</h1>
        <p>Subscribe with email and ID</p>
        <input type="email" id="signupEmail" placeholder="Your email" required />
        <br>
        <input type="text" id="signupID" placeholder="Your ID" required />
        <br>
        <button onclick="signup()">Subscribe</button>
        <p id="signupMessage"></p>
        <button onclick="showLogin()">‚¨Ö Already subscribe ? Please login</button>
      </div>

      <!-- === ADMIN PANEL === -->
      <div id="admin-panel" style="display:none;">
        <h1>üë®‚Äçüíª Moderator Dashboard</h1>
        <button id="logoutBtnAdmin" onclick="logout()">Logout</button>
        <p style="text-align:center">Select a user to view their quiz progress:</p>
        <div id="user-list" style="margin-top:20px;"></div>
        <div id="user-progress" style="margin-top:30px;"></div>
      </div>

      <!-- === THEME SELECTION === -->
      <div id="theme-selection" style="display:none;">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <h1>‚õΩ Quiz'Ops</h1>
          <button id="logoutBtn" onclick="logout()">Logout</button>
        </div>
        <p style="text-align:center">
          Pick a theme. Each quiz draws <b>10 random questions</b> from the theme‚Äôs question bank.
        </p>

        <!-- Dynamic themes grid -->
        <div class="themes"></div>

<div id="challenge-section" style="display:none; margin-top:24px;">
    <h2>‚öîÔ∏è D√©fis</h2>
    <button id="showChallengeBtn">Lancer un d√©fi</button>

    <div id="challenge-form" style="display:none; margin-top:12px;">
      <select id="opponentEmail">
  <option value="">Choisir un joueur...</option>
</select>
      <select id="challengeTheme">
        <option value="cargo_docs">Cargo Docs</option>
        <option value="refined_products">Refined Products</option>
        <option value="specialty_products">Specialty Products</option>
      </select>
      <button id="sendChallengeBtn">Envoyer le d√©fi</button>
    </div>

    <!-- Container pour d√©fis re√ßus -->
    <div id="my-challenges" style="margin-top:16px; display:none;">
        <h3>D√©fis re√ßus</h3>
        <div id="challenges-list"></div>
    </div>
</div>

        <!-- Progress dashboard -->
        <div id="progress-overview"></div>
      </div>

      <!-- === QUIZ CONTAINER === -->
      <div id="quiz-container" style="display:none;">
        <h2 id="theme-title"></h2>
        <div class="progress-bar"><div class="progress-fill" id="progressFill">0%</div></div>
		<div id="timer" style="text-align:center; margin-bottom:10px; font-weight:600;"></div>
        <div class="score" id="scoreLine"></div>
        <div class="question" id="question"></div>
        <div class="choices" id="choices"></div>
        <div class="result" id="result"></div>
        <div class="explanation" id="explanation"></div>
        <div class="row">
          <button id="prevBtn" onclick="prevQuestion()">‚¨Ö Previous</button>
          <button id="nextBtn" onclick="nextQuestion()">Next ‚û°</button>
          <button id="backBtn" onclick="goBack()">‚¨Ö Back to Menu</button>
        </div>
        <div class="footer-note">Tip: you get a different set each time you launch a theme.</div>
      </div>

<div id="overallProgressContainer" style="margin: 16px 0; text-align:center;">
  <div style="background:#eee; border-radius:8px; height:20px; width:80%; margin:0 auto; position:relative;">
    <div id="overallProgressFill" style="background:#4caf50; height:100%; width:0%; border-radius:8px; text-align:center; color:white; line-height:20px; font-size:12px;">
      0%
    </div>
  </div>
  
    </div>
  </div>

  <script>
    // ---------------------------
    // CONFIG
    // ---------------------------
    // Laisse vide si tu ne veux pas envoyer vers Power Automate pour l'instant
  function showSignup() {
    document.getElementById("login-container").style.display = "none";
    document.getElementById("signup-container").style.display = "block";
}

function showLogin() {
    document.getElementById("signup-container").style.display = "none";
    document.getElementById("login-container").style.display = "block";
}

  // === Power Automate Flow URL ===
const flowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/8529a06fdcc6401aaa54e12ccdf8053c/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=ZMFUE06qvb1Qjx-2UAwG47ivXUPZljA2ikv4TaMdVQE";
const flowUrlSignup = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/cb431fe6824e4af79ff1081e88adbcde/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=JJ-Qbs2tRRE5gFnpSBfUrVp6oPshyoZcKFEJ3CcVWvg";
const flow = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/cd72f3ad611140f4b40ee95952f496ac/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=U45wTZLPIBNCIHN1Jv8Uq1AmteCU1Bo6eLzz2TTmVIE"
const createChallengeFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/2a477945342b45fb8d16005ccea30204/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=rV-cHf43QIzra6-zmfEkfCNOEV00ovXN0VxL9Z62Wz0";
const getChallengesFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/31ef6faaebcb43f4878225828d23a559/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=21xbDVO1CPlcxZgqjjjJ7bi9F9IBvXDzU_1fDKc5K7Q";
const updateChallengeFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/f75d3f08213d4d3badffabd91a32f666/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=eOjS9FQtNfeonEXf3eYRX2y5koUv9nV-czcyrFN8lvM";
const getAllUsersFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/87639e159f094cfdb271eac85cc07e9a/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=44pRUiagqDm_20uaN8NVFifqclbejWMyNPDMan3Wntk"
const updateChallengeDoneFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/c9bcce3eda5549b3ae905734dadc8fcf/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=mNGG7Fs3Z0ywx5v95GrR2aKzEoQVzBGIK2XECgdpNA8";
const UPDATE_PROGRESS_URL = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/e23e3c436c3145bebd18206e4b7e55eb/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=CffamMjMGSTdVPz_ZJ8QOQOI8W_C0I1lBKutiMjQa84";
const GET_PROGRESS_URL = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/4d4e1d4fa7154adf9e982d40925666f5/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=uk1eQuzMtSrZ2MXRhXK7sz772Th105-hlY0mGSQjjjQ";

function getUserIP() {
  // ‚ö†Ô∏è HTML ne peut pas obtenir l‚ÄôIP r√©elle sans backend.
  // Ici, tu peux mettre une valeur fixe ou appeler une API IP si autoris√©.
  return "127.0.0.1";
}

  // Utility: shuffle
  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

    // === QUESTION BANK ===
    const quizData = {

  cargo_docs: {
    title: "Cargo Documentation",
    questions: [
      {
        id: "cdoc1",
        question: "What are the three legal functions of a Bill of Lading?",
        choices: ["Contract of carriage", "Cargo receipt", "Document of title", "Customs clearance"],
        correct: [0,1,2],
        explanation: "The Bill of Lading serves as evidence of the contract of carriage, receipt of goods, and document of title."
      },
      {
        id: "cdoc2",
        question: "Which documents are typically required under a Letter of Credit?",
        choices: ["Bill of Lading", "Certificate of Origin", "Commercial Invoice", "Time Sheet"],
        correct: [0,1,2],
        explanation: "Banks require the original Bill of Lading, Certificate of Origin, and Commercial Invoice to release payment."
      },
      {
        id: "cdoc3",
        question: "What does a 'Clean B/L' indicate?",
        choices: ["No defects or shortages", "Cargo is insured", "Cargo is negotiable", "Cargo is prepaid"],
        correct: [0],
        explanation: "A Clean B/L means no defects or shortages are noted on the cargo."
      },
      {
        id: "cdoc4",
        question: "Which document confirms the quantity of cargo loaded?",
        choices: ["Certificate of Quantity", "Cargo Manifest", "Bill of Lading", "Ullage Report"],
        correct: [0],
        explanation: "The Certificate of Quantity confirms the amount of product loaded and is used for invoicing."
      },
      {
        id: "cdoc5",
        question: "Which document is used to prove product origin for customs?",
        choices: ["Certificate of Quality", "Certificate of Origin", "Cargo Manifest", "LOI"],
        correct: [1],
        explanation: "The Certificate of Origin is required to determine applicable duties and trade agreements."
      },
      {
        id: "cdoc6",
        question: "What is the role of the Cargo Manifest?",
        choices: ["Customs clearance", "Ownership transfer", "Quality confirmation", "Payment guarantee"],
        correct: [0],
        explanation: "The Cargo Manifest lists all cargo items and is used by customs at discharge port."
      },
      {
        id: "cdoc7",
        question: "Which document confirms that shipping documents are onboard?",
        choices: ["Master‚Äôs Receipt for Documents", "LOI", "Cargo Manifest", "Time Sheet"],
        correct: [0],
        explanation: "The Master‚Äôs Receipt for Documents confirms that required documents are onboard the vessel."
      },
      {
        id: "cdoc8",
        question: "What is the consequence of a Claused B/L?",
        choices: ["Bank refuses payment", "Cargo is rejected", "Customs delay", "All of the above"],
        correct: [0],
        explanation: "Banks do not accept Claused B/Ls, which prevents payment under L/C."
      },
      {
        id: "cdoc9",
        question: "Which document allows cargo delivery without original B/L?",
        choices: ["Letter of Indemnity", "Cargo Manifest", "Certificate of Origin", "Time Sheet"],
        correct: [0],
        explanation: "A Letter of Indemnity (LOI) allows delivery without the original Bill of Lading."
      },
      {
        id: "cdoc10",
        question: "What must be included in a valid LOI?",
        choices: ["Authorized signatory", "Cargo description", "Contract reference", "All of the above"],
        correct: [3],
        explanation: "A valid LOI must include contract details, cargo info, and be signed by an authorized signatory."
      },
      {
        id: "cdoc11",
        question: "Which clause allows Charter-party terms to be included in a B/L?",
        choices: ["Incorporation clause", "To Order clause", "Clean clause", "Delivery clause"],
        correct: [0],
        explanation: "The incorporation clause allows Charter-party terms to be included in the B/L."
      },
      {
        id: "cdoc12",
        question: "Who is legally entitled to receive goods under a B/L?",
        choices: ["Consignee", "Notify Party", "Shipper", "Carrier"],
        correct: [0],
        explanation: "The Consignee is the legal recipient of goods under the Bill of Lading."
      },
      {
        id: "cdoc13",
        question: "What is the role of the Notify Party?",
        choices: ["Receives goods", "Is informed of shipment arrival", "Issues B/L", "Signs LOI"],
        correct: [1],
        explanation: "The Notify Party is informed of the shipment‚Äôs arrival but cannot claim the goods."
      },
      {
        id: "cdoc14",
        question: "Which document confirms cargo quality?",
        choices: ["Certificate of Quality", "Cargo Manifest", "Time Sheet", "LOI"],
        correct: [0],
        explanation: "The Certificate of Quality confirms compliance with contractual specifications."
      },
      {
        id: "cdoc15",
        question: "Which documents are typically signed by the Master?",
        choices: ["Bill of Lading", "Master‚Äôs Receipt for Documents", "Time Sheet", "All of the above"],
        correct: [3],
        explanation: "The Master signs the B/L, receipts for documents and samples, and the Time Sheet."
      },
      {
        id: "cdoc16",
        question: "What does 'To Order' mean on a B/L?",
        choices: ["Cargo is negotiable", "Cargo is insured", "Cargo is prepaid", "Cargo is rejected"],
        correct: [0],
        explanation: "'To Order' makes the B/L negotiable and transferable."
      },
      {
        id: "cdoc17",
        question: "Which document tracks loading/discharge timings?",
        choices: ["Time Sheet / Statement of Facts", "Cargo Manifest", "LOI", "Certificate of Origin"],
        correct: [0],
        explanation: "The Time Sheet records all operational events for laytime calculation."
      },
      {
        id: "cdoc18",
        question: "What is the purpose of the Master‚Äôs Receipt for Samples?",
        choices: ["Confirms sample delivery", "Confirms cargo quantity", "Confirms payment", "Confirms B/L issuance"],
        correct: [0],
        explanation: "It confirms that cargo samples have been delivered onboard."
      },
      {
        id: "cdoc19",
        question: "What is the risk of delivering cargo without original B/L?",
        choices: ["Misdelivery claim", "Loss of title", "Legal dispute", "All of the above"],
        correct: [3],
        explanation: "Delivery without original B/L exposes parties to legal and financial risks."
      },
      {
        id: "cdoc20",
        question: "Which document confirms vessel readiness?",
        choices: ["Notice of Readiness", "Bill of Lading", "LOI", "Cargo Manifest"],
        correct: [0],
        explanation: "The Notice of Readiness confirms the vessel is ready for loading/discharge."
      },
      {
        id: "cdoc21",
        question: "Which document confirms cargo was loaded?",
        choices: ["Shipped B/L", "Received for Shipment B/L", "LOI", "Cargo Manifest"],
        correct: [0],
        explanation: "A Shipped B/L confirms cargo has been loaded onboard."
      },
      {
        id: "cdoc22",
        question: "What is the role of the Charter-party in relation to the B/L?",
        choices: ["Defines carriage terms", "Defines payment terms", "Defines customs duties", "Defines cargo quality"],
        correct: [0],
        explanation: "The Charter-party defines the terms of carriage between Charterer and Carrier."
      },
      {
        id: "cdoc23",
        question: "Which document confirms tank cleanliness?",
        choices: ["Tank Inspection Report", "Certificate of Origin", "LOI", "Cargo Manifest"],
        correct: [0],
        explanation: "The Tank Inspection Report confirms the cleanliness of ship‚Äôs tanks before loading."
      },
      {
        id: "cdoc24",
        question: "What does a negotiable B/L allow?",
        choices: ["Transfer of ownership", "Customs clearance", "Cargo inspection", "Payment delay"],
        correct: [0],
        explanation: "A negotiable B/L allows transfer of ownership through endorsement."
      },
      {
        id: "cdoc25",
        question: "Which documents are typically signed in 3/3 originals?",
        choices: ["Bill of Lading", "Certificate of Quantity", "Certificate of Origin", "All of the above"],
        correct: [0],
        explanation: "The Bill of Lading is traditionally issued in 3/3 originals for legal and operational purposes."
      },

    {
        id: "cdoc26",
        question: "Which parties may be involved in signing a Letter of Indemnity?",
        choices: ["Charterer", "Shipper", "Receiver", "Carrier"],
        correct: [0,1,3],
        explanation: "LOIs are typically signed by Charterers or Shippers and addressed to the Carrier."
      },
      {
        id: "cdoc27",
        question: "Which risks are covered by a Letter of Indemnity?",
        choices: ["Misdelivery", "Loss of title", "Cargo damage", "Legal claims"],
        correct: [0,1,3],
        explanation: "LOIs cover risks such as misdelivery, loss of title, and legal consequences."
      },
      {
        id: "cdoc28",
        question: "Which documents are typically required for customs clearance?",
        choices: ["Certificate of Origin", "Cargo Manifest", "Commercial Invoice", "LOI"],
        correct: [0,1,2],
        explanation: "Customs authorities require Certificate of Origin, Cargo Manifest, and Invoice for clearance."
      },
      {
        id: "cdoc29",
        question: "Which elements must be present on a valid Bill of Lading?",
        choices: ["Name of shipper", "Name of consignee", "Cargo description", "Date of shipment"],
        correct: [0,1,2,3],
        explanation: "A valid B/L must include shipper, consignee, cargo details, and shipment date."
      },
      {
        id: "cdoc30",
        question: "Which types of Bill of Lading exist?",
        choices: ["Straight B/L", "To Order B/L", "Bearer B/L", "Received for Shipment B/L"],
        correct: [0,1,3],
        explanation: "Common types include Straight B/L, To Order B/L, and Received for Shipment B/L."
      },
      {
        id: "cdoc31",
        question: "Which document confirms the vessel has received cargo?",
        choices: ["Received for Shipment B/L", "Shipped B/L", "Cargo Manifest", "LOI"],
        correct: [0],
        explanation: "Received for Shipment B/L confirms cargo has been received but not yet loaded."
      },
      {
        id: "cdoc32",
        question: "Which documents are typically exchanged at discharge port?",
        choices: ["Original B/L", "LOI", "Cargo Manifest", "Discharge instructions"],
        correct: [0,2,3],
        explanation: "At discharge, original B/L, manifest and discharge instructions are exchanged."
      },
      {
        id: "cdoc33",
        question: "What is the purpose of the Tank Inspection Report?",
        choices: ["Confirm tank cleanliness", "Confirm cargo quantity", "Confirm cargo quality", "Confirm vessel readiness"],
        correct: [0],
        explanation: "The Tank Inspection Report confirms tanks are clean and suitable for loading."
      },
      {
        id: "cdoc34",
        question: "Which documents may be required by the bank for payment?",
        choices: ["Original B/L", "Certificate of Origin", "Commercial Invoice", "LOI"],
        correct: [0,1,2],
        explanation: "Banks require original B/L, Certificate of Origin, and Invoice under L/C terms."
      },
      {
        id: "cdoc35",
        question: "What does the incorporation clause in a B/L do?",
        choices: ["Includes Charter-party terms", "Transfers ownership", "Confirms cargo quality", "Confirms payment"],
        correct: [0],
        explanation: "It incorporates Charter-party terms into the Bill of Lading."
      },
      {
        id: "cdoc36",
        question: "Which document is used to confirm cargo delivery without original B/L?",
        choices: ["LOI", "Cargo Manifest", "Time Sheet", "Certificate of Quantity"],
        correct: [0],
        explanation: "LOI is used when cargo is delivered without the original Bill of Lading."
      },
      {
        id: "cdoc37",
        question: "Which parties are typically listed on a Bill of Lading?",
        choices: ["Shipper", "Consignee", "Notify Party", "Carrier"],
        correct: [0,1,2,3],
        explanation: "All listed parties are standard on a Bill of Lading."
      },
      {
        id: "cdoc38",
        question: "Which document confirms the cargo‚Äôs physical characteristics?",
        choices: ["Certificate of Quality", "Certificate of Quantity", "Cargo Manifest", "LOI"],
        correct: [0],
        explanation: "The Certificate of Quality confirms the physical properties of the cargo."
      },
      {
        id: "cdoc39",
        question: "Which document is used to confirm cargo volume?",
        choices: ["Certificate of Quantity", "Ullage Report", "Cargo Manifest", "Time Sheet"],
        correct: [0,1],
        explanation: "Both Certificate of Quantity and Ullage Report confirm cargo volume."
      },
      {
        id: "cdoc40",
        question: "Which documents are signed by the Master?",
        choices: ["Bill of Lading", "Master‚Äôs Receipts", "Time Sheet", "LOI"],
        correct: [0,1,2],
        explanation: "The Master signs the B/L, receipts for documents/samples, and Time Sheet."
      },
      {
        id: "cdoc41",
        question: "Which document confirms the vessel is ready for operations?",
        choices: ["Notice of Readiness", "Time Sheet", "Cargo Manifest", "LOI"],
        correct: [0],
        explanation: "The Notice of Readiness confirms the vessel is ready for loading/discharge."
      },
      {
        id: "cdoc42",
        question: "Which documents are used to verify cargo details at discharge?",
        choices: ["Cargo Manifest", "Certificate of Quantity", "Certificate of Origin", "LOI"],
        correct: [0,1,2],
        explanation: "Cargo Manifest, Quantity and Origin certificates are used to verify cargo details."
      },
      {
        id: "cdoc43",
        question: "Which document confirms the cargo has been shipped?",
        choices: ["Shipped B/L", "Received for Shipment B/L", "LOI", "Cargo Manifest"],
        correct: [0],
        explanation: "Shipped B/L confirms cargo has been loaded onboard."
      },
      {
        id: "cdoc44",
        question: "Which document is used to confirm sample delivery?",
        choices: ["Master‚Äôs Receipt for Samples", "Certificate of Quality", "LOI", "Cargo Manifest"],
        correct: [0],
        explanation: "Master‚Äôs Receipt for Samples confirms delivery of cargo samples onboard."
      },
      {
        id: "cdoc45",
        question: "Which documents are used to confirm cargo readiness?",
        choices: ["Notice of Readiness", "Tank Inspection Report", "Certificate of Quantity", "Time Sheet"],
        correct: [0,1],
        explanation: "Notice of Readiness and Tank Inspection confirm vessel and tank readiness."
      },
      {
        id: "cdoc46",
        question: "Which documents are used to support customs declarations?",
        choices: ["Certificate of Origin", "Cargo Manifest", "Commercial Invoice", "LOI"],
        correct: [0,1,2],
        explanation: "Customs declarations rely on Origin certificate, Manifest and Invoice."
      },
      {
        id: "cdoc47",
        question: "Which document confirms the cargo is free from contamination?",
        choices: ["Tank Inspection Report", "Certificate of Quality", "LOI", "Cargo Manifest"],
        correct: [0,1],
        explanation: "Tank Inspection and Quality Certificate confirm cargo cleanliness."
      },
      {
        id: "cdoc48",
        question: "Which document confirms the cargo quantity at loading?",
        choices: ["Certificate of Quantity", "Ullage Report", "Cargo Manifest", "LOI"],
        correct: [0,1],
        explanation: "Certificate of Quantity and Ullage Report confirm loaded volume."
      },
      {
        id: "cdoc49",
        question: "Which document is used to confirm cargo ownership?",
        choices: ["Bill of Lading", "LOI", "Certificate of Origin", "Cargo Manifest"],
        correct: [0],
        explanation: "The Bill of Lading acts as a document of title confirming ownership."
      },
      {
        id: "cdoc50",
        question: "Which documents are required for payment under a documentary sale?",
        choices: ["Original B/L", "Certificate of Origin", "Commercial Invoice", "All of the above"],
        correct: [3],
        explanation: "All listed documents are required for payment under documentary sale terms."
      }

  ]
},

crude_types_specs: { 
    title: "Crude Oil Types & Specs", 

 questions: [
  { id: "cru1", question: "Crude oil is a mixture of:", choices: ["Pure hydrocarbons", "Hydrocarbons and impurities", "Single compound", "Alcohols"], correct: 1, explanation: "Crude oil is a natural mixture of hydrocarbons and impurities like sulfur, nitrogen, metals, and salts." },
  { id: "cru2", question: "First major separation step for crude oil:", choices: ["Vacuum distillation", "Atmospheric distillation", "Cracking", "Reforming"], correct: 1, explanation: "Atmospheric distillation is the first step in refining crude oil, separating it into fractions based on boiling points." },
  { id: "cru3", question: "Main impurities in crude impacting refining:", choices: ["Nitrogen, sulfur, metals", "Helium and neon", "Water only", "Oxygen only"], correct: 0, explanation: "Sulfur, nitrogen, and metals are the main problematic impurities because they cause corrosion and catalyst poisoning." },
  { id: "cru4", question: "API gravity is a measure of:", choices: ["Viscosity", "Density", "Sulfur", "Aromatics"], correct: 1, explanation: "API gravity is a measure of the density of crude oil compared to water." },
  { id: "cru5", question: "Light crude generally has:", choices: ["Low API", "High API", "High sulfur", "High metals"], correct: 1, explanation: "Light crude has high API gravity, meaning it is less dense and yields more valuable light products." },
  { id: "cru6", question: "Sweet crude means:", choices: ["Low sulfur", "High sulfur", "High nitrogen", "Low metals"], correct: 0, explanation: "Sweet crude contains low sulfur and is easier to refine into clean fuels." },
  { id: "cru7", question: "A crude desalter removes mostly:", choices: ["Hydrogen", "Water and salts", "Aromatics", "Paraffins"], correct: 1, explanation: "A desalter removes water-soluble salts and water to prevent corrosion and fouling in the distillation unit." },
  { id: "cru8", question: "Bottom product of atmospheric distillation:", choices: ["Naphtha", "Kerosene", "Atmospheric residue", "Diesel"], correct: 2, explanation: "The heaviest fraction, atmospheric residue, remains at the bottom after atmospheric distillation." },
  { id: "cru9", question: "Typical sulfur content range in crudes:", choices: ["0‚Äì0.1%", "0.5‚Äì5%", "10%", "50%"], correct: 1, explanation: "Sulfur content in crude typically ranges between 0.5% and 5%." },
  { id: "cru10", question: "Crude oil resources are mainly found in:", choices: ["Igneous rocks", "Sedimentary basins", "Mountains", "Volcanoes"], correct: 1, explanation: "Crude oil forms in sedimentary basins where organic matter is buried and transformed under heat and pressure." },
  { id: "cru11", question: "What is heavy crude oil characterized by?", choices: ["High API gravity", "Low viscosity", "High viscosity and density", "Low sulfur"], correct: 2, explanation: "Heavy crude has high viscosity, low API gravity, and is harder to refine." },
  { id: "cru12", question: "Which element in crude oil contributes to SOx emissions?", choices: ["Carbon", "Sulfur", "Nitrogen", "Hydrogen"], correct: 1, explanation: "Sulfur in crude oil produces sulfur oxides (SOx) during combustion, causing air pollution." },
  { id: "cru13", question: "Vacuum distillation is applied to:", choices: ["Light naphtha", "Kerosene", "Atmospheric residue", "LPG"], correct: 2, explanation: "Atmospheric residue is sent to vacuum distillation to recover valuable heavy gas oils without cracking them." },
  { id: "cru14", question: "Which crude type is easier to refine?", choices: ["Heavy sour crude", "Light sweet crude", "Residue-rich crude", "Extra heavy crude"], correct: 1, explanation: "Light sweet crude is easier to refine and produces more high-value light products." },
  { id: "cru15", question: "Which crude oil fraction is used for making lubricants?", choices: ["LPG", "Gasoline", "Vacuum gas oil", "Heavy residue"], correct: 2, explanation: "Vacuum gas oil and heavier fractions are processed into base oils for lubricants." },
  { id: "cru16", question: "What is the typical hydrogen content in crude oil?", choices: ["1‚Äì5%", "10‚Äì14%", "20‚Äì25%", "50%"], correct: 1, explanation: "Crude oil typically contains around 10‚Äì14% hydrogen by weight." },
  { id: "cru17", question: "Crude oil with high paraffin content is prone to:", choices: ["High viscosity", "Wax deposition", "High sulfur", "Metal poisoning"], correct: 1, explanation: "Paraffinic crudes contain waxes that can solidify and cause flow problems at low temperatures." },
  { id: "cru18", question: "The pour point of crude oil refers to:", choices: ["Boiling point", "Flash point", "Lowest temperature it flows", "Viscosity at 100 ¬∞C"], correct: 2, explanation: "The pour point is the lowest temperature at which crude oil remains pourable." },
  { id: "cru19", question: "Which crude benchmark is used in Europe?", choices: ["WTI", "Dubai", "Brent", "Bonny Light"], correct: 2, explanation: "Brent crude is the main pricing benchmark in Europe." },
  { id: "cru20", question: "Which crude benchmark is used in the US?", choices: ["Brent", "WTI", "Dubai", "Urals"], correct: 1, explanation: "West Texas Intermediate (WTI) is the key benchmark for US crude oil pricing." },
  { id: "cru21", question: "Which crude oil benchmark is used in the Middle East?", choices: ["Brent", "WTI", "Dubai", "Bonny Light"], correct: 2, explanation: "Dubai crude is the key pricing benchmark in the Middle East and Asia." },
  { id: "cru22", question: "What does TAN (Total Acid Number) measure in crude?", choices: ["Acidity of crude", "Sulfur content", "Viscosity", "Density"], correct: 0, explanation: "TAN indicates the acidity of crude oil, which impacts corrosion in refinery units." },
  { id: "cru23", question: "What does a higher API gravity indicate?", choices: ["Heavier crude", "Lighter crude", "Higher sulfur", "Higher metals"], correct: 1, explanation: "Higher API gravity means the crude is lighter and more valuable." },
  { id: "cru24", question: "What does CCR (Conradson Carbon Residue) indicate?", choices: ["Sulfur content", "Coking tendency", "Viscosity", "API gravity"], correct: 1, explanation: "CCR measures the tendency of crude oil to form coke during processing." },
  { id: "cru25", question: "Which crude property impacts hydrogen consumption in refining?", choices: ["Sulfur content", "Wax content", "Water content", "Density"], correct: 0, explanation: "High sulfur content requires more hydrogen for hydrotreating and desulfurization." },
  { id: "cru26", question: "Which gas is dissolved in crude oil at reservoir conditions?", choices: ["Oxygen", "Carbon dioxide", "Methane", "Nitrogen"], correct: 2, explanation: "Methane and other light hydrocarbons are dissolved in crude oil under reservoir pressure." },
  { id: "cru27", question: "Which crude fraction is used as petrochemical feedstock?", choices: ["Fuel oil", "Naphtha", "Vacuum residue", "Asphalt"], correct: 1, explanation: "Naphtha is the primary feedstock for petrochemical production like olefins and aromatics." },
  { id: "cru28", question: "Which heavy crude upgrading process uses hydrogen?", choices: ["Coking", "Hydrocracking", "Visbreaking", "Thermal cracking"], correct: 1, explanation: "Hydrocracking uses hydrogen to upgrade heavy crude fractions into lighter products." },
  { id: "cru29", question: "Where is most of the world's crude oil located?", choices: ["Arctic", "Middle East", "Europe", "Australia"], correct: 1, explanation: "The Middle East holds the largest share of the world‚Äôs proven crude oil reserves." },
  { id: "cru30", question: "Which property differentiates sweet and sour crude?", choices: ["API gravity", "Sulfur content", "Viscosity", "Wax content"], correct: 1, explanation: "The sulfur content defines whether a crude is classified as sweet or sour." },
  { id: "cru31", question: "What does BS&W in crude oil stand for?", choices: ["Base Sulfur & Water", "Basic Sediment & Water", "Balance Salt & Wax", "Bitumen Sand & Wax"], correct: 1, explanation: "BS&W refers to Basic Sediment & Water, impurities removed before refining." },
  { id: "cru32", question: "Crude oil‚Äôs nitrogen compounds are problematic because:", choices: ["They increase viscosity", "They poison catalysts", "They lower API gravity", "They reduce hydrogen"], correct: 1, explanation: "Nitrogen compounds deactivate catalysts during hydrotreating and cracking." },
  { id: "cru33", question: "The flash point of crude oil is:", choices: ["Lowest flow temperature", "Temperature it ignites", "Density measure", "Pour point"], correct: 1, explanation: "The flash point is the temperature at which crude vapors ignite in the presence of a flame." },
  { id: "cru34", question: "What is bitumen derived from crude used for?", choices: ["Jet fuel", "Road construction", "Petrochemicals", "Cooking gas"], correct: 1, explanation: "Bitumen, the heaviest crude fraction, is widely used in road paving and roofing materials." },
  { id: "cru35", question: "Which is the lightest fraction in crude distillation?", choices: ["Diesel", "LPG", "Vacuum residue", "Fuel oil"], correct: 1, explanation: "LPG is the lightest fraction recovered during crude distillation." },
  { id: "cru36", question: "Which test measures crude‚Äôs metal content?", choices: ["XRF analysis", "API gravity", "Pour point", "CCR"], correct: 0, explanation: "X-ray fluorescence (XRF) is used to measure trace metals in crude oil." },
  { id: "cru37", question: "Which crude fraction has the highest boiling point?", choices: ["Gasoline", "Kerosene", "Vacuum residue", "Diesel"], correct: 2, explanation: "Vacuum residue has the highest boiling range and cannot be distilled under normal conditions." },
  { id: "cru38", question: "Which crude oil fraction is a key feedstock for catalytic cracking?", choices: ["LPG", "Vacuum gas oil", "Kerosene", "Asphalt"], correct: 1, explanation: "Vacuum gas oil is the main feedstock for FCC (fluid catalytic cracking) units." },
  { id: "cru39", question: "Crude oil density is usually expressed in:", choices: ["g/cm¬≥", "API gravity", "Pa¬∑s", "¬∞C"], correct: 1, explanation: "Crude oil density is expressed as API gravity, a standard industry measure." },
  { id: "cru40", question: "Which crude property impacts refinery yield of gasoline?", choices: ["Sulfur content", "Paraffinic content", "Viscosity", "Water content"], correct: 1, explanation: "Paraffinic crudes yield more gasoline when processed compared to naphthenic crudes." },
  { id: "cru41", question: "Which element in crude causes corrosion in distillation units?", choices: ["Sulfur", "Nitrogen", "Chlorides", "Paraffins"], correct: 2, explanation: "Chloride salts in crude oil hydrolyze into hydrochloric acid, causing corrosion." },
  { id: "cru42", question: "Which crude type generally requires more upgrading?", choices: ["Light sweet crude", "Heavy sour crude", "Condensates", "Paraffinic crude"], correct: 1, explanation: "Heavy sour crude requires extensive upgrading due to its high sulfur and metal content." },
  { id: "cru43", question: "Which crude oil property determines energy content?", choices: ["Sulfur", "Viscosity", "Hydrogen-to-carbon ratio", "Pour point"], correct: 2, explanation: "A higher hydrogen-to-carbon ratio indicates greater energy content and cleaner combustion." },
  { id: "cru44", question: "Which type of crude has higher wax content?", choices: ["Naphthenic crude", "Paraffinic crude", "Sour crude", "Heavy crude"], correct: 1, explanation: "Paraffinic crudes have higher wax content, leading to flow problems in pipelines." },
  { id: "cru45", question: "Which crude analysis measures hydrocarbon types?", choices: ["Distillation curve", "SARA analysis", "CCR", "Flash point"], correct: 1, explanation: "SARA analysis separates hydrocarbons into saturates, aromatics, resins, and asphaltenes." },
  { id: "cru46", question: "Which crude oil type yields more lubricants?", choices: ["Paraffinic crude", "Naphthenic crude", "Sour crude", "Light crude"], correct: 0, explanation: "Paraffinic crudes are preferred for lubricant production due to high wax and base oil content." },
  { id: "cru47", question: "Which measurement indicates crude stability?", choices: ["API gravity", "CCR", "Asphaltene content", "Flash point"], correct: 2, explanation: "Asphaltene content affects crude oil stability during transport and refining." },
  { id: "cru48", question: "Which crude oil property is most important for transport?", choices: ["Viscosity", "Pour point", "API gravity", "All of the above"], correct: 3, explanation: "Viscosity, pour point, and API gravity all impact how crude oil can be pumped and transported." },
  { id: "cru49", question: "Which crude fraction is mainly used for jet fuel?", choices: ["Naphtha", "Kerosene", "Diesel", "Vacuum residue"], correct: 1, explanation: "Kerosene fraction is primarily refined into jet fuel." },
  { id: "cru50", question: "Which heavy crude processing method produces petroleum coke?", choices: ["Hydrocracking", "Coking", "Visbreaking", "Reforming"], correct: 1, explanation: "Coking is used to upgrade heavy residues and produces petroleum coke as a byproduct." }
]
},

refined_products: {
  title: "Refined Products (Gasoline, Diesel, Jet A1, Fuel Oil)",
  questions: [

    {
      id: "rfp1",
      question: "Which refined product typically has the highest sulfur specification tolerance?",
      choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
      correct: 3,
      explanation: "Fuel oil has the highest sulfur tolerance, with levels up to 1% or more, unlike clean products which are strictly regulated for environmental reasons."
    },

    {
      id: "rfp2",
      question: "Which products are classified as clean petroleum products (CPP)?",
      choices: ["Gasoline", "Jet A1", "Diesel", "Fuel Oil"],
      correct: [0, 1, 2],
      explanation: "Gasoline, Jet A1, and Diesel are considered clean products due to their lower sulfur content and cleaner combustion properties. Fuel oil is classified as a dirty product."
    },

    {
      id: "rfp3",
      question: "What is the maximum freezing point allowed for Jet A1 fuel?",
      choices: ["-30¬∞C", "-40¬∞C", "-47¬∞C", "-55¬∞C"],
      correct: 2,
      explanation: "Jet A1 must remain liquid at high altitudes; hence, its freezing point must be below -47¬∞C to ensure safe operation."
    },

    {
      id: "rfp4",
      question: "Which parameters are used to define the volatility of gasoline?",
      choices: ["Reid Vapor Pressure", "ASTM distillation curve", "Flash point", "Freezing point"],
      correct: [0, 1],
      explanation: "Gasoline volatility is primarily defined by Reid Vapor Pressure and ASTM distillation points, which influence cold start and evaporation losses."
    },

    {
      id: "rfp5",
      question: "Which of the following additives are commonly used to improve cetane number in diesel?",
      choices: ["Alkyl nitrates", "Aromatics", "Olefins", "Methanol"],
      correct: 0,
      explanation: "Alkyl nitrates are used in diesel to improve ignition quality by increasing the cetane number."
    },

    {
      id: "rfp6",
      question: "Which product has the lowest flash point among the following?",
      choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
      correct: 0,
      explanation: "Gasoline has a very low flash point, making it highly flammable and volatile compared to other refined products."
    },

    {
      id: "rfp7",
      question: "Which of the following are considered key cold flow properties for diesel?",
      choices: ["Cloud point", "Pour point", "Freezing point", "Flash point"],
      correct: [0, 1],
      explanation: "Cloud point and pour point are critical for diesel performance in cold climates, indicating wax crystal formation and flowability."
    },

    {
      id: "rfp8",
      question: "Which of the following affect the octane number of gasoline?",
      choices: ["Aromatics", "Olefins", "Paraffins", "Sulfur content"],
      correct: [0, 1, 2],
      explanation: "Octane number is influenced by hydrocarbon composition: aromatics and olefins increase it, while paraffins have lower octane values."
    },

    {
      id: "rfp9",
      question: "Which product requires the highest thermal stability during storage and use?",
      choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
      correct: 2,
      explanation: "Jet A1 must maintain thermal stability to avoid degradation at high temperatures during flight operations."
    },

    {
      id: "rfp10",
      question: "Which of the following are typical Jet A1 quality control parameters?",
      choices: ["Thermal stability", "Water separation index", "Gum content", "Cetane number"],
      correct: [0, 1, 2],
      explanation: "Jet A1 is tested for thermal stability, water separation, and gum content to ensure clean combustion and safety."
    },

    {
      id: "rfp11",
      question: "Which refined product is most sensitive to cold flow issues in winter?",
      choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
      correct: 1,
      explanation: "Diesel is prone to wax crystallization at low temperatures, which can clog filters and affect engine performance."
    },

    {
      id: "rfp12",
      question: "What is the typical cetane number requirement for road diesel?",
      choices: ["40", "46", "51", "55"],
      correct: 2,
      explanation: "Modern diesel engines require a minimum cetane number of 51 to ensure efficient combustion and reduced emissions."
    },

    {
      id: "rfp13",
      question: "Which of the following are considered aromatic hydrocarbons?",
      choices: ["Benzene", "Toluene", "Xylene", "Hexane"],
      correct: [0, 1, 2],
      explanation: "Benzene, toluene, and xylene are aromatic compounds with ring structures, commonly found in gasoline blends."
    },

    {
      id: "rfp14",
      question: "Which product has the highest flash point requirement?",
      choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
      correct: 3,
      explanation: "Fuel oil must have a flash point above 70¬∞C for safe handling and storage due to its heavy composition."
    },

    {
      id: "rfp15",
      question: "Which of the following are typical blending constraints for gasoline?",
      choices: ["Octane number", "Vapor pressure", "Sulfur content", "Cetane number"],
      correct: [0, 1, 2],
      explanation: "Gasoline blending must meet octane, vapor pressure, and sulfur limits. Cetane number is relevant only for diesel."
    },

    {
      id: "rfp16",
      question: "Which of the following are used to improve lubricity in ultra-low sulfur diesel?",
      choices: ["Lubricity additives", "Cetane improvers", "Aromatics", "Methanol"],
      correct: 0,
      explanation: "Lubricity additives are added to compensate for the loss of natural lubricants removed during desulfurization."
    },

    {
      id: "rfp17",
      question: "Which of the following are typical Jet A1 contaminants to be avoided?",
      choices: ["Water", "Particulates", "Microbial growth", "Sulfur"],
      correct: [0, 1, 2],
      explanation: "Jet A1 must be free of water, particulates, and microbial contamination to ensure safe engine operation."
    },

    {
      id: "rfp18",
      question: "Which of the following are considered cold properties for Jet A1?",
      choices: ["Freezing point", "Pour point", "Cloud point", "Flash point"],
      correct: [0],
      explanation: "Jet A1 is specified by its freezing point, which must be below -47¬∞C to prevent fuel solidification at altitude."
    },

    {
      id: "rfp19",
      question: "Which of the following are typical sources of sulfur in refined products?",
      choices: ["Crude oil", "Additives", "Blending components", "Water"],
      correct: [0, 2],
      explanation: "Sulfur originates from crude oil and can be present in blending components. Additives and water are not sulfur sources."
    },

    {
      id: "rfp20",
      question: "Which of the following are used to characterize the volatility of diesel?",
      choices: ["ASTM distillation curve", "Reid Vapor Pressure", "Flash point", "Cloud point"],
      correct: [0, 2],
      explanation: "Diesel volatility is assessed using ASTM distillation and flash point. RVP is more relevant for gasoline."
    },

    {
      id: "rfp21",
      question: "Which of the following are considered environmental constraints for gasoline formulation?",
      choices: ["Aromatics content", "Benzene content", "Sulfur content", "Cetane number"],
      correct: [0, 1, 2],
      explanation: "Gasoline must meet strict limits on aromatics, benzene, and sulfur to reduce emissions. Cetane is not applicable."
    },

    {
      id: "rfp22",
      question: "Which of the following are typical Jet A1 additives?",
      choices: ["Anti-icing additive", "Static dissipator", "Lubricity improver", "Cetane booster"],
      correct: [0, 1, 2],
      explanation: "Jet A1 may include anti-icing agents, static dissipators, and lubricity improvers. Cetane boosters are for diesel."
    },

    {
      id: "rfp23",
      question: "Which of the following are typical properties of fuel oil?",
      choices: ["High viscosity", "High sulfur content", "Low flash point", "High volatility"],
      correct: [0, 1],
      explanation: "Fuel oil is a heavy product with high viscosity and sulfur content. It has low volatility and a relatively high flash point."
    },

    {
      id: "rfp24",
      question: "Which of the following are reasons for desulfurizing diesel?",
      choices: ["Reduce SOx emissions", "Improve engine performance", "Meet environmental regulations", "Increase octane number"],
      correct: [0, 1, 2],
      explanation: "Desulfurization reduces sulfur oxide emissions, improves engine durability, and ensures compliance with environmental standards."
    },

    {
      id: "rfp25",
      question: "Which of the following are typical Jet A1 quality tests?",
      choices: ["JFTOT thermal stability", "MSEP water separation", "Cetane index", "Gum content"],
      correct: [0, 1, 3],
      explanation: "Jet A1 is tested for thermal stability (JFTOT), water separation (MSEP), and gum content to ensure fuel cleanliness and performance."
    },
	
{
  id: "rfp26",
  question: "Which of the following are typical cold flow properties used to evaluate diesel fuel performance in winter conditions?",
  choices: ["Cloud point", "Pour point", "Freezing point", "Flash point"],
  correct: [0, 1],
  explanation: "Cloud point and pour point are key indicators of diesel's cold flow behaviour, as they reflect wax formation and flowability at low temperatures."
},
{
  id: "rfp27",
  question: "What is the minimum flash point required for Jet A1 fuel?",
  choices: ["30¬∞C", "38¬∞C", "47¬∞C", "55¬∞C"],
  correct: 1,
  explanation: "Jet A1 must have a minimum flash point of 38¬∞C to ensure safety during handling and storage, limiting the presence of light, volatile compounds."
},
{
  id: "rfp28",
  question: "Which of the following are considered environmental pollutants in gasoline composition?",
  choices: ["Benzene", "Aromatics", "Olefins", "Paraffins"],
  correct: [0, 1, 2],
  explanation: "Benzene, aromatics, and olefins contribute to harmful emissions and are regulated in gasoline formulations to reduce environmental impact."
},
{
  id: "rfp29",
  question: "Which of the following are typical additives used in Jet A1 fuel?",
  choices: ["Anti-icing agents", "Cetane improvers", "Static dissipators", "Lubricity enhancers"],
  correct: [0, 2, 3],
  explanation: "Jet A1 may include anti-icing additives, static dissipators, and lubricity enhancers to ensure safe and efficient engine performance."
},
{
  id: "rfp30",
  question: "Which of the following are typical specifications for diesel fuel?",
  choices: ["Cetane number", "Sulfur content", "Octane number", "Cloud point"],
  correct: [0, 1, 3],
  explanation: "Diesel fuel is characterised by its cetane number, sulfur content, and cold flow properties like cloud point. Octane number is not relevant for diesel."
},
{
  id: "rfp31",
  question: "Which of the following are considered heavy petroleum products?",
  choices: ["Fuel oil", "Diesel", "Jet A1", "Gasoline"],
  correct: 0,
  explanation: "Fuel oil is a heavy petroleum product with high viscosity and boiling point, unlike gasoline, diesel, and Jet A1 which are lighter fractions."
},
{
  id: "rfp32",
  question: "What is the typical sulfur content limit for ultra-low sulfur diesel (ULSD) in Europe?",
  choices: ["500 ppm", "350 ppm", "50 ppm", "10 ppm"],
  correct: 3,
  explanation: "ULSD in Europe must meet a maximum sulfur content of 10 ppm to comply with stringent environmental regulations."
},
{
  id: "rfp33",
  question: "Which of the following are considered key quality parameters for Jet A1?",
  choices: ["Freezing point", "Thermal stability", "Cetane number", "Water separation index"],
  correct: [0, 1, 3],
  explanation: "Jet A1 is evaluated based on freezing point, thermal stability (JFTOT), and water separation (MSEP). Cetane number is not applicable."
},
{
  id: "rfp34",
  question: "Which of the following are typical sources of contamination in refined products?",
  choices: ["Water", "Particulates", "Microbial growth", "Sulfur"],
  correct: [0, 1, 2],
  explanation: "Water, particulates, and microbial growth are common contaminants that can affect fuel quality and performance."
},
{
  id: "rfp35",
  question: "Which of the following are typical blending constraints for diesel fuel?",
  choices: ["Cetane number", "Sulfur content", "Cloud point", "Octane number"],
  correct: [0, 1, 2],
  explanation: "Diesel blending must meet cetane, sulfur, and cold flow specifications. Octane number is not relevant for diesel."
},
{
  id: "rfp36",
  question: "Which of the following are considered clean products in the refining industry?",
  choices: ["Gasoline", "Jet A1", "Diesel", "Fuel oil"],
  correct: [0, 1, 2],
  explanation: "Gasoline, Jet A1, and diesel are clean products due to their low contamination and high-quality standards. Fuel oil is a dirty product."
},
{
  id: "rfp37",
  question: "Which of the following are typical Jet A1 fuel quality tests?",
  choices: ["JFTOT", "MSEP", "Cetane index", "Gum content"],
  correct: [0, 1, 3],
  explanation: "Jet A1 is tested for thermal stability (JFTOT), water separation (MSEP), and gum content to ensure performance and safety."
},
{
  id: "rfp38",
  question: "Which of the following are typical characteristics of fuel oil?",
  choices: ["High viscosity", "High sulfur content", "Low flash point", "High volatility"],
  correct: [0, 1],
  explanation: "Fuel oil is a heavy product with high viscosity and sulfur content. It has low volatility and a relatively high flash point."
},
{
  id: "rfp39",
  question: "Which of the following are used to improve the cold flow properties of diesel?",
  choices: ["Pour point depressants", "Cloud point enhancers", "Cetane improvers", "Anti-icing agents"],
  correct: 0,
  explanation: "Pour point depressants are used to lower the temperature at which diesel begins to gel, improving cold flow performance."
},
{
  id: "rfp40",
  question: "Which of the following are typical Jet A1 contaminants to be avoided?",
  choices: ["Water", "Particulates", "Microbial growth", "Aromatics"],
  correct: [0, 1, 2],
  explanation: "Jet A1 must be free of water, particulates, and microbial growth to prevent engine issues and ensure safety."
},
{
  id: "rfp41",
  question: "Which of the following are considered aromatic hydrocarbons?",
  choices: ["Benzene", "Toluene", "Xylene", "Hexane"],
  correct: [0, 1, 2],
  explanation: "Benzene, toluene, and xylene are aromatic hydrocarbons with ring structures, commonly found in gasoline."
},
{
  id: "rfp42",
  question: "Which of the following are typical blending components for gasoline?",
  choices: ["Reformate", "Isomerate", "MTBE", "Cetane improver"],
  correct: [0, 1, 2],
  explanation: "Reformate, isomerate, and MTBE are used to enhance octane in gasoline. Cetane improvers are for diesel."
},
{
  id: "rfp43",
  question: "Which of the following are typical Jet A1 fuel properties?",
  choices: ["Freezing point", "Flash point", "Octane number", "Thermal stability"],
  correct: [0, 1, 3],
  explanation: "Jet A1 is characterised by its freezing point, flash point, and thermal stability. Octane number is not relevant."
},
{
  id: "rfp44",
  question: "Which of the following are used to improve gasoline octane number?",
  choices: ["Aromatics", "Olefins", "Paraffins", "MTBE"],
  correct: [0, 1, 3],
  explanation: "Aromatics, olefins, and MTBE increase octane number. Paraffins have lower octane values."
},
{
  id: "rfp45",
  question: "Which of the following are typical Jet A1 fuel specifications?",
  choices: ["Freezing point ‚â§ -47¬∞C", "Flash point ‚â• 38¬∞C", "Cetane number ‚â• 51", "Thermal stability (JFTOT)"],
  correct: [0, 1, 3],
  explanation: "Jet A1 must meet freezing point, flash point, and thermal stability requirements. Cetane number is for diesel."
},
{
  id: "rfp46",
  question: "Which of the following are typical diesel fuel cold flow specifications?",
  choices: ["Cloud point", "Pour point", "Freezing point", "Flash point"],
  correct: [0, 1],
  explanation: "Diesel cold flow properties are assessed using cloud and pour points. Freezing point is more relevant for Jet A1."
},
{
  id: "rfp47",
  question: "Which of the following are considered blending constraints for Jet A1?",
  choices: ["Sulfur content", "Freezing point", "Flash point", "Octane number"],
  correct: [0, 1, 2],
  explanation: "Jet A1 blending must meet sulfur, freezing point, and flash point limits. Octane number is not applicable."
},
{
  id: "rfp48",
  question: "Which of the following are typical Jet A1 additives?",
  choices: ["Anti-icing", "Static dissipator", "Cetane improver", "Lubricity enhancer"],
  correct: [0, 1, 3],
  explanation: "Jet A1 may include anti-icing agents, static dissipators, and lubricity enhancers. Cetane improvers are for diesel."
},
{
  id: "rfp49",
  question: "Which of the following are considered clean fuels?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel oil"],
  correct: [0, 1, 2],
  explanation: "Gasoline, diesel, and Jet A1 are clean fuels due to their low contamination and high-quality standards."
},
{
  id: "rfp50",
  question: "Which of the following are used to assess the volatility of gasoline?",
  choices: ["Reid Vapor Pressure", "ASTM distillation curve", "Flash point", "Pour point"],
  correct: [0, 1],
  explanation: "Gasoline volatility is assessed using Reid Vapor Pressure and ASTM distillation data. Flash and pour points are less relevant."
}

  ]
},
  
  trading_market: { 
    title: "Trading & Market Fundamentals", 

questions: [
  {
    id: "lex1",
    question: "What does 'backwardation' mean in oil markets?",
    choices: [
      "Spot price is lower than future price",
      "Future and spot price are equal",
      "Spot price is higher than future price",
      "Refining margin is negative"
    ],
    correct: 2,
    explanation: "Backwardation means near-term prices are higher than longer-dated futures, usually due to tight prompt supply."
  },
  {
    id: "lex2",
    question: "What does 'contango' mean in crude trading?",
    choices: [
      "Spot prices are higher than future prices",
      "It describes price volatility",
      "It‚Äôs a refining margin term",
      "Future prices are higher than spot prices"
    ],
    correct: 3,
    explanation: "Contango occurs when futures prices are above spot, often reflecting storage costs and abundant supply."
  },
  {
    id: "lex3",
    question: "A 'hedge' in trading refers to:",
    choices: [
      "A shipping cost",
      "A transaction to reduce risk exposure",
      "Speculating for profit",
      "A physical barrier in terminals"
    ],
    correct: 1,
    explanation: "Hedging is entering positions to offset price risks (e.g., buying crude futures to lock supply costs)."
  },
  {
    id: "lex4",
    question: "What is a 'crack spread'?",
    choices: [
      "Spread between diesel and gasoline only",
      "Difference between Brent and WTI",
      "Shipping differential between two ports",
      "Difference between crude and refined product prices"
    ],
    correct: 3,
    explanation: "A crack spread measures refinery margin: crude input price vs. value of refined outputs."
  },
  {
    id: "lex5",
    question: "What is a 'calendar spread' in futures trading?",
    choices: [
      "Arbitrage between two refineries",
      "Difference between Brent and Dubai",
      "Price difference between contracts of different maturities",
      "Difference in shipping costs between two routes"
    ],
    correct: 2,
    explanation: "Calendar spreads compare futures prices of the same commodity with different delivery months."
  },
  {
    id: "lex6",
    question: "What is a 'forward contract'?",
    choices: [
      "Spot market deal",
      "OTC agreement to buy/sell at future date and price",
      "Physical freight charter",
      "Standardized exchange-traded contract"
    ],
    correct: 1,
    explanation: "Forwards are OTC bilateral contracts fixing future price and delivery, unlike standardized futures."
  },
  {
    id: "lex7",
    question: "What is a 'future contract'?",
    choices: [
      "A standardized, exchange-traded contract",
      "A refinery maintenance plan",
      "An OTC agreement",
      "A pipeline tariff"
    ],
    correct: 0,
    explanation: "Futures are standardized contracts traded on exchanges, with margining and liquidity."
  },
  {
    id: "lex8",
    question: "What is the 'prompt month' contract?",
    choices: [
      "An option premium",
      "A physical crude delivery",
      "The nearest active futures month",
      "The farthest dated contract"
    ],
    correct: 2,
    explanation: "The prompt month is the nearest active maturity, often the reference for benchmarks."
  },
  {
    id: "lex9",
    question: "What does 'rollover' mean in futures trading?",
    choices: [
      "A margin call",
      "Switching from one maturity to the next",
      "Transferring crude between ships",
      "Physical rollover of barrels in tanks"
    ],
    correct: 1,
    explanation: "Rolling futures means closing a near-month position and opening a longer-dated one."
  },
  {
    id: "lex10",
    question: "What is 'basis risk'?",
    choices: [
      "Storage cost risk",
      "Currency exchange risk",
      "Risk of ship delay",
      "Risk that futures and physical prices do not move perfectly together"
    ],
    correct: 3,
    explanation: "Basis risk occurs when hedge instruments don‚Äôt perfectly track the physical exposure."
  },
  {
    id: "lex11",
    question: "What is 'PRA pricing' in oil markets?",
    choices: [
      "Pipeline regulated access",
      "Physical refinery allocation",
      "Port risk assessment",
      "Price assessed by Price Reporting Agencies"
    ],
    correct: 3,
    explanation: "PRA (Platts, Argus, etc.) provides benchmark assessments widely used in physical contracts."
  },
  {
    id: "lex12",
    question: "What does 'flat price' mean?",
    choices: [
      "The outright market price of a commodity",
      "Derivative spread",
      "Adjusted netback value",
      "Price difference between two grades"
    ],
    correct: 0,
    explanation: "Flat price is the outright market price (e.g., Brent $85/bbl)."
  },
  {
    id: "lex13",
    question: "What is a 'spread trade'?",
    choices: [
      "Export license mechanism",
      "Simultaneous buying and selling of related instruments",
      "Transport of crude via pipeline",
      "Storage hedging strategy"
    ],
    correct: 1,
    explanation: "Spread trading involves opposite positions in correlated contracts (e.g., Brent-WTI)."
  },
  {
    id: "lex14",
    question: "What is a 'swap' in oil trading?",
    choices: [
      "Pipeline tariff adjustment",
      "Physical cargo exchange",
      "An option premium",
      "Exchange of cash flows to manage risk"
    ],
    correct: 3,
    explanation: "Swaps are OTC derivatives exchanging fixed vs. floating prices, often used for hedging."
  },
  {
    id: "lex15",
    question: "What is 'mark-to-market' in trading?",
    choices: [
      "Updating book value of contracts to current market price",
      "Ship chartering contract",
      "Pipeline throughput monitoring",
      "Physical inventory valuation"
    ],
    correct: 0,
    explanation: "Mark-to-market adjusts the value of open positions to reflect daily prices."
  },
  {
    id: "lex16",
    question: "What is an 'ICE Brent contract'?",
    choices: [
      "An exchange-traded futures contract for Brent",
      "A swap agreement",
      "A shipping derivative",
      "A physical cargo deal"
    ],
    correct: 0,
    explanation: "ICE Brent is the global benchmark crude futures contract."
  },
  {
    id: "lex17",
    question: "What is 'Dated Brent'?",
    choices: [
      "A refinery marker",
      "An OTC swap",
      "A physical crude benchmark for North Sea loading",
      "A futures contract"
    ],
    correct: 2,
    explanation: "Dated Brent is the physical crude benchmark assessed by PRAs, basis for global pricing."
  },
  {
    id: "lex18",
    question: "What does 'netback' mean in trading?",
    choices: [
      "Pipeline tariff",
      "Delivered price at destination minus costs",
      "Charter rate of a tanker",
      "Storage margin"
    ],
    correct: 1,
    explanation: "Netback = product sales revenue minus transport, duties, and costs, showing refinery economics."
  },
  {
    id: "lex19",
    question: "What is 'arbitrage' in oil markets?",
    choices: [
      "Blending of two fuels",
      "Storage optimization",
      "Buying and selling simultaneously to capture price differentials",
      "Risk hedging"
    ],
    correct: 2,
    explanation: "Arbitrage exploits regional or product price differences, e.g. US Gulf vs. Europe."
  },
  {
    id: "lex20",
    question: "What is a 'time charter equivalent' (TCE)?",
    choices: [
      "Pipeline fee",
      "Storage rent",
      "Derivative swap",
      "Daily revenue measure for ships"
    ],
    correct: 3,
    explanation: "TCE is a normalized measure of daily ship earnings after voyage costs."
  },
  {
    id: "lex21",
    question: "What is a 'clean product tanker'?",
    choices: [
      "Ship designed for refined products (diesel, gasoline, jet)",
      "Ship carrying crude oil",
      "Tanker used for chemicals",
      "An LNG vessel"
    ],
    correct: 0,
    explanation: "Clean tankers carry refined petroleum products like diesel and gasoline."
  },
  {
    id: "lex22",
    question: "What does 'dirty tanker' refer to?",
    choices: [
      "Carrying crude or heavy fuel oil",
      "Tanker without cleaning",
      "Ballasted ship",
      "Old vessel"
    ],
    correct: 0,
    explanation: "Dirty tankers transport crude or residual fuels, as opposed to clean products."
  },
  {
    id: "lex23",
    question: "What is a 'demurrage' cost?",
    choices: [
      "Penalty for delayed loading/discharge beyond laytime",
      "Tanker fuel cost",
      "Pipeline fee",
      "Insurance premium"
    ],
    correct: 0,
    explanation: "Demurrage is charged when a vessel is delayed at port beyond agreed time."
  },
  {
    id: "lex24",
    question: "What is 'laycan' in shipping?",
    choices: [
      "Pipeline capacity",
      "Refinery shutdown plan",
      "Laydays and cancelling date for vessel arrival",
      "Trading option window"
    ],
    correct: 2,
    explanation: "Laycan defines the period during which a ship must present for loading."
  },
  {
    id: "lex25",
    question: "What is a 'VLCC'?",
    choices: [
      "Pipeline code",
      "Refinery unit",
      "Very Large Crude Carrier tanker",
      "Futures contract type"
    ],
    correct: 2,
    explanation: "VLCCs are massive crude tankers, typically carrying 2 million barrels."
  },
  {
    id: "lex26",
    question: "What is 'HSFO' in trading?",
    choices: [
      "High Sulfur Fuel Oil",
      "Heat Stable Fuel Output",
      "Hydrotreated Straight Fuel Oil",
      "Heavy Shipping Fuel Option"
    ],
    correct: 0,
    explanation: "HSFO is high sulfur fuel oil, used mainly for shipping pre-IMO 2020."
  },
  {
    id: "lex27",
    question: "What is 'ULSD'?",
    choices: [
      "Underground Line Storage Diesel",
      "Ultra-Low Sulfur Diesel",
      "Unleaded Super Diesel",
      "Utility Line Supply Diesel"
    ],
    correct: 1,
    explanation: "ULSD is a diesel grade with <15 ppm sulfur, the standard in US and Europe."
  },
  {
    id: "lex28",
    question: "What is 'IMO 2020'?",
    choices: [
      "Trading benchmark",
      "A new oil futures contract",
      "Refining technology",
      "Global sulfur cap regulation for shipping"
    ],
    correct: 3,
    explanation: "IMO 2020 reduced marine fuel sulfur limit to 0.5%, reshaping bunker and fuel markets."
  },
  {
    id: "lex29",
    question: "What is 'physical arbitrage'?",
    choices: [
      "Option premium strategy",
      "Storage optimization only",
      "Moving physical barrels to capture price differentials",
      "Derivative-only trading"
    ],
    correct: 2,
    explanation: "Physical arbitrage exploits geographical spreads by shipping oil between regions."
  },
  {
    id: "lex30",
    question: "What is a 'straddle option'?",
    choices: [
      "Blending option",
      "Options strategy buying call and put at same strike",
      "Shipping contract",
      "Pipeline swing contract"
    ],
    correct: 1,
    explanation: "Straddles profit from volatility, buying both call and put on the same strike/expiry."
  },
  {
    id: "lex31",
    question: "What is an 'option premium'?",
    choices: [
      "Freight cost",
      "Pipeline tariff",
      "The upfront cost paid to buy an option",
      "Storage fee"
    ],
    correct: 2,
    explanation: "The premium is the price paid for the right (not obligation) to buy/sell at a strike price."
  },
  {
    id: "lex32",
    question: "What is a 'long position'?",
    choices: [
      "A delayed cargo",
      "A wide crack spread",
      "Betting on falling prices",
      "Owning or being exposed to rising prices"
    ],
    correct: 3,
    explanation: "Being long means benefiting if prices increase (buy low, sell high)."
  },
  {
    id: "lex33",
    question: "What is a 'short position'?",
    choices: [
      "A forward hedge",
      "Pipeline bottleneck",
      "Owning physical barrels",
      "Betting on price decreases"
    ],
    correct: 3,
    explanation: "Short positions profit when prices decline (sell high, buy back lower)."
  },
  {
    id: "lex34",
    question: "What is 'margin call' in trading?",
    choices: [
      "Demurrage penalty",
      "Option expiration",
      "Pipeline delivery slot",
      "Request to post more collateral on losing positions"
    ],
    correct: 3,
    explanation: "Margin calls are requests from exchanges to top up funds when positions lose value."
  },
  {
    id: "lex35",
    question: "What is an 'ICE gasoil contract'?",
    choices: [
      "Pipeline allocation",
      "Physical diesel cargo",
      "European benchmark futures for diesel",
      "A swap agreement"
    ],
    correct: 2,
    explanation: "ICE gasoil is the main futures benchmark for European diesel/gasoil."
  },
  {
    id: "lex36",
    question: "What does 'outright' mean in trading?",
    choices: [
      "Flat price position without spreads",
      "Option premium",
      "Physical swap",
      "Blended barrel"
    ],
    correct: 0,
    explanation: "An outright is a single flat price exposure, not a spread or hedge."
  },
  {
    id: "lex37",
    question: "What is a 'barrel equivalent' (boe)?",
    choices: [
      "A tanker capacity",
      "Storage limit",
      "Refining output",
      "Energy equivalent measure for gas/oil"
    ],
    correct: 3,
    explanation: "BOE converts other energy units (gas, LNG) into crude oil equivalents."
  },
  {
    id: "lex38",
    question: "What is 'EFP' (Exchange for Physical)?",
    choices: [
      "Mechanism to swap futures for a physical cargo",
      "Freight premium",
      "Pipeline entry fee",
      "Energy finance protocol"
    ],
    correct: 0,
    explanation: "EFP allows counterparties to convert futures into a physical position."
  },
  {
    id: "lex39",
    question: "What is 'floating price contract'?",
    choices: [
      "Spot-only deal",
      "A fixed price forward",
      "Price linked to a benchmark index (Platts, Brent)",
      "Option derivative"
    ],
    correct: 2,
    explanation: "Floating price contracts are indexed to benchmarks, adjusted with differentials."
  },
  {
    id: "lex40",
    question: "What does 'differential' mean in trading?",
    choices: [
      "Pipeline fee",
      "Freight premium",
      "Currency hedge",
      "Adjustment vs. a benchmark to reflect quality or location"
    ],
    correct: 3,
    explanation: "Differentials adjust contracts vs. a benchmark to reflect crude/product quality or geography."
  },
  {
    id: "lex41",
    question: "What is 'WTI Midland'?",
    choices: [
      "A futures contract",
      "A refining process",
      "A tanker route",
      "A US crude grade from Permian Basin"
    ],
    correct: 3,
    explanation: "WTI Midland is a key Permian crude stream, priced against WTI benchmarks."
  },
  {
    id: "lex42",
    question: "What does 'ICE Clear' provide?",
    choices: [
      "Shipping routes",
      "Clearing and settlement for futures",
      "Refinery scheduling",
      "Pipeline operations"
    ],
    correct: 1,
    explanation: "ICE Clear provides risk management, margining, and settlement for exchange trades."
  },
  {
    id: "lex43",
    question: "What is 'position limit'?",
    choices: [
      "Maximum size of a position regulated by exchange",
      "Pipeline storage max",
      "Refinery output cap",
      "Cargo volume limit"
    ],
    correct: 0,
    explanation: "Position limits are regulatory caps on open positions to prevent market manipulation."
  },
  {
    id: "lex44",
    question: "What is 'volatility' in trading?",
    choices: [
      "Storage capacity",
      "Freight speed",
      "Pipeline flow rate",
      "Degree of price fluctuation over time"
    ],
    correct: 3,
    explanation: "Volatility measures how much and how fast prices change, key for risk and options pricing."
  },
  {
    id: "lex45",
    question: "What is a 'swaption'?",
    choices: [
      "Swap between two crudes",
      "Storage contract",
      "An option granting the right to enter a swap",
      "Shipping option"
    ],
    correct: 2,
    explanation: "A swaption gives the right, not obligation, to enter into a swap at a future date."
  },
  {
    id: "lex46",
    question: "What is 'backwardation' used for in trading strategy?",
    choices: [
      "Locking in low future prices",
      "Speculating on price declines",
      "Taking advantage of higher spot prices for immediate sales",
      "Avoiding storage costs"
    ],
    correct: 2,
    explanation: "Traders can sell prompt crude at higher prices than futures in backwardation."
  },
    {
      id: "lex47",
      question: "What is 'contango' used for in trading strategy?",
      choices: [
        "Immediate sale advantage",
        "Storage and carry trades",
        "Hedging refining margins",
        "Reducing shipping risk"
      ],
      correct: 1,
      explanation: "Contango enables storage-based strategies, buying spot and selling futures."
    },
    {
      id: "lex48",
      question: "What is a 'calendar spread' used for?",
      choices: [
        "Arbitrage between ports",
        "Trading difference between nearby and deferred futures",
        "Refining margin calculation",
        "Physical cargo hedging"
      ],
      correct: 1,
      explanation: "Calendar spreads exploit price differences between futures of different maturities."
    },
    {
      id: "lex49",
      question: "What is 'TCE' mainly used for?",
      choices: [
        "Option pricing",
        "Ship revenue comparison",
        "Storage optimization",
        "Futures margin calculation"
      ],
      correct: 1,
      explanation: "TCE normalizes vessel earnings across voyages for operational and financial comparison."
    },
    {
      id: "lex50",
      question: "What is 'netback' used for in trading?",
      choices: [
        "Calculating refinery profitability",
        "Determining shipping charter rates",
        "Setting storage fees",
        "Evaluating option premiums"
      ],
      correct: 0,
      explanation: "Netback measures revenue minus costs, key for assessing refinery economics."
    },
  ]
},


middle_ops: {
  title: "Middle for Ops",
  questions: [
    {
      id: "mops1",
      question: "What is a swap in the context of hedging?",
      choices: [
        "A contract exchanging cash flows based on floating and fixed prices",
        "A physical delivery contract",
        "A standardized exchange-traded contract",
        "A contract that fixes the price of a cargo"
      ],
      correct: [0],
      explanation: "A swap is a customizable contract where two parties exchange cash flows based on a commodity‚Äôs price. It converts floating price exposure into fixed price."
    },
    {
      id: "mops2",
      question: "What is the impact of a BL date change on a trader‚Äôs position?",
      choices: [
        "It may create a short position",
        "It has no impact",
        "It creates a long position",
        "It affects daily pricing"
      ],
      correct: [0,3],
      explanation: "Changing the BL date shifts the pricing start. If the trader already hedged, they may become short and need to buy back swaps."
    },
    {
      id: "mops3",
      question: "What is the role of the Middle Office in exposure monitoring?",
      choices: [
        "Calculating P&L",
        "Negotiating contracts",
        "Controlling positions",
        "Executing trades"
      ],
      correct: [0,2],
      explanation: "The Middle Office calculates P&L and monitors exposures after the deal is entered into Medissys."
    },
    {
      id: "mops4",
      question: "What does 'pricing in' mean?",
      choices: [
        "Hedging a physical purchase",
        "Hedging a physical sale",
        "Creating a long position",
        "Creating a short position"
      ],
      correct: [0,3],
      explanation: "Pricing in refers to a physical purchase with floating pricing, creating a short position. The hedge is a paper sale."
    },
    {
      id: "mops5",
      question: "What is the impact of a quantity reduction on the trader‚Äôs position?",
      choices: [
        "Creates a short position",
        "Creates a long position",
        "No impact if pricing hasn‚Äôt started",
        "Immediate gain"
      ],
      correct: [0,2],
      explanation: "If pricing has started, reducing quantity creates a short position because the trader has over-hedged."
    },
    {
      id: "mops6",
      question: "What is the purpose of a derivative in hedging?",
      choices: [
        "Eliminate price risk exposure",
        "Create a physical position",
        "Increase volatility",
        "Fix the price of a contract"
      ],
      correct: [0],
      explanation: "Derivatives eliminate price risk by creating a paper position opposite to the physical one."
    },
    {
      id: "mops7",
      question: "What does 'pricing out' refer to?",
      choices: [
        "Hedging a physical sale",
        "Creating a long position",
        "Creating a short position",
        "Buying paper"
      ],
      correct: [0,1,3],
      explanation: "Pricing out refers to a physical sale with floating pricing, creating a long position. The hedge is a paper purchase."
    },
    {
      id: "mops8",
      question: "How is PnL calculated when the BL date changes?",
      choices: [
        "Excess hedged quantity √ó price difference",
        "Total quantity √ó fixed price",
        "Unloaded quantity √ó floating price",
        "Sold quantity √ó average price"
      ],
      correct: [0],
      explanation: "PnL is calculated by multiplying the excess hedged quantity by the difference between average quote and balmo swap price."
    },
    {
      id: "mops9",
      question: "What is a contango market?",
      choices: [
        "Future prices are higher than prompt prices",
        "Prompt prices are higher than future prices",
        "Positive spreads",
        "Negative spreads"
      ],
      correct: [0,3],
      explanation: "Contango means future prices exceed prompt prices, resulting in negative time spreads."
    },
    {
      id: "mops10",
      question: "What is the role of Mark-to-Market (MTM)?",
      choices: [
        "Estimate value of unpriced deals",
        "Fix the final price",
        "Determine physical volume",
        "Calculate storage costs"
      ],
      correct: [0],
      explanation: "MTM estimates the future value of a deal, helping anticipate exposure and PnL."
    },
    {
      id: "mops11",
      question: "What is the main risk covered by hedging?",
      choices: [
        "Price risk",
        "Credit risk",
        "Operational risk",
        "Delivery risk"
      ],
      correct: [0],
      explanation: "Hedging primarily addresses price risk from market fluctuations."
    },
    {
      id: "mops12",
      question: "What does it mean to be 'long' on a spread?",
      choices: [
        "Long first leg, short second leg",
        "Short first leg, long second leg",
        "Long both legs",
        "Short both legs"
      ],
      correct: [0],
      explanation: "Being long on a spread means long on the first leg and short on the second."
    },
    {
      id: "mops13",
      question: "What is the impact of floating price on trader‚Äôs position?",
      choices: [
        "Creates price exposure",
        "Fixes price at deal signature",
        "Eliminates risk",
        "Creates physical position"
      ],
      correct: [0],
      explanation: "Floating prices are unknown at deal time, creating exposure."
    },
    {
      id: "mops14",
      question: "What is the Middle Office‚Äôs role in hedging exercises?",
      choices: [
        "Exposure monitoring",
        "PnL calculation",
        "Quote validation",
        "Swap execution"
      ],
      correct: [0,1],
      explanation: "Middle Office monitors exposure and calculates PnL when operational changes occur."
    },
    {
      id: "mops15",
      question: "What results from buying physical at fixed price and selling at floating?",
      choices: [
        "Long position",
        "Short position",
        "No exposure",
        "Guaranteed gain"
      ],
      correct: [0],
      explanation: "This setup creates a long position, benefiting from rising market prices."
    },
    {
      id: "mops16",
      question: "What is the role of a future in hedging?",
      choices: [
        "Standardized exchange-traded contract",
        "Customized bilateral contract",
        "Physical contract",
        "Deferred delivery contract"
      ],
      correct: [0],
      explanation: "Futures are standardized contracts traded on exchanges, used for hedging."
    },
    {
      id: "mops17",
      question: "What does it mean to be 'short' on a swap?",
      choices: [
        "Sell fixed price, buy floating price",
        "Buy fixed price, sell floating price",
        "Sell both legs",
        "Buy both legs"
      ],
      correct: [0],
      explanation: "Being short on a swap means selling the fixed leg and buying the floating leg."
    },
    {
      id: "mops18",
      question: "How does quantity change affect PnL?",
      choices: [
        "PnL = excess quantity √ó price difference",
        "PnL = total quantity √ó fixed price",
        "No impact",
        "Automatic gain"
      ],
      correct: [0],
      explanation: "PnL is calculated based on excess hedged quantity and price difference."
    },
    {
      id: "mops19",
      question: "What is the role of the balmo swap in PnL calculation?",
      choices: [
        "Buy-back price of the hedge",
        "Initial sale price",
        "Average quote price",
        "Physical cargo price"
      ],
      correct: [0],
      explanation: "Balmo swap is the market price used to buy back excess hedge and calculate PnL."
    },
    {
      id: "mops20",
      question: "What is the link between pricing and hedging?",
      choices: [
        "Pricing triggers hedging",
        "Hedging precedes pricing",
        "Pricing determines PnL",
        "Hedging removes pricing"
      ],
      correct: [1],
      explanation: "Hedging is often done before pricing starts to cover exposure."
    },
    {
      id: "mops21",
      question: "What is the 'floating leg' in a swap?",
      choices: [
        "Part linked to variable price",
        "Part linked to fixed price",
        "Part linked to delivery",
        "Part linked to volume"
      ],
      correct: [0],
      explanation: "The floating leg is based on market quotes and varies daily."
    },
    {
      id: "mops22",
      question: "What is the Middle Office‚Äôs role in quote monitoring?",
      choices: [
        "Validate pricing periods",
        "Calculate averages",
        "Check date errors",
        "Execute trades"
      ],
      correct: [0,2],
      explanation: "Middle Office validates pricing periods and checks for errors like incorrect BL dates."
    },
    {
      id: "mops23",
      question: "What happens to a short position in a rising market?",
      choices: [
        "Potential loss",
        "Potential gain",
        "No impact",
        "Neutral position"
      ],
      correct: [0],
      explanation: "Short positions lose value when market prices rise."
    },
    {
      id: "mops24",
      question: "What happens to a long position in a rising market?",
      choices: [
        "Potential gain",
        "Potential loss",
        "No impact",
        "Neutral position"
      ],
      correct: [0],
      explanation: "Long positions gain value when market prices rise."
    },
    {
      id: "mops25",
      question: "What is the Middle Office‚Äôs role in PnL calculation?",
      choices: [
        "Compare hedged and market prices",
        "Execute trades",
        "Validate volumes",
        "Negotiate contracts"
      ],
      correct: [0],
      explanation: "Middle Office compares hedged prices with market prices to calculate PnL."
    },
	
    {
      id: "mops26",
      question: "What does a 'long position' mean in trading?",
      choices: [
        "Profit when market rises",
        "Loss when market rises",
        "Profit when market falls",
        "No exposure"
      ],
      correct: [0],
      explanation: "A trader with a long position gains when the market rises and loses when it falls."
    },
    {
      id: "mops27",
      question: "What is the trader‚Äôs position when selling a floating price cargo without a physical purchase?",
      choices: [
        "No exposure until pricing starts",
        "Short position",
        "Long position",
        "Immediate exposure"
      ],
      correct: [0],
      explanation: "If pricing hasn‚Äôt started and no physical cargo is linked, there is no exposure yet."
    },
    {
      id: "mops28",
      question: "What is the trader‚Äôs position when selling gasoline from storage with M+1 pricing?",
      choices: [
        "Short the M/M+1 spread",
        "Long the M/M+1 spread",
        "No exposure",
        "Flat position"
      ],
      correct: [0],
      explanation: "Selling from storage with M+1 pricing creates a short position on the M/M+1 spread."
    },
    {
      id: "mops29",
      question: "What is the impact of moving the BL date forward after pricing has started?",
      choices: [
        "Creates a short position",
        "Creates a long position",
        "No impact",
        "Fixes the price"
      ],
      correct: [0],
      explanation: "If pricing has started, moving the BL date forward means the trader has over-hedged and is short."
    },
    {
      id: "mops30",
      question: "How is the PnL calculated when the trader is short due to BL date change?",
      choices: [
        "Excess quantity √ó price difference",
        "Total quantity √ó fixed price",
        "Unhedged quantity √ó market price",
        "No PnL impact"
      ],
      correct: [0],
      explanation: "PnL is calculated by multiplying the excess hedged quantity by the difference between quote average and balmo swap."
    },
    {
      id: "mops31",
      question: "What does 'pricing in' refer to?",
      choices: [
        "Physical purchase with floating price",
        "Physical sale with floating price",
        "Fixed price purchase",
        "No exposure"
      ],
      correct: [0],
      explanation: "Pricing in refers to a physical purchase with floating pricing, creating a short position."
    },
    {
      id: "mops32",
      question: "What is the hedge associated with 'pricing in'?",
      choices: [
        "Sale of paper",
        "Purchase of paper",
        "No hedge",
        "Physical sale"
      ],
      correct: [0],
      explanation: "Pricing in creates a short position, which is hedged by selling paper."
    },
    {
      id: "mops33",
      question: "What does 'pricing out' refer to?",
      choices: [
        "Physical sale with floating price",
        "Physical purchase with fixed price",
        "No exposure",
        "Physical sale with fixed price"
      ],
      correct: [0],
      explanation: "Pricing out refers to a physical sale with floating pricing, creating a long position."
    },
    {
      id: "mops34",
      question: "What is the hedge associated with 'pricing out'?",
      choices: [
        "Purchase of paper",
        "Sale of paper",
        "No hedge",
        "Physical purchase"
      ],
      correct: [0],
      explanation: "Pricing out creates a long position, which is hedged by buying paper."
    },
    {
      id: "mops35",
      question: "What is a swap composed of?",
      choices: [
        "Fixed leg and floating leg",
        "Physical and paper leg",
        "Long and short leg",
        "Forward and backward leg"
      ],
      correct: [0],
      explanation: "A swap has two legs: one fixed and one floating."
    },
    {
      id: "mops36",
      question: "What does selling a swap mean?",
      choices: [
        "Sell fixed price, buy floating price",
        "Buy fixed price, sell floating price",
        "Sell both legs",
        "Buy both legs"
      ],
      correct: [0],
      explanation: "Selling a swap means selling the fixed leg and buying the floating leg."
    },
    {
      id: "mops37",
      question: "What is the trader‚Äôs position when buying fixed and selling floating?",
      choices: [
        "Long position",
        "Short position",
        "Neutral position",
        "No exposure"
      ],
      correct: [0],
      explanation: "Buying fixed and selling floating creates a long position."
    },
    {
      id: "mops38",
      question: "What is the trader‚Äôs position when selling fixed and buying floating?",
      choices: [
        "Short position",
        "Long position",
        "Neutral position",
        "No exposure"
      ],
      correct: [0],
      explanation: "Selling fixed and buying floating creates a short position."
    },
    {
      id: "mops39",
      question: "What is the role of the OTC market?",
      choices: [
        "Trading swaps and options",
        "Physical delivery",
        "No credit risk",
        "High liquidity"
      ],
      correct: [0],
      explanation: "The OTC market is used for trading swaps, options, and structured products."
    },
    {
      id: "mops40",
      question: "What is the role of brokers in the OTC market?",
      choices: [
        "Facilitate trades",
        "Execute physical delivery",
        "Settle contracts",
        "Eliminate credit risk"
      ],
      correct: [0],
      explanation: "Brokers play a key role in facilitating OTC trades."
    },
    {
      id: "mops41",
      question: "What is the difference between futures and swaps?",
      choices: [
        "Futures are exchange-traded, swaps are OTC",
        "Swaps are physical, futures are paper",
        "Futures are bilateral, swaps are standardized",
        "Swaps are more liquid"
      ],
      correct: [0],
      explanation: "Futures are traded on exchanges, while swaps are OTC contracts."
    },
    {
      id: "mops42",
      question: "What is a time-spread?",
      choices: [
        "Price difference between two maturities",
        "Price difference between two products",
        "Price difference between two locations",
        "Price difference between two grades"
      ],
      correct: [0],
      explanation: "A time-spread is the price difference between different maturities."
    },
    {
      id: "mops43",
      question: "What does 'contango' mean?",
      choices: [
        "Future prices are higher than prompt prices",
        "Prompt prices are higher than future prices",
        "Prices are flat",
        "Market is illiquid"
      ],
      correct: [0],
      explanation: "Contango is when future prices exceed prompt prices."
    },
    {
      id: "mops44",
      question: "What does 'backwardation' mean?",
      choices: [
        "Prompt prices are higher than future prices",
        "Future prices are higher than prompt prices",
        "Prices are flat",
        "Market is illiquid"
      ],
      correct: [0],
      explanation: "Backwardation is when prompt prices exceed future prices."
    },
    {
      id: "mops45",
      question: "What is a crack spread?",
      choices: [
        "Difference between product and crude",
        "Difference between two maturities",
        "Difference between two locations",
        "Difference between two grades"
      ],
      correct: [0],
      explanation: "A crack spread is the relative value of a product compared to crude."
    },
    {
      id: "mops46",
      question: "What is the trader‚Äôs position when selling a cargo with M+1 pricing?",
      choices: [
        "Long position",
        "Short position",
        "Neutral position",
        "No exposure"
      ],
      correct: [0],
      explanation: "Selling with M+1 pricing creates a long position."
    },
    {
      id: "mops47",
      question: "What is the trader‚Äôs position when buying a cargo with M+1 pricing?",
      choices: [
        "Short position",
        "Long position",
        "Neutral position",
        "No exposure"
      ],
      correct: [0],
      explanation: "Buying with M+1 pricing creates a short position."
    },
    {
      id: "mops48",
      question: "What is the role of the clearing house in futures trading?",
      choices: [
        "Manage credit risk",
        "Execute trades",
        "Settle physical cargo",
        "Provide quotes"
      ],
      correct: [0],
      explanation: "Clearing houses manage credit risk through margin calls."
    },
    {
      id: "mops49",
      question: "What is the final settlement in futures?",
      choices: [
        "Monthly expiry",
        "Daily quote",
        "Physical delivery",
        "No settlement"
      ],
      correct: [0],
      explanation: "Final settlement refers to the monthly expiry of futures contracts."
    },
    {
      id: "mops50",
      question: "What is the daily settlement in futures?",
      choices: [
        "Minute marker average",
        "End-of-day quote",
        "Opening price",
        "Weekly average"
      ],
      correct: [0],
      explanation: "Daily settlement is calculated using a minute marker average."
    }
  ]
},




 pricing: {
  title: "Pricing Strategies & Exposures",
  questions: [
    {
      id: "p1",
      question: "You buy a Gasoil cargo CIF NWE indexed to ICE Gasoil M-1 + $5/MT. Delivery is delayed to M. What is your exposure?",
      choices: [
        "Short exposure to the time spread M vs M-1",
        "No exposure",
        "Long exposure to the time spread M vs M-1",
        "You gain $5/MT extra"
      ],
      correct: 0,
      explanation: "Changing delivery from M-1 to M alters the pricing period, creating exposure to the time spread."
    },
    {
      id: "p2",
      question: "You hedge a Jet CIF NWE sale with ICE Gasoil futures. What residual risk remains?",
      choices: [
        "Freight exposure CIF vs FOB",
        "No risk",
        "Basis risk Jet CIF NWE vs ICE Gasoil",
        "Time Spread risk"
      ],
      correct: 2,
      explanation: "Jet CIF and ICE Gasoil are correlated but not identical‚Äîbasis risk remains."
    },
    {
      id: "p3",
      question: "You buy a Brent crude cargo and hedge with ICE Brent futures. What type of risk remains?",
      choices: [
        "Quality risk",
        "None, perfect hedge",
        "Basis and timing spread risk",
        "Flat price risk"
      ],
      correct: 2,
      explanation: "ICE Brent and Dated Brent differ slightly, leaving a basis and timing spread exposure."
    },
    {
      id: "p4",
      question: "You sell a Jet FOB ARA cargo indexed to CIF NWE. What is your main risk?",
      choices: [
        "Flat price risk",
        "Freight exposure ARA‚ÄìNWE",
        "No risk",
        "Time Spread risk"
      ],
      correct: 1,
      explanation: "Using a CIF index for an FOB sale introduces freight exposure."
    },
    {
      id: "p5",
      question: "A trader buys Gasoil FOB ARA and sells CIF Med. What new exposure is introduced?",
      choices: [
        "Long Freight ARA‚ÄìMed",
        "Short Freight ARA‚ÄìMed",
        "Quality differential",
        "Flat price risk"
      ],
      correct: 1,
      explanation: "Switching from FOB to CIF adds freight exposure on the shipping route and exposes you to higher freight cost"
    },
    {
      id: "p6",
      question: "A Jet CIF NWE sale is hedged using Gasoil swaps. What is the main residual risk?",
      choices: [
        "Physical vs Paper risk",
        "Freight risk",
        "Basis risk Jet vs Gasoil",
        "No risk"
      ],
      correct: 2,
      explanation: "Jet and Gasoil are correlated but distinct products‚Äîbasis risk remains."
    },
    {
      id: "p7",
      question: "You pre-hedged 100 kb Brent futures for a crude cargo that gets canceled. What happens?",
      choices: [
        "You are long paper Brent",
        "You are short paper Brent",
        "You are flat",
        "No effect"
      ],
      correct: 0,
      explanation: "Without physical barrels, your futures hedge becomes a speculative long."
    },
    {
      id: "p8",
      question: "You hedge a physical Jet sale in EUR with a futures contract quoted in USD. What exposure arises?",
      choices: [
        "None",
        "Basis risk",
        "Flat price risk",
        "FX risk EUR/USD"
      ],
      correct: 3,
      explanation: "Currency mismatch between physical and hedge introduces FX exposure."
    },
    {
      id: "p9",
      question: "A cargo is fixed price 'Brent Dated + $2/bbl'. Market rises $3/bbl before delivery. If unhedged, what happens to the seller?",
      choices: [
        "Seller loses $3/bbl",
        "Seller gains $3/bbl",
        "Buyer loses $3/bbl",
        "No effect until invoice"
      ],
      correct: 0,
      explanation: "Seller fixed the price, so any further rise means a loss versus market."
    },
    {
      id: "p10",
      question: "A trader buys Jet CIF NWE for M+1 and sells M+2. What type of exposure is this?",
      choices: [
        "Short Time Spread",
        "Long Time Spread",
        "Flat price exposure",
        "No exposure"
      ],
      correct: 0,
      explanation: "Buying and selling different months creates a calendar time spread position."
    },
    {
      id: "p11",
      question: "You sell a Gasoil term 100 kb/month pricing cal M+1 but only deliver 80 kb. What‚Äôs your hedge situation?",
      choices: [
        "Under-hedged 20 kb, I'm long",
        "Under-hedged 20 kb, I'm short",
        "Over-hedged 20 kb, I'm long",
        "Over-hedged 20 kb, I'm short"
      ],
      correct: 3,
      explanation: "If you hedged for 100 kb and only deliver 80 kb, you remain short paper 20 kb."
    },
    {
      id: "p12",
      question: "A Gasoil cargo priced vs Platts CIF Med is hedged using ICE Gasoil. What‚Äôs your risk?",
      choices: [
        "Flat price risk",
        "Freight risk only",
        "No risk",
        "Basis risk between Med and NWE"
      ],
      correct: 3,
      explanation: "Different regional pricing creates basis risk (Med vs NWE)."
    },
    {
      id: "p13",
      question: "You‚Äôre short Jet CIF NWE swaps and prices fall. What happens to your P&L?",
      choices: [
        "You lose",
        "It depends on physical position",
        "No impact",
        "You gain"
      ],
      correct: 3,
      explanation: "Short swaps benefit when prices fall."
    },
    {
      id: "p14",
      question: "A trader buys Fuel Oil FOB Singapore but hedges with Gasoil futures. What is the residual risk?",
      choices: [
        "Flat price risk",
        "Freight risk",
        "None",
        "Basis risk"
      ],
      correct: 3,
      explanation: "Fuel Oil and Gasoil have different fundamentals ‚Äî basis risk remains."
    },
    {
      id: "p15",
      question: "You're long Gasoil swaps M. And you've bought a physical cargo pricing on M+1. How to neutralize the exposure?",
      choices: [
        "Buy M vs M+1 Gasoil spread",
        "Sell M Gasoil swaps",
        "Sell M vs M+1 Gasoil spread",
        "Buy M Gasoil swaps"
      ],
      correct: 2,
      explanation: "You're long M and short M+1. Adding a time spread M vs M+1 hedge offsets the mismatch."
    },
    {
      id: "p16",
      question: "You are long Gasoil CIF Med and short Jet CIF NWE. What type of trade is this?",
      choices: [
        "Flat price",
        "Inter-product spread",
        "Time spread",
        "Arb trade"
      ],
      correct: [1,3],
      explanation: "It‚Äôs an inter-product spread between Gasoil and Jet."
    },
    {
      id: "p17",
      question: "You hedge a physical in EUR using ICE Gasoil in USD. Market stable, EUR/USD falls. What happens?",
      choices: [
        "FX loss on hedge",
        "No effect",
        "FX gain on hedge",
        "Price risk appears"
      ],
      correct: 0,
      explanation: "USD strengthens, so hedge loses in EUR terms."
    },
    {
      id: "p18",
      question: "You‚Äôre long physical Jet and short futures. Prices rise sharply. What‚Äôs your net effect?",
      choices: [
        "Gain both sides",
        "Gain on physical, loss on futures ‚Üí roughly neutral",
        "Loss both sides",
        "Loss on physical, gain on futures"
      ],
      correct: 1,
      explanation: "Proper hedge neutralizes price movement."
    },
    {
      id: "p19",
      question: "You buy Crude cargo pricing CIF Med and sell it pricing FOB NWE. What exposure appears?",
      choices: [
        "Time spread",
        "None",
        "Freight Med‚ÄìNWE",
        "Arb decision"
      ],
      correct: 2,
      explanation: "Switching from CIF to FOB creates freight exposure."
    },
    {
      id: "p20",
      question: "A Gasoil cargo is priced vs M average. Market backwardates strongly. When to sell if you‚Äôre long?",
      choices: [
        "As early as possible",
        "As late as possible",
        "It doesn‚Äôt matter",
        "Mid-month"
      ],
      correct: 0,
      explanation: "In backwardation, earlier sale avoids losing value as prices fall into delivery."
    },
    {
      id: "p21",
      question: "A Jet CIF Med cargo is sold at fixed price. Market prices rise. If unhedged, what happens?",
      choices: [
        "Gain for the seller",
        "Freight loss",
        "Loss for the seller",
        "No change"
      ],
      correct: 2,
      explanation: "Selling against a rising price means the seller loses as he already fixed the price."
    },
    {
      id: "p22",
      question: "A refiner sells Gasoil term barrels indexed to ICE Gasoil. How can it hedge exposure?",
      choices: [
        "Buy Crack Spread",
        "Sell ICE Gasoil futures",
        "Buy ICE Gasoil futures",
        "No hedge needed"
      ],
      correct: 1,
      explanation: "Selling physical means you short paper to lock in margin."
    },
    {
      id: "p23",
      question: "You buy a cargo of 700,000 bbls of Crude oil pricing 5 After B/L. What's your daily pricing?",
      choices: [
        "+ 140kbbls every day",
        "- 140kbbls every day",
        "No daily pricing because you hedged the cargo.",
        "700,000 bbls every day."
      ],
      correct: 1,
      explanation: "Buying a cargo floating price means your are exposed to prices decreasing. Therefore you are short. 700 / 5 = 140. So short 140kbbls over 5 days."
    },
    {
      id: "p24",
      question: "You are long Brent futures but prices drop $2/bbl. What happens?",
      choices: [
        "Margin credit increases",
        "Gain $2/bbl",
        "No effect",
        "Lose $2/bbl"
      ],
      correct: 3,
      explanation: "Long futures lose when prices fall."
    },
    {
      id: "p25",
      question: "You sell Jet CIF NWE swaps for M, but physical sale is M+1. How to hedge properly?",
      choices: [
        "Buy M vs M+1 Jet spread",
        "Sell M Jet swaps",
        "Sell M vs M+1 Jet spread",
        "Buy M Jet swaps"
      ],
      correct: 0,
      explanation: "A time spread hedge balances the pricing period mismatch."
    },
	{
  id: "p26",
  question: "You buy Jet CIF Med cargo indexed to Gasoil CIF NWE. What is your main exposure?",
  choices: [
    "Flat price risk",
    "Basis risk",
    "Freight risk",
    "Physical quality risk Jet vs Gasoil"
  ],
  correct: 1,
  explanation: "Different regional benchmarks (Med vs NWE) create basis risk."
},
{
  id: "p27",
  question: "You sell Gasoil FOB ARA but hedge using CIF Med swaps. What is the main risk?",
  choices: [
    "Freight",
    "Flat price risk",
    "Storage cost",
    "No exposure"
  ],
  correct: 0,
  explanation: "The hedge uses a different regional basis ‚Äî freight Med‚ÄìARA remains unhedged."
},
{
  id: "p28",
  question: "A trader buys a physical Gasoil cargo at fixed price which he sells floating price and is long paper Gasoil. What‚Äôs the exposure?",
  choices: [
    "Flat",
    "Double long exposure",
    "Short position",
    "Long position"
  ],
  correct: 1,
  explanation: "Both long positions compound exposure to rising prices."
},
{
  id: "p29",
  question: "A refiner sells Jet CIF NWE and buys Brent futures. What remains unhedged?",
  choices: [
    "Refining margin risk",
    "Flat price exposure",
    "Netback",
    "None"
  ],
  correct: 0,
  explanation: "Refiner still exposed to crack spread (Jet vs Brent)."
},
{
  id: "p30",
  question: "A trader buys crude linked to Brent and sells one linked to Dubai. What exposure is this?",
  choices: [
    "Long spread Brent/Dubai",
    "Short Spread Brent/Dubai",
    "Freight Med‚ÄìAsia",
    "Storage risk"
  ],
  correct: 1,
  explanation: "Exposure lies in the differential between Brent and Dubai benchmarks."
},
{
  id: "p31",
  question: "You sell a Jet cargo indexed to M-1 but deliver in M. Prices fall. What happens?",
  choices: [
    "Gain due to timing difference",
    "Loss due to timing difference",
    "No change",
    "Freight gain"
  ],
  correct: 1,
  explanation: "Selling against an earlier (higher) index in a falling market means loss."
},
{
  id: "p32",
  question: "You‚Äôre short 5,000 tons of Gasoil futures and prices fall $20/ton. What‚Äôs your result?",
  choices: [
    "Gain $100,000",
    "Lose $100,000",
    "No effect",
    "Gain $200,000"
  ],
  correct: 0,
  explanation: "Short futures gain when market prices fall."
},
{
  id: "p33",
  question: "A crude cargo is priced 'Brent Dated ‚Äì $1/bbl'. Market backwardates. Who benefits?",
  choices: [
    "Seller",
    "Buyer",
    "Both equal",
    "Neither"
  ],
  correct: 0,
  explanation: "Backwardation benefits the seller since the discount narrows in value."
},
{
  id: "p34",
  question: "You buy Jet CIF Med and sell Jet CIF NWE. Market structure inverts. What happens?",
  choices: [
    "Loss on spread position",
    "Gain on spread position",
    "No change",
    "Flat price risk"
  ],
  correct: 0,
  explanation: "If the Med weakens vs NWE, the long Med/short NWE position loses value."
},
{
  id: "p35",
  question: "A trader hedges Brent-linked crude exposure with Dated Brent swaps. Main residual risk?",
  choices: [
    "Timing risk",
    "Quality risk",
    "Basis exposure",
    "Arb risk"
  ],
  correct: 2,
  explanation: "ICE Brent and Dated Brent don‚Äôt perfectly align, leaving basis exposure."
},
{
  id: "p36",
  question: "You sell a cargo at fixed $100/bbl but don‚Äôt hedge. Prices drop to $90/bbl. What‚Äôs the result?",
  choices: [
    "Loss $10/bbl",
    "Gain $10/bbl",
    "Flat P&L",
    "Depends on freight"
  ],
  correct: 1,
  explanation: "Seller locked in at $100 and benefits from the market decline."
},
{
  id: "p37",
  question: "A trader buys a cargo of Jet of 50 kb Jet CIF NWE and hedges with 2 ICE Gasoil futures. Is the hedge correct?",
  choices: [
    "Under-hedged - long",
    "Under-hedged - short",
    "Over-hedged - long",
    "Over-hedged - short"
  ],
  correct: 1,
  explanation: "Each ICE Gasoil contract covers 100 tons ‚Üí ~12.6 kb, so hedge is too small."
},
{
  id: "p38",
  question: "You buy 1 Brent Dec future and sell 1 Brent Jan future. What position is this?",
  choices: [
    "Flat",
    "Time spread short Dec/Jan",
    "Time spread long Dec/Jan",
    "No position"
  ],
  correct: 2,
  explanation: "Buying Dec and selling Jan = long nearby, short deferred = long time spread."
},
{
  id: "p39",
  question: "You buy Jet CIF NWE and hedge with Brent futures. What‚Äôs your exposure?",
  choices: [
    "Short crack spread",
    "Long crack spread",
    "No exposure",
    "Long Brent"
  ],
  correct: 1,
  explanation: "Jet vs Brent represents a refining margin exposure."
},
{
  id: "p40",
  question: "A call option is bought. Who is rewarded if strike price is hit?",
  choices: [
    "Buyer receives option premium",
    "Seller receives option premium",
    "Buyer becomes long on expiry",
    "Seller loses"
  ],
  correct: [1,2],
  explanation: "A call buyer profits when the underlying asset increases in price and the option has been excercised. The seller profits from the premium."
},
{
  id: "p41",
  question: "A trader sells a cargo of 3,000 tons of Gasoil but hedges 4,000 tons. Market rises. What happens?",
  choices: [
    "Over-hedged, gain on futures",
    "Over-hedged, loss on futures",
    "No impact",
    "Over-hedged, Flat Pnl"
  ],
  correct: 1,
  explanation: "Being over-hedged means loss on excess short futures when prices rise."
},
{
  id: "p42",
  question: "You buy Jet CIF Med and hedge with Gasoil CIF Med. Prices rise equally. P&L effect?",
  choices: [
    "Gain due to higher price",
    "Gain due to higher Jet/Gasoil spread",
    "Loss due to higher price",
    "Neutral hedge"
  ],
  correct: 3,
  explanation: "Perfect correlation means hedge offsets movement."
},
{
  id: "p43",
  question: "You bought a physical Fuel cargo at fixed price which you need to sell and you have a short futures position. Prices rally. What‚Äôs the combined result?",
  choices: [
    "Gain",
    "Loss",
    "No result",
    "Gain on both sides"
  ],
  correct: 2,
  explanation: "Proper hedge neutralizes price move: gain on physical, loss on paper."
},
{
  id: "p44",
  question: "A trader sells Gasoil M swaps but buys physical for M+1. What exposure remains?",
  choices: [
    "Long time spread exposure M-1/M+1",
    "Flat price",
    "Short time spread exposure M-1/M+1",
    "None"
  ],
  correct: 2,
  explanation: "M vs M+1 difference creates a two-month time spread exposure."
},
{
  id: "p45",
  question: "A Jet CIF NWE sale is priced on a 10-day average. Hedge prices monthly. What risk?",
  choices: [
    "Structure risk (period exposure)",
    "Flat price risk",
    "Freight risk",
    "No risk"
  ],
  correct: 0,
  explanation: "Different pricing periods mean imperfect hedge."
},
{
  id: "p46",
  question: "A put option is bought. Who is rewarded if strike price is hit?",
  choices: [
    "Buyer receives option premium",
    "Seller receives option premium",
    "Buyer becomes long on expiry",
    "Seller loses"
  ],
  correct: 1,
  explanation: "A call buyer profits when the underlying asset increases in price and the option has been excercised. The seller profits from the premium."
},
{
  id: "p47",
  question: "You buy a Jet cargo CIF Med and intend to sell it in Singapore. What‚Äôs the risk?",
  choices: [
    "Freight risk",
    "Geographic arbitrage risk",
    "No exposure",
    "Quality risk"
  ],
  correct: [0,1,3],
  explanation: "Different regions create both freight and basis risk."
},
{
  id: "p48",
  question: "You‚Äôre short Brent futures and market rallies $4/bbl. What happens?",
  choices: [
    "Gain $4/bbl",
    "Lose $4/bbl",
    "No effect",
    "Depends on storage"
  ],
  correct: 1,
  explanation: "Short futures lose when prices rise."
},
{
  id: "p49",
  question: "You buy Jet CIF NWE and hedge with Gasoil CIF NWE. Jet cracks widen faster than Gasoil cracks. Result?",
  choices: [
    "Gain on physical Jet",
    "Loss on hedge",
    "Both gain equally",
    "Loss on physical Gasoil"
  ],
  correct: 0,
  explanation: "Jet strengthening vs Gasoil benefits Jet long positions."
},
{
  id: "p50",
  question: "A trader sells Gasoil term barrels indexed to M-1 but enters in deal sheet pricing M. What‚Äôs the impact?",
  choices: [
    "Time spread",
    "Freight risk",
    "Flat price impact",
    "Trader made a mistake"
  ],
  correct: [0,2,3],
  explanation: "Pricing period is completely wrong in the system. It is trader's fault (but Middle Office and Ops should have checked). This creates Flat Price as deal priced in the past and potential Time spread with new hedge needed."
}
  ]
},


  barge_customs_vetting: {
    title: "Barge, Customs & Vetting",
    questions: [
      {
        id: "bcv1",
        question: "Which regulations apply to inland barge operations?",
        choices: ["ADN", "ISGINTT", "SOLAS", "OCIMF"],
        correct: [0,1],
        explanation: "ADN governs dangerous goods transport on inland waterways; ISGINTT provides safety guidelines for terminals and tankers."
      },
      {
        id: "bcv2",
        question: "What is the purpose of barge vetting?",
        choices: ["Assess safety compliance", "Evaluate crew competence", "Verify technical condition", "Approve commercial terms"],
        correct: [0,1,2],
        explanation: "Vetting ensures the barge meets safety, crew, and technical standards before operations."
      },
      {
        id: "bcv3",
        question: "Which organizations are referenced in barge vetting standards?",
        choices: ["OCIMF", "EBIS", "ADN", "IMO"],
        correct: [0,1,2],
        explanation: "OCIMF, EBIS, and ADN provide frameworks for barge vetting and compliance."
      },
      {
        id: "bcv4",
        question: "What does EBIS stand for?",
        choices: ["European Barge Inspection Scheme", "Emergency Barge Inspection Standard", "Environmental Barge Integrity System", "European Bulk Inspection Safety"],
        correct: [0],
        explanation: "EBIS is the European Barge Inspection Scheme used for vetting inland barges."
      },
      {
        id: "bcv5",
        question: "Which documents are required before barge loading?",
        choices: ["ADN certificate", "Vetting approval", "Crew list", "Cargo declaration"],
        correct: [0,1,2],
        explanation: "ADN certificate, vetting approval, and crew list are mandatory before loading operations."
      },
      {
        id: "bcv6",
        question: "What is the role of the Port Shipping Agent?",
        choices: ["Customs declaration", "Berth coordination", "Cargo documentation", "Vetting inspection"],
        correct: [0,1,2],
        explanation: "The agent handles customs, berth planning, and cargo paperwork‚Äînot vetting itself."
      },
      {
        id: "bcv7",
        question: "Which factors are assessed during barge vetting?",
        choices: ["Hull condition", "Crew training", "Navigation equipment", "Cargo type"],
        correct: [0,1,2],
        explanation: "Vetting focuses on vessel integrity, crew competence, and equipment‚Äînot cargo type."
      },
      {
        id: "bcv8",
        question: "What is the minimum vetting validity period for barges?",
        choices: ["3 months", "6 months", "12 months", "24 months"],
        correct: [1],
        explanation: "Vetting approvals are typically valid for 6 months unless otherwise specified."
      },
      {
        id: "bcv9",
        question: "Which barge characteristics are critical for chartering?",
        choices: ["Propulsion type", "Draft", "Air draft", "Under keel clearance"],
        correct: [0,1,2,3],
        explanation: "All listed characteristics affect barge suitability for specific routes and terminals."
      },
      {
        id: "bcv10",
        question: "What is the purpose of the ADN certificate?",
        choices: ["Confirm dangerous goods compliance", "Authorize crew operations", "Validate customs clearance", "Confirm vessel ownership"],
        correct: [0],
        explanation: "ADN certificate confirms the barge complies with regulations for transporting dangerous goods."
      },
      {
        id: "bcv11",
        question: "Which parties are involved in barge vetting approval?",
        choices: ["Trading desk", "HSE", "Vetting team", "Terminal operator"],
        correct: [1,2,3],
        explanation: "HSE, vetting team, and terminal operator assess and approve barge suitability."
      },
      {
        id: "bcv12",
        question: "Which customs documents are required for international barge movements?",
        choices: ["Cargo manifest", "Certificate of Origin", "Excise declaration", "ADN certificate"],
        correct: [0,1,2],
        explanation: "Manifest, origin certificate, and excise declaration are required for customs clearance."
      },
      {
        id: "bcv13",
        question: "What is the role of the terminal in vetting?",
        choices: ["Approve barge access", "Conduct safety checks", "Issue ADN certificate", "Coordinate loading"],
        correct: [0,1],
        explanation: "Terminals approve access and conduct safety checks but do not issue ADN certificates."
      },
      {
        id: "bcv14",
        question: "Which barge dimensions affect terminal compatibility?",
        choices: ["Length", "Beam", "Air draft", "Propulsion type"],
        correct: [0,1,2],
        explanation: "Length, beam, and air draft determine if the barge can safely berth at the terminal."
      },
      {
        id: "bcv15",
        question: "Which inspections are part of barge vetting?",
        choices: ["Hull integrity", "Fire safety", "Navigation systems", "Crew certification"],
        correct: [0,1,2,3],
        explanation: "All listed elements are inspected during vetting to ensure operational safety."
      },
      {
        id: "bcv16",
        question: "What is the role of the HSE team in barge operations?",
        choices: ["Monitor safety compliance", "Approve vetting", "Train crew", "Issue customs documents"],
        correct: [0,1],
        explanation: "HSE monitors safety and participates in vetting but does not issue customs documents."
      },
      {
        id: "bcv17",
        question: "Which barge types require special vetting attention?",
        choices: ["Single hull", "Double hull", "Self-propelled", "Push barges"],
        correct: [0],
        explanation: "Single hull barges pose higher risk and require stricter vetting scrutiny."
      },
      {
        id: "bcv18",
        question: "Which customs risks must be managed during barge discharge?",
        choices: ["Incorrect cargo declaration", "Missing origin certificate", "Excise fraud", "Crew documentation errors"],
        correct: [0,1,2],
        explanation: "Customs risks include declaration errors, missing documents, and excise fraud."
      },
      {
        id: "bcv19",
        question: "Which barge features impact under keel clearance?",
        choices: ["Draft", "Tide level", "Berth depth", "Cargo weight"],
        correct: [0,1,2,3],
        explanation: "All listed factors affect the clearance between barge keel and seabed."
      },
      {
        id: "bcv20",
        question: "Which documents are reviewed during vetting?",
        choices: ["Crew certificates", "Safety manual", "ADN certificate", "Cargo manifest"],
        correct: [0,1,2],
        explanation: "Vetting focuses on crew, safety, and regulatory compliance‚Äînot cargo manifest."
      },
      {
        id: "bcv21",
        question: "What is the role of the barge chartering team?",
        choices: ["Select suitable barges", "Negotiate terms", "Ensure vetting compliance", "Issue customs documents"],
        correct: [0,1,2],
        explanation: "Chartering team selects barges, negotiates, and ensures vetting‚Äînot customs."
      },
      {
        id: "bcv22",
        question: "Which barge operations require customs coordination?",
        choices: ["Cross-border movement", "Excise cargo", "International crew", "Domestic fuel transfer"],
        correct: [0,1],
        explanation: "Cross-border and excise cargo operations require customs coordination."
      },
      {
        id: "bcv23",
        question: "Which vetting criteria relate to crew?",
        choices: ["Training records", "Certification", "Experience", "Nationality"],
        correct: [0,1,2],
        explanation: "Vetting assesses crew competence‚Äînot nationality."
      },
      {
        id: "bcv24",
        question: "Which barge documents are required for terminal access?",
        choices: ["Vetting approval", "ADN certificate", "Crew list", "Cargo manifest"],
        correct: [0,1,2],
        explanation: "Terminals require vetting, ADN, and crew list‚Äînot necessarily cargo manifest."
      },
      {
        id: "bcv25",
        question: "Which customs documents are handled by the Port Shipping Agent?",
        choices: ["Cargo manifest", "Excise declaration", "Certificate of Origin", "Crew visas"],
        correct: [0,1,2],
        explanation: "The agent manages cargo and customs documents‚Äînot crew immigration."
      },
	  
      {
        id: "bcv26",
        question: "Which vetting statuses can be assigned to a vessel?",
        choices: ["Inspected", "Unclassified +", "Unclassified -", "Rejected"],
        correct: [0,1,2,3],
        explanation: "Vetting statuses include Inspected, Unclassified (positive or negative), and Rejected depending on inspection results."
      },
      {
        id: "bcv27",
        question: "What is the validity of a tanker inspection under TAM?",
        choices: ["6 months for vessels ‚â•15 years", "12 months for vessels <15 years", "3 months for spot voyages", "24 months for time charters"],
        correct: [0,1],
        explanation: "Inspections are valid for 6 months for older vessels and 12 months for newer ones."
      },
      {
        id: "bcv28",
        question: "Which documents are required for customs clearance?",
        choices: ["Cargo manifest", "Certificate of Origin", "Excise declaration", "Crew list"],
        correct: [0,1,2],
        explanation: "Customs clearance requires cargo manifest, origin certificate, and excise declaration."
      },
      {
        id: "bcv29",
        question: "What is the role of the Port Shipping Agent (PSA)?",
        choices: ["Coordinate berth access", "Submit customs documents", "Arrange nautical services", "Approve vetting"],
        correct: [0,1,2],
        explanation: "PSA coordinates port operations and documentation but does not approve vetting."
      },
      {
        id: "bcv30",
        question: "Which types of vetting responses exist for tankers?",
        choices: ["VAI", "VRN", "MOA", "MOR"],
        correct: [0,1,2,3],
        explanation: "Vetting responses include agreement (VAI), response number (VRN), approval (MOA), and refusal (MOR)."
      },
      {
        id: "bcv31",
        question: "Which documents are required for a vetting request?",
        choices: ["Vessel questionnaire", "Cargo details", "Terminal confirmation", "Crew certificates"],
        correct: [0,1,2],
        explanation: "Vetting requests must include vessel questionnaire, cargo info, and terminal confirmation."
      },
      {
        id: "bcv32",
        question: "Which service providers are approved for STS operations?",
        choices: ["Teekay Marine Solutions", "Fender Care Marine", "Safe STS Ltd", "MariFlex Pump Services"],
        correct: [0,1,2,3],
        explanation: "These providers are approved for STS operations within specific port limits."
      },
      {
        id: "bcv33",
        question: "What is the role of inerting in transshipment?",
        choices: ["Reduce oxygen level", "Prevent explosion", "Ensure cargo compatibility", "Facilitate customs clearance"],
        correct: [0,1],
        explanation: "Inerting reduces oxygen to prevent explosion during ship-to-barge transfers."
      },
      {
        id: "bcv34",
        question: "Which incidents require immediate notification?",
        choices: ["Collision", "Grounding", "Spill", "Delay due to weather"],
        correct: [0,1,2],
        explanation: "Major incidents like collision, grounding, or spill must be reported immediately."
      },
      {
        id: "bcv35",
        question: "Which email should be used for barge incident reporting?",
        choices: ["bargeincidents.tsgeneva@totsa.com", "cargoincidents.tsgeneva@totsa.com", "vetting@totsa.com", "ops@totsa.com"],
        correct: [0],
        explanation: "All barge incidents must be reported to bargeincidents.tsgeneva@totsa.com."
      },
      {
        id: "bcv36",
        question: "What happens if negative information is received post-vetting approval?",
        choices: ["Approval is withdrawn", "Reinspection is required", "Operations are suspended", "No action is taken"],
        correct: [0,1,2],
        explanation: "Negative info may lead to withdrawal of approval, reinspection, or suspension."
      },
      {
        id: "bcv37",
        question: "Which barge types require vetting?",
        choices: ["Dumb barge", "Push barge", "Motorized barge", "Tugboat"],
        correct: [0,1,2],
        explanation: "All listed barge types must be vetted, especially if part of a convoy."
      },
      {
        id: "bcv38",
        question: "Which regulations govern barge construction and operation?",
        choices: ["ADN", "ISGINTT", "CDNI", "CMNI"],
        correct: [0,1],
        explanation: "ADN and ISGINTT regulate barge construction and safety operations."
      },
      {
        id: "bcv39",
        question: "What is the purpose of the CDNI convention?",
        choices: ["Polluter-pays principle", "Waste management", "Cargo documentation", "Crew training"],
        correct: [0,1],
        explanation: "CDNI enforces polluter-pays and waste handling rules for inland navigation."
      },
      {
        id: "bcv40",
        question: "Which documents are required under CDNI?",
        choices: ["Transport Confirmation", "Transport Document", "Discharge Statement", "Crew list"],
        correct: [0,1,2],
        explanation: "CDNI requires confirmation, transport document, and discharge statement."
      },
      {
        id: "bcv41",
        question: "What is the CMNI convention?",
        choices: ["Contract of carriage", "Customs regulation", "Crew certification", "Cargo inspection"],
        correct: [0],
        explanation: "CMNI governs contracts for international barge transport."
      },
      {
        id: "bcv42",
        question: "Which vetting system replaced EBIS?",
        choices: ["SIRE-BIRE", "OCIMF", "ISGINTT", "TAM"],
        correct: [0],
        explanation: "EBIS was integrated into OCIMF‚Äôs SIRE-BIRE system for unified inspections."
      },
      {
        id: "bcv43",
        question: "Which inspection frequency applies to TC barges?",
        choices: ["Every 6 months", "Every 12 months", "Every 3 years", "Every voyage"],
        correct: [0],
        explanation: "TC barges are inspected every 6 months by or on behalf of TotalEnergies."
      },
      {
        id: "bcv44",
        question: "Which elements are inspected during vetting?",
        choices: ["Technical value", "Crew professionalism", "Office support", "Cargo type"],
        correct: [0,1,2],
        explanation: "Vetting focuses on technical, crew, and office support‚Äînot cargo type."
      },
      {
        id: "bcv45",
        question: "Which hull types are prohibited for dangerous cargo?",
        choices: ["Single hull", "Double hull", "Triple hull", "Composite hull"],
        correct: [0],
        explanation: "Single hull barges are prohibited for dangerous cargo since 2019."
      },
      {
        id: "bcv46",
        question: "Which PSA services are related to customs?",
        choices: ["Declaration of cargo", "Excise goods", "Provisions", "Crew visas"],
        correct: [0,1,2],
        explanation: "PSA handles cargo, excise, and provisions declarations‚Äînot visas."
      },
      {
        id: "bcv47",
        question: "Which documents are managed by PSA during port call?",
        choices: ["SOF", "FDA", "PDA", "Cargo manifest"],
        correct: [0,1,2],
        explanation: "PSA manages Statement of Facts, Final DA, and Port DA."
      },
      {
        id: "bcv48",
        question: "Which vetting approvals are needed for transshipment?",
        choices: ["One per unit", "Location details", "Cargo type", "Crew nationality"],
        correct: [0,1],
        explanation: "Each unit must be approved with location and operation details."
      },
      {
        id: "bcv49",
        question: "Which vetting statuses apply to barges?",
        choices: ["Inspected", "Rejected", "Unclassified +", "Unclassified -"],
        correct: [0,1,2,3],
        explanation: "Barges can be classified as Inspected, Rejected, or Unclassified."
      },
      {
        id: "bcv50",
        question: "Which documents are required for vessel vetting?",
        choices: ["SIRE report", "Q88", "Terminal confirmation", "Cargo manifest"],
        correct: [0,1,2],
        explanation: "Vessel vetting requires SIRE report, Q88, and terminal confirmation."
      }
	    ]
},


  contracts_legal_insurance: {
    title: "Contracts, Legal & Insurance",
    questions: [
      {
        id: "cli1",
        question: "Which law and jurisdiction apply to TOTSA contracts?",
        choices: ["English law / London High Court", "New York law / AAA arbitration", "Singapore law / SIAC arbitration", "Texas law / AAA arbitration"],
        correct: [0],
        explanation: "TOTSA contracts are governed by English law and subject to the jurisdiction of the London High Court."
      },
      {
        id: "cli2",
        question: "What does a Warranty of Title guarantee?",
        choices: ["Seller has legal right to sell", "Cargo is free of liens", "Buyer enjoys quiet possession", "Cargo is insured"],
        correct: [0,1,2],
        explanation: "A Warranty of Title guarantees the seller's right to sell, absence of liens, and buyer's peaceful possession."
      },
      {
        id: "cli3",
        question: "Which Incoterm obliges the seller to provide marine insurance?",
        choices: ["FOB", "CFR", "CIF", "DAP"],
        correct: [2],
        explanation: "Under CIF, the seller must provide marine insurance for the cargo."
      },
      {
        id: "cli4",
        question: "What is the minimum insurance coverage required under T&S GTC?",
        choices: ["100% of CIF value", "110% of CIF value", "90% of FOB value", "120% of invoice value"],
        correct: [1],
        explanation: "T&S GTC requires insurance coverage of 110% of the CIF cargo value."
      },
      {
        id: "cli5",
        question: "Which clauses are typically included in a Letter of Indemnity?",
        choices: ["Title warranty", "Document validity", "Indemnity for missing B/L", "Cargo insurance terms"],
        correct: [0,1,2],
        explanation: "LOIs include warranties on title, document validity, and indemnity for missing original B/L."
      },
      {
        id: "cli6",
        question: "What is the role of the indemnifying party in a contract?",
        choices: ["Compensate for losses", "Defend against claims", "Hold harmless", "Provide insurance"],
        correct: [0,1,2],
        explanation: "The indemnifying party must compensate, defend, and hold the other party harmless."
      },
      {
        id: "cli7",
        question: "Which risks are covered under Institute Cargo Clauses (A)?",
        choices: ["All risks", "Named perils", "War risks", "Pollution"],
        correct: [0],
        explanation: "Institute Cargo Clauses (A) provide all-risk coverage subject to exclusions."
      },
      {
        id: "cli8",
        question: "What is the deductible for shortage under T&S cargo insurance?",
        choices: ["0.5% of insured value", "1% of CIF value", "USD 20,000", "No deductible"],
        correct: [0],
        explanation: "Shortage is covered subject to a 0.5% deductible under T&S cargo insurance."
      },
      {
        id: "cli9",
        question: "Which clause should be avoided when negotiating demurrage?",
        choices: ["Time bar clause", "Laycan clause", "Pro rata clause", "Force majeure clause"],
        correct: [0],
        explanation: "Time bar clauses are unfavorable when TOTSA is claiming demurrage."
      },
      {
        id: "cli10",
        question: "What does 'jointly and severally bound' mean in a bank LOI?",
        choices: ["Bank shares full liability", "Bank guarantees payment", "Bank is co-indemnitor", "Bank is only witness"],
        correct: [0,1,2],
        explanation: "It means the bank shares full liability and guarantees the LOI obligations."
      },
      {
        id: "cli11",
        question: "Which document is not required for payment under GTC?",
        choices: ["Warranty of Title", "Commercial Invoice", "Certificate of Quality", "Original B/L"],
        correct: [0],
        explanation: "WOT is not a negotiable document required for payment under GTC."
      },
      {
        id: "cli12",
        question: "Which clause allows termination in case of sanctions?",
        choices: ["Trade Restrictions", "Force Majeure", "Change of Control", "Indemnity"],
        correct: [0],
        explanation: "Trade Restrictions clause allows suspension or termination if sanctions apply."
      },
      {
        id: "cli13",
        question: "What is the role of DARA in insurance management?",
        choices: ["Assess risks", "Negotiate policies", "Issue certificates", "Manage claims"],
        correct: [0,1],
        explanation: "DARA assesses risks and negotiates global insurance coverage."
      },
      {
        id: "cli14",
        question: "Which insurance is required when chartering a vessel?",
        choices: ["P&I Club membership", "Oil pollution cover", "War risk cover", "Cargo insurance"],
        correct: [0,1,2],
        explanation: "Chartered vessels must have P&I membership and pollution/war risk cover."
      },
      {
        id: "cli15",
        question: "Which clause defines the transfer of title and risk?",
        choices: ["Delivery Terms", "Warranty of Title", "Incoterms", "Insurance clause"],
        correct: [0],
        explanation: "Delivery Terms clause defines when title and risk transfer to the buyer."
      },
      {
        id: "cli16",
        question: "What is the consequence of a missing original B/L?",
        choices: ["LOI required", "Payment delayed", "Title not transferred", "Insurance invalid"],
        correct: [0],
        explanation: "A Letter of Indemnity is required to proceed with payment without original B/L."
      },
      {
        id: "cli17",
        question: "Which Incoterm is most protective for the seller?",
        choices: ["CIF", "FOB", "DAP", "CFR"],
        correct: [0],
        explanation: "CIF is most protective for the seller as it includes insurance and delivery obligations."
      },
      {
        id: "cli18",
        question: "What is the role of the Sale of Goods Act 1979?",
        choices: ["Implied title warranty", "Defines delivery terms", "Sets insurance rules", "Regulates arbitration"],
        correct: [0],
        explanation: "The Act implies the seller has the right to sell and guarantees quiet possession."
      },
      {
        id: "cli19",
        question: "Which clause should be added to protect against vessel claims?",
        choices: ["Recourse clause", "Indemnity clause", "Insurance clause", "Force majeure clause"],
        correct: [0],
        explanation: "Recourse clause ensures the terminal seeks recovery from vessel before claiming indemnity."
      },
      {
        id: "cli20",
        question: "Which insurance covers storage risks?",
        choices: ["Marine cargo extension", "Property damage policy", "General liability", "War risk cover"],
        correct: [0,1],
        explanation: "Storage risks are covered by marine cargo extension and property damage policies."
      },
      {
        id: "cli21",
        question: "What is the minimum cover required under Institute Cargo Clauses (A)?",
        choices: ["All risks", "Named perils", "War risks", "Pollution"],
        correct: [0],
        explanation: "Institute Cargo Clauses (A) provide all-risk coverage for marine cargo."
      },
      {
        id: "cli22",
        question: "Which clause allows contract termination in case of default?",
        choices: ["Termination clause", "Force majeure", "Trade restrictions", "Change of control"],
        correct: [0],
        explanation: "Termination clause allows ending the contract if obligations are not met."
      },
      {
        id: "cli23",
        question: "What is the role of the indemnified party?",
        choices: ["Receive compensation", "Provide insurance", "Defend claims", "Issue LOI"],
        correct: [0],
        explanation: "The indemnified party is protected and compensated for losses under the indemnity."
      },
      {
        id: "cli24",
        question: "Which clause defines the scope of insurance obligations?",
        choices: ["Insurance clause", "Delivery clause", "Warranty clause", "Indemnity clause"],
        correct: [0],
        explanation: "The insurance clause defines who insures, coverage scope, and duration."
      },
      {
        id: "cli25",
        question: "Which document confirms the seller‚Äôs right to sell the cargo?",
        choices: ["Warranty of Title", "LOI", "Certificate of Origin", "Commercial Invoice"],
        correct: [0],
        explanation: "The Warranty of Title confirms the seller has legal ownership and right to sell."
      },
	  
      {
        id: "cli26",
        question: "What must be declared to SIACI for insurance purposes?",
        choices: ["Vessels with cargo value ‚â• 100M USD", "Storage exceeding 75M USD", "War risk areas", "All CIF sales"],
        correct: [0,1,2],
        explanation: "SIACI must be notified for high-value cargoes, large storage, and war risk areas."
      },
      {
        id: "cli27",
        question: "Which Incoterm obliges the seller to provide insurance?",
        choices: ["FOB", "CFR", "CIF", "DAP"],
        correct: [2],
        explanation: "Under CIF, the seller must provide insurance for the goods during transport."
      },
      {
        id: "cli28",
        question: "What is the standard deductible for contamination under T&S insurance?",
        choices: ["0.5% of CIF value", "20,000 USD", "No deductible", "1,000,000 USD"],
        correct: [1],
        explanation: "Contamination claims are subject to a 20,000 USD deductible."
      },
      {
        id: "cli29",
        question: "Which clause defines the transfer of title and risk?",
        choices: ["Delivery clause", "Warranty of Title", "Incoterms", "Insurance clause"],
        correct: [0],
        explanation: "The delivery clause specifies when title and risk pass to the buyer."
      },
      {
        id: "cli30",
        question: "What does the Sale of Goods Act 1979 imply?",
        choices: ["Seller has right to sell", "Goods are free of liens", "Buyer enjoys quiet possession", "Seller must insure cargo"],
        correct: [0,1,2],
        explanation: "The Act implies title, freedom from encumbrances, and quiet possession."
      },
      {
        id: "cli31",
        question: "Which law governs TOTSA contracts?",
        choices: ["English law", "New York law", "Singapore law", "Texas law"],
        correct: [0],
        explanation: "TOTSA contracts are governed by English law."
      },
      {
        id: "cli32",
        question: "What is the insurance coverage required for CIF sales?",
        choices: ["100% of CIF value", "110% of CIF value", "90% of FOB value", "120% of invoice value"],
        correct: [1],
        explanation: "T&S requires 110% CIF value coverage for CIF sales."
      },
      {
        id: "cli33",
        question: "Which clause allows contract termination in case of force majeure?",
        choices: ["Termination clause", "Force majeure clause", "Trade restrictions", "Indemnity clause"],
        correct: [1],
        explanation: "Force majeure clauses allow termination if events prevent performance."
      },
      {
        id: "cli34",
        question: "Which risks are covered under Institute Cargo Clauses (A)?",
        choices: ["All risks", "Named perils", "War risks", "Pollution"],
        correct: [0],
        explanation: "ICC (A) provides all-risk coverage subject to exclusions."
      },
      {
        id: "cli35",
        question: "What is the role of DARA?",
        choices: ["Negotiate insurance", "Manage claims", "Issue certificates", "Assess risks"],
        correct: [0,1,3],
        explanation: "DARA handles risk assessment, negotiation, and claims management."
      },
      {
        id: "cli36",
        question: "Which clause should be avoided when claiming demurrage?",
        choices: ["Time bar clause", "Laycan clause", "Force majeure clause", "Indemnity clause"],
        correct: [0],
        explanation: "Time bar clauses can prevent demurrage recovery if not timely claimed."
      },
      {
        id: "cli37",
        question: "Which document confirms the seller‚Äôs legal right to sell?",
        choices: ["Warranty of Title", "LOI", "Certificate of Origin", "Commercial Invoice"],
        correct: [0],
        explanation: "WOT confirms seller‚Äôs ownership and right to sell the cargo."
      },
      {
        id: "cli38",
        question: "What is the insurance implication for cargo over 100M USD?",
        choices: ["Automatic coverage", "Prior declaration required", "No coverage", "Bank guarantee needed"],
        correct: [1],
        explanation: "Cargo over 100M USD must be declared to SIACI for coverage."
      },
      {
        id: "cli39",
        question: "Which clause protects against third-party claims?",
        choices: ["Indemnity clause", "Recourse clause", "Insurance clause", "Force majeure clause"],
        correct: [0],
        explanation: "Indemnity clauses protect against third-party claims and losses."
      },
      {
        id: "cli40",
        question: "Which clause defines the seller‚Äôs obligation to deliver documents?",
        choices: ["LOI clause", "Delivery clause", "Document clause", "Warranty clause"],
        correct: [2],
        explanation: "Document clauses specify which documents must be delivered for payment."
      },
      {
        id: "cli41",
        question: "What is the consequence of a missing original B/L?",
        choices: ["LOI required", "Payment delayed", "Title not transferred", "Insurance invalid"],
        correct: [0],
        explanation: "LOI is required to proceed with payment without original B/L."
      },
      {
        id: "cli42",
        question: "Which clause should be reciprocal in contracts?",
        choices: ["Force majeure", "Assignment", "Termination", "Indemnity"],
        correct: [0,1,2],
        explanation: "These clauses should apply equally to both parties."
      },
      {
        id: "cli43",
        question: "Which insurance covers third-party liabilities when chartering?",
        choices: ["Charterer‚Äôs liability", "P&I Club", "Cargo insurance", "Storage insurance"],
        correct: [0,1],
        explanation: "Charterer‚Äôs liability and P&I cover third-party risks during chartering."
      },
      {
        id: "cli44",
        question: "Which clause defines the scope of insurance obligations?",
        choices: ["Insurance clause", "Delivery clause", "Warranty clause", "Indemnity clause"],
        correct: [0],
        explanation: "Insurance clause defines who insures, coverage scope, and duration."
      },
      {
        id: "cli45",
        question: "Which clause allows contract termination for non-payment?",
        choices: ["Termination clause", "Force majeure", "Indemnity clause", "Assignment clause"],
        correct: [0],
        explanation: "Termination clause allows ending the contract if payment is not made."
      },
      {
        id: "cli46",
        question: "Which clause should be added to protect against vessel claims?",
        choices: ["Recourse clause", "Indemnity clause", "Insurance clause", "Force majeure clause"],
        correct: [0],
        explanation: "Recourse clause ensures terminal seeks recovery from vessel first."
      },
      {
        id: "cli47",
        question: "Which clause defines the seller‚Äôs obligation to insure cargo?",
        choices: ["Insurance clause", "Delivery clause", "Warranty clause", "Indemnity clause"],
        correct: [0],
        explanation: "Insurance clause defines seller‚Äôs obligation to insure cargo under CIF."
      },
      {
        id: "cli48",
        question: "Which clause defines the buyer‚Äôs right to quiet possession?",
        choices: ["Warranty of Title", "Indemnity clause", "Delivery clause", "Insurance clause"],
        correct: [0],
        explanation: "WOT guarantees buyer‚Äôs peaceful possession of the goods."
      },
      {
        id: "cli49",
        question: "Which clause should be avoided in third-party LOIs?",
        choices: ["Vague wording", "Automatic cancellation", "Limited enforceability", "Bank countersignature"],
        correct: [0,1,2],
        explanation: "LOIs must be precise, enforceable, and not auto-expiring."
      },
      {
        id: "cli50",
        question: "Which clause defines the governing law and jurisdiction?",
        choices: ["Jurisdiction clause", "Arbitration clause", "Delivery clause", "Insurance clause"],
        correct: [0,1],
        explanation: "Jurisdiction and arbitration clauses define applicable law and forum."
      }
  ]
},


  refining_blending: { 
    title: "Refining & Blending", 

        questions: [
          // 1
          
{
  id: "rfb1",
  question: "To raise gasoline octane without adding sulfur, blend with:",
  choices: ["Alkylate", "Vacuum residue", "Light cycle oil (LCO)", "Heavy fuel oil"],
  correct: 0,
  explanation: "Alkylate is a high-octane, low-sulfur, olefin-free component, ideal for clean octane enhancement in gasoline blending."
},
{
  id: "rfb2",
  question: "Gasoline RVP increases the most when adding:",
  choices: ["Reformate", "Kerosene", "Butane", "Diesel"],
  correct: 2,
  explanation: "Butane has a very high vapor pressure, so even small additions significantly increase the RVP of the gasoline pool."
},
{
  id: "rfb3",
  question: "A common gasoline detergent additive is:",
  choices: ["Polyether amine (PEA)", "Sodium chloride", "Water", "Sulfur"],
  correct: 0,
  explanation: "PEA detergents are used in gasoline to clean intake valves and fuel injectors, preventing deposit formation."
},
{
  id: "rfb4",
  question: "Typical cetane improver for diesel blending:",
  choices: ["MTBE", "Toluene", "2-ethylhexyl nitrate (2-EHN)", "Ethanol"],
  correct: 2,
  explanation: "2-EHN is a nitrate-based additive that reduces ignition delay and increases the cetane number of diesel fuels."
},
{
  id: "rfb5",
  question: "Adding FAME (biodiesel) to diesel mainly:",
  choices: ["Reduces lubricity", "Improves lubricity", "Eliminates sulfur", "Raises octane"],
  correct: 1,
  explanation: "FAME improves the lubricity of ultra-low sulfur diesel, which otherwise lacks natural lubricants due to desulfurization."
},
{
  id: "rfb6",
  question: "Which property is notably non-linear in gasoline blending?",
  choices: ["Octane number", "Density", "Sulfur content", "Color"],
  correct: 0,
  explanation: "Octane number blending is non-linear; the final octane of a blend cannot be predicted by simple volume averaging."
},
{
  id: "rfb7",
  question: "Best low-sulfur, high-octane gasoline blendstock:",
  choices: ["FCC gasoline", "Alkylate", "Reformate", "Straight-run naphtha"],
  correct: 1,
  explanation: "Alkylate offers high RON and MON, with very low sulfur and no olefins, making it ideal for clean gasoline blending."
},
{
  id: "rfb8",
  question: "Blend component that raises aromatics and octane:",
  choices: ["Reformate", "Alkylate", "Butane", "Hydrotreated naphtha"],
  correct: 0,
  explanation: "Catalytic reformate is rich in aromatics, which significantly increase octane but may challenge benzene and aromatics limits."
},
{
  id: "rfb9",
  question: "To improve diesel cold flow you would typically add:",
  choices: ["Kerosene (winterization)", "Heavy cycle oil", "Bitumen", "Water"],
  correct: 0,
  explanation: "Kerosene lowers the cloud point and CFPP of diesel, improving cold flow properties during winter blending."
},
{
  id: "rfb10",
  question: "Final product release is based on meeting:",
  choices: ["Crude assay data", "Pump performance curves", "Applicable product specification (e.g., ASTM/EN)", "Material safety data sheet"],
  correct: 2,
  explanation: "Product release is based on certified lab results that confirm compliance with official specifications like ASTM or EN standards."
},
{
  id: "rfb11",
  question: "Case study: Summer gasoline is over-volatile. What should you trim first?",
  choices: ["Butane", "Alkylate", "Reformate", "Isomerate"],
  correct: 0,
  explanation: "Butane has the highest vapor pressure and is the first component to reduce when gasoline exceeds summer RVP limits."
},
{
  id: "rfb12",
  question: "Case study: Winter startability complaints. First corrective addition?",
  choices: ["Butane", "Heavy reformate", "Diesel", "Resid"],
  correct: 0,
  explanation: "Adding butane increases volatility, improving cold start performance in winter conditions‚Äîwithin seasonal RVP limits."
},
{
  id: "rfb13",
  question: "Which component most increases benzene in gasoline?",
  choices: ["Reformate", "Isomerate", "Alkylate", "Ethanol"],
  correct: 0,
  explanation: "Reformate contains significant benzene levels, while alkylate and isomerate are benzene-lean and help reduce benzene content."
},
{
  id: "rfb14",
  question: "To reduce gasoline benzene below 1 vol%, favor:",
  choices: ["Reformate", "Alkylate", "FCC gasoline", "Coker naphtha"],
  correct: 1,
  explanation: "Alkylate has near-zero benzene and is used to dilute high-benzene components like reformate to meet benzene specs."
},
{
  id: "rfb15",
  question: "Non-oxygenate octane booster often referenced in racing fuels:",
  choices: ["Toluene", "Ethanol", "MTBE", "Kerosene"],
  correct: 0,
  explanation: "Toluene is an aromatic compound with high octane boosting capability, commonly used in racing fuels despite regulatory limits."
},
{
  id: "rfb16",
  question: "Which gasoline property is the most seasonal constraint in trading?",
  choices: ["RVP (volatility)", "Olefins", "Color", "Sulfur always"],
  correct: 0,
  explanation: "RVP is tightly regulated by season and geography, making it the most variable and restrictive property in gasoline trading."
},
{
  id: "rfb17",
  question: "Diesel density is too high. Which blendstock helps the most?",
  choices: ["Kerosene", "LCO", "Vacuum gasoil", "Reformate"],
  correct: 0,
  explanation: "Kerosene has lower density and helps reduce overall diesel density while improving cold flow properties."
},
{
  id: "rfb18",
  question: "Which component most effectively raises diesel cetane?",
  choices: ["Light cycle oil", "HVO diesel", "Reformate", "Butane"],
  correct: 1,
  explanation: "HVO diesel is paraffinic, with very high cetane and low aromatics, making it an excellent cetane improver."
},
{
  id: "rfb19",
  question: "Which diesel component most harms CFPP/cold flow?",
  choices: ["Light cycle oil (LCO)", "Kerosene", "Hydrotreated diesel", "HVO diesel"],
  correct: 0,
  explanation: "LCO is aromatic-rich and negatively impacts cold flow properties and smoke emissions in diesel."
},
{
  id: "rfb20",
  question: "Rising FAME content in diesel increases risk of:",
  choices: ["Oxidation instability", "Low lubricity", "Higher sulfur", "Lower density"],
  correct: 0,
  explanation: "FAME is prone to oxidation, which can lead to gum formation and filter plugging; antioxidants are often added to mitigate this."
},

{
  id: "rfb21",
  question: "Which blending component is most effective at reducing sulfur in gasoline?",
  choices: ["Alkylate", "FCC gasoline", "Reformate", "Coker naphtha"],
  correct: 0,
  explanation: "Alkylate is virtually sulfur-free, making it ideal for blending into low-sulfur gasoline pools."
},
{
  id: "rfb22",
  question: "Which component is most likely to increase olefins in gasoline?",
  choices: ["Alkylate", "FCC gasoline", "Reformate", "Isomerate"],
  correct: 1,
  explanation: "FCC gasoline is rich in olefins, which can increase reactivity and emissions in gasoline."
},
{
  id: "rfb23",
  question: "Which blending component is most aromatic-rich?",
  choices: ["Reformate", "Alkylate", "Isomerate", "Straight-run naphtha"],
  correct: 0,
  explanation: "Reformate is produced via catalytic reforming and is highly aromatic, contributing to high octane."
},
{
  id: "rfb24",
  question: "Which property is most affected by adding ethanol to gasoline?",
  choices: ["Octane", "Sulfur", "Density", "Cetane"],
  correct: 0,
  explanation: "Ethanol significantly increases octane number but also raises vapor pressure and oxygen content."
},
{
  id: "rfb25",
  question: "Which diesel component is most likely to reduce lubricity?",
  choices: ["FAME", "Hydrotreated diesel", "Kerosene", "LCO"],
  correct: 1,
  explanation: "Hydrotreating removes natural lubricants from diesel, reducing lubricity unless additives are used."
},
{
  id: "rfb26",
  question: "Which gasoline component is most volatile?",
  choices: ["Butane", "Reformate", "Alkylate", "Isomerate"],
  correct: 0,
  explanation: "Butane has a very low boiling point and high vapor pressure, making it the most volatile component."
},
{
  id: "rfb27",
  question: "Which blending component is used to reduce sulfur in diesel?",
  choices: ["LCO", "Straight-run diesel", "Hydrotreated diesel", "Kerosene"],
  correct: 2,
  explanation: "Hydrotreating removes sulfur and nitrogen compounds, producing low-sulfur diesel suitable for ULSD specs."
},
{
  id: "rfb28",
  question: "Which blending component is most likely to increase smoke emissions in diesel?",
  choices: ["LCO", "HVO", "Kerosene", "Straight-run diesel"],
  correct: 0,
  explanation: "LCO is aromatic-rich and contributes to higher particulate emissions and smoke in diesel engines."
},
{
  id: "rfb29",
  question: "Which blending component is used to reduce the pour point of diesel?",
  choices: ["Kerosene", "LCO", "Bitumen", "Reformate"],
  correct: 0,
  explanation: "Kerosene has better cold flow properties and is used to lower the pour point of diesel in winter."
},
{
  id: "rfb30",
  question: "Which blending component is most likely to increase the density of diesel?",
  choices: ["Kerosene", "LCO", "HVO", "Reformate"],
  correct: 1,
  explanation: "LCO has a higher density and can increase the overall density of the diesel pool."
},
{
  id: "rfb31",
  question: "Which component is most suitable for increasing gasoline RON without increasing benzene?",
  choices: ["Reformate", "Alkylate", "Coker naphtha", "LCO"],
  correct: 1,
  explanation: "Alkylate has high RON and negligible benzene, making it ideal for clean octane enhancement."
},
{
  id: "rfb32",
  question: "Which blending component is most likely to increase the sulfur content in gasoline?",
  choices: ["Alkylate", "Reformate", "FCC gasoline", "Isomerate"],
  correct: 2,
  explanation: "FCC gasoline typically contains higher sulfur levels unless hydrotreated."
},
{
  id: "rfb33",
  question: "Which diesel component is most paraffinic and has high cetane?",
  choices: ["HVO", "LCO", "Straight-run diesel", "Reformate"],
  correct: 0,
  explanation: "HVO (Hydrotreated Vegetable Oil) is highly paraffinic and has excellent cetane properties."
},
{
  id: "rfb34",
  question: "Which blending component is used to reduce the aromatic content in diesel?",
  choices: ["LCO", "HVO", "Reformate", "Bitumen"],
  correct: 1,
  explanation: "HVO is free of aromatics and helps reduce the aromatic content in diesel blends."
},
{
  id: "rfb35",
  question: "Which gasoline component is most sensitive to oxidation?",
  choices: ["Reformate", "Alkylate", "Isomerate", "Butane"],
  correct: 0,
  explanation: "Reformate contains unsaturated aromatics, making it more prone to oxidation and gum formation."
},
{
  id: "rfb36",
  question: "Which blending component is used to improve gasoline cold start performance?",
  choices: ["Butane", "Reformate", "Alkylate", "Diesel"],
  correct: 0,
  explanation: "Butane increases volatility, aiding cold start performance in winter gasoline blends."
},
{
  id: "rfb37",
  question: "Which diesel component is most likely to reduce the flash point?",
  choices: ["Kerosene", "LCO", "HVO", "Bitumen"],
  correct: 0,
  explanation: "Kerosene has a lower flash point and can reduce the overall flash point of diesel blends."
},
{
  id: "rfb38",
  question: "Which blending component is most likely to increase the RVP of gasoline?",
  choices: ["Alkylate", "Reformate", "Butane", "Isomerate"],
  correct: 2,
  explanation: "Butane has a very high vapor pressure and significantly increases the RVP of gasoline."
},
{
  id: "rfb39",
  question: "Which blending component is most suitable for reducing the sulfur content in diesel?",
  choices: ["Hydrotreated diesel", "LCO", "Straight-run diesel", "Bitumen"],
  correct: 0,
  explanation: "Hydrotreated diesel has undergone desulfurization and is used to meet low sulfur specifications."
},
{
  id: "rfb40",
  question: "Which component is most likely to increase the density of gasoline?",
  choices: ["Reformate", "Alkylate", "Isomerate", "Butane"],
  correct: 0,
  explanation: "Reformate has a higher density due to its aromatic content and increases the density of the gasoline pool."
},
{
  id: "rfb41",
  question: "Which blending component is most effective at reducing the smoke point in diesel?",
  choices: ["LCO", "HVO", "Kerosene", "Reformate"],
  correct: 0,
  explanation: "LCO contains high levels of aromatics, which reduce the smoke point and increase particulate emissions."
},
{
  id: "rfb42",
  question: "Which blending component is most likely to increase the lubricity of diesel?",
  choices: ["FAME", "HVO", "Kerosene", "Reformate"],
  correct: 0,
  explanation: "FAME (biodiesel) improves lubricity, especially in ultra-low sulfur diesel which lacks natural lubricants."
},
{
  id: "rfb43",
  question: "Which gasoline component is most likely to increase the MON?",
  choices: ["Reformate", "Alkylate", "Isomerate", "Butane"],
  correct: 0,
  explanation: "Reformate contributes significantly to both RON and MON due to its aromatic content."
},
{
  id: "rfb44",
  question: "Which diesel component is most likely to reduce the sulfur content?",
  choices: ["Hydrotreated diesel", "LCO", "Straight-run diesel", "Bitumen"],
  correct: 0,
  explanation: "Hydrotreating removes sulfur compounds, making hydrotreated diesel suitable for low-sulfur applications."
},
{
  id: "rfb45",
  question: "Which blending component is most likely to increase the cloud point of diesel?",
  choices: ["HVO", "LCO", "Kerosene", "Bitumen"],
  correct: 1,
  explanation: "LCO has poor cold flow properties and can raise the cloud point of diesel blends."
},
{
  id: "rfb46",
  question: "Which component is used to reduce the freezing point of Jet A1?",
  choices: ["Kerosene", "Butane", "Reformate", "Diesel"],
  correct: 0,
  explanation: "Jet A1 is primarily composed of kerosene, which has a low freezing point suitable for high-altitude flight."
},
{
  id: "rfb47",
  question: "Which blending component is most likely to increase the gum content in gasoline?",
  choices: ["Reformate", "Alkylate", "Isomerate", "Butane"],
  correct: 0,
  explanation: "Reformate contains unsaturated hydrocarbons that can oxidize and form gums during storage."
},
{
  id: "rfb48",
  question: "Which blending component is most suitable for reducing the aromatic content in gasoline?",
  choices: ["Reformate", "Alkylate", "FCC gasoline", "Coker naphtha"],
  correct: 1,
  explanation: "Alkylate is free of aromatics and is used to dilute aromatic-rich components like reformate."
},
{
  id: "rfb49",
  question: "Which component is most likely to increase the cetane number of diesel?",
  choices: ["HVO", "LCO", "Reformate", "Butane"],
  correct: 0,
  explanation: "HVO diesel has a high cetane number and is used to improve ignition quality in diesel blends."
},
{
  id: "rfb50",
  question: "Which blending component is most likely to increase the RVP of gasoline in summer?",
  choices: ["Butane", "Alkylate", "Reformate", "Isomerate"],
  correct: 0,
  explanation: "Butane's high vapor pressure makes it a key contributor to RVP increases, especially problematic in summer."
}


        ]
      },

  specialty_products: { 
    title: "LPG, VGO, Bitumen, and Other Specialty Products", 
    questions: [

{
  id: "sp1",
  question: "Which specialty products are considered light hydrocarbons?",
  choices: ["LPG", "VGO", "Bitumen", "Naphtha"],
  correct: [0, 3],
  explanation: "LPG and naphtha are light hydrocarbons with low boiling points, while VGO and bitumen are heavier fractions with higher boiling ranges."
},
{
  id: "sp2",
  question: "Which products are sensitive to temperature during storage?",
  choices: ["LPG", "Bitumen", "VGO", "Diesel"],
  correct: [0, 1, 2],
  explanation: "LPG is volatile and must be stored under pressure; bitumen and VGO are viscous and require heating to remain pumpable."
},
{
  id: "sp3",
  question: "Which products are commonly used as feedstock for cracking units?",
  choices: ["VGO", "LPG", "Bitumen", "Gasoline"],
  correct: [0],
  explanation: "VGO (Vacuum Gas Oil) is a primary feedstock for FCC and hydrocracking units due to its high molecular weight and conversion potential."
},
{
  id: "sp4",
  question: "Which product is typically stored in underground salt caverns?",
  choices: ["Bitumen", "LPG", "Diesel", "VGO"],
  correct: [1],
  explanation: "LPG is stored in underground salt caverns to safely manage its high vapor pressure and flammability."
},
{
  id: "sp5",
  question: "Which of the following has the highest viscosity at ambient temperature?",
  choices: ["LPG", "VGO", "Bitumen", "Naphtha"],
  correct: [2],
  explanation: "Bitumen is a semi-solid at ambient temperature and has extremely high viscosity compared to other petroleum products."
},
{
  id: "sp6",
  question: "Which product is most likely to form hydrates in the presence of water?",
  choices: ["Bitumen", "LPG", "VGO", "Jet A1"],
  correct: [1],
  explanation: "LPG can form hydrates or ice crystals when water is present, especially during pressure drops, posing operational risks."
},
{
  id: "sp7",
  question: "Which test is used to determine the softening point of bitumen?",
  choices: ["ASTM D86", "Pensky-Martens", "Ring and Ball", "Reid Vapor Pressure"],
  correct: [2],
  explanation: "The Ring and Ball method is the standard test to determine the softening point of bitumen, indicating its temperature sensitivity."
},
{
  id: "sp8",
  question: "Which products typically require desulfurization before further processing?",
  choices: ["LPG", "VGO", "Bitumen", "Jet A1"],
  correct: [1, 2],
  explanation: "VGO and bitumen often contain high sulfur levels and must be desulfurized to meet environmental and process requirements."
},
{
  id: "sp9",
  question: "What is the typical boiling range of VGO?",
  choices: ["< 100¬∞C", "100‚Äì200¬∞C", "200‚Äì380¬∞C", "380‚Äì550¬∞C"],
  correct: [3],
  explanation: "VGO is obtained from vacuum distillation and typically boils between 380¬∞C and 550¬∞C."
},
{
  id: "sp10",
  question: "Which product is primarily used in road construction and waterproofing?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [2],
  explanation: "Bitumen is widely used in road paving and waterproofing due to its adhesive and water-resistant properties."
},
{
  id: "sp11",
  question: "Which of the following are typical LPG quality specifications?",
  choices: ["Low sulfur content", "High vapor pressure", "Low boiling point", "High viscosity"],
  correct: [0, 1, 2],
  explanation: "LPG is characterized by low sulfur, high vapor pressure, and low boiling point. It is a light, volatile product with low viscosity."
},
{
  id: "sp12",
  question: "Which of the following are typical contaminants in LPG?",
  choices: ["Water", "Hydrogen sulfide", "Asphaltenes", "Mercaptans"],
  correct: [0, 1, 3],
  explanation: "LPG must be free of water, H2S, and mercaptans to avoid corrosion and ensure safety. Asphaltenes are not present in LPG."
},
{
  id: "sp13",
  question: "Which product is most likely to require heating before pumping?",
  choices: ["LPG", "Bitumen", "Diesel", "Naphtha"],
  correct: [1],
  explanation: "Bitumen is solid or highly viscous at ambient temperature and must be heated to flow or be pumped."
},
{
  id: "sp14",
  question: "Which of the following are typical applications of VGO?",
  choices: ["FCC feedstock", "Hydrocracking feedstock", "Lubricant base oil", "Jet fuel"],
  correct: [0, 1],
  explanation: "VGO is used as feedstock in FCC and hydrocracking units to produce lighter, more valuable products."
},
{
  id: "sp15",
  question: "Which of the following are typical LPG components?",
  choices: ["Propane", "Butane", "Pentane", "Hexane"],
  correct: [0, 1],
  explanation: "LPG is primarily composed of propane and butane. Pentane and hexane are heavier and typically found in naphtha."
},
{
  id: "sp16",
  question: "Which product is most likely to contain asphaltenes?",
  choices: ["LPG", "VGO", "Bitumen", "Jet A1"],
  correct: [2],
  explanation: "Bitumen contains a high concentration of asphaltenes, contributing to its high viscosity and dark color."
},
{
  id: "sp17",
  question: "Which of the following are typical properties of bitumen?",
  choices: ["High softening point", "High sulfur content", "Low volatility", "High pour point"],
  correct: [0, 1, 2, 3],
  explanation: "Bitumen has a high softening point, high sulfur, low volatility, and a high pour point, making it solid at room temperature."
},
{
  id: "sp18",
  question: "Which of the following are typical LPG safety concerns?",
  choices: ["Flammability", "Corrosivity", "High pressure", "Toxicity"],
  correct: [0, 2],
  explanation: "LPG is highly flammable and stored under pressure. It is not inherently toxic but can displace oxygen in confined spaces."
},
{
  id: "sp19",
  question: "Which of the following are typical bitumen quality tests?",
  choices: ["Penetration test", "Ring and Ball softening point", "Flash point", "Cetane number"],
  correct: [0, 1, 2],
  explanation: "Bitumen is tested for penetration, softening point, and flash point. Cetane number is not relevant for bitumen."
},
{
  id: "sp20",
  question: "Which of the following are typical LPG specifications?",
  choices: ["Doctor test", "Reid Vapor Pressure", "Evaporation test", "Cetane index"],
  correct: [0, 1, 2],
  explanation: "LPG is tested using the Doctor test for sulfur, RVP for volatility, and evaporation tests for residue. Cetane index is for diesel."
},
{
  id: "sp21",
  question: "Which of the following are typical uses of LPG?",
  choices: ["Domestic heating", "Petrochemical feedstock", "Road paving", "Cooking fuel"],
  correct: [0, 1, 3],
  explanation: "LPG is used for heating, cooking, and as a petrochemical feedstock. It is not used in road paving (bitumen is)."
},
{
  id: "sp22",
  question: "Which of the following are typical characteristics of VGO?",
  choices: ["High boiling point", "Low density", "High sulfur content", "Used in FCC"],
  correct: [0, 2, 3],
  explanation: "VGO has a high boiling point, moderate to high sulfur content, and is used in FCC units. It has higher density than lighter products."
},
{
  id: "sp23",
  question: "Which of the following are typical flash point values for bitumen?",
  choices: ["> 100¬∞C", "> 180¬∞C", "> 230¬∞C", "> 250¬∞C"],
  correct: [2, 3],
  explanation: "Bitumen has a high flash point, typically above 230‚Äì250¬∞C, due to its heavy composition and low volatility."
},
{
  id: "sp24",
  question: "Which of the following are typical LPG handling precautions?",
  choices: ["Avoid heat sources", "Ensure ventilation", "Use corrosion-resistant materials", "Store at ambient pressure"],
  correct: [0, 1, 2],
  explanation: "LPG must be kept away from heat, stored under pressure, and handled with corrosion-resistant equipment in ventilated areas."
},
{
  id: "sp25",
  question: "Which of the following are typical indicators of bitumen quality?",
  choices: ["Penetration index", "Softening point", "Viscosity at 60¬∞C", "Cetane number"],
  correct: [0, 1, 2],
  explanation: "Bitumen quality is assessed using penetration index, softening point, and viscosity. Cetane number is not applicable."
},

{
  id: "sp26",
  question: "Which of the following are typical flash point values for bitumen?",
  choices: [">100¬∞C", ">180¬∞C", ">230¬∞C", ">250¬∞C"],
  correct: [2, 3],
  explanation: "Bitumen has a very high flash point, typically above 230‚Äì250¬∞C, due to its heavy molecular structure and low volatility."
},
{
  id: "sp27",
  question: "Which of the following are typical LPG safety tests?",
  choices: ["Doctor test", "Copper strip corrosion", "Flash point", "Penetration test"],
  correct: [0, 1],
  explanation: "LPG is tested for sulfur content using the Doctor test and for corrosivity using the copper strip corrosion test. Flash point and penetration tests are not applicable."
},
{
  id: "sp28",
  question: "Which of the following are typical bitumen quality indicators?",
  choices: ["Penetration", "Softening point", "Flash point", "Cetane number"],
  correct: [0, 1, 2],
  explanation: "Bitumen is characterized by penetration, softening point, and flash point. Cetane number is not relevant for bitumen."
},
{
  id: "sp29",
  question: "Which of the following are typical LPG volatility tests?",
  choices: ["Evaporation test", "Reid Vapor Pressure", "ASTM D86", "Distillation under vacuum"],
  correct: [0, 1],
  explanation: "LPG volatility is assessed using evaporation tests and Reid Vapor Pressure. ASTM D86 and vacuum distillation are not suitable for LPG."
},
{
  id: "sp30",
  question: "Which of the following are typical contaminants in bitumen?",
  choices: ["Asphaltenes", "Water", "Sulfur", "Paraffins"],
  correct: [0, 1, 2],
  explanation: "Bitumen contains asphaltenes and sulfur naturally, and water contamination must be avoided to prevent foaming and degradation."
},
{
  id: "sp31",
  question: "Which of the following are typical uses of VGO?",
  choices: ["Lubricant base oil", "FCC feedstock", "Hydrocracking feedstock", "Jet fuel"],
  correct: [1, 2],
  explanation: "VGO is primarily used as feedstock for FCC and hydrocracking units to produce lighter fuels. It is not used directly as a fuel or lubricant."
},
{
  id: "sp32",
  question: "Which of the following are typical LPG storage requirements?",
  choices: ["Pressurized tanks", "Ambient temperature", "Underground caverns", "Cryogenic tanks"],
  correct: [0, 2],
  explanation: "LPG is stored in pressurized tanks or underground salt caverns to manage its high vapor pressure. Cryogenic storage is not required."
},
{
  id: "sp33",
  question: "Which of the following are typical bitumen handling precautions?",
  choices: ["Preheating before pumping", "Avoid water contact", "Use of insulated pipelines", "Storage at ambient temperature"],
  correct: [0, 1, 2],
  explanation: "Bitumen must be preheated and kept insulated to maintain flow. Water contact must be avoided to prevent foaming and explosions."
},
{
  id: "sp34",
  question: "Which of the following are typical LPG components?",
  choices: ["Methane", "Propane", "Butane", "Ethane"],
  correct: [1, 2],
  explanation: "LPG is mainly composed of propane and butane. Methane and ethane are typically found in natural gas, not LPG."
},
{
  id: "sp35",
  question: "Which of the following are typical bitumen softening point test methods?",
  choices: ["Ring and Ball", "Penetration test", "Reid Vapor Pressure", "ASTM D36"],
  correct: [0, 3],
  explanation: "The softening point of bitumen is measured using the Ring and Ball method, standardized under ASTM D36."
},
{
  id: "sp36",
  question: "Which of the following are typical LPG purity requirements?",
  choices: ["Low sulfur", "No water", "No asphaltenes", "Low octane number"],
  correct: [0, 1],
  explanation: "LPG must be free of sulfur and water to prevent corrosion and hydrate formation. Octane number and asphaltenes are not relevant."
},
{
  id: "sp37",
  question: "Which of the following are typical bitumen applications?",
  choices: ["Roofing", "Road paving", "Jet fuel", "Waterproofing"],
  correct: [0, 1, 3],
  explanation: "Bitumen is used in construction for roofing, road paving, and waterproofing. It is not used as a fuel."
},
{
  id: "sp38",
  question: "Which of the following are typical LPG hazards?",
  choices: ["High flammability", "Toxicity", "Asphaltene precipitation", "Hydrate formation"],
  correct: [0, 3],
  explanation: "LPG is highly flammable and can form hydrates in the presence of water. It is not inherently toxic and does not contain asphaltenes."
},
{
  id: "sp39",
  question: "Which of the following are typical VGO properties?",
  choices: ["High boiling point", "Low viscosity", "High sulfur content", "Used in FCC"],
  correct: [0, 2, 3],
  explanation: "VGO has a high boiling point and sulfur content, and is used in FCC units. It is more viscous than lighter products."
},
{
  id: "sp40",
  question: "Which of the following are typical bitumen stability concerns?",
  choices: ["Asphaltene precipitation", "Water contamination", "Low flash point", "High volatility"],
  correct: [0, 1],
  explanation: "Bitumen stability is affected by asphaltene precipitation and water contamination. It has low volatility and a high flash point."
},
{
  id: "sp41",
  question: "Which of the following are typical LPG quality control parameters?",
  choices: ["Doctor test", "Evaporation residue", "Flash point", "Penetration index"],
  correct: [0, 1],
  explanation: "LPG is tested for sulfur using the Doctor test and for evaporation residue to assess heavy ends. Flash point and penetration index are not applicable."
},
{
  id: "sp42",
  question: "Which of the following are typical bitumen softening point ranges?",
  choices: ["50‚Äì70¬∞C", "100‚Äì150¬∞C", "230‚Äì250¬∞C", "300‚Äì350¬∞C"],
  correct: [2],
  explanation: "Bitumen softening point typically falls between 230¬∞C and 250¬∞C, indicating its high-temperature resistance."
},
{
  id: "sp43",
  question: "Which of the following are typical LPG boiling points?",
  choices: ["-42¬∞C", "-0.5¬∞C", "36¬∞C", "100¬∞C"],
  correct: [0, 1],
  explanation: "LPG components like propane and butane have boiling points around -42¬∞C and -0.5¬∞C respectively, making them highly volatile."
},
{
  id: "sp44",
  question: "Which of the following are typical bitumen test methods?",
  choices: ["Penetration test", "Ring and Ball", "Cetane index", "Flash point test"],
  correct: [0, 1, 3],
  explanation: "Bitumen is tested using penetration, softening point (Ring and Ball), and flash point methods. Cetane index is for diesel."
},
{
  id: "sp45",
  question: "Which of the following are typical LPG applications?",
  choices: ["Cooking", "Heating", "Road paving", "Petrochemical feedstock"],
  correct: [0, 1, 3],
  explanation: "LPG is used for cooking, heating, and as a petrochemical feedstock. It is not used in road paving."
},
{
  id: "sp46",
  question: "Which of the following are typical bitumen handling temperatures?",
  choices: ["Ambient", "100¬∞C", "150¬∞C", "200¬∞C"],
  correct: [2, 3],
  explanation: "Bitumen must be heated to 150‚Äì200¬∞C to remain fluid and pumpable during handling and application."
},
{
  id: "sp47",
  question: "Which of the following are typical LPG impurities to be removed?",
  choices: ["Water", "Mercaptans", "Asphaltenes", "Hydrogen sulfide"],
  correct: [0, 1, 3],
  explanation: "LPG must be free of water, mercaptans, and hydrogen sulfide to ensure safety and prevent corrosion. Asphaltenes are not present in LPG."
},
{
  id: "sp48",
  question: "Which of the following are typical bitumen stability tests?",
  choices: ["Spot test", "Compatibility test", "Doctor test", "Penetration test"],
  correct: [0, 1],
  explanation: "Bitumen stability is assessed using spot and compatibility tests to evaluate asphaltene precipitation and fluxant interaction."
},
{
  id: "sp49",
  question: "Which of the following are typical LPG volatility constraints?",
  choices: ["High RVP", "Low boiling point", "High flash point", "Low sulfur"],
  correct: [0, 1, 3],
  explanation: "LPG must have high RVP, low boiling point, and low sulfur content. Flash point is not a relevant constraint for LPG."
},
{
  id: "sp50",
  question: "Which of the following are typical bitumen composition elements?",
  choices: ["Asphaltenes", "Resins", "Paraffins", "Aromatics"],
  correct: [0, 1, 3],
  explanation: "Bitumen is composed of asphaltenes, resins, and aromatics. Paraffins are more typical of lighter fractions like waxes."
}

 ]
      },
	  

  credit_finance: {
    title: "Credit & Finance",
    questions: [
      {
        id: "cf1",
        question: "What are the main types of payment risk in trade finance?",
        choices: ["Credit risk", "Operational risk", "Political risk", "Market risk"],
        correct: [0,2],
        explanation: "Credit risk and political risk are key concerns in trade finance, especially in cross-border transactions. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf2",
        question: "Which instruments are used to mitigate payment risk?",
        choices: ["Letter of Credit", "Bank Guarantee", "Open Account", "Standby LC"],
        correct: [0,1,3],
        explanation: "Letters of Credit, Bank Guarantees, and Standby LCs are commonly used to secure payment. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf3",
        question: "What does UCP 600 regulate?",
        choices: ["Incoterms", "Letters of Credit", "Banking fees", "Cargo insurance"],
        correct: [1],
        explanation: "UCP 600 is the ICC regulation governing Letters of Credit. (The job of a trading operator - April 2025 1.pdf)"
      },
      {
        id: "cf4",
        question: "Which parties are involved in a Letter of Credit?",
        choices: ["Applicant", "Beneficiary", "Issuing Bank", "Advising Bank"],
        correct: [0,1,2,3],
        explanation: "All listed parties are involved in the LC process. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf5",
        question: "What is the role of the Advising Bank?",
        choices: ["Issues the LC", "Confirms authenticity", "Pays the beneficiary", "Checks documents"],
        correct: [1],
        explanation: "The Advising Bank confirms the LC‚Äôs authenticity to the beneficiary. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf6",
        question: "Which risks are covered by credit insurance?",
        choices: ["Non-payment", "Political risk", "Currency fluctuation", "Bank default"],
        correct: [0,1],
        explanation: "Credit insurance typically covers non-payment and political risks. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf7",
        question: "What is the main risk of an open account transaction?",
        choices: ["Buyer default", "Document fraud", "Bank insolvency", "Cargo damage"],
        correct: [0],
        explanation: "Open account exposes the seller to buyer default risk. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf8",
        question: "Which payment terms offer the highest security for the seller?",
        choices: ["Cash in advance", "Letter of Credit", "Open account", "Bank guarantee"],
        correct: [0,1],
        explanation: "Cash in advance and LC provide strong protection for the seller. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf9",
        question: "What is the role of the Issuing Bank in an LC?",
        choices: ["Issues the LC", "Pays the beneficiary", "Checks documents", "Confirms authenticity"],
        correct: [0,1,2],
        explanation: "The Issuing Bank issues the LC, checks documents, and pays if compliant. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf10",
        question: "Which document triggers payment under a documentary sale?",
        choices: ["Commercial Invoice", "Original Bill of Lading", "Certificate of Origin", "Letter of Credit"],
        correct: [0,1,3],
        explanation: "Payment is triggered by presentation of compliant documents under the LC. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf11",
        question: "What is the purpose of a Standby Letter of Credit?",
        choices: ["Guarantee payment", "Replace bank guarantee", "Finance cargo", "Confirm shipment"],
        correct: [0,1],
        explanation: "Standby LC acts as a payment guarantee and can replace a bank guarantee. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf12",
        question: "Which factors influence a counterparty‚Äôs credit profile?",
        choices: ["Payment history", "Country risk", "Financial statements", "Cargo type"],
        correct: [0,1,2],
        explanation: "Credit profile is assessed based on payment history, country risk, and financials. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf13",
        question: "Which document confirms the agreed payment terms?",
        choices: ["Contract", "Invoice", "Letter of Credit", "Charter-party"],
        correct: [0,2],
        explanation: "Payment terms are defined in the contract and LC. (The job of a trading operator - April 2025 1.pdf)"
      },
      {
        id: "cf14",
        question: "What is the risk of relying solely on invoice payment?",
        choices: ["Delayed payment", "Non-payment", "Currency risk", "Political risk"],
        correct: [0,1],
        explanation: "Invoice-based payment exposes the seller to delay and default. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf15",
        question: "Which tools help monitor financial exposure?",
        choices: ["Credit limits", "Daily exposure reports", "Bank confirmations", "Cargo manifest"],
        correct: [0,1],
        explanation: "Credit limits and exposure reports help manage financial risk. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf16",
        question: "What is the benefit of using a confirmed LC?",
        choices: ["Reduced seller risk", "Bank payment guarantee", "Faster payment", "Lower cost"],
        correct: [0,1],
        explanation: "Confirmed LC adds a second bank‚Äôs guarantee, reducing seller risk. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf17",
        question: "Which risks are not covered by credit insurance?",
        choices: ["Fraud", "Cargo damage", "Currency fluctuation", "Bank default"],
        correct: [0,1,2,3],
        explanation: "Credit insurance excludes fraud, cargo damage, currency and bank risks. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf18",
        question: "What is the role of the trading operator in credit risk management?",
        choices: ["Monitor payment terms", "Check document compliance", "Flag exposure", "Negotiate LC terms"],
        correct: [0,1,2],
        explanation: "Operators monitor terms, check documents, and flag exposure. (The job of a trading operator - April 2025 1.pdf)"
      },
      {
        id: "cf19",
        question: "Which payment method is most risky for the seller?",
        choices: ["Open account", "Cash in advance", "Letter of Credit", "Bank guarantee"],
        correct: [0],
        explanation: "Open account offers no protection to the seller. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf20",
        question: "Which document confirms the buyer‚Äôs obligation to pay?",
        choices: ["Letter of Credit", "Contract", "Invoice", "Bank guarantee"],
        correct: [0,1],
        explanation: "LC and contract confirm buyer‚Äôs obligation to pay. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf21",
        question: "What is the role of the Confirming Bank?",
        choices: ["Adds payment guarantee", "Issues the LC", "Checks documents", "Pays the seller"],
        correct: [0,3],
        explanation: "Confirming Bank adds its guarantee and pays if documents are compliant. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf22",
        question: "Which risks are considered country risks?",
        choices: ["Political instability", "Currency controls", "Sanctions", "Bank insolvency"],
        correct: [0,1,2],
        explanation: "Country risk includes political, currency and sanction-related risks. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
      {
        id: "cf23",
        question: "Which document defines the financial terms of a transaction?",
        choices: ["Contract", "Invoice", "Letter of Credit", "Cargo Manifest"],
        correct: [0,2],
        explanation: "Contract and LC define financial terms such as payment method and timing. (The job of a trading operator - April 2025 1.pdf)"
      },
      {
        id: "cf24",
        question: "Which tools are used to secure payment in high-risk countries?",
        choices: ["Confirmed LC", "Credit insurance", "Bank guarantee", "Open account"],
        correct: [0,1,2],
        explanation: "Confirmed LC, insurance and guarantees help mitigate country risk. (TRADE FINANCE-Payment risk securities.pdf)"
      },
      {
        id: "cf25",
        question: "Which factors increase financial exposure?",
        choices: ["High contract value", "Long payment terms", "Weak buyer profile", "Unconfirmed LC"],
        correct: [0,1,2,3],
        explanation: "All listed factors increase exposure and require monitoring. (CREDIT MANAGEMENT TOTAL T&S -M. Gallouj 2018 (1).pdf)"
      },
	  
      {
        id: "cf26",
        question: "Which documents must be presented to the bank under a documentary credit?",
        choices: ["Invoice", "Bill of Lading", "Certificate of Origin", "Cargo Manifest"],
        correct: [0,1,2],
        explanation: "Under UCP 600, the bank requires invoice, B/L, and Certificate of Origin for payment."
      },
      {
        id: "cf27",
        question: "What does the bank check when reviewing documents under an LC?",
        choices: ["Compliance with LC terms", "Cargo quality", "Document consistency", "Shipment timing"],
        correct: [0,2],
        explanation: "Banks check compliance and consistency of documents, not the goods themselves."
      },
      {
        id: "cf28",
        question: "Which instruments are used to secure payment in case of buyer default?",
        choices: ["Standby LC", "Silent cover", "Credit insurance", "Open account"],
        correct: [0,1,2],
        explanation: "Standby LC, silent cover, and insurance mitigate non-payment risk."
      },
      {
        id: "cf29",
        question: "What are the disadvantages of silent cover?",
        choices: ["Long payment delay", "Partial risk transfer", "High cost", "Buyer obligation"],
        correct: [0,1,2],
        explanation: "Silent cover involves long delays, partial risk transfer, and cost for the seller."
      },
      {
        id: "cf30",
        question: "Which ratios are used to assess a counterparty‚Äôs creditworthiness?",
        choices: ["ROE", "Current ratio", "Debt-to-equity", "Gross margin"],
        correct: [0,1,2,3],
        explanation: "Profitability, liquidity, and solvency ratios are key in credit analysis."
      },
      {
        id: "cf31",
        question: "What is the role of the credit manager?",
        choices: ["Set credit lines", "Validate excess", "Monitor exposure", "Negotiate contracts"],
        correct: [0,1,2],
        explanation: "Credit managers define limits, validate excess, and monitor exposure."
      },
      {
        id: "cf32",
        question: "Which actions help reduce working capital requirement (WCR)?",
        choices: ["Receivables discounting", "Inventory financing", "Credit extension", "Prepayment"],
        correct: [0,1,2],
        explanation: "Discounting and financing reduce WCR by improving cash flow."
      },
      {
        id: "cf33",
        question: "Which risks are considered political risks?",
        choices: ["Sanctions", "Currency controls", "Government instability", "Bank default"],
        correct: [0,1,2],
        explanation: "Political risks include sanctions, currency restrictions, and instability."
      },
      {
        id: "cf34",
        question: "What is the purpose of a Bid Bond?",
        choices: ["Prevent offer withdrawal", "Guarantee performance", "Secure payment", "Reduce exposure"],
        correct: [0],
        explanation: "Bid Bonds prevent withdrawal of offers during tenders."
      },
      {
        id: "cf35",
        question: "What is the role of the Performance Bond?",
        choices: ["Guarantee contract execution", "Secure payment", "Cover cargo loss", "Reduce WCR"],
        correct: [0],
        explanation: "Performance Bonds cover non-performance after contract award."
      },
      {
        id: "cf36",
        question: "Which elements are part of credit risk analysis?",
        choices: ["Ownership", "Financial profile", "Business profile", "Market risk"],
        correct: [0,1,2,3],
        explanation: "Credit risk analysis includes ownership, financials, business and market indicators."
      },
      {
        id: "cf37",
        question: "What is the Time Value of Money (TVM)?",
        choices: ["Money today is worth more than tomorrow", "Interest rate impact", "Discounting principle", "Currency risk"],
        correct: [0,1,2],
        explanation: "TVM reflects the idea that money now is more valuable due to earning potential."
      },
      {
        id: "cf38",
        question: "Which costs impact the P&L in trade finance?",
        choices: ["LC cost", "Late payment interest", "Insurance", "Freight differential"],
        correct: [0,1,2],
        explanation: "Financial costs like LC fees, interest, and insurance affect profitability."
      },
      {
        id: "cf39",
        question: "Which documents are needed to issue a customer profile?",
        choices: ["Company description", "Shareholder list", "Rating", "Stock exchange info"],
        correct: [0,1,2,3],
        explanation: "Customer profiles include company structure, shareholders, rating, and market data."
      },
      {
        id: "cf40",
        question: "Which reports are produced by the credit team?",
        choices: ["Country risk", "Exposure per counterparty", "Bank exposure", "Derivative reports"],
        correct: [0,1,2,3],
        explanation: "Credit team monitors country, counterparty, bank and derivative exposures."
      },
      {
        id: "cf41",
        question: "Which documents are required for counterparty clearance?",
        choices: ["Certificate of incorporation", "Bank reference", "Shareholder list", "Worldcheck screening"],
        correct: [0,1,2,3],
        explanation: "Clearance requires legal, financial and compliance documents."
      },
      {
        id: "cf42",
        question: "Which payment methods are used in physical trading?",
        choices: ["Open account", "Standby LC", "Documentary LC", "Offset"],
        correct: [0,1,2,3],
        explanation: "All listed methods are used depending on counterparty and risk."
      },
      {
        id: "cf43",
        question: "Which regions have the highest open credit exposure in physical trading?",
        choices: ["West Europe", "Asia", "America", "Africa"],
        correct: [0,2],
        explanation: "West Europe and America hold the largest open credit exposure."
      },
      {
        id: "cf44",
        question: "Which actions must the operator take to secure payment?",
        choices: ["Ensure document compliance", "Monitor due dates", "Invoice interest for delay", "Minimize working capital"],
        correct: [0,1,2,3],
        explanation: "Operators must ensure compliance, timely payment, and financial efficiency."
      },
      {
        id: "cf45",
        question: "Which departments must be involved in case of payment delay?",
        choices: ["Credit", "Trading", "Legal", "Insurance"],
        correct: [0,1,2,3],
        explanation: "All listed departments may be involved to mitigate financial loss."
      },
      {
        id: "cf46",
        question: "Which documents are used to support payment claims?",
        choices: ["Invoice", "Shipping documents", "LOI", "Warranty of title"],
        correct: [0,1,3],
        explanation: "Invoices, shipping docs and title warranties support payment claims."
      },
      {
        id: "cf47",
        question: "Which costs must be re-invoiced by the operator?",
        choices: ["Freight", "Inspection", "Storage", "Financial costs"],
        correct: [0,1,2,3],
        explanation: "Operators re-invoice all transaction-related costs."
      },
      {
        id: "cf48",
        question: "Which financial guarantees may be required by Credit Dept?",
        choices: ["Standby LC", "Documentary LC", "Silent cover", "Insurance"],
        correct: [0,1,2,3],
        explanation: "Credit Dept may require any of these instruments based on risk profile."
      },
      {
        id: "cf49",
        question: "Which elements must be verified before passing title?",
        choices: ["LC in place", "Document availability", "Credit approval", "Contract compliance"],
        correct: [0,1,2,3],
        explanation: "All listed elements must be verified to secure the transaction."
      },
      {
        id: "cf50",
        question: "Which tools help evaluate pricing and financial impact?",
        choices: ["Medissys valuation", "Eco Web", "Exposure reports", "LC tracker"],
        correct: [0,1],
        explanation: "Medissys and Eco Web support pricing and financial evaluation."
      }

  ]
      },


 loss_control: {
    title: "Loss Control",
    questions: [
      {
        id: "lc1",
        question: "What is the primary objective of Loss Control in oil operations?",
        choices: ["Reduce product losses", "Optimise transport costs", "Improve crude quality", "Ensure customs compliance"],
        correct: [0],
        explanation: "Loss Control aims to reduce both physical and paper losses during operations."
      },
      {
        id: "lc2",
        question: "Which types of losses are identified in Loss Control?",
        choices: ["Physical losses", "Paper losses", "Tax losses", "Environmental losses"],
        correct: [0,1],
        explanation: "Physical losses (e.g. leakage, evaporation) and paper losses (e.g. measurement or calculation errors) are the main types."
      },
      {
        id: "lc3",
        question: "Which tool is used to adjust discrepancies between ship and shore measurements?",
        choices: ["VCF", "VEF", "SOF", "API 53B"],
        correct: [1],
        explanation: "The Vessel Experience Factor (VEF) is a ratio used to align shipboard measurements with shore figures."
      },
      {
        id: "lc4",
        question: "How many voyages are required to calculate a valid VEF?",
        choices: ["5", "10", "20", "Minimum 5, maximum 20"],
        correct: [3],
        explanation: "VEF calculation requires at least 5 qualified voyages and up to 20 maximum."
      },
      {
        id: "lc5",
        question: "What does a VEF > 1 indicate?",
        choices: ["Ship quantity is increased", "Ship quantity is reduced", "Quality is improved", "Density is corrected"],
        correct: [1],
        explanation: "A VEF greater than 1 means the ship quantity is reduced after correction."
      },
      {
        id: "lc6",
        question: "Which method is used to measure the product level in a tank?",
        choices: ["Innage", "Ullage", "Radar", "Thermography"],
        correct: [1],
        explanation: "Ullage measures the empty space in the tank, allowing deduction of product height."
      },
      {
        id: "lc7",
        question: "Which factor is used to correct volume to reference temperature?",
        choices: ["VCF", "VEF", "API 53B", "ASTM 54B"],
        correct: [0],
        explanation: "Volume Correction Factor (VCF) adjusts measured volume to the reference temperature (15¬∞C)."
      },
      {
        id: "lc8",
        question: "What risks are associated with unexplained product loss?",
        choices: ["Impact on P&L", "Customs fines", "Environmental pollution", "Fraud suspicion"],
        correct: [0,1,2,3],
        explanation: "Unexplained losses can lead to financial, legal, environmental and reputational consequences."
      },
      {
        id: "lc9",
        question: "What measurement error can cause an apparent loss of 4,310 litres?",
        choices: ["1 mm height", "1¬∞C temperature", "0.001 density", "1 m¬≥ volume"],
        correct: [0],
        explanation: "A 1 mm error in height measurement can result in a 4,310 litre discrepancy in large tanks."
      },
      {
        id: "lc10",
        question: "What is the role of Loss Control in contracts?",
        choices: ["Verify quantity and quality clauses", "Negotiate prices", "Manage insurance", "Audit suppliers"],
        correct: [0],
        explanation: "Loss Control ensures contract clauses related to quantity and quality are correctly applied."
      },
      {
        id: "lc11",
        question: "Which document records all events during cargo operations?",
        choices: ["Statement of Facts (SOF)", "Charter Party", "NOR", "Cargo Manifest"],
        correct: [0],
        explanation: "SOF lists all operational events during loading and discharging."
      },
      {
        id: "lc12",
        question: "What does GOV stand for?",
        choices: ["Gross Observed Volume", "General Oil Volume", "Gas Oil Value", "Global Operational Value"],
        correct: [0],
        explanation: "GOV refers to the total volume measured before any corrections."
      },
      {
        id: "lc13",
        question: "What is the corrected volume at standard temperature called?",
        choices: ["GSV", "VCF", "TOV", "GOV"],
        correct: [0],
        explanation: "Gross Standard Volume (GSV) is the volume corrected to 15¬∞C using VCF."
      },
      {
        id: "lc14",
        question: "Which sampling method is preferred for closed systems?",
        choices: ["MK7", "Open thief", "First foot", "Running sample"],
        correct: [0],
        explanation: "MK7 samplers are designed for closed systems to ensure safety and representativity."
      },
      {
        id: "lc15",
        question: "What is the purpose of Crude Oil Washing (COW)?",
        choices: ["Recover residual oil", "Clean tanks", "Reduce pollution", "Improve quality"],
        correct: [0,1,2],
        explanation: "COW helps recover oil residues, clean tanks and reduce environmental impact."
      },
      {
        id: "lc16",
        question: "Which factor affects VCF calculation?",
        choices: ["Temperature", "Density", "Volume", "Pressure"],
        correct: [0,1],
        explanation: "VCF is calculated based on temperature and density of the product."
      },
      {
        id: "lc17",
        question: "What does TOV include?",
        choices: ["Free water", "Oil", "Sediments", "All of the above"],
        correct: [3],
        explanation: "Total Observed Volume (TOV) includes oil, free water and sediments."
      },
      {
        id: "lc18",
        question: "Which document is used to reconcile stock differences?",
        choices: ["Stock reconciliation report", "Bill of Lading", "Certificate of Quality", "Invoice"],
        correct: [0],
        explanation: "Stock reconciliation reports compare expected and actual volumes to identify discrepancies."
      },
      {
        id: "lc19",
        question: "What is the acceptable tolerance for stock reconciliation?",
        choices: ["< 0.5%", "< 1%", "< 2%", "No tolerance"],
        correct: [1],
        explanation: "A tolerance of less than 1% is generally acceptable for stock reconciliation."
      },
      {
        id: "lc20",
        question: "Which operation can cause paper loss?",
        choices: ["Incorrect VCF", "Wrong tank calibration", "Misreading temperature", "All of the above"],
        correct: [3],
        explanation: "All listed errors can lead to paper losses due to incorrect calculations."
      },
	  
{
        id: "lc21",
        question: "Which operation can cause physical loss?",
        choices: ["Tank leakage", "Evaporation", "Pipeline rupture", "All of the above"],
        correct: [3],
        explanation: "All listed operations can result in physical product loss."
      },
      {
        id: "lc22",
        question: "What is the purpose of a first foot sample?",
        choices: ["Check contamination", "Verify initial quality", "Calibrate instruments", "Measure temperature"],
        correct: [0,1],
        explanation: "First foot samples are taken early to detect contamination and confirm product quality."
      },
      {
        id: "lc23",
        question: "Which document defines the agreed quantity and quality terms?",
        choices: ["Contract", "Bill of Lading", "Certificate of Quality", "Charter Party"],
        correct: [0],
        explanation: "The contract outlines the agreed terms for quantity and quality between parties."
      },
      {
        id: "lc24",
        question: "What does a negative stock reconciliation indicate?",
        choices: ["Loss", "Gain", "Measurement error", "All of the above"],
        correct: [0,2],
        explanation: "A negative reconciliation suggests a loss or possible measurement error."
      },
      {
        id: "lc25",
        question: "Which sampling method ensures representativity?",
        choices: ["Running sample", "Spot sample", "First foot", "Top sample"],
        correct: [0],
        explanation: "Running samples are taken during flow and provide a representative product profile."
      },
      {
        id: "lc26",
        question: "What is the role of inert gas during COW?",
        choices: ["Prevent explosion", "Maintain pressure", "Improve cleaning", "Reduce oxygen"],
        correct: [0,3],
        explanation: "Inert gas prevents explosion and reduces oxygen during tank cleaning operations."
      },
      {
        id: "lc27",
        question: "Which factor is critical in calculating VCF?",
        choices: ["API gravity", "Temperature", "Density", "Tank height"],
        correct: [1,2],
        explanation: "VCF is calculated using temperature and density of the crude oil."
      },
      {
        id: "lc28",
        question: "What does GSV exclude?",
        choices: ["Free water", "Sediments", "Oil", "VCF"],
        correct: [0,1],
        explanation: "GSV excludes free water and sediments; it represents clean oil volume at standard temperature."
      },
      {
        id: "lc29",
        question: "Which tool helps detect systematic losses over time?",
        choices: ["VEF", "Stock reconciliation", "Sampling log", "Tank calibration"],
        correct: [1],
        explanation: "Stock reconciliation identifies recurring discrepancies and potential systematic losses."
      },
      {
        id: "lc30",
        question: "What is the impact of incorrect temperature measurement?",
        choices: ["Wrong VCF", "Incorrect volume", "Loss or gain", "All of the above"],
        correct: [3],
        explanation: "Incorrect temperature affects VCF and volume, leading to apparent losses or gains."
      },
      {
        id: "lc31",
        question: "Which document certifies the product‚Äôs physical properties?",
        choices: ["Certificate of Quality", "Bill of Lading", "Invoice", "Charter Party"],
        correct: [0],
        explanation: "The Certificate of Quality confirms the physical characteristics of the cargo."
      },
      {
        id: "lc32",
        question: "What is the purpose of tank calibration?",
        choices: ["Ensure accurate volume measurement", "Detect leaks", "Improve blending", "Reduce losses"],
        correct: [0],
        explanation: "Tank calibration ensures volume measurements are accurate and reliable."
      },
      {
        id: "lc33",
        question: "Which operation is most prone to paper loss?",
        choices: ["Measurement", "Sampling", "Calculation", "All of the above"],
        correct: [3],
        explanation: "Paper losses can occur during measurement, sampling, and calculation stages."
      },
      {
        id: "lc34",
        question: "What does a VEF < 1 indicate?",
        choices: ["Ship quantity is increased", "Ship quantity is reduced", "Loss is expected", "Gain is expected"],
        correct: [0],
        explanation: "A VEF less than 1 increases the ship quantity after correction."
      },
      {
        id: "lc35",
        question: "Which factor is used to convert GOV to GSV?",
        choices: ["VCF", "VEF", "API gravity", "Temperature"],
        correct: [0],
        explanation: "VCF is applied to GOV to obtain GSV at standard temperature."
      },
      {
        id: "lc36",
        question: "What is the role of the Loss Control team during loading?",
        choices: ["Monitor measurements", "Verify sampling", "Check documentation", "All of the above"],
        correct: [3],
        explanation: "Loss Control oversees all aspects of loading to prevent losses and ensure accuracy."
      },
      {
        id: "lc37",
        question: "Which error can result from incorrect tank calibration?",
        choices: ["Wrong volume", "Incorrect reconciliation", "Paper loss", "All of the above"],
        correct: [3],
        explanation: "Incorrect calibration affects volume and reconciliation, leading to paper losses."
      },
      {
        id: "lc38",
        question: "What is the function of the Statement of Facts?",
        choices: ["Record operational events", "Confirm timings", "Support demurrage claims", "All of the above"],
        correct: [3],
        explanation: "SOF documents all events and timings, supporting operational and financial claims."
      },
      {
        id: "lc39",
        question: "Which sampling error can lead to quality disputes?",
        choices: ["Contaminated sample", "Wrong timing", "Incorrect method", "All of the above"],
        correct: [3],
        explanation: "Sampling errors can compromise representativity and lead to disputes over quality."
      },
      {
        id: "lc40",
        question: "What is the impact of incorrect density measurement?",
        choices: ["Wrong VCF", "Incorrect volume", "Loss or gain", "All of the above"],
        correct: [3],
        explanation: "Density affects VCF and volume calculations, impacting reconciliation and perceived losses."
      },
      {
        id: "lc41",
        question: "Which document is used to initiate cargo operations?",
        choices: ["Notice of Readiness (NOR)", "SOF", "Bill of Lading", "Certificate of Origin"],
        correct: [0],
        explanation: "NOR signals that the vessel is ready to commence cargo operations."
      },
      {
        id: "lc42",
        question: "What is the role of blending in Loss Control?",
        choices: ["Achieve target quality", "Reduce off-spec cargo", "Improve value", "All of the above"],
        correct: [3],
        explanation: "Blending helps meet quality specs, reduce penalties, and enhance cargo value."
      },
      {
        id: "lc43",
        question: "Which factor is critical during tank stripping?",
        choices: ["Temperature", "Residue level", "Inert gas", "Tank pressure"],
        correct: [1],
        explanation: "Stripping aims to remove residues; monitoring residue level is essential."
      },
      {
        id: "lc44",
        question: "What is the purpose of a closed sampling system?",
        choices: ["Ensure safety", "Prevent contamination", "Maintain representativity", "All of the above"],
        correct: [3],
        explanation: "Closed systems protect operators, prevent contamination, and ensure sample integrity."
      },
      {
        id: "lc45",
        question: "Which document supports quantity claims?",
        choices: ["Bill of Lading", "SOF", "VEF report", "Stock reconciliation"],
        correct: [3],
        explanation: "Stock reconciliation helps justify quantity discrepancies and support claims."
      },
      {
        id: "lc46",
        question: "What is the impact of incorrect API gravity?",
        choices: ["Wrong VCF", "Incorrect volume", "Quality dispute", "All of the above"],
        correct: [3],
        explanation: "API gravity affects VCF and quality classification, impacting volume and commercial terms."
      },
      {
        id: "lc47",
        question: "Which operation is monitored to prevent contamination?",
        choices: ["Sampling", "Blending", "Tank cleaning", "All of the above"],
        correct: [3],
        explanation: "All listed operations are monitored to avoid contamination risks."
      },
      {
        id: "lc48",
        question: "What is the role of the Loss Control team post-discharge?",
        choices: ["Verify final measurements", "Check reconciliation", "Review documentation", "All of the above"],
        correct: [3],
        explanation: "Post-discharge, Loss Control ensures all data is accurate and reconciled."
      },
      {
        id: "lc49",
        question: "Which factor can cause evaporation losses?",
        choices: ["High temperature", "Low pressure", "Open tank", "All of the above"],
        correct: [3],
        explanation: "Evaporation increases with temperature, low pressure, and exposure to air."
      },
      {
        id: "lc50",
        question: "What is the benefit of accurate reconciliation?",
        choices: ["Loss prevention", "Improved reporting", "Better decision-making", "All of the above"],
        correct: [3],
        explanation: "Accurate reconciliation supports operational integrity, reporting, and strategic decisions."
      }
	  
	   ]
      }
};

    // ---------------------------
    // Unlock logic
    // ---------------------------
 function isThemeUnlocked(theme) {
  const order = Object.keys(quizData);
  const N = order.length;
  if (N === 0) return false;
  // le premier th√®me est toujours dispo
  if (theme === order[0]) return true;

  // date de d√©but pour le d√©blocage mensuel (ajuste si tu veux)
  const start = new Date(2026, 0, 1); // 1 Jan 2026
  const now = new Date();
  const monthDiff = (now.getFullYear() - start.getFullYear()) * 12 + (now.getMonth() - start.getMonth());
  // monthlyMaxIndex = index maximum d√©bloquable par la r√®gle "1 th√®me par mois" (0 = only first)
  const monthlyMaxIndex = Math.max(0, Math.min(N - 1, monthDiff));

  // Construire s√©quentiellement l'indice maximal d√©bloqu√© (pr√©fixe contigu)
  // unlockedIndex = index le plus √©lev√© (>=0) qui est d√©verrouill√© (0 = premier)
  let unlockedIndex = 0;
  for (let k = 1; k < N; k++) {
    const prevTheme = order[k - 1];

    const totalPrev = quizData[prevTheme]?.questions?.length || 0;
    const solvedPrev = getSolvedCount(prevTheme) || 0;

    // On consid√®re "compl√©t√©" seulement si il y a des questions ET que toutes sont r√©solues
    const prevCompleted = (totalPrev > 0) && (solvedPrev === totalPrev);

    // D√©blocage par date : si l'index k est <= monthlyMaxIndex
    const allowedByDate = k <= monthlyMaxIndex;

    // Si le th√®me pr√©c√©dent est compl√©t√© OU la date permet d'atteindre cet index,
    // alors k devient d√©verrouill√©. Sinon on stoppe (assure pr√©fixe contigu).
    if (prevCompleted || allowedByDate) {
      unlockedIndex = k;
    } else {
      break;
    }
  }

  const themeIdx = order.indexOf(theme);
  return themeIdx <= unlockedIndex;
}
    // ---------------------------
    // UI / Themes grid
    // ---------------------------
    function renderThemesGrid() {
      const grid = document.querySelector(".themes");
      if (!grid) return;
      grid.innerHTML = "";

 const icons = {
  cargo_docs: "https://img.icons8.com/fluency/96/document.png",
  crude_types_specs: "https://img.icons8.com/?size=96&id=18348&format=png",
  refined_products: "https://img.icons8.com/color/96/gas-station.png",
  trading_market: "https://img.icons8.com/color/96/combo-chart.png",
  pricing: "https://img.icons8.com/color/96/contract.png",
  refining_blending: "https://img.icons8.com/color/96/factory.png",
  specialty_products: "https://img.icons8.com/color/96/laboratory.png",
  regulations_compliance: "https://img.icons8.com/color/96/law.png",
  operations_coordination: "https://img.icons8.com/color/96/teamwork.png",

  // üÜï New themes
  middle_ops: "https://img.icons8.com/color/96/organization.png", // coordination / back-office
  barge_customs_vetting: "https://img.icons8.com/color/96/cargo-ship.png", // barge transport
  contracts_legal_insurance: "https://img.icons8.com/color/96/law.png", // legal/contracts
  credit_finance: "https://img.icons8.com/color/96/money-bag.png", // finance/credit
  loss_control: "https://img.icons8.com/color/96/inspection.png" // loss control / quality check
};

      Object.keys(quizData).forEach(t => {
        const unlocked = isThemeUnlocked(t);
        const total = quizData[t].questions.length;
        const solved = getSolvedCount(t);
        const pct = total ? Math.round((solved / total) * 100) : 0;
        const icon = unlocked ? (icons[t] || icons['cargo_docs']) : "https://img.icons8.com/ios-filled/96/lock.png";

        const div = document.createElement("div");
        div.className = "theme-button";
        div.innerHTML = `
          <img src="${icon}" alt="${quizData[t].title}"/><br>
          ${quizData[t].title}
          <div class="progress-mini" style="margin-top:10px;width:100%;">
            <div class="progress-mini-fill" style="width:${pct}%"></div>
          </div>
          <div class="mini-row" style="width:100%;">
            <span style="font-size:12px">${solved}/${total || 0} solved</span>
            <span style="font-size:12px">${pct}%</span>
          </div>
        `;

        if (unlocked) div.onclick = () => startQuiz(t);
        else {
          div.style.opacity = "0.55";
          div.style.cursor = "not-allowed";
          // tooltip simple
          div.title = "Th√®me verrouill√© ‚Äî se d√©bloque progressivement √† partir de Jan 2026";
        }
        grid.appendChild(div);
      });
    }

    // ---------------------------
/* ========= State ========= */
  let currentTheme = "";
  let questionIndex = 0;
  let selectedSet = [];
  let score = 0;
  let answersHistory = {}; // { [qIndex]: { selected:number[], isCorrect:boolean, explanation:string, id?:string } }
  let currentUser = null;
let timerInterval = null;
let timeLeft = 25;

  /* ========= Login ========= */
  
async function login() {
    const email = document.getElementById("emailInput").value.trim().toLowerCase();
    const password = document.getElementById("passwordInput").value.trim();

    if (!email || !email.includes("@")) {
        alert("Please enter a valid email");
        return;
    }
    if (!password) {
        alert("Please enter your ID");
        return;
    }

    // === V√©rifier si c'est l'admin ===
    if (email === "admin@quiz.com" && password === "admin123") {
        currentUser = "admin";
        document.getElementById("login-container").style.display = "none";
        document.getElementById("admin-panel").style.display = "block";
        renderUserList();
        return;
    }

    // === V√©rification via Flow Login ===
    try {
        const res = await fetch(flowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, id: password })
        });
        const text = await res.text();
        console.log("Login Flow response:", text);

        if (text.includes("Login r√©ussi")) {
            // ‚úÖ Login ok
            currentUser = email;
            localStorage.setItem("quizUser", currentUser);
            document.getElementById("login-container").style.display = "none";
            document.getElementById("theme-selection").style.display = "block";
			
			    // üîπ Afficher/recharger la barre globale
    const overallContainer = document.getElementById("overallProgressContainer");
    if (overallContainer) overallContainer.style.display = "block";

            renderThemesGrid();
            loadProgressOverview();
			

            document.getElementById("challenge-section").style.display = "block";
            document.getElementById("my-challenges").style.display = "block";
            await loadMyChallenges(email); // <-- passer l'email ici ‚úÖ
			await loadProgressFromCloud();
			updateOverallProgressBar();      // mettre √† jour la barre globale

        } else {
            // ‚ö° Si login √©choue, v√©rifier si on a un user temporaire stock√©
            const tempUser = JSON.parse(localStorage.getItem("tempUser") || "null");
            if (tempUser && tempUser.email === email && tempUser.id === password) {
                currentUser = email;
                localStorage.setItem("quizUser", currentUser);
                document.getElementById("login-container").style.display = "none";
                document.getElementById("theme-selection").style.display = "block";
                renderThemesGrid();
                loadProgressOverview();

                document.getElementById("challenge-section").style.display = "block";
                document.getElementById("my-challenges").style.display = "block";
                await loadMyChallenges(email); // <-- passer l'email ici aussi ‚úÖ
            } else {
                alert("‚ùå Email ou ID incorrect. If first connexion, please subscribe.");
            }
        }
    } catch (err) {
        console.error("‚ùå Login error:", err);
        alert("‚ùå Unable to login. Please check your connection or try later.");
    }
}

function logout() {
  // üî¥ Stop le timer en cours
  stopTimer();

  // üî¥ R√©initialise l'affichage du timer
  const timerEl = document.getElementById("timer");
  if (timerEl) timerEl.textContent = "";

// üî¥ R√©initialiser la barre globale
const overallContainer = document.getElementById("overallProgressContainer");
if (overallContainer) {
    overallContainer.style.display = "none"; // on cache le conteneur complet
    const overallFill = document.getElementById("overallProgressFill");
    if (overallFill) {
        overallFill.style.width = "0%";
        overallFill.textContent = "";
    }
}

  try { localStorage.removeItem("quizUser"); } catch(e) {}
  currentUser = null;
  document.getElementById("theme-selection").style.display = "none";
  document.getElementById("quiz-container").style.display = "none";
  document.getElementById("admin-panel").style.display = "none";
  document.getElementById("challenge-section").style.display = "none";
  document.getElementById("login-container").style.display = "block";
  document.getElementById("my-challenges").style.display = "none";
}

window.addEventListener("DOMContentLoaded", async () => { // <-- rendre async pour pouvoir await
    let saved = null;
    try { saved = localStorage.getItem("quizUser"); } catch(e) {}
    if (saved) {
      currentUser = saved;
      document.getElementById("login-container").style.display = "none";
      document.getElementById("theme-selection").style.display = "block";
      
      renderThemesGrid();
      loadProgressOverview();

      // üîπ Afficher la barre globale
      const overallContainer = document.getElementById("overallProgressContainer");
      if (overallContainer) overallContainer.style.display = "block";

      // üîπ Charger la progression depuis le cloud
      await loadProgressFromCloud();  // ‚úÖ √ßa mettra √† jour la barre et les th√®mes

      updateOverallProgressBar();      // üîπ mettre √† jour la barre globale apr√®s cloud

      document.getElementById("challenge-section").style.display = "block";
      document.getElementById("my-challenges").style.display = "block";
      await loadMyChallenges(currentUser); // <-- passer l'email explicitement
    }
});

  /* ========= Persistent progress (unique solved) ========= */
  function getUserProgress() {
    try {
      return JSON.parse(localStorage.getItem("progress_" + currentUser) || "{}");
    } catch(e) { return {}; }
  }
  function setUserProgress(data) {
    try {
      localStorage.setItem("progress_" + currentUser, JSON.stringify(data));
    } catch(e) {}
  }
  
// üîπ Fonction pour nettoyer et pr√©parer le payload avant envoi
function prepareProgressPayload(progress, email) {
    const cleanedProgress = {};

    for (const [theme, data] of Object.entries(progress)) {
        if (!theme) continue; // Ignorer les cl√©s vides
        cleanedProgress[theme] = {
            solved: data.solved.map(String) // Convertir tous les IDs en string
        };
    }

    return {
        Email: email,
        Progress: cleanedProgress
    };
}

function syncProgressToCloud(progressData, email) {
    if (!progressData || !email) return;

    // üîπ On transforme la progression pour le Flow
    Object.keys(progressData).forEach(theme => {
        if (!theme || !progressData[theme]?.solved) return;

        const payload = {
            Email: email,
            Theme: theme,                     // obligatoire
            SolvedIds: progressData[theme].solved.map(id => id.toString()), // obligatoire
            IP: getUserIP() || "0.0.0.0"      // optionnel
        };

        console.log("üì§ Sync payload:", payload);

        fetch("https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com/powerautomate/automations/direct/workflows/e23e3c436c3145bebd18206e4b7e55eb/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=CffamMjMGSTdVPz_ZJ8QOQOI8W_C0I1lBKutiMjQa84", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        })
        .then(res => {
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            return res.json();
        })
        .then(() => console.log("‚úÖ Donn√©es envoy√©es au Flow avec succ√®s"))
        .catch(err => console.error("‚ùå Error syncing progress:", err));
    });
}

function updateOverallProgressBar() {
  const progress = getUserProgress();
  let totalQuestions = 0;
  let totalSolved = 0;

  for (const theme of Object.keys(quizData)) {
    const themeTotal = quizData[theme].questions.length || 0;
    const themeSolved = progress[theme]?.solved?.length || 0;

    totalQuestions += themeTotal;
    totalSolved += themeSolved;
  }

  const percent = totalQuestions ? Math.round((totalSolved / totalQuestions) * 100) : 0;
  const fill = document.getElementById("overallProgressFill");

  if (fill) {
    fill.style.width = percent + "%";
    fill.textContent = percent + "% overall completed";
  }
}

// üîπ R√©cup√®re la progression stock√©e dans Power Automate
async function loadProgressFromCloud() {
  if (!currentUser) return;

  try {
    const res = await fetch(GET_PROGRESS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ Email: currentUser })
    });

    const data = await res.json();
    console.log("üì¶ R√©ponse compl√®te du Flow :", data);

    // üß© Extraire correctement la partie utile
    const progressBody = data?.progress?.body || [];
    const normalized = {};

    for (const entry of progressBody) {
      // Chaque entr√©e ressemble √† { refined_products: [...] }
      const theme = Object.keys(entry)[0];
      const solvedArray = entry[theme];

      if (theme && Array.isArray(solvedArray)) {
        normalized[theme] = { solved: solvedArray.map(String) };
      }
    }

    console.log("‚òÅÔ∏è Progress loaded from cloud (normalized):", normalized);

    // ‚úÖ Enregistre la progression normalis√©e
    setUserProgress(normalized);

    // üîÑ Met √† jour l‚ÄôUI
    renderThemesGrid();
    loadProgressOverview();
    updateTopProgressBar();
	updateOverallProgressBar();

  } catch (err) {
    console.error("‚ùå Erreur lors du chargement de la progression :", err);
  }
}


 function markQuestionAsSolved(theme, qid) {
    if (!qid || !currentTheme) return;

    const data = getUserProgress();
    if (!data[theme]) data[theme] = { solved: [] };
    if (!Array.isArray(data[theme].solved)) data[theme].solved = [];

    // ‚úÖ Ajouter uniquement si la question n‚Äôest pas d√©j√† pr√©sente
    if (!data[theme].solved.includes(qid)) {
        data[theme].solved.push(qid);

        // ‚úÖ S'assurer de ne pas d√©passer le total de questions du th√®me
        const total = quizData[theme]?.questions.length || 0;
        if (data[theme].solved.length > total) {
            data[theme].solved = data[theme].solved.slice(0, total);
        }

        setUserProgress(data);
    syncProgressToCloud(data, currentUser); // ‚úÖ ajout des bons params
		updateTopProgressBar();  // üîÑ Actualise barre en haut
		loadProgressOverview();  // üîÑ Et met √† jour la liste compl√®te
		updateOverallProgressBar();
    }
}
  function getSolvedCount(theme) {
    const data = getUserProgress();
    return data[theme]?.solved?.length || 0;
  }


  /* ========= Progress overview (cards list) ========= */
  function loadProgressOverview() {
    const overview = document.getElementById("progress-overview");
    if (!overview) return;
    const themes = Object.keys(quizData);

    let html = '<h3 style="text-align:center;margin-top:24px;">Your Progress</h3>';
    html += themes.map(t => {
      const total = quizData[t].questions.length;
      const solved = getSolvedCount(t);
      const pct = total ? Math.round((solved / total) * 100) : 0;
      return `
        <div class="progress-card">
          <div style="font-weight:700;">${quizData[t].title}</div>
          <div class="progress-mini">
            <div class="progress-mini-fill" style="width:${pct}%;"></div>
          </div>
          <div class="mini-row">
            <span>${solved}/${total || 0} solved</span>
            <span>${pct}%</span>
          </div>
        </div>`;
    }).join("");

    overview.innerHTML = html;
  }

  /* ========= Listes of users ========= */
  
function renderUserList() {
  let users = {};
  try { users = JSON.parse(localStorage.getItem("quizUsers") || "{}"); } catch(e) {}

  const userListDiv = document.getElementById("user-list");
  userListDiv.innerHTML = "";

  const emails = Object.keys(users);
  if (emails.length === 0) {
    userListDiv.innerHTML = "<p>No registered users yet.</p>";
    return;
  }

  emails.forEach(email => {
    if (email === "admin@quiz.com") return; // on ne liste pas l‚Äôadmin
    const btn = document.createElement("button");
    btn.textContent = email;
    btn.style.display = "block";
    btn.style.margin = "6px auto";
    btn.style.padding = "8px 12px";
    btn.style.borderRadius = "8px";
    btn.style.border = "1px solid #ccc";
    btn.onclick = () => showUserProgress(email);
    userListDiv.appendChild(btn);
  });
}

function showUserProgress(email) {
  const container = document.getElementById("user-progress");

  let data = {};
  try { data = JSON.parse(localStorage.getItem("progress_" + email) || "{}"); } catch(e) {}

  let html = `<h3>üìä Progress for ${email}</h3>`;

  const themes = Object.keys(quizData);
  if (themes.length === 0) {
    html += "<p>No themes available.</p>";
  } else {
    html += themes.map(t => {
      const total = quizData[t].questions.length;
      const solved = data[t]?.solved?.length || 0;
      const pct = total ? Math.round((solved / total) * 100) : 0;
      return `
        <div class="progress-card">
          <div style="font-weight:700;">${quizData[t].title}</div>
          <div class="progress-mini">
            <div class="progress-mini-fill" style="width:${pct}%;"></div>
          </div>
          <div class="mini-row">
            <span>${solved}/${total || 0} solved</span>
            <span>${pct}%</span>
          </div>
        </div>`;
    }).join("");
  }

  container.innerHTML = html;
}

  /* ========= Email et ID ========= */

async function signup() {
    const email = document.getElementById("signupEmail").value.trim().toLowerCase();
    const id = document.getElementById("signupID").value.trim();

    if (!email || !email.includes("@") || !id) {
        alert("‚ùå Please enter a valid email and ID.");
        return;
    }


try {
        const res = await fetch(flowUrlSignup, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, id })
        });

        const data = await res.json();
        console.log("Signup Flow response:", data);

        if (data?.status === 200 || data?.status === 400) {
            // ‚úÖ Stockage imm√©diat local pour login instantan√©
            localStorage.setItem("tempUser", JSON.stringify({ email, id }));
            alert("‚úÖ " + data.message);
            showLogin();
        } else {
            alert("‚ùå Technical error during signup. Please try again later.");
        }
    } catch (err) {
        console.error("‚ùå Signup error:", err);
        alert("‚ùå Technical error during signup. Please try again later.");
    }
}

// === Mot de passe oubli√© ===

// Afficher/cacher le formulaire "Mot de passe oubli√©"
document.getElementById("forgotID").onclick = () => {
    const form = document.getElementById("forgotIDForm");
    form.style.display = form.style.display === "none" ? "block" : "none";
}

  document.getElementById("sendID").onclick = () => {
    const email = document.getElementById("forgotEmail").value.trim().toLowerCase();
    if(!email || !email.includes("@")) { 
      alert("Enter a valid email"); 
      return; 
    }

    fetch("https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/458482932c2546798bc331d62bcd9579/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=OacmhYAvpw_QjrCTJvpr0T-2Rgp2PBbR5HbxS5NVm3c", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    })
    .then(res => {
      if(res.status === 200) alert("‚úÖ Email sent successfully!");
      else if(res.status === 400) alert("‚ùå Email does not exist");
      else alert("‚ùå Error: " + res.status);
    })
    .catch(err => console.error("‚ùå Fetch error:", err));
  }



// üîπ Variable globale pour savoir si on est en mode d√©fi
let isChallengeSession = false;

// =======================
// START QUIZ
// =======================

function smartShuffle(theme) {
    if (!quizData[theme]?.questions) return [];

    const allQuestions = [...quizData[theme].questions];
    const solvedIds = getUserProgress()[theme]?.solved || [];

    // S√©parer questions r√©solues et non r√©solues
    const unsolved = allQuestions.filter(q => !solvedIds.includes(q.id));
    const solved = allQuestions.filter(q => solvedIds.includes(q.id));

    // M√©langer chacune des deux listes
    const shuffledUnsolved = shuffle(unsolved);
    const shuffledSolved = shuffle(solved);

    // Priorit√© aux non-r√©solues
    const combined = [...shuffledUnsolved, ...shuffledSolved];

    // On limite √† 10 questions max
    return combined.slice(0, Math.min(10, combined.length));
}

function startQuiz(input, challengeMode = false, theme = null, challenge = null) {
    isChallengeSession = challengeMode; // ‚úÖ active/d√©sactive mode d√©fi

    let questions;
    if (challengeMode) {
        // input = tableau de questions pour le d√©fi
        questions = input;
        currentTheme = theme;
    } else {
        // quiz normal par th√®me
        currentTheme = input;
        questions = quizData[input]?.questions.slice();
    }

    if (!questions || questions.length === 0) {
        document.getElementById("theme-selection").style.display = "none";
        document.getElementById("quiz-container").style.display = "block";
        document.getElementById("theme-title").textContent = "Theme: " + (challengeMode ? theme : quizData[input].title);
        document.getElementById("question").textContent = "‚ö†Ô∏è No questions available for this theme.";
        document.getElementById("choices").innerHTML = "";
        document.getElementById("result").textContent = "";
        document.getElementById("explanation").textContent = "";
        document.getElementById("prevBtn").style.display = "none";
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("backBtn").style.display = "inline-block";
        if (!challengeMode) document.getElementById("challenge-section").style.display = "block";
        return;
    }

  // Initialisation session
selectedSet = smartShuffle(currentTheme);
questionIndex = 0;
score = 0;
answersHistory = {};

    // Affichage UI
    document.getElementById("theme-selection").style.display = "none";
    document.getElementById("quiz-container").style.display = "block";
    if (challengeMode) document.getElementById("challenge-section").style.display = "none";
    document.getElementById("theme-title").textContent = "Theme: " + (challengeMode ? theme : quizData[input].title);

    updateScoreLine();
    updateTopProgressBar();
    showQuestion();

    // Gestion d√©fi : pr√©paration envoi score √† la fin
    if (challengeMode && challenge) {
window.onChallengeFinished = async function(finalScore) {
    if (currentUser === challenge.opponent) {
        challenge.opponentScore = finalScore;
    } else if (currentUser === challenge.challenger) {
        challenge.challengerScore = finalScore;
    }

    console.log("Envoi score d√©fi au Flow :", challenge);

    // 1Ô∏è‚É£ Envoi du score au Flow principal (inchang√©)
    try {
        const payload = {
            ID: challenge.ID,
            challengerScore: challenge.challengerScore ?? null,
            opponentScore: challenge.opponentScore ?? null,
            status: challenge.status || "accepted"
        };

        console.log("üì§ Envoi score au Flow :", payload);

        const res = await fetch(updateChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
        console.log("‚úÖ Score envoy√© au Flow !");
    } catch (err) {
        console.error("‚ùå Erreur lors de l‚Äôenvoi du score :", err);
    }

    // 2Ô∏è‚É£ Met √† jour la colonne Done correspondante (NOUVEAUT√â)
    try {
      const isChallenger = (currentUser === challenge.challenger);
const donePayload = {
    ID: challenge.ID,
    currentUser: currentUser,
    role: isChallenger ? "challenger" : "opponent"
};

        console.log("‚öôÔ∏è Envoi du Done au Flow :", donePayload);

        const doneRes = await fetch(updateChallengeDoneFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(donePayload)
        });

        if (!doneRes.ok) throw new Error(`Erreur HTTP ${doneRes.status}`);
        console.log("‚úÖ Colonne Done mise √† jour dans Excel !");
    } catch (err) {
        console.error("‚ùå Erreur lors de la mise √† jour du Done :", err);
    }

    // 3Ô∏è‚É£ Si les deux ont jou√© ‚Üí checkWinner
    if (challenge.challengerScore != null && challenge.opponentScore != null) {
        checkWinner(challenge);
    }

    // 4Ô∏è‚É£ Nettoyage pour √©viter doublons
    window.onChallengeFinished = null;
};
    }
}


  function updateScoreLine() {
  const totalQ = selectedSet.length || 1; // √©viter division par 0
  const displayScore = Math.min(score, totalQ); // jamais sup√©rieur au total
  document.getElementById("scoreLine").textContent =
      `Question ${questionIndex + 1} / ${totalQ} ‚Ä¢ Score: ${displayScore}`;
}

// =======================
// UPDATE TOP PROGRESS BAR
// =======================
function updateTopProgressBar() {
    if (!currentTheme || isChallengeSession) return; // ignore si mode d√©fi

    // üîÑ Recharge √† jour
    const freshData = getUserProgress();
	
    const total = quizData[currentTheme].questions.length || 1; // √©viter div/0
    let solved = getSolvedCount(currentTheme);

    if (solved > total) solved = total;

    const percent = Math.round((solved / total) * 100);
    const fill = document.getElementById("progressFill");
    if (fill) {
        fill.style.width = percent + "%";
        fill.textContent = percent + "%";
    }

    if (percent === 100) {
        renderThemesGrid();
        loadProgressOverview();
    }
}

 function showQuestion() {
  const q = selectedSet[questionIndex];
  const choicesDiv = document.getElementById("choices");
  if (!q) {
    document.getElementById("question").textContent = "‚ö†Ô∏è Question not found!";
    choicesDiv.innerHTML = "";
    document.getElementById("result").textContent = "";
    document.getElementById("explanation").textContent = "";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("prevBtn").style.display = "none";
    return;
  }

  document.getElementById("question").textContent = q.question;
  choicesDiv.innerHTML = "";
  document.getElementById("result").textContent = "";
  document.getElementById("explanation").textContent = "";
  document.getElementById("nextBtn").style.display = "none";
  document.getElementById("prevBtn").style.display = questionIndex > 0 ? "inline-block" : "none";
  document.getElementById("backBtn").style.display = "none";

  const multiple = Array.isArray(q.correct);
  q.choices.forEach((choice, idx) => {
    const wrapper = document.createElement("label");
    wrapper.className = "choice";
    const input = document.createElement("input");
    input.type = multiple ? "checkbox" : "radio";
    input.name = "answer";
    input.value = idx;
    const text = document.createElement("span");
    text.textContent = choice;
    wrapper.appendChild(input);
    wrapper.appendChild(text);
    choicesDiv.appendChild(wrapper);
  });

  const checkBtn = document.createElement("button");
  checkBtn.textContent = "Submit Answer";
  checkBtn.className = "submit-btn";
  checkBtn.onclick = () => { stopTimer(); checkAnswer(); };
  choicesDiv.appendChild(checkBtn);

  if (answersHistory[questionIndex]) {
    restoreAnswerState();
    stopTimer();
    document.getElementById("timer").textContent = "";
  } else {
    startTimer();
  }

  updateScoreLine();
  updateTopProgressBar();
}

function startTimer() {
  stopTimer(); // √©viter un double timer
  timeLeft = 25;
  document.getElementById("timer").textContent = `‚è≥ Time left: ${timeLeft}s`;

  timerInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = `‚è≥ Time left: ${timeLeft}s`;

    if (timeLeft <= 0) {
      stopTimer();
      autoFail();
    }
  }, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function autoFail() {
  const q = selectedSet[questionIndex];
  const wrappers = document.querySelectorAll(".choice");
  const inputs = document.querySelectorAll("input[name='answer']");
  inputs.forEach(el => el.disabled = true);

  // marquer la bonne r√©ponse en vert
  if (!Array.isArray(q.correct)) {
    wrappers.forEach((wrapper, i) => {
      if (i === q.correct) wrapper.classList.add("correct");
    });
  } else {
    wrappers.forEach((wrapper, i) => {
      if (q.correct.includes(i)) wrapper.classList.add("correct");
    });
  }

document.getElementById("nextBtn").style.display = "inline-block";

  // afficher mauvais r√©sultat
  const answerTxt = Array.isArray(q.correct)
    ? q.correct.map(i => q.choices[i]).join(", ")
    : q.choices[q.correct];
  document.getElementById("result").textContent = "‚è∞ Time's up! Correct: " + answerTxt;
  document.getElementById("result").style.color = "red";
  document.getElementById("explanation").textContent = q.explanation || "";

  answersHistory[questionIndex] = { selected: [], isCorrect: false, explanation: q.explanation, id: q.id };

  // envoyer comme incorrect
  sendAnswerToFlow(q, [], false);

  // afficher bouton Next
  document.getElementById("nextBtn").style.display = "inline-block";
}

function checkAnswer() {
  const q = selectedSet[questionIndex];
  const wrappers = document.querySelectorAll(".choice");
  const inputs = document.querySelectorAll("input[name='answer']");
  
  // R√©cup√©rer les r√©ponses s√©lectionn√©es
  let selected = Array.from(inputs)
    .filter(el => el.checked)
    .map(el => parseInt(el.value));

  if (selected.length === 0) { 
    alert("Select an answer"); 
    return; 
  }

  // Bloquer les inputs
  inputs.forEach(el => el.disabled = true);

  // V√©rifier la r√©ponse
  let isCorrect = false;
  if (!Array.isArray(q.correct)) {
    wrappers.forEach((wrapper, i) => {
      if (i === q.correct) wrapper.classList.add("correct");
      else if (selected.includes(i)) wrapper.classList.add("wrong");
    });
    if (selected.length === 1 && selected[0] === q.correct) isCorrect = true;
  } else {
    const correctSorted = [...q.correct].sort((a,b)=>a-b);
    const selectedSorted = [...selected].sort((a,b)=>a-b);
    wrappers.forEach((wrapper, i) => {
      if (q.correct.includes(i)) wrapper.classList.add("correct");
      else if (selected.includes(i)) wrapper.classList.add("wrong");
    });
    if (JSON.stringify(selectedSorted) === JSON.stringify(correctSorted)) isCorrect = true;
  }

  // Affichage r√©sultat
  if (isCorrect) {
    score++;
    document.getElementById("result").textContent = "‚úÖ Correct!";
    document.getElementById("result").style.color = "green";
  } else {
    const answerTxt = Array.isArray(q.correct)
      ? q.correct.map(i => q.choices[i]).join(", ")
      : q.choices[q.correct];
    document.getElementById("result").textContent = "‚ùå Wrong. Correct: " + answerTxt;
    document.getElementById("result").style.color = "red";
  }

  document.getElementById("explanation").textContent = q.explanation || "";

  // M√©morise l'√©tat dans la session
  answersHistory[questionIndex] = { selected, isCorrect, explanation: q.explanation, id: q.id };

  // ‚úÖ Envoi imm√©diat au Flow
  sendAnswerToFlow(q, selected, isCorrect);

  // Toujours r√©v√©ler le bouton Next
  const nb = document.getElementById("nextBtn");
  if (nb) nb.style.display = "inline-block";

  // Mettre √† jour le score affich√©
  updateScoreLine();
}

 stopTimer(); // ‚è±Ô∏è stoppe et r√©cup√®re le temps de cette question
 
/* ========= Fonction pour envoyer au Flow avec debug ========= */
function sendAnswerToFlow(q, selected, isCorrect) {
  if (!currentUser || !currentTheme) return;

  const selectedAnswers = Array.isArray(selected)
    ? selected.map(i => q.choices[i]).join(", ")
    : q.choices[selected];

  const payload = {
    email: currentUser,
    IP: getUserIP(),           // tu peux remplacer par navigator.userAgent ou vrai IP si dispo
    Theme: currentTheme,
    question: q.question,
    reponse: selectedAnswers,
    resultat: isCorrect ? "Correct" : "Incorrect"
  };

  console.log("üì§ Payload envoy√© au Flow:", payload); // debug JSON

  fetch(flow, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(res => {
    if (res.status === 202 || res.status === 200) {
      console.log("‚úÖ Donn√©es envoy√©es au Flow avec succ√®s");
    } else {
      console.error("‚ùå Erreur Flow:", res.status, res.statusText);
    }
  })
  .catch(err => console.error("‚ùå Erreur fetch:", err));
}
	

  function restoreAnswerState() {
    const q = selectedSet[questionIndex];
    const saved = answersHistory[questionIndex];
    if (!saved) return;

    const wrappers = document.querySelectorAll(".choice");
    const inputs = document.querySelectorAll("input[name='answer']");
    inputs.forEach(el => {
      if (saved.selected.includes(parseInt(el.value))) el.checked = true;
      el.disabled = true;
    });

    wrappers.forEach((wrapper, i) => {
      if (Array.isArray(q.correct)) {
        if (q.correct.includes(i)) wrapper.classList.add("correct");
        else if (saved.selected.includes(i)) wrapper.classList.add("wrong");
      } else {
        if (i === q.correct) wrapper.classList.add("correct");
        else if (saved.selected.includes(i)) wrapper.classList.add("wrong");
      }
    });

    document.getElementById("result").textContent = saved.isCorrect ? "‚úÖ Correct!" : "‚ùå Wrong.";
    document.getElementById("result").style.color = saved.isCorrect ? "green" : "red";
    document.getElementById("explanation").textContent = saved.explanation || "";

    const nb = document.getElementById("nextBtn");
    if (nb) nb.style.display = "inline-block";
  }

// =======================
// COMMIT SESSION SOLVED + SYNC CLOUD
// =======================
function commitSessionSolved() {
    if (!currentTheme || isChallengeSession) return; // ignore les d√©fis

    const data = getUserProgress();
    if (!data[currentTheme]) data[currentTheme] = { solved: [] };

    const total = quizData[currentTheme]?.questions.length || 0;

    // Ajouter les bonnes r√©ponses √† la progression locale
    Object.keys(answersHistory).forEach(k => {
        const rec = answersHistory[k];
        if (rec?.isCorrect && rec?.id && !data[currentTheme].solved.includes(rec.id)) {
            data[currentTheme].solved.push(rec.id);
        }
    });

    // S'assurer de ne pas d√©passer le total
    if (data[currentTheme].solved.length > total) {
        data[currentTheme].solved = data[currentTheme].solved.slice(0, total);
    }

    // Stockage local
    setUserProgress(data);

    // üîπ Envoi imm√©diat vers Power Automate avec nettoyage
    syncProgressToCloud(data, currentUser);
}


 // =======================
// NEXT QUESTION
// =======================
function nextQuestion() {
    if (questionIndex < selectedSet.length - 1) {
        questionIndex++;
        showQuestion();
    } else {
        // Fin de session
        commitSessionSolved();          // marquer les bonnes r√©ponses (ignore si d√©fi)
        updateTopProgressBar();         // mise √† jour barre de progression (ignore si d√©fi)
        renderThemesGrid();             // mise √† jour grille accueil
        loadProgressOverview();         // mise √† jour cartes progress
		updateOverallProgressBar();
		
        document.getElementById("question").textContent = "üéâ Quiz completed!";
        document.getElementById("choices").innerHTML = "";
        document.getElementById("result").textContent = `Final Score: ${score}/${selectedSet.length}`;
        document.getElementById("explanation").textContent = "";
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("prevBtn").style.display = "inline-block";
        document.getElementById("backBtn").style.display = "inline-block";

        // ‚úÖ Si c‚Äôest un d√©fi, envoyer le score au Flow
        finishChallengeIfNeeded();

        // retour menu automatique apr√®s 1s
        setTimeout(() => { goBack(); }, 1000);
    }
}


  function prevQuestion() {
    if (questionIndex > 0) {
      questionIndex--;
      showQuestion();
    }
  }

  function goBack() {
    document.getElementById("quiz-container").style.display = "none";
    document.getElementById("theme-selection").style.display = "block";
    renderThemesGrid();
    loadProgressOverview();

document.getElementById("challenge-section").style.display = "block";

    // stop timer et reset affichage
    stopTimer();
    const timerEl = document.getElementById("timer");
    if (timerEl) timerEl.textContent = "";

    // reset barre visuelle de l‚ÄôUI du quiz (facultatif)
    const fill = document.getElementById("progressFill");
    if (fill) { fill.style.width = "0%"; fill.textContent = "0%"; }
}
  
 function sendTestRow() {
  fetch(flowUrl, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
  Email: "test@example.com",
  IP: "127.0.0.1",
  Theme: "TestTheme",
  Question: "Test question",
  Reponse: "Test answer",
  Resultat: "Correct"
})
  })
  .then(res => alert("Test row sent! Status " + res.status))
  .catch(err => console.error("‚ùå Flow error", err));
}

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("‚úÖ Service Worker registered"))
    .catch(err => console.error("‚ùå Service Worker error", err));
}

// ‚ö° Remplir la liste d√©roulante des emails depuis Flow
async function loadAllEmails() {
  if (!getAllUsersFlowUrl) {
    console.error("getAllUsersFlowUrl n'est pas d√©fini.");
    return;
  }

  try {
    const res = await fetch(getAllUsersFlowUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    });

    if (!res.ok) throw new Error("Erreur HTTP " + res.status);

    const raw = await res.json();
    console.log("üì• R√©ponse Flow getAllUsers (parsed) :", raw);

    const dataArray = Array.isArray(raw.body) ? raw.body : raw;
    const list = dataArray.map(item => item.email).filter(Boolean);

    const emailSelect = document.getElementById("opponentEmail");
    if (!emailSelect) {
      console.warn("Element #opponentEmail introuvable dans le DOM.");
      return;
    }

    emailSelect.innerHTML = "";

    // placeholder
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "Choisir un joueur...";
    emailSelect.appendChild(placeholder);

    // remplir la liste
    list.forEach(email => {
      if (email.toLowerCase() === (currentUser || "").toLowerCase()) return;
      const option = document.createElement("option");
      option.value = email;
      option.textContent = email;
      emailSelect.appendChild(option);
    });

    console.log(`‚úÖ ${emailSelect.options.length - 1} emails charg√©s dans la liste.`);
  } catch (err) {
    console.error("‚ùå Impossible de charger la liste des emails :", err);
  }
}


// ‚ö° Remplir la liste d√©roulante des th√®mes
function loadAllThemes() {
    const themeSelect = document.getElementById("challengeTheme");
    themeSelect.innerHTML = ""; // reset

    Object.keys(quizData).forEach(t => {
        const option = document.createElement("option");
        option.value = t;
        option.textContent = quizData[t].title || t;
        themeSelect.appendChild(option);
    });
}

// Added for challenge
// === Challenge ===

// Affiche/cacher le formulaire de d√©fi
document.getElementById("showChallengeBtn").onclick = () => {
    const form = document.getElementById("challenge-form");
    form.style.display = form.style.display === "none" ? "block" : "none";

    // üîπ Charger dynamiquement les emails et th√®mes
    loadAllEmails();
    loadAllThemes();
};

// Envoyer un d√©fi
document.getElementById("sendChallengeBtn").onclick = async () => {
    const opponent = document.getElementById("opponentEmail").value.trim().toLowerCase();
    const theme = document.getElementById("challengeTheme").value;

    if (!opponent || !theme) {
        alert("‚ùå Veuillez remplir l'email et s√©lectionner un th√®me !");
        return;
    }

    // R√©cup√©rer toutes les questions du th√®me s'il y en a
    const allQuestions = quizData[theme]?.questions || [];

    // M√™me si aucune question, on cr√©e un tableau vide pour le challenge
    const picked = allQuestions.length > 0
        ? shuffle([...allQuestions])
            .slice(0, Math.min(10, allQuestions.length))
            .map(q => String(q.id)) // üîπ Conversion en string pour Flow
        : [];

    const payload = {
        challenger: currentUser,
        opponent: opponent,
        theme: theme,
        questions: picked,
        status: "pending",
        challengerScore: null,
        opponentScore: null
    };

    console.log("üì§ Challenge envoy√© :", payload);

    try {
        const res = await fetch(createChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (res.ok) {
            alert("‚úÖ D√©fi envoy√© √† " + opponent);
            document.getElementById("challenge-form").style.display = "none";
        } else {
            alert("‚ùå Erreur lors de l'envoi du d√©fi : " + res.status);
        }
    } catch (err) {
        console.error(err);
        alert("‚ùå Impossible d'envoyer le d√©fi. V√©rifiez votre connexion.");
    }
};

// Charger mes d√©fis
// Fonction pour charger les d√©fis re√ßus par l'utilisateur

// Fonction pour accepter ou refuser un d√©fi via Power Automate

function parseExcelBool(value) {
    if (value === true) return true;
    if (typeof value === "string") {
        const normalized = value.trim().toLowerCase();
        return normalized === "true" || normalized === "yes" || normalized === "1";
    }
    if (typeof value === "number") return value === 1;
    return false;
}

// üîπ Charger mes d√©fis re√ßus
async function loadMyChallenges(userEmail) {
    if (!userEmail) return;

    const challengesList = document.getElementById("challenges-list");
    if (!challengesList) {
        console.warn("loadMyChallenges: √©l√©ment #challenges-list introuvable");
        return;
    }
    challengesList.innerHTML = "";

    try {
        const response = await fetch(getChallengesFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ opponent: userEmail })
        });

        if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
        let challenges = await response.json();
	
console.log("üì• Donn√©es brutes re√ßues du Flow (MyChallenges):", challenges);

        // üîπ Conversion et nettoyage
        challenges = (challenges || []).map(c => ({
            ...c,
            challengerScore: c.challengerScore ? Number(c.challengerScore) : null,
            opponentScore: c.opponentScore ? Number(c.opponentScore) : null,
challengerDone: parseExcelBool(c.challengerDone),
opponentDone: parseExcelBool(c.opponentDone),
            status: (c.status || "pending").toLowerCase(),
        }));

        console.log("üìã D√©fis re√ßus apr√®s conversion :", challenges.map(c => ({
            ID: c.ID,
            status: c.status,
            challengerDone: c.challengerDone,
            opponentDone: c.opponentDone
        })));

        // üîπ Filtrage robuste : ne montrer que pending ET non encore jou√©s par l'utilisateur
        const visible = challenges.filter(c =>
            c.status === "pending" &&
            (
                (c.opponent === userEmail && !c.opponentDone) ||
                (c.challenger === userEmail && !c.challengerDone)
            )
        );

        console.log("üîé D√©fis visibles pour l'utilisateur :", visible);

        if (visible.length === 0) {
            challengesList.innerHTML = "<p>Aucun d√©fi re√ßu pour le moment.</p>";
            return;
        }

        visible.forEach(challenge => {
            const div = document.createElement("div");
            div.className = "challenge-item";
            div.style.border = "1px solid #ccc";
            div.style.padding = "10px";
            div.style.marginBottom = "10px";

            const info = document.createElement("p");
            info.textContent = `De: ${challenge.challenger} | Th√®me: ${challenge.theme}`;
            div.appendChild(info);

            const acceptBtn = document.createElement("button");
            acceptBtn.textContent = "Accepter";
            acceptBtn.style.marginRight = "5px";
            acceptBtn.onclick = async () => {
                const qArray = Array.isArray(challenge.questions) ? challenge.questions : JSON.parse(challenge.questions || "[]");
                const success = await respondToChallenge(challenge.ID, "accepted");
                if (success) {
                    div.remove();
                    const qSet = qArray.map(qid => quizData[challenge.theme]?.questions.find(q => q.id === qid)).filter(q => q);
                    if (qSet.length === 0) { alert("‚ö†Ô∏è Aucune question trouv√©e pour ce d√©fi !"); return; }
                    startQuiz(qSet, true, challenge.theme, challenge);
                }
            };

            const rejectBtn = document.createElement("button");
            rejectBtn.textContent = "Refuser";
            rejectBtn.onclick = async () => {
                const success = await respondToChallenge(challenge.ID, "rejected");
                if (success) div.remove();
            };

            div.appendChild(acceptBtn);
            div.appendChild(rejectBtn);
            challengesList.appendChild(div);
        });

    } catch (error) {
        console.error("‚ùå Erreur loadMyChallenges :", error);
        challengesList.innerHTML = "<p>Erreur lors du chargement des d√©fis.</p>";
    }
}

async function loadSentChallenges(userEmail) {
    if (!userEmail) return;

    const sentList = document.getElementById("sent-challenges-list");
    if (!sentList) {
        console.warn("loadSentChallenges: √©l√©ment #sent-challenges-list introuvable");
        return;
    }
    sentList.innerHTML = "";

    try {
        const response = await fetch(getChallengesFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ challenger: userEmail })
        });

        if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
        let challenges = await response.json();

console.log("üì• Donn√©es brutes re√ßues du Flow (SentChallenges):", challenges);

        challenges = (challenges || []).map(c => ({
            ...c,
            challengerScore: c.challengerScore ? Number(c.challengerScore) : null,
            opponentScore: c.opponentScore ? Number(c.opponentScore) : null,
challengerDone: parseExcelBool(c.challengerDone),
opponentDone: parseExcelBool(c.opponentDone),
            status: (c.status || "pending").toLowerCase(),
        }));

        console.log("üì§ D√©fis envoy√©s apr√®s conversion :", challenges);

        // üîπ Filtrage : ne montrer que pending et non encore jou√©s par le challenger
        const visible = challenges.filter(c =>
            c.status === "pending" &&
            c.challenger === userEmail &&
            !c.challengerDone
        );

        console.log("üîé D√©fis envoy√©s visibles :", visible);

        if (visible.length === 0) {
            sentList.innerHTML = "<p>Aucun d√©fi envoy√© pour le moment.</p>";
            return;
        }

        visible.forEach(challenge => {
            const div = document.createElement("div");
            div.className = "challenge-item";
            div.style.border = "1px solid #ccc";
            div.style.padding = "10px";
            div.style.marginBottom = "10px";

            const info = document.createElement("p");
            info.textContent = `√Ä: ${challenge.opponent} | Th√®me: ${challenge.theme}`;
            div.appendChild(info);

            const playBtn = document.createElement("button");
            playBtn.textContent = "Faire mon d√©fi";
            playBtn.onclick = () => {
                if (challenge.challengerDone) { alert("‚ö†Ô∏è Tu as d√©j√† termin√© ce d√©fi !"); return; }
                const qArray = Array.isArray(challenge.questions) ? challenge.questions : JSON.parse(challenge.questions || "[]");
                const qSet = qArray.map(qid => quizData[challenge.theme]?.questions.find(q => q.id === qid)).filter(q => q);
                if (qSet.length === 0) { alert("‚ö†Ô∏è Aucune question trouv√©e pour ce d√©fi !"); return; }
                startQuiz(qSet, true, challenge.theme, challenge);
            };

            div.appendChild(playBtn);
            sentList.appendChild(div);
        });

    } catch (error) {
        console.error("‚ùå Erreur loadSentChallenges :", error);
        sentList.innerHTML = "<p>Erreur lors du chargement des d√©fis envoy√©s.</p>";
    }
}

// === üîÅ AUTO-REFRESH DES D√âFIS ===
// Recharge automatiquement les d√©fis toutes les 15 secondes
function startChallengeAutoRefresh() {
    if (!currentUser) return;

    console.log("üîÅ Auto-refresh des d√©fis activ√© pour :", currentUser);

    // Chargement initial
    loadMyChallenges(currentUser);
    loadSentChallenges(currentUser);

    // Intervalle de rafra√Æchissement
    setInterval(() => {
        console.log("üîÑ Rafra√Æchissement automatique des d√©fis...");
        loadMyChallenges(currentUser);
        loadSentChallenges(currentUser);
    }, 30000); // 30000 = 15 secondes
}

// Lancer l'auto-refresh d√®s que la page est charg√©e et l'utilisateur connu
window.addEventListener("DOMContentLoaded", () => {
    if (currentUser) {
        startChallengeAutoRefresh();
    }
});

async function respondToChallenge(ID, status) {
    try {
        const res = await fetch(updateChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ID, status })
        });

        if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);

        console.log(`‚úÖ Donn√©es envoy√©es au Flow avec succ√®s (${status})`);
        return true;
    } catch (error) {
        console.error(`Erreur lors de la r√©ponse au d√©fi (${status}):`, error);
        alert("Une erreur est survenue. Veuillez r√©essayer.");
        return false;
    }
}

// Fonction pour r√©cup√©rer le challenge complet depuis Flow
async function getChallengeFromFlow(challengeID) {
    try {
        const res = await fetch(getChallengeByIdFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ID: challengeID })
        });
        if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
        const data = await res.json();

        // üîπ Conversions num√©riques
        data.challengerScore = data.challengerScore !== null && data.challengerScore !== '' ? Number(data.challengerScore) : null;
        data.opponentScore   = data.opponentScore !== null && data.opponentScore !== '' ? Number(data.opponentScore) : null;

        // üîπ Conversion bool√©ens
        data.challengerDone = data.challengerDone === true || data.challengerDone === "true";
        data.opponentDone = data.opponentDone === true || data.opponentDone === "true";

        return data;
    } catch (err) {
        console.error("‚ùå Impossible de r√©cup√©rer le challenge :", err);
        return null;
    }
}

// Quand un joueur finit son d√©fi

window.onChallengeFinished = async function(finalScore, challenge) {
    if (!challenge || !challenge.ID) {
        console.error("‚ùå Challenge invalide ou ID manquant", challenge);
        return alert("‚ùå Challenge invalide.");
    }

    const isChallenger = (currentUser === challenge.challenger);

    // üîπ Mettre √† jour le score local
    if (isChallenger) challenge.challengerScore = Number(finalScore);
    else challenge.opponentScore = Number(finalScore);

    console.log("üèÅ Fin du d√©fi pour", currentUser, "| Score:", finalScore);

    try {
        // --- 1Ô∏è‚É£ Envoyer le score au Flow ---
        const scorePayload = {
            ID: challenge.ID,
            challengerScore: challenge.challengerScore,
            opponentScore: challenge.opponentScore,
            status: "pending"
        };

        console.log("üì§ Envoi du score au Flow :", scorePayload);

        const scoreRes = await fetch(updateChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(scorePayload)
        });

        if (!scoreRes.ok) throw new Error(`Erreur HTTP ${scoreRes.status}`);
        console.log("‚úÖ Score envoy√© au Flow !");

        // --- 2Ô∏è‚É£ Mettre √† jour la colonne Done et r√©cup√©rer le JSON du Flow ---
        const donePayload = {
            ID: challenge.ID,
            currentUser: currentUser,
            role: isChallenger ? "challenger" : "opponent"
        };

        console.log("‚öôÔ∏è Envoi du Done au Flow :", donePayload);

        const doneRes = await fetch(updateChallengeDoneFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(donePayload)
        });

        if (!doneRes.ok) throw new Error(`Erreur HTTP ${doneRes.status}`);

        // üîπ R√©cup√©rer la r√©ponse JSON du Flow
        const doneData = await doneRes.json();
        // üîπ Mettre √† jour les propri√©t√©s locales avec les valeurs renvoy√©es
        challenge.challengerDone = !!doneData.challengerDone;
        challenge.opponentDone = !!doneData.opponentDone;

        console.log(`‚úÖ Done mis √† jour depuis Flow :`, challenge);

        // --- 3Ô∏è‚É£ Attendre un court d√©lai pour laisser Excel/Flow propager la MAJ ---
        await new Promise(resolve => setTimeout(resolve, 800));

        // --- 4Ô∏è‚É£ Recharger les listes pour cacher le d√©fi termin√© ---
        if (typeof loadMyChallenges === "function") loadMyChallenges(currentUser);
        if (typeof loadSentChallenges === "function") loadSentChallenges(currentUser);

        console.log("üîÑ Listes de d√©fis recharg√©es apr√®s mise √† jour Done");

    } catch (err) {
        console.error("‚ùå Erreur lors de la finalisation du d√©fi :", err);
        alert("Une erreur est survenue lors de la finalisation du d√©fi. R√©essaie !");
        return;
    }

    // üîπ Recharger le challenge complet
    let freshChallenge;
    try {
        freshChallenge = await getChallengeFromFlow(challenge.ID);
        if (!freshChallenge) throw new Error("Impossible de r√©cup√©rer le d√©fi complet.");
    } catch (err) {
        console.error(err);
        return alert("Impossible de r√©cup√©rer le d√©fi complet apr√®s le score.");
    }

    // üîπ D√©terminer le statut final
    const challengerScore = freshChallenge.challengerScore;
    const opponentScore   = freshChallenge.opponentScore;
    const status = (challengerScore !== null && opponentScore !== null) ? "finished" : "pending";

    challenge.status = status;
    challenge.challengerScore = challengerScore;
    challenge.opponentScore = opponentScore;

    // üîπ Si termin√©, envoyer le statut final
    if (status === "finished") {
        try {
            const finalPayload = {
                ID: challenge.ID,
                challengerScore,
                opponentScore,
                status: "finished"
            };
            await fetch(updateChallengeFlowUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(finalPayload)
            });
            console.log("‚úÖ Statut final 'finished' envoy√© au Flow pour l'ID :", challenge.ID);
        } catch (err) {
            console.error(err);
        }
    }

    // üîπ üîÅ Rafra√Æchir automatiquement la liste des d√©fis pour cacher ceux d√©j√† faits
    loadMyChallenges(currentUser);
    loadSentChallenges(currentUser);
};

// FINISH CHALLENGE IF NEEDED
// =======================
function finishChallengeIfNeeded() {
    console.log("‚ö° finishChallengeIfNeeded appel√© :", isChallengeSession, window.currentChallenge);
    if (isChallengeSession && typeof window.onChallengeFinished === "function") {
        window.onChallengeFinished(score, window.currentChallenge || null);
        isChallengeSession = false;
    }
}

// V√©rifier le gagnant et stopper toute boucle
async function checkWinner(challenge) {
    // V√©rifier que les deux scores sont pr√©sents
    if (
        typeof challenge.challengerScore === 'number' &&
        !isNaN(challenge.challengerScore) &&
        typeof challenge.opponentScore === 'number' &&
        !isNaN(challenge.opponentScore)
    ) {
        let msg;
        if (challenge.challengerScore > challenge.opponentScore) {
            msg = `${challenge.challenger} a gagn√© !`;
        } else if (challenge.opponentScore > challenge.challengerScore) {
            msg = `${challenge.opponent} a gagn√© !`;
        } else {
            msg = "√âgalit√© parfaite !";
        }

        alert("üèÜ R√©sultat du d√©fi : " + msg);

        // Bloquer toute relance du d√©fi
        challenge.status = "finished";
        console.log("‚úÖ D√©fi termin√©, boucle stopp√©e, statut:", challenge.status);

        // üîπ Appel au Flow pour mettre √† jour le statut de cette row
        const payload = {
            ID: challenge.ID,
            challengerScore: challenge.challengerScore,
            opponentScore: challenge.opponentScore,
            status: "finished"
        };

        try {
            const res = await fetch(updateChallengeFlowUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
            console.log("‚úÖ Statut final 'finished' envoy√© au Flow pour l'ID :", challenge.ID);
        } catch (err) {
            console.error("‚ùå Erreur lors de l‚Äôenvoi du statut final au Flow :", err);
            alert("Impossible de mettre √† jour le statut final. R√©essaie !");
        }
    }
}

// Charger les d√©fis √† chaque login
window.addEventListener("DOMContentLoaded", () => {
    if (currentUser) loadMyChallenges(currentUser);
});
  
  </script>
</body>
</html>

