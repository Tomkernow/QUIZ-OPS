<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Quiz'Ops</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
 
  <!-- Manifest pour PWA -->
<link rel="manifest" href="manifest.json">
 
  <!-- Couleur de la barre de statut -->
<meta name="theme-color" content="#004aad">
 
  <!-- Pour iOS : rendre l'app installable -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
 
  <!-- Ic√¥nes iOS -->
<link rel="apple-touch-icon" href="icons/icon-192.png">
 
  <!-- Si tu veux changer l'ic√¥ne pour diff√©rents formats -->
<link rel="apple-touch-icon" sizes="152x152" href="icons/icon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="icons/icon-512.png">
  
  <style>
    :root {
      --bg:#f4f7fa; --text:#333; --card:#fff; --primary:#1a5276;
      --muted:#ecf0f1; --border:#d0d7de; --good:#28a745; --bad:#dc3545;
    }
    * { box-sizing: border-box; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: var(--bg) url("https://images.unsplash.com/photo-1581094651181-3592e59b95a0?auto=format&fit=crop&w=1400&q=80") no-repeat center center fixed;
      background-size: cover; color: var(--text); margin: 0; padding: 0;
    }
    .overlay { background: rgba(255,255,255,0.95); min-height: 100vh; padding: 32px; }
    .container {
      max-width: 980px; margin: auto; background: var(--card); padding: 28px;
      border-radius: 16px; box-shadow: 0 6px 24px rgba(0,0,0,.12); animation: fadeIn 0.45s ease;
    }
    h1,h2 { color: var(--primary); text-align: center; margin: 0 0 12px; }
    .themes { display: grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap: 16px; margin-top: 20px; }
    .theme-button {
      background: var(--muted); border: 1px solid var(--border); border-radius: 12px;
      padding: 18px; cursor: pointer; font-size: 15px; font-weight: 600; text-align: center;
      transition: transform 0.18s, box-shadow 0.18s; user-select: none;
      min-height:110px; display:flex; flex-direction:column; justify-content:center; align-items:center;
    }
    .theme-button img { width: 48px; height: 48px; margin-bottom: 8px; }
    .theme-button:hover { transform: translateY(-4px); box-shadow: 0 6px 16px rgba(0,0,0,0.12); }

    .question { font-size: 1.2rem; margin: 14px 0; font-weight: 600; }
    .choice { display: flex; align-items: center; gap: 8px; padding: 12px 14px; margin-bottom: 12px;
      border: 1px solid var(--border); border-radius: 10px; background: #fff; cursor: pointer; transition: background 0.12s, transform 0.12s; }
    .choice:hover { background: #f4f6f8; transform: translateY(-2px); }
    .choice.correct { background-color: #d4edda !important; border-color: var(--good) !important; }
    .choice.wrong { background-color: #f8d7da !important; border-color: var(--bad) !important; }

    .submit-btn {
      display: inline-block; margin-top: 12px; background: var(--primary); color: white;
      padding: 10px 16px; border: none; border-radius: 10px; font-size: 0.98rem; cursor: pointer;
      transition: background 0.12s, transform 0.12s;
    }
    .submit-btn:hover { background: #154360; transform: scale(1.02); }

    .result { margin-top: 8px; font-weight: 700; }
    .explanation { margin-top: 10px; padding: 12px; border-left: 4px solid var(--primary);
      background: #f3f6f8; border-radius: 6px; line-height: 1.4; }

    .row { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
    #nextBtn, #prevBtn, #backBtn {
      display: none; margin-top: 14px; padding: 10px 16px; border-radius: 10px;
    }
    #nextBtn { border: 1px solid var(--primary); background: var(--primary); color: #fff; }
    #prevBtn { border: 1px solid var(--border); background: var(--muted); }
    #backBtn { border: 1px solid var(--border); background: var(--muted); }

    .score { margin-top: 6px; text-align: center; color: #555; }
    .footer-note { margin-top: 18px; font-size: 12px; color: #666; text-align: center; }

    .progress-bar { margin: 12px 0; height: 20px; width: 100%; background: #eee; border-radius: 12px; overflow: hidden; }
    .progress-fill { height: 100%; width: 0%; background: var(--primary); text-align: center; color: #fff; font-size: 12px; line-height: 20px; transition: width 0.3s ease; }

    #login-container { text-align:center; }
    #login-container input {
      padding: 12px; width: 70%; max-width: 320px; margin-bottom: 12px;
      border: 1px solid var(--border); border-radius: 8px;
    }
    #login-container button {
      background: var(--primary); color: #fff; padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer;
    }
    #logoutBtn { margin-top: 8px; background: transparent; color: #666; border: none; cursor: pointer; text-decoration: underline; }

    #progress-overview { margin-top: 24px; }
    .progress-card {
      border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin-top: 10px; background: #fff;
    }
    .progress-mini { height: 10px; background:#eee; border-radius: 8px; overflow:hidden; }
    .progress-mini-fill { height: 100%; width: 0%; background: var(--primary); transition: width .3s; }
    .mini-row { display:flex; justify-content:space-between; font-size: 12px; color:#555; margin-top:6px; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    /* petites am√©liorations responsive */
    @media (max-width:520px){
      .theme-button img { width: 40px; height: 40px; }
      #login-container input { width: 90%; }
    }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="container">

     <!-- === LOGIN PAGE === -->
      <div id="login-container">
        <h1>üîë Login to Quiz'Ops</h1>
        <p><button onclick="showSignup()" style="background:none;border:none;color:var(--primary);cursor:pointer;text-decoration:underline;font-size:0.9rem;">First connexion ? Subscribe</button></p>
        <p>Enter your email and password to start</p>
        <input type="email" id="emailInput" placeholder="your@email.com" />
        <br>
        <input type="password" id="passwordInput" placeholder="Password" />
        <br>
        <button onclick="login()">Login</button>
        <!-- Bouton mot de passe oubli√© -->
        <div style="margin-top:8px;">
          <button id="forgotID">Password forgot ?</button>
        </div>
        <div id="forgotIDForm" style="display:none;margin-top:10px">
          <input type="email" id="forgotEmail" placeholder="Your email" required />
          <button id="sendID">Send ID</button>
          <p id="forgotMessage"></p>
        </div>
      </div>

      <!-- SIGNUP PAGE -->
      <div id="signup-container" style="display:none; text-align:center;">
        <h1>üÜï First connexion ?</h1>
        <p>Subscribe with email and ID</p>
        <input type="email" id="signupEmail" placeholder="Your email" required />
        <br>
        <input type="text" id="signupID" placeholder="Your ID" required />
        <br>
        <button onclick="signup()">Subscribe</button>
        <p id="signupMessage"></p>
        <button onclick="showLogin()">‚¨Ö Already subscribe ? Please login</button>
      </div>

      <!-- === ADMIN PANEL === -->
      <div id="admin-panel" style="display:none;">
        <h1>üë®‚Äçüíª Moderator Dashboard</h1>
        <button id="logoutBtnAdmin" onclick="logout()">Logout</button>
        <p style="text-align:center">Select a user to view their quiz progress:</p>
        <div id="user-list" style="margin-top:20px;"></div>
        <div id="user-progress" style="margin-top:30px;"></div>
      </div>

      <!-- === THEME SELECTION === -->
      <div id="theme-selection" style="display:none;">
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <h1>‚õΩ Quiz'Ops</h1>
          <button id="logoutBtn" onclick="logout()">Logout</button>
        </div>
        <p style="text-align:center">
          Pick a theme. Each quiz draws <b>10 random questions</b> from the theme‚Äôs question bank.
        </p>

        <!-- Dynamic themes grid -->
        <div class="themes"></div>

<div id="challenge-section" style="display:none; margin-top:24px;">
    <h2>‚öîÔ∏è D√©fis</h2>
    <button id="showChallengeBtn">Lancer un d√©fi</button>

    <div id="challenge-form" style="display:none; margin-top:12px;">
      <select id="opponentEmail">
  <option value="">Choisir un joueur...</option>
</select>
      <select id="challengeTheme">
        <option value="cargo_docs">Cargo Docs</option>
        <option value="refined_products">Refined Products</option>
        <option value="specialty_products">Specialty Products</option>
      </select>
      <button id="sendChallengeBtn">Envoyer le d√©fi</button>
    </div>

    <!-- Container pour d√©fis re√ßus -->
    <div id="my-challenges" style="margin-top:16px; display:none;">
        <h3>D√©fis re√ßus</h3>
        <div id="challenges-list"></div>
    </div>
</div>

        <!-- Progress dashboard -->
        <div id="progress-overview"></div>
      </div>

      <!-- === QUIZ CONTAINER === -->
      <div id="quiz-container" style="display:none;">
        <h2 id="theme-title"></h2>
        <div class="progress-bar"><div class="progress-fill" id="progressFill">0%</div></div>
		<div id="timer" style="text-align:center; margin-bottom:10px; font-weight:600;"></div>
        <div class="score" id="scoreLine"></div>
        <div class="question" id="question"></div>
        <div class="choices" id="choices"></div>
        <div class="result" id="result"></div>
        <div class="explanation" id="explanation"></div>
        <div class="row">
          <button id="prevBtn" onclick="prevQuestion()">‚¨Ö Previous</button>
          <button id="nextBtn" onclick="nextQuestion()">Next ‚û°</button>
          <button id="backBtn" onclick="goBack()">‚¨Ö Back to Menu</button>
        </div>
        <div class="footer-note">Tip: you get a different set each time you launch a theme.</div>
      </div>

<div id="overallProgressContainer" style="margin: 16px 0; text-align:center;">
  <div style="background:#eee; border-radius:8px; height:20px; width:80%; margin:0 auto; position:relative;">
    <div id="overallProgressFill" style="background:#4caf50; height:100%; width:0%; border-radius:8px; text-align:center; color:white; line-height:20px; font-size:12px;">
      0%
    </div>
  </div>
  
    </div>
  </div>

  <script>
    // ---------------------------
    // CONFIG
    // ---------------------------
    // Laisse vide si tu ne veux pas envoyer vers Power Automate pour l'instant
  function showSignup() {
    document.getElementById("login-container").style.display = "none";
    document.getElementById("signup-container").style.display = "block";
}

function showLogin() {
    document.getElementById("signup-container").style.display = "none";
    document.getElementById("login-container").style.display = "block";
}

  // === Power Automate Flow URL ===
const flowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/8529a06fdcc6401aaa54e12ccdf8053c/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=ZMFUE06qvb1Qjx-2UAwG47ivXUPZljA2ikv4TaMdVQE";
const flowUrlSignup = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/cb431fe6824e4af79ff1081e88adbcde/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=JJ-Qbs2tRRE5gFnpSBfUrVp6oPshyoZcKFEJ3CcVWvg";
const flow = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/cd72f3ad611140f4b40ee95952f496ac/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=U45wTZLPIBNCIHN1Jv8Uq1AmteCU1Bo6eLzz2TTmVIE"
const createChallengeFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/2a477945342b45fb8d16005ccea30204/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=rV-cHf43QIzra6-zmfEkfCNOEV00ovXN0VxL9Z62Wz0";
const getChallengesFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/31ef6faaebcb43f4878225828d23a559/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=21xbDVO1CPlcxZgqjjjJ7bi9F9IBvXDzU_1fDKc5K7Q";
const updateChallengeFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/f75d3f08213d4d3badffabd91a32f666/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=eOjS9FQtNfeonEXf3eYRX2y5koUv9nV-czcyrFN8lvM";
const getAllUsersFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/87639e159f094cfdb271eac85cc07e9a/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=44pRUiagqDm_20uaN8NVFifqclbejWMyNPDMan3Wntk"
const updateChallengeDoneFlowUrl = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/c9bcce3eda5549b3ae905734dadc8fcf/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=mNGG7Fs3Z0ywx5v95GrR2aKzEoQVzBGIK2XECgdpNA8";
const UPDATE_PROGRESS_URL = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/e23e3c436c3145bebd18206e4b7e55eb/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=CffamMjMGSTdVPz_ZJ8QOQOI8W_C0I1lBKutiMjQa84";
const GET_PROGRESS_URL = "https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/4d4e1d4fa7154adf9e982d40925666f5/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=uk1eQuzMtSrZ2MXRhXK7sz772Th105-hlY0mGSQjjjQ";

function getUserIP() {
  // ‚ö†Ô∏è HTML ne peut pas obtenir l‚ÄôIP r√©elle sans backend.
  // Ici, tu peux mettre une valeur fixe ou appeler une API IP si autoris√©.
  return "127.0.0.1";
}

  // Utility: shuffle
  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

    // === QUESTION BANK ===
    const quizData = {
      cargo_docs: {
        title: "Cargo Documentation",
        questions: [
    {
  id: "cdoc1",
  question: "Which document serves as proof of title for crude oil cargo?",
  choices: ["Bill of Lading", "Certificate of Quality", "Charter Party", "Invoice"],
  correct: 0,
  explanation: "The Bill of Lading is the legal document that represents cargo ownership."
},
{
  id: "cdoc2",
  question: "Which documents are usually required by banks under a Letter of Credit?",
  choices: ["Bill of Lading", "Commercial Invoice", "Certificate of Origin", "NOR"],
  correct: [0,1,2],
  explanation: "Banks require the Bill of Lading, Commercial Invoice, and Certificate of Origin for payment."
},
{
  id: "cdoc3",
  question: "Which document records loading and discharging operations timings?",
  choices: ["Statement of Facts (SOF)", "Charter Party", "NOR", "Cargo Manifest"],
  correct: 0,
  explanation: "The Statement of Facts (SOF) lists all events during cargo ops."
},
{
  id: "cdoc4",
  question: "Which documents are considered key for customs clearance?",
  choices: ["Bill of Lading", "Certificate of Origin", "Commercial Invoice", "Q88"],
  correct: [0,1,2],
  explanation: "Customs clearance usually needs B/L, Certificate of Origin, and Invoice."
},
{
  id: "cdoc5",
  question: "Which document specifies vessel readiness to load/discharge?",
  choices: ["Notice of Readiness (NOR)", "SOF", "Charter Party", "Survey Report"],
  correct: 0,
  explanation: "The NOR certifies the ship is ready for operations."
},
{
  id: "cdoc6",
  question: "Which documents may contain details on product specifications?",
  choices: ["Certificate of Quality", "Certificate of Quantity", "Survey Report", "Q88"],
  correct: [0,1,2],
  explanation: "CoQ, CoQnty, and Survey Reports provide product details."
},
{
  id: "cdoc7",
  question: "Which document describes technical vessel specifications?",
  choices: ["Q88", "Charter Party", "Bill of Lading", "Invoice"],
  correct: 0,
  explanation: "The Q88 is a tanker questionnaire listing vessel specs."
},
{
  id: "cdoc8",
  question: "Which documents are critical for resolving cargo disputes?",
  choices: ["Surveyor Report", "Pumping Log", "SOF", "Bunker Delivery Note"],
  correct: [0,1,2],
  explanation: "Survey, pumping log, and SOF help reconcile disputes."
},
{
  id: "cdoc9",
  question: "Which document summarizes all cargo loaded on the vessel?",
  choices: ["Cargo Manifest", "Invoice", "Bill of Lading", "Q88"],
  correct: 0,
  explanation: "The Cargo Manifest lists all cargo parcels."
},
{
  id: "cdoc10",
  question: "Which documents prove cargo quality?",
  choices: ["Certificate of Quality", "Surveyor Report", "Commercial Invoice", "Charter Party"],
  correct: [0,1],
  explanation: "CoQ and Surveyor Reports certify cargo quality."
},
{
  id: "cdoc11",
  question: "Which document provides a vessel‚Äôs performance and demurrage obligations?",
  choices: ["Charter Party", "Bill of Lading", "Q88", "Invoice"],
  correct: 0,
  explanation: "The Charter Party governs vessel terms and demurrage."
},
{
  id: "cdoc12",
  question: "Which documents are normally issued by the ship‚Äôs Master?",
  choices: ["Bill of Lading", "SOF", "NOR", "Survey Report"],
  correct: [0,1,2],
  explanation: "B/L, SOF, and NOR are typically issued by the Master."
},
{
  id: "cdoc13",
  question: "Which certificate shows origin of cargo for import duties?",
  choices: ["Certificate of Origin", "Certificate of Quality", "Bill of Lading", "Invoice"],
  correct: 0,
  explanation: "The Certificate of Origin is used for customs duties."
},
{
  id: "cdoc14",
  question: "Which documents confirm loaded and discharged quantities?",
  choices: ["Certificate of Quantity", "Survey Report", "Pumping Log", "Invoice"],
  correct: [0,1,2],
  explanation: "All three confirm actual loaded/discharged cargo."
},
{
  id: "cdoc15",
  question: "Which documents are legally binding contracts?",
  choices: ["Charter Party", "Bill of Lading", "Invoice", "Q88"],
  correct: [0,1],
  explanation: "The Charter Party and B/L are legal documents."
},
{
  id: "cdoc16",
  question: "Which document is often countersigned by the terminal?",
  choices: ["SOF", "NOR", "Survey Report", "Invoice"],
  correct: [0,1],
  explanation: "SOF and NOR are often signed by terminal and Master."
},
{
  id: "cdoc17",
  question: "Which certificates are key for jet fuel cargoes?",
  choices: ["Certificate of Quality", "Certificate of Analysis", "Certificate of Origin", "Bunker Delivery Note"],
  correct: [0,1],
  explanation: "CoQ and CoA are essential for jet fuel certification."
},
{
  id: "cdoc18",
  question: "Which documents protect cargo interests in case of dispute?",
  choices: ["Letter of Protest", "Surveyor Report", "SOF", "Charter Party"],
  correct: [0,1,2],
  explanation: "Protest letters, survey, and SOF support claims."
},
{
  id: "cdoc19",
  question: "Which documents are usually attached to Letters of Credit?",
  choices: ["Bill of Lading", "Commercial Invoice", "Insurance Certificate", "Packing List"],
  correct: [0,1,2,3],
  explanation: "All four are typically required in L/C documentation."
},
{
  id: "cdoc20",
  question: "Which document confirms vessel tank cleanliness before loading?",
  choices: ["Tank Inspection Certificate", "Q88", "SOF", "NOR"],
  correct: 0,
  explanation: "A Tank Inspection Certificate is issued before loading sensitive cargo."
},
{
  id: "cdoc21",
  question: "Which documents are relevant to insurance claims?",
  choices: ["Bill of Lading", "Insurance Certificate", "Surveyor Report", "Invoice"],
  correct: [0,1,2,3],
  explanation: "All are needed for insurance claims."
},
{
  id: "cdoc22",
  question: "Which document is used to declare the ship‚Äôs arrival?",
  choices: ["Notice of Readiness", "Bill of Entry", "SOF", "Cargo Manifest"],
  correct: 1,
  explanation: "The Bill of Entry declares the vessel‚Äôs arrival to customs."
},
{
  id: "cdoc23",
  question: "Which documents provide details of demurrage calculations?",
  choices: ["SOF", "Charter Party", "Invoice", "NOR"],
  correct: [0,1],
  explanation: "SOF and Charter Party form the basis of demurrage claims."
},
{
  id: "cdoc24",
  question: "Which documents are commonly signed by the surveyor?",
  choices: ["Survey Report", "Certificate of Quality", "Certificate of Quantity", "Bunker Delivery Note"],
  correct: [0,1,2],
  explanation: "Surveyor signs Survey Reports and CoQ/CoQnty."
},
{
  id: "cdoc25",
  question: "Which documents provide evidence for laytime calculation?",
  choices: ["NOR", "SOF", "Charter Party", "Invoice"],
  correct: [0,1,2],
  explanation: "NOR, SOF, and Charter Party are essential for laytime."
},

{
  id: "cdoc26",
  question: "Which documents must match under a Letter of Credit to avoid rejection?",
  choices: ["Bill of Lading", "Commercial Invoice", "Certificate of Origin", "Insurance Certificate"],
  correct: [0,1,2,3],
  explanation: "All presented documents must strictly match L/C terms to avoid rejection."
},
{
  id: "cdoc27",
  question: "Which document proves insurance coverage for cargo?",
  choices: ["Insurance Certificate", "Bill of Lading", "Surveyor Report", "Charter Party"],
  correct: 0,
  explanation: "The Insurance Certificate provides proof of coverage."
},
{
  id: "cdoc28",
  question: "Which documents are critical in case of cargo shortage disputes?",
  choices: ["Certificate of Quantity", "Surveyor Report", "Pumping Log", "SOF"],
  correct: [0,1,2,3],
  explanation: "All are necessary to prove where the loss occurred."
},
{
  id: "cdoc29",
  question: "Which document declares the vessel has completed cargo ops?",
  choices: ["SOF", "Notice of Readiness", "Charter Party", "Completion Certificate"],
  correct: 3,
  explanation: "A Completion Certificate may be issued after operations finish."
},
{
  id: "cdoc30",
  question: "Which documents are issued at the load port?",
  choices: ["Bill of Lading", "Certificate of Quality", "Certificate of Quantity", "Invoice"],
  correct: [0,1,2],
  explanation: "B/L, CoQ, and CoQnty are issued at load port."
},
{
  id: "cdoc31",
  question: "Which document evidences vessel seaworthiness?",
  choices: ["Class Certificate", "Q88", "Charter Party", "Bill of Lading"],
  correct: 0,
  explanation: "Class Certificates prove vessel seaworthiness."
},
{
  id: "cdoc32",
  question: "Which documents are important in off-spec cargo claims?",
  choices: ["Certificate of Quality", "Surveyor Report", "Heating Logs", "Charter Party"],
  correct: [0,1,2],
  explanation: "CoQ, survey, and heating logs support or defend quality claims."
},
{
  id: "cdoc33",
  question: "Which document contains legal conditions for cargo carriage?",
  choices: ["Bill of Lading", "Charter Party", "Invoice", "Survey Report"],
  correct: [0,1],
  explanation: "Both B/L and Charter Party include legal clauses."
},
{
  id: "cdoc34",
  question: "Which documents are commonly used to check cargo description?",
  choices: ["Cargo Manifest", "Bill of Lading", "Commercial Invoice", "Q88"],
  correct: [0,1,2],
  explanation: "Manifest, B/L, and Invoice must match cargo description."
},
{
  id: "cdoc35",
  question: "Which document specifies tank cleanliness before loading clean products?",
  choices: ["Tank Cleanliness Certificate", "Surveyor Report", "Q88", "SOF"],
  correct: [0,1],
  explanation: "Tank cleanliness certificates and surveyor reports confirm readiness."
},
{
  id: "cdoc36",
  question: "Which documents are key in demurrage disputes?",
  choices: ["SOF", "NOR", "Charter Party", "Laytime Statement"],
  correct: [0,1,2,3],
  explanation: "All four are needed to settle demurrage disputes."
},
{
  id: "cdoc37",
  question: "Which document states cargo has been loaded on board?",
  choices: ["On-board Bill of Lading", "Cargo Manifest", "Survey Report", "Charter Party"],
  correct: 0,
  explanation: "An on-board B/L confirms cargo is physically loaded."
},
{
  id: "cdoc38",
  question: "Which documents can be used to prove force majeure in cargo ops?",
  choices: ["Port Authority Notice", "Weather Reports", "SOF", "Charter Party"],
  correct: [0,1,2,3],
  explanation: "All can be used as supporting evidence for force majeure claims."
},
{
  id: "cdoc39",
  question: "Which documents confirm cargo weight?",
  choices: ["Certificate of Quantity", "Survey Report", "Pumping Log", "Bill of Lading"],
  correct: [0,1,2],
  explanation: "CoQ, Survey, and Pumping Log confirm weights."
},
{
  id: "cdoc40",
  question: "Which document serves as a receipt for cargo?",
  choices: ["Bill of Lading", "Invoice", "Certificate of Origin", "SOF"],
  correct: 0,
  explanation: "The Bill of Lading is both a receipt and title document."
},
{
  id: "cdoc41",
  question: "Which documents are checked during port State control?",
  choices: ["Bill of Lading", "SOF", "Q88", "Class Certificates"],
  correct: [2,3],
  explanation: "PSC checks vessel class certificates and sometimes Q88."
},
{
  id: "cdoc42",
  question: "Which documents can be electronically issued?",
  choices: ["Electronic Bill of Lading", "Invoice", "Cargo Manifest", "Survey Report"],
  correct: [0,1,2],
  explanation: "B/L, Invoice, and Manifest can now be issued electronically."
},
{
  id: "cdoc43",
  question: "Which document records vessel pumping performance?",
  choices: ["Pumping Log", "SOF", "Survey Report", "Charter Party"],
  correct: 0,
  explanation: "The Pumping Log records cargo pumping rates."
},
{
  id: "cdoc44",
  question: "Which documents are vital for laytime calculation?",
  choices: ["NOR", "SOF", "Charter Party", "Completion Certificate"],
  correct: [0,1,2],
  explanation: "NOR, SOF, and CP are required for laytime."
},
{
  id: "cdoc45",
  question: "Which documents confirm cargo identity?",
  choices: ["Certificate of Analysis", "Certificate of Quality", "Commercial Invoice", "Survey Report"],
  correct: [0,1,2],
  explanation: "CoA, CoQ, and Invoice confirm product identity."
},
{
  id: "cdoc46",
  question: "Which document is key for phytosanitary clearance of biofuels?",
  choices: ["Phytosanitary Certificate", "Certificate of Quality", "Certificate of Origin", "Invoice"],
  correct: 0,
  explanation: "Phytosanitary Certificates are mandatory for biofuels/agri products."
},
{
  id: "cdoc47",
  question: "Which documents are usually provided by independent inspectors?",
  choices: ["Surveyor Report", "Certificate of Quantity", "Certificate of Quality", "Invoice"],
  correct: [0,1,2],
  explanation: "Inspectors issue Survey Reports and CoQ/CoQnty."
},
{
  id: "cdoc48",
  question: "Which document is required for dangerous cargo declaration?",
  choices: ["Material Safety Data Sheet (MSDS)", "Bill of Lading", "Cargo Manifest", "Survey Report"],
  correct: 0,
  explanation: "The MSDS is mandatory for dangerous cargo."
},
{
  id: "cdoc49",
  question: "Which documents protect charterers in disputes?",
  choices: ["Charter Party", "Letter of Protest", "NOR", "SOF"],
  correct: [0,1,3],
  explanation: "Charter Party, Protest letters, and SOF protect charterers."
},
{
  id: "cdoc50",
  question: "Which documents must be consistent across trade?",
  choices: ["Bill of Lading", "Commercial Invoice", "Certificate of Origin", "Cargo Manifest"],
  correct: [0,1,2,3],
  explanation: "All must match for smooth cargo operations and trade compliance."
}

  ]
},

crude_types_specs: { 
    title: "Crude Oil Types & Specs", 

 questions: [
  { id: "cru1", question: "Crude oil is a mixture of:", choices: ["Pure hydrocarbons", "Hydrocarbons and impurities", "Single compound", "Alcohols"], correct: 1, explanation: "Crude oil is a natural mixture of hydrocarbons and impurities like sulfur, nitrogen, metals, and salts." },
  { id: "cru2", question: "First major separation step for crude oil:", choices: ["Vacuum distillation", "Atmospheric distillation", "Cracking", "Reforming"], correct: 1, explanation: "Atmospheric distillation is the first step in refining crude oil, separating it into fractions based on boiling points." },
  { id: "cru3", question: "Main impurities in crude impacting refining:", choices: ["Nitrogen, sulfur, metals", "Helium and neon", "Water only", "Oxygen only"], correct: 0, explanation: "Sulfur, nitrogen, and metals are the main problematic impurities because they cause corrosion and catalyst poisoning." },
  { id: "cru4", question: "API gravity is a measure of:", choices: ["Viscosity", "Density", "Sulfur", "Aromatics"], correct: 1, explanation: "API gravity is a measure of the density of crude oil compared to water." },
  { id: "cru5", question: "Light crude generally has:", choices: ["Low API", "High API", "High sulfur", "High metals"], correct: 1, explanation: "Light crude has high API gravity, meaning it is less dense and yields more valuable light products." },
  { id: "cru6", question: "Sweet crude means:", choices: ["Low sulfur", "High sulfur", "High nitrogen", "Low metals"], correct: 0, explanation: "Sweet crude contains low sulfur and is easier to refine into clean fuels." },
  { id: "cru7", question: "A crude desalter removes mostly:", choices: ["Hydrogen", "Water and salts", "Aromatics", "Paraffins"], correct: 1, explanation: "A desalter removes water-soluble salts and water to prevent corrosion and fouling in the distillation unit." },
  { id: "cru8", question: "Bottom product of atmospheric distillation:", choices: ["Naphtha", "Kerosene", "Atmospheric residue", "Diesel"], correct: 2, explanation: "The heaviest fraction, atmospheric residue, remains at the bottom after atmospheric distillation." },
  { id: "cru9", question: "Typical sulfur content range in crudes:", choices: ["0‚Äì0.1%", "0.5‚Äì5%", "10%", "50%"], correct: 1, explanation: "Sulfur content in crude typically ranges between 0.5% and 5%." },
  { id: "cru10", question: "Crude oil resources are mainly found in:", choices: ["Igneous rocks", "Sedimentary basins", "Mountains", "Volcanoes"], correct: 1, explanation: "Crude oil forms in sedimentary basins where organic matter is buried and transformed under heat and pressure." },
  { id: "cru11", question: "What is heavy crude oil characterized by?", choices: ["High API gravity", "Low viscosity", "High viscosity and density", "Low sulfur"], correct: 2, explanation: "Heavy crude has high viscosity, low API gravity, and is harder to refine." },
  { id: "cru12", question: "Which element in crude oil contributes to SOx emissions?", choices: ["Carbon", "Sulfur", "Nitrogen", "Hydrogen"], correct: 1, explanation: "Sulfur in crude oil produces sulfur oxides (SOx) during combustion, causing air pollution." },
  { id: "cru13", question: "Vacuum distillation is applied to:", choices: ["Light naphtha", "Kerosene", "Atmospheric residue", "LPG"], correct: 2, explanation: "Atmospheric residue is sent to vacuum distillation to recover valuable heavy gas oils without cracking them." },
  { id: "cru14", question: "Which crude type is easier to refine?", choices: ["Heavy sour crude", "Light sweet crude", "Residue-rich crude", "Extra heavy crude"], correct: 1, explanation: "Light sweet crude is easier to refine and produces more high-value light products." },
  { id: "cru15", question: "Which crude oil fraction is used for making lubricants?", choices: ["LPG", "Gasoline", "Vacuum gas oil", "Heavy residue"], correct: 2, explanation: "Vacuum gas oil and heavier fractions are processed into base oils for lubricants." },
  { id: "cru16", question: "What is the typical hydrogen content in crude oil?", choices: ["1‚Äì5%", "10‚Äì14%", "20‚Äì25%", "50%"], correct: 1, explanation: "Crude oil typically contains around 10‚Äì14% hydrogen by weight." },
  { id: "cru17", question: "Crude oil with high paraffin content is prone to:", choices: ["High viscosity", "Wax deposition", "High sulfur", "Metal poisoning"], correct: 1, explanation: "Paraffinic crudes contain waxes that can solidify and cause flow problems at low temperatures." },
  { id: "cru18", question: "The pour point of crude oil refers to:", choices: ["Boiling point", "Flash point", "Lowest temperature it flows", "Viscosity at 100 ¬∞C"], correct: 2, explanation: "The pour point is the lowest temperature at which crude oil remains pourable." },
  { id: "cru19", question: "Which crude benchmark is used in Europe?", choices: ["WTI", "Dubai", "Brent", "Bonny Light"], correct: 2, explanation: "Brent crude is the main pricing benchmark in Europe." },
  { id: "cru20", question: "Which crude benchmark is used in the US?", choices: ["Brent", "WTI", "Dubai", "Urals"], correct: 1, explanation: "West Texas Intermediate (WTI) is the key benchmark for US crude oil pricing." },
  { id: "cru21", question: "Which crude oil benchmark is used in the Middle East?", choices: ["Brent", "WTI", "Dubai", "Bonny Light"], correct: 2, explanation: "Dubai crude is the key pricing benchmark in the Middle East and Asia." },
  { id: "cru22", question: "What does TAN (Total Acid Number) measure in crude?", choices: ["Acidity of crude", "Sulfur content", "Viscosity", "Density"], correct: 0, explanation: "TAN indicates the acidity of crude oil, which impacts corrosion in refinery units." },
  { id: "cru23", question: "What does a higher API gravity indicate?", choices: ["Heavier crude", "Lighter crude", "Higher sulfur", "Higher metals"], correct: 1, explanation: "Higher API gravity means the crude is lighter and more valuable." },
  { id: "cru24", question: "What does CCR (Conradson Carbon Residue) indicate?", choices: ["Sulfur content", "Coking tendency", "Viscosity", "API gravity"], correct: 1, explanation: "CCR measures the tendency of crude oil to form coke during processing." },
  { id: "cru25", question: "Which crude property impacts hydrogen consumption in refining?", choices: ["Sulfur content", "Wax content", "Water content", "Density"], correct: 0, explanation: "High sulfur content requires more hydrogen for hydrotreating and desulfurization." },
  { id: "cru26", question: "Which gas is dissolved in crude oil at reservoir conditions?", choices: ["Oxygen", "Carbon dioxide", "Methane", "Nitrogen"], correct: 2, explanation: "Methane and other light hydrocarbons are dissolved in crude oil under reservoir pressure." },
  { id: "cru27", question: "Which crude fraction is used as petrochemical feedstock?", choices: ["Fuel oil", "Naphtha", "Vacuum residue", "Asphalt"], correct: 1, explanation: "Naphtha is the primary feedstock for petrochemical production like olefins and aromatics." },
  { id: "cru28", question: "Which heavy crude upgrading process uses hydrogen?", choices: ["Coking", "Hydrocracking", "Visbreaking", "Thermal cracking"], correct: 1, explanation: "Hydrocracking uses hydrogen to upgrade heavy crude fractions into lighter products." },
  { id: "cru29", question: "Where is most of the world's crude oil located?", choices: ["Arctic", "Middle East", "Europe", "Australia"], correct: 1, explanation: "The Middle East holds the largest share of the world‚Äôs proven crude oil reserves." },
  { id: "cru30", question: "Which property differentiates sweet and sour crude?", choices: ["API gravity", "Sulfur content", "Viscosity", "Wax content"], correct: 1, explanation: "The sulfur content defines whether a crude is classified as sweet or sour." },
  { id: "cru31", question: "What does BS&W in crude oil stand for?", choices: ["Base Sulfur & Water", "Basic Sediment & Water", "Balance Salt & Wax", "Bitumen Sand & Wax"], correct: 1, explanation: "BS&W refers to Basic Sediment & Water, impurities removed before refining." },
  { id: "cru32", question: "Crude oil‚Äôs nitrogen compounds are problematic because:", choices: ["They increase viscosity", "They poison catalysts", "They lower API gravity", "They reduce hydrogen"], correct: 1, explanation: "Nitrogen compounds deactivate catalysts during hydrotreating and cracking." },
  { id: "cru33", question: "The flash point of crude oil is:", choices: ["Lowest flow temperature", "Temperature it ignites", "Density measure", "Pour point"], correct: 1, explanation: "The flash point is the temperature at which crude vapors ignite in the presence of a flame." },
  { id: "cru34", question: "What is bitumen derived from crude used for?", choices: ["Jet fuel", "Road construction", "Petrochemicals", "Cooking gas"], correct: 1, explanation: "Bitumen, the heaviest crude fraction, is widely used in road paving and roofing materials." },
  { id: "cru35", question: "Which is the lightest fraction in crude distillation?", choices: ["Diesel", "LPG", "Vacuum residue", "Fuel oil"], correct: 1, explanation: "LPG is the lightest fraction recovered during crude distillation." },
  { id: "cru36", question: "Which test measures crude‚Äôs metal content?", choices: ["XRF analysis", "API gravity", "Pour point", "CCR"], correct: 0, explanation: "X-ray fluorescence (XRF) is used to measure trace metals in crude oil." },
  { id: "cru37", question: "Which crude fraction has the highest boiling point?", choices: ["Gasoline", "Kerosene", "Vacuum residue", "Diesel"], correct: 2, explanation: "Vacuum residue has the highest boiling range and cannot be distilled under normal conditions." },
  { id: "cru38", question: "Which crude oil fraction is a key feedstock for catalytic cracking?", choices: ["LPG", "Vacuum gas oil", "Kerosene", "Asphalt"], correct: 1, explanation: "Vacuum gas oil is the main feedstock for FCC (fluid catalytic cracking) units." },
  { id: "cru39", question: "Crude oil density is usually expressed in:", choices: ["g/cm¬≥", "API gravity", "Pa¬∑s", "¬∞C"], correct: 1, explanation: "Crude oil density is expressed as API gravity, a standard industry measure." },
  { id: "cru40", question: "Which crude property impacts refinery yield of gasoline?", choices: ["Sulfur content", "Paraffinic content", "Viscosity", "Water content"], correct: 1, explanation: "Paraffinic crudes yield more gasoline when processed compared to naphthenic crudes." },
  { id: "cru41", question: "Which element in crude causes corrosion in distillation units?", choices: ["Sulfur", "Nitrogen", "Chlorides", "Paraffins"], correct: 2, explanation: "Chloride salts in crude oil hydrolyze into hydrochloric acid, causing corrosion." },
  { id: "cru42", question: "Which crude type generally requires more upgrading?", choices: ["Light sweet crude", "Heavy sour crude", "Condensates", "Paraffinic crude"], correct: 1, explanation: "Heavy sour crude requires extensive upgrading due to its high sulfur and metal content." },
  { id: "cru43", question: "Which crude oil property determines energy content?", choices: ["Sulfur", "Viscosity", "Hydrogen-to-carbon ratio", "Pour point"], correct: 2, explanation: "A higher hydrogen-to-carbon ratio indicates greater energy content and cleaner combustion." },
  { id: "cru44", question: "Which type of crude has higher wax content?", choices: ["Naphthenic crude", "Paraffinic crude", "Sour crude", "Heavy crude"], correct: 1, explanation: "Paraffinic crudes have higher wax content, leading to flow problems in pipelines." },
  { id: "cru45", question: "Which crude analysis measures hydrocarbon types?", choices: ["Distillation curve", "SARA analysis", "CCR", "Flash point"], correct: 1, explanation: "SARA analysis separates hydrocarbons into saturates, aromatics, resins, and asphaltenes." },
  { id: "cru46", question: "Which crude oil type yields more lubricants?", choices: ["Paraffinic crude", "Naphthenic crude", "Sour crude", "Light crude"], correct: 0, explanation: "Paraffinic crudes are preferred for lubricant production due to high wax and base oil content." },
  { id: "cru47", question: "Which measurement indicates crude stability?", choices: ["API gravity", "CCR", "Asphaltene content", "Flash point"], correct: 2, explanation: "Asphaltene content affects crude oil stability during transport and refining." },
  { id: "cru48", question: "Which crude oil property is most important for transport?", choices: ["Viscosity", "Pour point", "API gravity", "All of the above"], correct: 3, explanation: "Viscosity, pour point, and API gravity all impact how crude oil can be pumped and transported." },
  { id: "cru49", question: "Which crude fraction is mainly used for jet fuel?", choices: ["Naphtha", "Kerosene", "Diesel", "Vacuum residue"], correct: 1, explanation: "Kerosene fraction is primarily refined into jet fuel." },
  { id: "cru50", question: "Which heavy crude processing method produces petroleum coke?", choices: ["Hydrocracking", "Coking", "Visbreaking", "Reforming"], correct: 1, explanation: "Coking is used to upgrade heavy residues and produces petroleum coke as a byproduct." }
]
},
  refined_products: { 
    title: "Refined Products (Gasoline, Diesel, Jet A1, Fuel Oil)", 
    questions: [

{
  id: "rfp1",
  question: "Which refined product typically has the highest sulfur specification tolerance?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 3,
  explanation: "Fuel oil has the highest sulfur tolerance compared to clean products."
},
{
  id: "rfp2",
  question: "Which products are classified as clean petroleum products (CPP)?",
  choices: ["Gasoline", "Jet A1", "Diesel", "Fuel Oil"],
  correct: [0,1,2],
  explanation: "Gasoline, jet fuel, and diesel are CPP. Fuel oil is dirty cargo."
},
{
  id: "rfp3",
  question: "What is the primary concern when blending gasoline with high aromatics?",
  choices: ["Octane increase", "Knock resistance", "Environmental restrictions", "Viscosity"],
  correct: [0,1,2],
  explanation: "Aromatics increase octane but face restrictions due to emissions."
},
{
  id: "rfp4",
  question: "Which refined product requires freezing point testing?",
  choices: ["Diesel", "Gasoline", "Jet A1", "Fuel Oil"],
  correct: 2,
  explanation: "Jet A1 requires freezing point control for aviation safety."
},
{
  id: "rfp5",
  question: "Which specs are critical in marine fuel oil trading?",
  choices: ["Viscosity", "Sulfur content", "Density", "Octane number"],
  correct: [0,1,2],
  explanation: "Marine fuels are controlled by viscosity, sulfur, and density; octane applies to gasoline."
},
{
  id: "rfp6",
  question: "Which refined product is mostly subject to octane rating?",
  choices: ["Diesel", "Gasoline", "Jet A1", "Fuel Oil"],
  correct: 1,
  explanation: "Octane rating defines gasoline anti-knock properties."
},
{
  id: "rfp7",
  question: "Which refined products are subject to flash point requirements?",
  choices: ["Jet A1", "Diesel", "Gasoline", "Fuel Oil"],
  correct: [0,1,3],
  explanation: "Jet, diesel, and fuel oil have minimum flash point requirements."
},
{
  id: "rfp8",
  question: "Which product has the lowest density?",
  choices: ["Gasoline", "Jet A1", "Diesel", "Fuel Oil"],
  correct: 0,
  explanation: "Gasoline is the lightest refined product in density."
},
{
  id: "rfp9",
  question: "Which test is used to measure cetane number?",
  choices: ["Ignition quality test", "Octane engine test", "Viscosity test", "Freezing point test"],
  correct: 0,
  explanation: "Cetane number measures diesel ignition quality."
},
{
  id: "rfp10",
  question: "Which products face seasonal specification adjustments?",
  choices: ["Diesel", "Gasoline", "Jet A1", "Fuel Oil"],
  correct: [0,1],
  explanation: "Diesel and gasoline specs vary winter/summer (volatility, cloud point)."
},
{
  id: "rfp11",
  question: "Which refined product requires smoke point testing?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: 1,
  explanation: "Jet A1 requires smoke point testing to assess combustion quality."
},
{
  id: "rfp12",
  question: "Which refined product has the strictest sulfur specification globally?",
  choices: ["Gasoline", "Diesel (ULSD)", "Jet A1", "Fuel Oil"],
  correct: 1,
  explanation: "Ultra Low Sulfur Diesel (ULSD) has the tightest sulfur limits."
},
{
  id: "rfp13",
  question: "Which products are traded in both paper and physical markets?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [0,1,2,3],
  explanation: "All refined products are traded via derivatives and physical cargoes."
},
{
  id: "rfp14",
  question: "Which product is most sensitive to vapor pressure specs?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 0,
  explanation: "Gasoline volatility (Reid Vapor Pressure) is strictly regulated."
},
{
  id: "rfp15",
  question: "Which refined products are classified as middle distillates?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: [0,1],
  explanation: "Diesel and jet are middle distillates; gasoline is light, fuel oil is heavy."
},
{
  id: "rfp16",
  question: "Which blending component is used to increase octane?",
  choices: ["MTBE", "Ethanol", "Toluene", "Sulfur"],
  correct: [0,1,2],
  explanation: "MTBE, ethanol, and aromatics boost octane rating."
},
{
  id: "rfp17",
  question: "Which specs are critical in jet fuel safety?",
  choices: ["Flash point", "Freezing point", "Smoke point", "Viscosity"],
  correct: [0,1,2],
  explanation: "Jet fuel is controlled by flash, freezing, and smoke point."
},
{
  id: "rfp18",
  question: "Which refined product is most used in petrochemical feedstock blending?",
  choices: ["Gasoline", "Naphtha", "Jet A1", "Diesel"],
  correct: 1,
  explanation: "Naphtha is widely used in steam cracking for petrochemicals."
},
{
  id: "rfp19",
  question: "Which specifications are controlled by ASTM standards?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [0,1,2,3],
  explanation: "All refined products have ASTM standards for specs."
},
{
  id: "rfp20",
  question: "Which refined product requires lubricity testing?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: 0,
  explanation: "Diesel lubricity is critical for engine performance."
},
{
  id: "rfp21",
  question: "Which products are subject to cloud point testing?",
  choices: ["Diesel", "Gasoline", "Jet A1", "Fuel Oil"],
  correct: [0,3],
  explanation: "Diesel and fuel oil cloud points affect cold flow properties."
},
{
  id: "rfp22",
  question: "Which spec impacts aviation safety the most?",
  choices: ["Freezing point", "Density", "Cetane number", "Viscosity"],
  correct: 0,
  explanation: "Jet A1 freezing point is critical for flight safety."
},
{
  id: "rfp23",
  question: "Which refined product typically trades against Brent benchmarks?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [1,2,3],
  explanation: "Diesel, jet, and fuel oil are often priced against Brent. Gasoline uses RBOB benchmarks."
},
{
  id: "rfp24",
  question: "Which quality specs must align between load and discharge ports?",
  choices: ["Density", "Sulfur content", "Flash point", "Octane number"],
  correct: [0,1,2,3],
  explanation: "All quality parameters must remain within spec during voyage."
},
{
  id: "rfp25",
  question: "Which refined product requires most stringent cleanliness of tanks?",
  choices: ["Diesel", "Gasoline", "Jet A1", "Fuel Oil"],
  correct: 2,
  explanation: "Jet A1 tanks must be extremely clean to avoid contamination."	
  },
  
  {
  id: "rfp26",
  question: "Which products require specific cold flow additives in winter?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: [0,1],
  explanation: "Diesel and jet fuel need cold flow additives to prevent gelling at low temperatures."
},
{
  id: "rfp27",
  question: "Which refined product has the highest volatility?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 0,
  explanation: "Gasoline is the lightest and most volatile refined product."
},
{
  id: "rfp28",
  question: "Which specifications are critical for marine diesel engines?",
  choices: ["Sulfur content", "Viscosity", "Cetane number", "Octane rating"],
  correct: [0,1,2],
  explanation: "Marine diesel requires control of sulfur, viscosity, and cetane for engine safety."
},
{
  id: "rfp29",
  question: "Which products are usually measured in metric tons for trading?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [1,2,3],
  explanation: "Middle and heavy distillates (diesel, jet, fuel oil) are traded in metric tons; gasoline often in barrels or tons."
},
{
  id: "rfp30",
  question: "Which refined products are affected by Reid Vapor Pressure regulations?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 0,
  explanation: "RVP controls gasoline volatility to manage evaporative emissions."
},
{
  id: "rfp31",
  question: "Which products have strict limitations on water content?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: [0,1,3],
  explanation: "Water in diesel, jet fuel, and fuel oil can damage engines; gasoline is less sensitive."
},
{
  id: "rfp32",
  question: "Which product is most sensitive to storage tank cleanliness?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 2,
  explanation: "Jet A1 must be stored in clean tanks to avoid contamination."
},
{
  id: "rfp33",
  question: "Which products are middle distillates?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [1,2],
  explanation: "Diesel and Jet A1 are middle distillates; gasoline is light, fuel oil is heavy."
},
{
  id: "rfp34",
  question: "Which properties are critical for aviation fuel safety?",
  choices: ["Freezing point", "Flash point", "Smoke point", "Octane number"],
  correct: [0,1,2],
  explanation: "Freezing, flash, and smoke points are crucial for Jet A1 performance."
},
{
  id: "rfp35",
  question: "Which refined product requires lubricity testing?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: 0,
  explanation: "Diesel requires lubricity testing for proper engine operation."
},
{
  id: "rfp36",
  question: "Which products are most affected by sulfur regulations?",
  choices: ["Diesel", "Gasoline", "Jet A1", "Fuel Oil"],
  correct: [0,2,3],
  explanation: "Diesel, jet, and fuel oil have strict sulfur limits; gasoline less so."
},
{
  id: "rfp37",
  question: "Which refined products are traded with flat price exposure?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [0,1,2,3],
  explanation: "All refined products can be traded on flat price or swaps markets."
},
{
  id: "rfp38",
  question: "Which products require viscosity checks for pumping safety?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: [0,1,3],
  explanation: "Diesel, jet fuel, and fuel oil must meet viscosity requirements for handling."
},
{
  id: "rfp39",
  question: "Which product is most affected by cold filter plugging point?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 1,
  explanation: "Diesel is sensitive to CFPP in cold climates."
},
{
  id: "rfp40",
  question: "Which products are classified as dirty products?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 3,
  explanation: "Fuel oil is considered a dirty product."
},
{
  id: "rfp41",
  question: "Which products are subject to ASTM D1655 standard?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: 1,
  explanation: "ASTM D1655 applies to aviation turbine fuels."
},
{
  id: "rfp42",
  question: "Which products require pour point testing?",
  choices: ["Diesel", "Jet A1", "Gasoline", "Fuel Oil"],
  correct: [0,1,3],
  explanation: "Pour point testing ensures safe handling in cold temperatures."
},
{
  id: "rfp43",
  question: "Which product is traded as RBOB in US markets?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 0,
  explanation: "RBOB (Reformulated Blendstock for Oxygenate Blending) is gasoline."
},
{
  id: "rfp44",
  question: "Which products are blended with ethanol or MTBE to improve performance?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: 0,
  explanation: "Gasoline can be blended with ethanol or MTBE for octane and emission improvements."
},
{
  id: "rfp45",
  question: "Which specifications affect marine fuel suitability?",
  choices: ["Viscosity", "Sulfur content", "Density", "Octane number"],
  correct: [0,1,2],
  explanation: "Marine fuels must meet viscosity, sulfur, and density requirements."
},
{
  id: "rfp46",
  question: "Which products have seasonal volatility adjustments?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [0,1],
  explanation: "Gasoline and diesel have summer/winter spec adjustments."
},
{
  id: "rfp47",
  question: "Which properties determine engine performance in diesel?",
  choices: ["Cetane number", "Sulfur content", "Viscosity", "Octane number"],
  correct: [0,1,2],
  explanation: "Cetane, sulfur, and viscosity directly impact diesel engine performance."
},
{
  id: "rfp48",
  question: "Which products are subject to flash point requirements for safety?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [1,2,3],
  explanation: "Diesel, jet, and fuel oil have minimum flash point safety regulations."
},
{
  id: "rfp49",
  question: "Which refined products require water content analysis before shipment?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [0,1,2,3],
  explanation: "All products need water content checks to prevent contamination or engine issues."
},
{
  id: "rfp50",
  question: "Which products are considered middle distillates and traded globally?",
  choices: ["Gasoline", "Diesel", "Jet A1", "Fuel Oil"],
  correct: [1,2],
  explanation: "Diesel and Jet A1 are middle distillates with global trade relevance."
}
  ]
},
  
  trading_market: { 
    title: "Trading & Market Fundamentals", 

questions: [
  {
    id: "lex1",
    question: "What does 'backwardation' mean in oil markets?",
    choices: [
      "Spot price is lower than future price",
      "Future and spot price are equal",
      "Spot price is higher than future price",
      "Refining margin is negative"
    ],
    correct: 2,
    explanation: "Backwardation means near-term prices are higher than longer-dated futures, usually due to tight prompt supply."
  },
  {
    id: "lex2",
    question: "What does 'contango' mean in crude trading?",
    choices: [
      "Spot prices are higher than future prices",
      "It describes price volatility",
      "It‚Äôs a refining margin term",
      "Future prices are higher than spot prices"
    ],
    correct: 3,
    explanation: "Contango occurs when futures prices are above spot, often reflecting storage costs and abundant supply."
  },
  {
    id: "lex3",
    question: "A 'hedge' in trading refers to:",
    choices: [
      "A shipping cost",
      "A transaction to reduce risk exposure",
      "Speculating for profit",
      "A physical barrier in terminals"
    ],
    correct: 1,
    explanation: "Hedging is entering positions to offset price risks (e.g., buying crude futures to lock supply costs)."
  },
  {
    id: "lex4",
    question: "What is a 'crack spread'?",
    choices: [
      "Spread between diesel and gasoline only",
      "Difference between Brent and WTI",
      "Shipping differential between two ports",
      "Difference between crude and refined product prices"
    ],
    correct: 3,
    explanation: "A crack spread measures refinery margin: crude input price vs. value of refined outputs."
  },
  {
    id: "lex5",
    question: "What is a 'calendar spread' in futures trading?",
    choices: [
      "Arbitrage between two refineries",
      "Difference between Brent and Dubai",
      "Price difference between contracts of different maturities",
      "Difference in shipping costs between two routes"
    ],
    correct: 2,
    explanation: "Calendar spreads compare futures prices of the same commodity with different delivery months."
  },
  {
    id: "lex6",
    question: "What is a 'forward contract'?",
    choices: [
      "Spot market deal",
      "OTC agreement to buy/sell at future date and price",
      "Physical freight charter",
      "Standardized exchange-traded contract"
    ],
    correct: 1,
    explanation: "Forwards are OTC bilateral contracts fixing future price and delivery, unlike standardized futures."
  },
  {
    id: "lex7",
    question: "What is a 'future contract'?",
    choices: [
      "A standardized, exchange-traded contract",
      "A refinery maintenance plan",
      "An OTC agreement",
      "A pipeline tariff"
    ],
    correct: 0,
    explanation: "Futures are standardized contracts traded on exchanges, with margining and liquidity."
  },
  {
    id: "lex8",
    question: "What is the 'prompt month' contract?",
    choices: [
      "An option premium",
      "A physical crude delivery",
      "The nearest active futures month",
      "The farthest dated contract"
    ],
    correct: 2,
    explanation: "The prompt month is the nearest active maturity, often the reference for benchmarks."
  },
  {
    id: "lex9",
    question: "What does 'rollover' mean in futures trading?",
    choices: [
      "A margin call",
      "Switching from one maturity to the next",
      "Transferring crude between ships",
      "Physical rollover of barrels in tanks"
    ],
    correct: 1,
    explanation: "Rolling futures means closing a near-month position and opening a longer-dated one."
  },
  {
    id: "lex10",
    question: "What is 'basis risk'?",
    choices: [
      "Storage cost risk",
      "Currency exchange risk",
      "Risk of ship delay",
      "Risk that futures and physical prices do not move perfectly together"
    ],
    correct: 3,
    explanation: "Basis risk occurs when hedge instruments don‚Äôt perfectly track the physical exposure."
  },
  {
    id: "lex11",
    question: "What is 'PRA pricing' in oil markets?",
    choices: [
      "Pipeline regulated access",
      "Physical refinery allocation",
      "Port risk assessment",
      "Price assessed by Price Reporting Agencies"
    ],
    correct: 3,
    explanation: "PRA (Platts, Argus, etc.) provides benchmark assessments widely used in physical contracts."
  },
  {
    id: "lex12",
    question: "What does 'flat price' mean?",
    choices: [
      "The outright market price of a commodity",
      "Derivative spread",
      "Adjusted netback value",
      "Price difference between two grades"
    ],
    correct: 0,
    explanation: "Flat price is the outright market price (e.g., Brent $85/bbl)."
  },
  {
    id: "lex13",
    question: "What is a 'spread trade'?",
    choices: [
      "Export license mechanism",
      "Simultaneous buying and selling of related instruments",
      "Transport of crude via pipeline",
      "Storage hedging strategy"
    ],
    correct: 1,
    explanation: "Spread trading involves opposite positions in correlated contracts (e.g., Brent-WTI)."
  },
  {
    id: "lex14",
    question: "What is a 'swap' in oil trading?",
    choices: [
      "Pipeline tariff adjustment",
      "Physical cargo exchange",
      "An option premium",
      "Exchange of cash flows to manage risk"
    ],
    correct: 3,
    explanation: "Swaps are OTC derivatives exchanging fixed vs. floating prices, often used for hedging."
  },
  {
    id: "lex15",
    question: "What is 'mark-to-market' in trading?",
    choices: [
      "Updating book value of contracts to current market price",
      "Ship chartering contract",
      "Pipeline throughput monitoring",
      "Physical inventory valuation"
    ],
    correct: 0,
    explanation: "Mark-to-market adjusts the value of open positions to reflect daily prices."
  },
  {
    id: "lex16",
    question: "What is an 'ICE Brent contract'?",
    choices: [
      "An exchange-traded futures contract for Brent",
      "A swap agreement",
      "A shipping derivative",
      "A physical cargo deal"
    ],
    correct: 0,
    explanation: "ICE Brent is the global benchmark crude futures contract."
  },
  {
    id: "lex17",
    question: "What is 'Dated Brent'?",
    choices: [
      "A refinery marker",
      "An OTC swap",
      "A physical crude benchmark for North Sea loading",
      "A futures contract"
    ],
    correct: 2,
    explanation: "Dated Brent is the physical crude benchmark assessed by PRAs, basis for global pricing."
  },
  {
    id: "lex18",
    question: "What does 'netback' mean in trading?",
    choices: [
      "Pipeline tariff",
      "Delivered price at destination minus costs",
      "Charter rate of a tanker",
      "Storage margin"
    ],
    correct: 1,
    explanation: "Netback = product sales revenue minus transport, duties, and costs, showing refinery economics."
  },
  {
    id: "lex19",
    question: "What is 'arbitrage' in oil markets?",
    choices: [
      "Blending of two fuels",
      "Storage optimization",
      "Buying and selling simultaneously to capture price differentials",
      "Risk hedging"
    ],
    correct: 2,
    explanation: "Arbitrage exploits regional or product price differences, e.g. US Gulf vs. Europe."
  },
  {
    id: "lex20",
    question: "What is a 'time charter equivalent' (TCE)?",
    choices: [
      "Pipeline fee",
      "Storage rent",
      "Derivative swap",
      "Daily revenue measure for ships"
    ],
    correct: 3,
    explanation: "TCE is a normalized measure of daily ship earnings after voyage costs."
  },
  {
    id: "lex21",
    question: "What is a 'clean product tanker'?",
    choices: [
      "Ship designed for refined products (diesel, gasoline, jet)",
      "Ship carrying crude oil",
      "Tanker used for chemicals",
      "An LNG vessel"
    ],
    correct: 0,
    explanation: "Clean tankers carry refined petroleum products like diesel and gasoline."
  },
  {
    id: "lex22",
    question: "What does 'dirty tanker' refer to?",
    choices: [
      "Carrying crude or heavy fuel oil",
      "Tanker without cleaning",
      "Ballasted ship",
      "Old vessel"
    ],
    correct: 0,
    explanation: "Dirty tankers transport crude or residual fuels, as opposed to clean products."
  },
  {
    id: "lex23",
    question: "What is a 'demurrage' cost?",
    choices: [
      "Penalty for delayed loading/discharge beyond laytime",
      "Tanker fuel cost",
      "Pipeline fee",
      "Insurance premium"
    ],
    correct: 0,
    explanation: "Demurrage is charged when a vessel is delayed at port beyond agreed time."
  },
  {
    id: "lex24",
    question: "What is 'laycan' in shipping?",
    choices: [
      "Pipeline capacity",
      "Refinery shutdown plan",
      "Laydays and cancelling date for vessel arrival",
      "Trading option window"
    ],
    correct: 2,
    explanation: "Laycan defines the period during which a ship must present for loading."
  },
  {
    id: "lex25",
    question: "What is a 'VLCC'?",
    choices: [
      "Pipeline code",
      "Refinery unit",
      "Very Large Crude Carrier tanker",
      "Futures contract type"
    ],
    correct: 2,
    explanation: "VLCCs are massive crude tankers, typically carrying 2 million barrels."
  },
  {
    id: "lex26",
    question: "What is 'HSFO' in trading?",
    choices: [
      "High Sulfur Fuel Oil",
      "Heat Stable Fuel Output",
      "Hydrotreated Straight Fuel Oil",
      "Heavy Shipping Fuel Option"
    ],
    correct: 0,
    explanation: "HSFO is high sulfur fuel oil, used mainly for shipping pre-IMO 2020."
  },
  {
    id: "lex27",
    question: "What is 'ULSD'?",
    choices: [
      "Underground Line Storage Diesel",
      "Ultra-Low Sulfur Diesel",
      "Unleaded Super Diesel",
      "Utility Line Supply Diesel"
    ],
    correct: 1,
    explanation: "ULSD is a diesel grade with <15 ppm sulfur, the standard in US and Europe."
  },
  {
    id: "lex28",
    question: "What is 'IMO 2020'?",
    choices: [
      "Trading benchmark",
      "A new oil futures contract",
      "Refining technology",
      "Global sulfur cap regulation for shipping"
    ],
    correct: 3,
    explanation: "IMO 2020 reduced marine fuel sulfur limit to 0.5%, reshaping bunker and fuel markets."
  },
  {
    id: "lex29",
    question: "What is 'physical arbitrage'?",
    choices: [
      "Option premium strategy",
      "Storage optimization only",
      "Moving physical barrels to capture price differentials",
      "Derivative-only trading"
    ],
    correct: 2,
    explanation: "Physical arbitrage exploits geographical spreads by shipping oil between regions."
  },
  {
    id: "lex30",
    question: "What is a 'straddle option'?",
    choices: [
      "Blending option",
      "Options strategy buying call and put at same strike",
      "Shipping contract",
      "Pipeline swing contract"
    ],
    correct: 1,
    explanation: "Straddles profit from volatility, buying both call and put on the same strike/expiry."
  },
  {
    id: "lex31",
    question: "What is an 'option premium'?",
    choices: [
      "Freight cost",
      "Pipeline tariff",
      "The upfront cost paid to buy an option",
      "Storage fee"
    ],
    correct: 2,
    explanation: "The premium is the price paid for the right (not obligation) to buy/sell at a strike price."
  },
  {
    id: "lex32",
    question: "What is a 'long position'?",
    choices: [
      "A delayed cargo",
      "A wide crack spread",
      "Betting on falling prices",
      "Owning or being exposed to rising prices"
    ],
    correct: 3,
    explanation: "Being long means benefiting if prices increase (buy low, sell high)."
  },
  {
    id: "lex33",
    question: "What is a 'short position'?",
    choices: [
      "A forward hedge",
      "Pipeline bottleneck",
      "Owning physical barrels",
      "Betting on price decreases"
    ],
    correct: 3,
    explanation: "Short positions profit when prices decline (sell high, buy back lower)."
  },
  {
    id: "lex34",
    question: "What is 'margin call' in trading?",
    choices: [
      "Demurrage penalty",
      "Option expiration",
      "Pipeline delivery slot",
      "Request to post more collateral on losing positions"
    ],
    correct: 3,
    explanation: "Margin calls are requests from exchanges to top up funds when positions lose value."
  },
  {
    id: "lex35",
    question: "What is an 'ICE gasoil contract'?",
    choices: [
      "Pipeline allocation",
      "Physical diesel cargo",
      "European benchmark futures for diesel",
      "A swap agreement"
    ],
    correct: 2,
    explanation: "ICE gasoil is the main futures benchmark for European diesel/gasoil."
  },
  {
    id: "lex36",
    question: "What does 'outright' mean in trading?",
    choices: [
      "Flat price position without spreads",
      "Option premium",
      "Physical swap",
      "Blended barrel"
    ],
    correct: 0,
    explanation: "An outright is a single flat price exposure, not a spread or hedge."
  },
  {
    id: "lex37",
    question: "What is a 'barrel equivalent' (boe)?",
    choices: [
      "A tanker capacity",
      "Storage limit",
      "Refining output",
      "Energy equivalent measure for gas/oil"
    ],
    correct: 3,
    explanation: "BOE converts other energy units (gas, LNG) into crude oil equivalents."
  },
  {
    id: "lex38",
    question: "What is 'EFP' (Exchange for Physical)?",
    choices: [
      "Mechanism to swap futures for a physical cargo",
      "Freight premium",
      "Pipeline entry fee",
      "Energy finance protocol"
    ],
    correct: 0,
    explanation: "EFP allows counterparties to convert futures into a physical position."
  },
  {
    id: "lex39",
    question: "What is 'floating price contract'?",
    choices: [
      "Spot-only deal",
      "A fixed price forward",
      "Price linked to a benchmark index (Platts, Brent)",
      "Option derivative"
    ],
    correct: 2,
    explanation: "Floating price contracts are indexed to benchmarks, adjusted with differentials."
  },
  {
    id: "lex40",
    question: "What does 'differential' mean in trading?",
    choices: [
      "Pipeline fee",
      "Freight premium",
      "Currency hedge",
      "Adjustment vs. a benchmark to reflect quality or location"
    ],
    correct: 3,
    explanation: "Differentials adjust contracts vs. a benchmark to reflect crude/product quality or geography."
  },
  {
    id: "lex41",
    question: "What is 'WTI Midland'?",
    choices: [
      "A futures contract",
      "A refining process",
      "A tanker route",
      "A US crude grade from Permian Basin"
    ],
    correct: 3,
    explanation: "WTI Midland is a key Permian crude stream, priced against WTI benchmarks."
  },
  {
    id: "lex42",
    question: "What does 'ICE Clear' provide?",
    choices: [
      "Shipping routes",
      "Clearing and settlement for futures",
      "Refinery scheduling",
      "Pipeline operations"
    ],
    correct: 1,
    explanation: "ICE Clear provides risk management, margining, and settlement for exchange trades."
  },
  {
    id: "lex43",
    question: "What is 'position limit'?",
    choices: [
      "Maximum size of a position regulated by exchange",
      "Pipeline storage max",
      "Refinery output cap",
      "Cargo volume limit"
    ],
    correct: 0,
    explanation: "Position limits are regulatory caps on open positions to prevent market manipulation."
  },
  {
    id: "lex44",
    question: "What is 'volatility' in trading?",
    choices: [
      "Storage capacity",
      "Freight speed",
      "Pipeline flow rate",
      "Degree of price fluctuation over time"
    ],
    correct: 3,
    explanation: "Volatility measures how much and how fast prices change, key for risk and options pricing."
  },
  {
    id: "lex45",
    question: "What is a 'swaption'?",
    choices: [
      "Swap between two crudes",
      "Storage contract",
      "An option granting the right to enter a swap",
      "Shipping option"
    ],
    correct: 2,
    explanation: "A swaption gives the right, not obligation, to enter into a swap at a future date."
  },
  {
    id: "lex46",
    question: "What is 'backwardation' used for in trading strategy?",
    choices: [
      "Locking in low future prices",
      "Speculating on price declines",
      "Taking advantage of higher spot prices for immediate sales",
      "Avoiding storage costs"
    ],
    correct: 2,
    explanation: "Traders can sell prompt crude at higher prices than futures in backwardation."
  },
    {
      id: "lex47",
      question: "What is 'contango' used for in trading strategy?",
      choices: [
        "Immediate sale advantage",
        "Storage and carry trades",
        "Hedging refining margins",
        "Reducing shipping risk"
      ],
      correct: 1,
      explanation: "Contango enables storage-based strategies, buying spot and selling futures."
    },
    {
      id: "lex48",
      question: "What is a 'calendar spread' used for?",
      choices: [
        "Arbitrage between ports",
        "Trading difference between nearby and deferred futures",
        "Refining margin calculation",
        "Physical cargo hedging"
      ],
      correct: 1,
      explanation: "Calendar spreads exploit price differences between futures of different maturities."
    },
    {
      id: "lex49",
      question: "What is 'TCE' mainly used for?",
      choices: [
        "Option pricing",
        "Ship revenue comparison",
        "Storage optimization",
        "Futures margin calculation"
      ],
      correct: 1,
      explanation: "TCE normalizes vessel earnings across voyages for operational and financial comparison."
    },
    {
      id: "lex50",
      question: "What is 'netback' used for in trading?",
      choices: [
        "Calculating refinery profitability",
        "Determining shipping charter rates",
        "Setting storage fees",
        "Evaluating option premiums"
      ],
      correct: 0,
      explanation: "Netback measures revenue minus costs, key for assessing refinery economics."
    },
  ]
},
  pricing_contracts: { 
    title: "Pricing & Contracts", 
    questions: [
    {
      id: "pc1",
      question: "Your company has a Gasoil term contract: monthly lifting of 700 kb CIF NWE, priced at ICE Gasoil M-1 average + $10/MT. On the 20th of the month, you reduce your lifting to 670 kb. What is the impact on your flat price exposure?",
      choices: [
        "You remain fully hedged with no impact",
        "You are left long 30 kb of futures exposure",
        "You are short 30 kb of futures exposure",
        "No impact since final nomination has no link to futures"
      ],
      correct: 1,
      explanation: "If you pre-hedged 700 kb on ICE Gasoil but reduce to 670 kb physical, you are left long 30 kb paper exposure."
    },
    {
      id: "pc2",
      question: "In a Jet Fuel contract under GTCs, a Force Majeure clause is invoked by the seller due to refinery outage. What is the buyer entitled to?",
      choices: [
        "Automatic compensation for lost barrels",
        "Release from the obligation to lift volumes during the FM period",
        "Ability to source elsewhere and claim damages",
        "The seller must deliver replacement cargoes from third parties"
      ],
      correct: 1,
      explanation: "Force majeure releases both parties from their obligations during the FM event; seller is not forced to supply replacement barrels."
    },
    {
      id: "pc3",
      question: "A Crude contract is priced as 'Brent Dated average M-1' + premium. On the 15th of the month you roll your cargo to M (current month). What is your exposure?",
      choices: [
        "You are exposed to a flat price move",
        "You are exposed to a time spread move between M and M-1",
        "You are hedged with no exposure",
        "You are exposed to FX risk only"
      ],
      correct: 1,
      explanation: "Rolling from M-1 to M changes your indexation and exposes you to the M vs M-1 time spread."
    },
    {
      id: "pc4",
      question: "In Fuel Oil contracts, disputes over Quality are usually resolved based on:",
      choices: [
        "Surveyor appointed at discharge port",
        "Lab analysis at seller‚Äôs refinery",
        "Independent inspector‚Äôs certificate at load port",
        "Average of buyer and seller results"
      ],
      correct: 2,
      explanation: "Standard GTCs often state 'Q final at load port as per independent inspector certificate'."
    },
    {
      id: "pc5",
      question: "A Biofuel buyer refuses cargo citing 'off-spec viscosity'. Under GTC, Quality is final load port as per inspector certificate. What is the likely outcome?",
      choices: [
        "Buyer can reject and claim damages",
        "Buyer must accept cargo and cannot reject",
        "Seller must offer replacement barrels",
        "Dispute goes automatically to arbitration"
      ],
      correct: 1,
      explanation: "If Q final load port and inspector certified on-spec, buyer cannot reject cargo."
    },
    {
      id: "pc6",
      question: "You have a Jet CIF contract indexed to Platts Jet CIF NWE M-1. You sell cargo on FOB basis instead. What is your new risk?",
      choices: [
        "Freight exposure",
        "Quality differential exposure",
        "Currency risk only",
        "No risk if hedged with futures"
      ],
      correct: 0,
      explanation: "Switching from CIF to FOB introduces freight exposure since buyer now arranges transport."
    },
    {
      id: "pc7",
      question: "A Gasoil contract specifies '30 days credit after B/L date'. What risk does the seller carry?",
      choices: [
        "Price risk",
        "Credit / counterparty risk",
        "Operational risk",
        "No risk, buyer is always solvent"
      ],
      correct: 1,
      explanation: "Seller carries counterparty credit risk until payment is received."
    },
    {
      id: "pc8",
      question: "In a Crude sale, the Charter Party freight increases unexpectedly. Who bears the cost under CIF contract?",
      choices: [
        "Buyer",
        "Seller",
        "Shared equally",
        "Shipping company"
      ],
      correct: 1,
      explanation: "Under CIF, seller arranges and pays for freight."
    },
    {
      id: "pc9",
      question: "Fuel Oil term contract: 100 kb monthly lifting, priced vs Singapore 380 CST average. You lift only 80 kb. What happens to the remaining 20 kb?",
      choices: [
        "Automatically carried to next month",
        "Buyer can lift later without penalty",
        "You are in default under GTCs",
        "No consequence since volumes are 'approximate'"
      ],
      correct: 2,
      explanation: "Failing to lift contracted quantity is a default unless otherwise agreed."
    },
    {
      id: "pc10",
      question: "A Gasoil cargo is priced vs ICE Gasoil futures. If your hedges are in Brent futures, what mismatch do you face?",
      choices: [
        "No mismatch, both are correlated",
        "Basis risk between Brent and Gasoil",
        "FX risk only",
        "Freight risk"
      ],
      correct: 1,
      explanation: "Using Brent to hedge Gasoil creates basis risk (Brent vs ICE Gasoil)."
    },
    {
      id: "pc11",
      question: "A crude buyer disputes volume shortage at discharge. Which document governs final Quantity?",
      choices: [
        "Charter Party",
        "Surveyor‚Äôs outturn certificate",
        "Bill of Lading",
        "Commercial Invoice"
      ],
      correct: 1,
      explanation: "Quantity is usually final at discharge as per independent surveyor‚Äôs certificate."
    },
    {
      id: "pc12",
      question: "In a Jet sale contract, laytime/demurrage terms are usually referenced from:",
      choices: [
        "Charter Party",
        "General Terms & Conditions",
        "Bill of Lading",
        "Survey Report"
      ],
      correct: 0,
      explanation: "Demurrage is based on Charter Party terms agreed between shipowner and charterer."
    },
    {
      id: "pc13",
      question: "A Gasoil buyer fails to open LC by deadline. Under GTC, what can the seller do?",
      choices: [
        "Cancel the contract",
        "Deliver without payment",
        "Wait indefinitely",
        "Force buyer into arbitration"
      ],
      correct: 0,
      explanation: "Failure to provide LC is a breach allowing seller to cancel."
    },
    {
      id: "pc14",
      question: "In a Crude sale, if buyer nominates a vessel that does not meet terminal restrictions, what happens?",
      choices: [
        "Seller must accept vessel anyway",
        "Buyer must re-nominate compliant vessel",
        "Cargo is cancelled automatically",
        "Seller pays extra costs"
      ],
      correct: 1,
      explanation: "Buyer must nominate a vessel acceptable to terminal; otherwise re-nomination is required."
    },
    {
      id: "pc15",
      question: "A Biofuel contract references RED II compliance. What does this mean?",
      choices: [
        "Product meets EU sustainability criteria",
        "Cargo exempt from duties",
        "Buyer cannot reject",
        "Blend obligation waived"
      ],
      correct: 0,
      explanation: "RED II compliance ensures product meets EU renewable sustainability requirements."
    },
    {
      id: "pc16",
      question: "A Gasoil sale 'subject to LC opening'. Buyer requests delivery before LC issued. Should seller accept?",
      choices: [
        "Yes, under GTC it is safe",
        "Yes, but only with discount",
        "No, as credit risk is not covered",
        "Yes, since cargo is already on water"
      ],
      correct: 2,
      explanation: "Seller should not deliver before LC opening; otherwise exposed to non-payment."
    },
    {
      id: "pc17",
      question: "In a Crude DES contract, who bears risk of vessel delay at discharge?",
      choices: [
        "Buyer",
        "Seller",
        "Shared equally",
        "Port Authority"
      ],
      correct: 1,
      explanation: "In DES (Delivered Ex Ship), seller bears risk until cargo is delivered at discharge port."
    },
    {
      id: "pc18",
      question: "A Jet cargo indexed to Platts Jet CIF NWE M-1 is priced using which period?",
      choices: [
        "Current month (M)",
        "Previous month (M-1)",
        "Next month (M+1)",
        "Averaged 3 months"
      ],
      correct: 1,
      explanation: "M-1 means pricing is based on the previous month‚Äôs average."
    },
    {
      id: "pc19",
      question: "Fuel Oil GTC dispute clauses usually refer to:",
      choices: [
        "ICC Arbitration",
        "English High Court",
        "Local chamber of commerce",
        "Singapore Court"
      ],
      correct: 0,
      explanation: "Standard GTCs refer disputes to ICC Arbitration under English law."
    },
    {
      id: "pc20",
      question: "A Crude cargo under FOB sale suffers delay due to late vessel arrival. Who pays demurrage?",
      choices: [
        "Buyer",
        "Seller",
        "Shared equally",
        "Shipowner"
      ],
      correct: 0,
      explanation: "In FOB, buyer nominates vessel and pays demurrage if vessel delays."
    },
    {
      id: "pc21",
      question: "A Gasoil cargo is rejected by buyer for being off-spec density. Inspector certificate load port shows on-spec. Who is right?",
      choices: [
        "Buyer",
        "Seller",
        "Inspector",
        "Depends on arbitration"
      ],
      correct: 1,
      explanation: "Under GTC, quality final load port inspector governs. Buyer must accept cargo."
    },
    {
      id: "pc22",
      question: "Biofuel cargo priced vs Argus FOB ARA. Buyer wants CIF basis. What changes?",
      choices: [
        "Freight cost added",
        "FX risk shifts",
        "No change",
        "Quality terms change"
      ],
      correct: 0,
      explanation: "Switch from FOB to CIF adds freight and insurance responsibility."
    },
    {
      id: "pc23",
      question: "In Jet contracts, what is the impact if you hedge physical sales with ICE Gasoil futures?",
      choices: [
        "Perfect hedge",
        "Basis risk Jet vs Gasoil",
        "FX risk only",
        "Freight risk"
      ],
      correct: 1,
      explanation: "Jet CIF NWE vs ICE Gasoil introduces basis risk."
    },
    {
      id: "pc24",
      question: "A Crude cargo price is 'Brent Dated + $1/bbl'. Market moves +$2/bbl. What is seller‚Äôs exposure?",
      choices: [
        "Seller gains $2/bbl",
        "Seller loses $2/bbl",
        "Seller unaffected, buyer exposed",
        "Both gain equally"
      ],
      correct: 1,
      explanation: "If not pre-hedged, seller loses $2/bbl since sale price was fixed at Brent +1."
    },
    {
      id: "pc25",
      question: "Fuel Oil cargo nominated late by buyer, vessel misses laycan. Who bears cost?",
      choices: [
        "Seller",
        "Buyer",
        "Shipowner",
        "Shared equally"
      ],
      correct: 1,
      explanation: "Late nomination is buyer‚Äôs fault; buyer bears consequences."
    },
	 {
      id: "pc26",
      question: "In a Gasoil term contract, which elements are usually critical in the General Terms & Conditions (GTC)?",
      choices: ["Quality determination method", "Quantity finality", "Dispute resolution clause", "Nomination deadlines"],
      correct: [0,1,2,3],
      explanation: "All four are fundamental: Q&Q determination, nomination rules, and dispute mechanisms define the backbone of GTC."
    },
    {
      id: "pc27",
      question: "In a Crude CIF contract, which risks remain for the seller after title transfer?",
      choices: ["Demurrage costs if vessel delayed at discharge", "Credit risk until payment received", "Exposure to flat price moves", "Freight volatility risk"],
      correct: [1,2],
      explanation: "Once title passes, freight/demurrage are buyer‚Äôs risk. Seller still carries counterparty (payment) risk and unhedged flat price exposure."
    },
    {
      id: "pc28",
      question: "Which circumstances usually qualify under Force Majeure in oil contracts?",
      choices: ["War", "Earthquake", "Buyer unwilling to pay", "Refinery shutdown due to fire"],
      correct: [0,1,3],
      explanation: "War, natural disasters, accidents like fire are FM. Simple unwillingness to pay is not."
    },
    {
      id: "pc29",
      question: "You buy a Jet cargo CIF NWE, indexed to M-1 average. To hedge, which instruments could you use?",
      choices: ["ICE Gasoil futures", "Platts Jet swaps", "Brent futures", "Currency forwards"],
      correct: [0,1,3],
      explanation: "ICE Gasoil and Jet swaps are natural hedges. Currency forwards protect FX exposure."
    },
    {
      id: "pc30",
      question: "A Fuel Oil sale is disputed on quantity at discharge. Which documents are relevant to resolve the case?",
      choices: ["Bill of Lading", "Surveyor outturn certificate", "Charter Party", "Statement of Facts"],
      correct: [0,1,3],
      explanation: "Quantity disputes are resolved with B/L, independent survey certificates, and supporting operational records (SOF)."
    },
    {
      id: "pc31",
      question: "Which risks exist when hedging Crude purchases priced vs Brent Dated with ICE Brent futures?",
      choices: ["Time spread risk", "Basis risk", "FX risk", "Freight risk"],
      correct: [0,1,2],
      explanation: "ICE Brent futures hedge flat Brent, not Dated, leaving basis/time spread risk. FX exposure exists if priced in USD but revenues in another currency."
    },
    {
      id: "pc32",
      question: "In a Biofuel contract, which sustainability documents may be required by buyer?",
      choices: ["ISCC certificate", "RED II compliance proof", "Cargo Manifest", "Certificate of Analysis"],
      correct: [0,1],
      explanation: "ISCC and RED II compliance are critical for biofuels. Manifest/CoA are standard docs but not sustainability proof."
    },
    {
      id: "pc33",
      question: "A Gasoil FOB contract specifies 'NOR to be tendered at load port by 12:00 LT'. What happens if vessel tenders NOR late?",
      choices: ["Laytime starts later", "Demurrage claims may be reduced", "Buyer is still fully liable", "NOR may be invalid"],
      correct: [0,1,3],
      explanation: "Late NOR impacts laytime calculation and can be considered invalid, reducing seller‚Äôs demurrage claims."
    },
    {
      id: "pc34",
      question: "Which elements drive the final flat price in crude term contracts?",
      choices: ["Index (Brent/WTI/Urals)", "Differential agreed", "Month of pricing (M, M-1)", "Freight component"],
      correct: [0,1,2,3],
      explanation: "Flat price = Index + Differential, adjusted by pricing period and freight under CIF contracts."
    },
    {
      id: "pc35",
      question: "In Jet sales, what risks exist if you hedge with Gasoil futures instead of Jet swaps?",
      choices: ["Basis risk", "Liquidity risk", "Currency risk", "Operational risk"],
      correct: [0,1],
      explanation: "Basis risk Jet vs Gasoil, and Jet swaps being less liquid create liquidity concerns."
    },
    {
      id: "pc36",
      question: "In GTC, which situations typically allow termination of the contract?",
      choices: ["Buyer fails to open LC", "Force majeure persists beyond X days", "Dispute over survey results", "Payment default"],
      correct: [0,1,3],
      explanation: "Termination rights include LC not opened, long FM, or payment default. Disputes over survey are resolved differently, not termination."
    },
    {
      id: "pc37",
      question: "A crude term contract mentions 'quality as per API gravity and sulphur'. Which additional elements might be disputed?",
      choices: ["Pour point", "Asphaltenes content", "Water & sediment", "Viscosity"],
      correct: [0,2,3],
      explanation: "API and sulphur are standard, but pour point/asphaltenes/water are often critical in disputes."
    },
    {
      id: "pc38",
      question: "In a CIF contract, what costs must the seller cover?",
      choices: ["Freight", "Insurance", "Inspection fees load port", "Demurrage at discharge"],
      correct: [0,1,2],
      explanation: "Seller pays freight, insurance, and load port inspection. Discharge demurrage is buyer‚Äôs responsibility."
    },
    {
      id: "pc39",
      question: "If a buyer reduces nomination after the hedge is placed, what risks arise?",
      choices: ["Over-hedged position", "Flat price exposure", "FX risk", "Freight mismatch"],
      correct: [0,1],
      explanation: "Seller is left over-hedged and thus exposed to flat price changes."
    },
    {
      id: "pc40",
      question: "Fuel Oil disputes on quality can involve which methods of resolution?",
      choices: ["Joint lab analysis", "Arbitration under GTC", "Seller‚Äôs refinery certificate final", "Independent umpire lab"],
      correct: [0,1,3],
      explanation: "Disputes often use joint testing or an umpire lab; arbitration if unresolved."
    },
    {
      id: "pc41",
      question: "Which clauses are most negotiated in long-term Crude contracts?",
      choices: ["Destination restrictions", "Quality tolerance", "Pricing mechanism", "Letter of Credit terms"],
      correct: [0,1,2,3],
      explanation: "All of these are critical in term crude sales."
    },
    {
      id: "pc42",
      question: "A Jet FOB sale is priced vs Platts Jet CIF NWE. What risks emerge?",
      choices: ["Freight exposure", "Basis risk", "Time spread risk", "Currency mismatch"],
      correct: [0,1],
      explanation: "FOB vs CIF index introduces freight and potential basis risk."
    },
    {
      id: "pc43",
      question: "Which scenarios create exposure when hedging Biofuel with Gasoil futures?",
      choices: ["Basis risk biofuel vs gasoil", "Sustainability premium mismatch", "FX risk if priced in EUR", "No risk, correlation is perfect"],
      correct: [0,1,2],
      explanation: "Biofuels have unique pricing dynamics; Gasoil futures only partly hedge."
    },
    {
      id: "pc44",
      question: "In a Crude CIF contract, title transfer usually occurs at which moment?",
      choices: ["B/L issuance", "Discharge completion", "After customs clearance", "Upon NOR tendering"],
      correct: [0,1],
      explanation: "Title transfer is often at B/L, but in some contracts at discharge. Always check GTC."
    },
    {
      id: "pc45",
      question: "In a Gasoil sale, which tools can mitigate counterparty risk?",
      choices: ["Letter of Credit", "Parent company guarantee", "Cash in advance", "Performance bond"],
      correct: [0,1,2,3],
      explanation: "All of these instruments reduce counterparty credit risk exposure."
    },
    {
      id: "pc46",
      question: "When pricing Crude DES, which elements affect netback calculation?",
      choices: ["FOB price", "Freight", "Insurance", "Port costs"],
      correct: [0,1,2,3],
      explanation: "DES price includes FOB + Freight + Insurance + Port costs."
    },
    {
      id: "pc47",
      question: "Buyer claims cargo delay due to seller‚Äôs late nomination. Which consequences may apply?",
      choices: ["Demurrage at load port", "Cancellation rights for buyer", "Claim for market loss", "Change of laycan"],
      correct: [0,1,2],
      explanation: "Late nomination may cause demurrage, allow cancellation, and claims for losses."
    },
    {
      id: "pc48",
      question: "In Fuel Oil swaps used for hedging, which risks remain uncovered?",
      choices: ["Quality differential", "Operational risk", "Credit risk of counterparty", "Time spread volatility"],
      correct: [0,2,3],
      explanation: "Swaps hedge flat price but not operational/quality/credit/time spread risks."
    },
    {
      id: "pc49",
      question: "In Biofuel contracts, which clauses are often unique compared to fossil fuels?",
      choices: ["Sustainability certification", "Blend obligation", "CO2 emission accounting", "RED II compliance"],
      correct: [0,1,3],
      explanation: "Biofuels require sustainability proofs, blend mandates, and RED II compliance."
    },
    {
      id: "pc50",
      question: "In a crude long-term SPA, which events may trigger renegotiation?",
      choices: ["Tax regime change", "Pipeline disruption", "Regulatory change (sanctions)", "Price volatility > 10%"],
      correct: [0,1,2],
      explanation: "Renegotiations may be triggered by structural/regulatory changes; simple volatility is not usually a trigger."
	   }
  ]
},
logistics_shipping: { 
  title: "Logistics & Shipping Operations", 
  questions: [
    { id: "log1", question: "You buy crude FOB and sell CIF. At which point does the title of the cargo usually transfer?",
      choices: [
        "When the vessel passes the ship rail at the loadport",
        "When the vessel arrives at discharge port",
        "When the cargo is discharged into shore tanks",
        "When the Bill of Lading is issued"
      ],
      correct: [0,3],
      explanation: "FOB transfers title/loadport once the product passes ship‚Äôs rail. However, many contracts also link title to the Bill of Lading date."
    },
    { id: "log2", question: "You sold cargo DAP Rotterdam but the receiver changes the discharge port to Antwerp. What are the operational impacts?",
      choices: [
        "Additional port costs must be renegotiated",
        "Vessel deviation time may be for seller‚Äôs account",
        "The Incoterm allows the buyer to freely change port without discussion",
        "Demurrage calculations may change"
      ],
      correct: [0,1,3],
      explanation: "Changing discharge port affects port costs, voyage time and demurrage. Buyer cannot change port freely without agreement."
    },
    { id: "log3", question: "Which items are critical to check on a Bill of Lading (B/L)?",
      choices: [
        "Correct cargo description and quantity",
        "Loadport and discharge port",
        "Date of issue",
        "Correct freight rate",
        "Shipper, consignee and notify parties"
      ],
      correct: [0,1,2,4],
      explanation: "Cargo, ports, date and parties must be correct. Freight rate belongs to the charter party, not B/L."
    },
    { id: "log4", question: "Why is crude oil washing (COW) performed on tankers?",
      choices: [
        "To reduce clingage losses",
        "To comply with MARPOL regulations",
        "To clean tanks for next cargo",
        "To speed up discharge pumping"
      ],
      correct: [0,1,2],
      explanation: "COW reduces losses, ensures regulatory compliance, and prepares tanks for next cargo."
    },
    { id: "log5", question: "What risks occur when nominating a vessel late to a counterparty?",
      choices: [
        "Receiver may reject the vessel",
        "Demurrage will automatically be zero",
        "Charter party clauses may be breached",
        "Operational delays at the terminal"
      ],
      correct: [0,2,3],
      explanation: "Late nominations risk rejection, contract breach and delays. Demurrage is unrelated."
    },
    { id: "log6", question: "In a CIF sale, who is responsible for arranging insurance?",
      choices: ["Buyer", "Seller", "Port Authority", "Charterer"],
      correct: [1],
      explanation: "Seller must provide insurance under CIF Incoterm."
    },
    { id: "log7", question: "Which factors affect demurrage exposure?",
      choices: [
        "Port congestion",
        "Weather delays",
        "Incorrect laytime calculation",
        "Freight rate movements"
      ],
      correct: [0,1,2],
      explanation: "Demurrage depends on time spent in port and laytime clauses. Freight rate does not affect it."
    },
    { id: "log8", question: "When issuing a Letter of Indemnity (LOI) for delivery without B/L, what are key risks?",
      choices: [
        "Buyer may not pay cargo",
        "Double claim on cargo title",
        "Loss of P&I coverage",
        "Higher freight rate"
      ],
      correct: [0,1,2],
      explanation: "LOIs expose to risk of non-payment, double title claim, and loss of insurance protection."
    },
    { id: "log9", question: "You are discharging a cargo with high pour point in winter. What operational issues matter?",
      choices: [
        "Need for heating coils during voyage",
        "Slower pumping rates at discharge",
        "Risk of solidification in lines",
        "Impact on octane number"
      ],
      correct: [0,1,2],
      explanation: "Heating is required to maintain flow; otherwise pumping slows or solidifies."
    },
    { id: "log10", question: "What are the key documents required for crude oil cargo discharge?",
      choices: [
        "Bill of Lading",
        "Certificate of Quantity (CQ)",
        "Charter Party",
        "Certificate of Quality",
        "Letter of Credit"
      ],
      correct: [0,1,3],
      explanation: "B/L, CQ and Certificate of Quality are essential for title and customs. LC is for finance."
    },
    { id: "log11", question: "When does laytime typically start counting?",
      choices: [
        "Upon vessel arrival at anchorage",
        "Once Notice of Readiness (NOR) is tendered and accepted",
        "At the start of pumping",
        "When charter party is signed"
      ],
      correct: [1],
      explanation: "Laytime begins after NOR is tendered and accepted, subject to berth availability and CP terms."
    },
    { id: "log12", question: "Which Incoterm gives the seller maximum control of the transport chain?",
      choices: ["FOB", "CFR", "CIF", "DAP"],
      correct: [3],
      explanation: "DAP means seller organizes transport until delivery point. FOB transfers control at loadport."
    },
    { id: "log13", question: "Why is ullage measurement important during cargo loading?",
      choices: [
        "To calculate loaded volume",
        "To check vessel stability",
        "To set freight cost",
        "To confirm cargo heating"
      ],
      correct: [0,1],
      explanation: "Ullage helps confirm volume and stability of vessel. Freight cost is pre-agreed, not from ullage."
    },
    { id: "log14", question: "What are common causes of cargo contamination?",
      choices: [
        "Unclean tanks",
        "Line displacement issues",
        "Improper crude oil washing",
        "Incorrect bill of lading data"
      ],
      correct: [0,1,2],
      explanation: "Contamination usually results from tank cleanliness or line issues, not documentation errors."
    },
    { id: "log15", question: "What is the function of a cargo surveyor?",
      choices: [
        "Verify cargo quantity",
        "Check quality specifications",
        "Issue vessel certificates",
        "Monitor loading/discharge operations"
      ],
      correct: [0,1,3],
      explanation: "Surveyors independently verify quantity, quality and observe operations. They do not issue vessel certs."
    },
    { id: "log16", question: "In an FOB deal, who is responsible for freight?",
      choices: ["Buyer", "Seller", "Vessel master", "Port authority"],
      correct: [0],
      explanation: "Buyer arranges and pays for freight under FOB terms."
    },
    { id: "log17", question: "What are typical reasons for issuing a Letter of Protest (LOP)?",
      choices: [
        "Delays in operations",
        "Unsafe loading practices",
        "Incorrect laytime calculation",
        "Pipeline rupture"
      ],
      correct: [0,1,2],
      explanation: "LOPs are issued for delays, unsafe ops, or disputes over time counting."
    },
    { id: "log18", question: "Why might a receiver request a split Bill of Lading?",
      choices: [
        "To allow multiple consignees",
        "To adjust freight rate",
        "To manage financing with different banks",
        "To accelerate vessel turnaround"
      ],
      correct: [0,2],
      explanation: "Split B/Ls are used for multiple buyers/financing arrangements."
    },
    { id: "log19", question: "What are the impacts of weather delays at loadport?",
      choices: [
        "Potential demurrage",
        "Cargo contamination",
        "Late delivery to buyer",
        "Increased freight rates"
      ],
      correct: [0,2],
      explanation: "Weather delays may trigger demurrage and cause late delivery, but not contamination."
    },
    { id: "log20", question: "What is the role of the Notice of Readiness (NOR)?",
      choices: [
        "Triggers laytime start",
        "Confirms vessel readiness for loading/discharge",
        "Acts as a customs clearance",
        "Serves as title document"
      ],
      correct: [0,1],
      explanation: "NOR indicates vessel readiness and triggers laytime. It has no customs or title role."
    },
    { id: "log21", question: "Why might a charterer prefer a time charter over a voyage charter?",
      choices: [
        "Flexibility in using vessel for multiple voyages",
        "Lower bunker risk exposure",
        "Fixed freight for one trip",
        "No responsibility for demurrage"
      ],
      correct: [0,1],
      explanation: "Time charters give flexibility and shift bunker risk to owner. Voyage charters fix freight per trip."
    },
    { id: "log22", question: "What are bunker adjustment factors in shipping?",
      choices: [
        "Charges linked to fuel cost changes",
        "Extra demurrage fees",
        "Terminal loading charges",
        "Insurance premium"
      ],
      correct: [0],
      explanation: "BAF are surcharges applied to adjust freight with bunker fuel prices."
    },
    { id: "log23", question: "What happens if a cargo is discharged against a wrong Bill of Lading?",
      choices: [
        "Risk of double claims on cargo",
        "Receiver may refuse payment",
        "Insurance coverage could be void",
        "Laytime resets"
      ],
      correct: [0,1,2],
      explanation: "Delivering without correct B/L risks double claim, non-payment, and loss of P&I cover."
    },
    { id: "log24", question: "Why is heating critical during voyage for some fuel oils?",
      choices: [
        "To maintain pumpable viscosity",
        "To meet sulfur specifications",
        "To avoid wax precipitation",
        "To reduce demurrage"
      ],
      correct: [0,2],
      explanation: "Heating avoids solidification and maintains flow. It has no effect on sulfur spec."
    },
    { id: "log25", question: "Which clause protects the owner from liability for strike delays?",
      choices: [
        "Force majeure",
        "Laytime exception clause",
        "Demurrage clause",
        "Safe berth warranty"
      ],
      correct: [1],
      explanation: "Laytime exception clauses often exclude counting strike delays."
    },
    { id: "log26", question: "What are typical risks with STS (Ship-to-Ship) transfer operations?",
      choices: [
        "Oil spillage",
        "Hull damage",
        "Documentation errors",
        "Cargo contamination"
      ],
      correct: [0,1,3],
      explanation: "STS risks include pollution, hull contact and contamination. Documentation errors are secondary."
    },
    { id: "log27", question: "Why is draft survey important?",
      choices: [
        "To calculate cargo weight via vessel displacement",
        "To measure cargo temperature",
        "To check trim and stability",
        "To calculate bunker consumption"
      ],
      correct: [0,2],
      explanation: "Draft surveys measure cargo loaded/discharged and check stability."
    },
    { id: "log28", question: "What are consequences of incorrect ullage report?",
      choices: [
        "Commercial disputes over quantity",
        "Loss of trust with counterparties",
        "Impact on demurrage",
        "Legal claims"
      ],
      correct: [0,1,3],
      explanation: "Wrong ullage can cause disputes, legal claims, and damage credibility. Demurrage is unaffected."
    },
    { id: "log29", question: "What are common reasons for cargo shortage claims?",
      choices: [
        "Evaporation losses",
        "Tank clingage",
        "Measurement errors",
        "Incorrect Incoterm"
      ],
      correct: [0,1,2],
      explanation: "Losses come from evaporation, clingage, and errors. Incoterms do not cause shortages."
    },
    { id: "log30", question: "What is a Letter of Credit‚Äôs role in oil trading?",
      choices: [
        "Guarantees payment to seller if documents comply",
        "Confirms vessel seaworthiness",
        "Covers demurrage costs",
        "Acts as title document"
      ],
      correct: [0],
      explanation: "LC secures payment but does not certify vessel or cover demurrage."
    },
    { id: "log31", question: "What are safe berth warranties in charter parties?",
      choices: [
        "Charterer guarantees berth is physically safe",
        "Seller guarantees port costs",
        "Buyer accepts laytime delays",
        "Owner guarantees vessel age"
      ],
      correct: [0],
      explanation: "Safe berth warranties put liability on charterers to nominate a safe port/berth."
    },
    { id: "log32", question: "Why is tank inspection before loading important?",
      choices: [
        "Ensures tanks are clean",
        "Prevents contamination",
        "Confirms pump functionality",
        "Verifies port charges"
      ],
      correct: [0,1,2],
      explanation: "Tank inspections avoid contamination and confirm readiness. Port charges are unrelated."
    },
    { id: "log33", question: "What is the role of a Notice of Protest (NOP)?",
      choices: [
        "Formally records disagreement",
        "Protects legal rights in disputes",
        "Acts as customs document",
        "Resets laytime"
      ],
      correct: [0,1],
      explanation: "NOP preserves charterers‚Äô/owners‚Äô rights in disputes. It is not a customs doc."
    },
    { id: "log34", question: "What can cause a vessel to be rejected at loadport?",
      choices: [
        "Failing vetting inspection",
        "Not meeting terminal restrictions",
        "Having expired certificates",
        "High freight rate"
      ],
      correct: [0,1,2],
      explanation: "Rejection is linked to safety, certificates, or terminal rules. Freight rate is irrelevant."
    },
    { id: "log35", question: "What are consequences of incorrect NOR tendering?",
      choices: [
        "Laytime disputes",
        "Loss of demurrage claim",
        "Faster port clearance",
        "Operational delays"
      ],
      correct: [0,1,3],
      explanation: "Incorrect NOR impacts demurrage rights and may cause disputes or delays."
    },
    { id: "log36", question: "Why might a cargo receiver insist on shore tank gauging?",
      choices: [
        "Independent verification of quantity",
        "Cross-check against ship figures",
        "To reduce demurrage",
        "Customs compliance"
      ],
      correct: [0,1,3],
      explanation: "Shore tank gauging provides independent verification and supports customs clearance."
    },
    { id: "log37", question: "What is the role of a cargo manifest?",
      choices: [
        "Lists all cargo loaded/discharged",
        "Used for customs clearance",
        "Acts as a freight contract",
        "Details vessel speed"
      ],
      correct: [0,1],
      explanation: "Cargo manifest is for customs and cargo listing, not freight contracts."
    },
    { id: "log38", question: "What are common reasons for high demurrage bills?",
      choices: [
        "Port congestion",
        "Receiver delays",
        "Incorrect NOR",
        "Short laytime allowance"
      ],
      correct: [0,1,2,3],
      explanation: "All listed factors can drive demurrage costs up."
    },
    { id: "log39", question: "Why is weather routing important in tanker operations?",
      choices: [
        "Avoids delays",
        "Minimizes fuel consumption",
        "Protects cargo integrity",
        "Increases port tariffs"
      ],
      correct: [0,1,2],
      explanation: "Routing reduces delays, saves fuel, and protects cargo. Port tariffs are unrelated."
    },
    { id: "log40", question: "What does 'free pratique' mean?",
      choices: [
        "Health clearance for vessel to enter port",
        "Permission to start loading",
        "Exemption from port costs",
        "Customs clearance"
      ],
      correct: [0],
      explanation: "Free pratique is health clearance allowing vessel entry."
    },
    { id: "log41", question: "Why is slops management important?",
      choices: [
        "Environmental compliance",
        "Port reception facility costs",
        "Tank space availability",
        "Laytime savings"
      ],
      correct: [0,1,2],
      explanation: "Slops handling avoids pollution, manages space, and adds costs. It doesn‚Äôt save laytime."
    },
    { id: "log42", question: "What happens if ship documents are not presented correctly under an LC?",
      choices: [
        "Bank may refuse payment",
        "Cargo title may be disputed",
        "Demurrage resets",
        "Seller faces cashflow risk"
      ],
      correct: [0,1,3],
      explanation: "Incorrect docs block payment and risk title disputes. Demurrage is unrelated."
    },
    { id: "log43", question: "Why is compatibility testing done before blending or commingling cargoes?",
      choices: [
        "Prevent asphaltene precipitation",
        "Avoid sludge formation",
        "Ensure contractual quality",
        "Reduce pumping time"
      ],
      correct: [0,1,2],
      explanation: "Compatibility testing prevents quality issues; it does not impact pumping time."
    },
    { id: "log44", question: "What is a 'deadfreight' claim?",
      choices: [
        "Owner‚Äôs claim for unused vessel space",
        "Demurrage for delays",
        "Extra bunker consumption",
        "Insurance premium increase"
      ],
      correct: [0],
      explanation: "Deadfreight compensates owners when charterers fail to provide full cargo."
    },
    { id: "log45", question: "What are typical bunker risks in shipping operations?",
      choices: [
        "Fuel contamination",
        "Price volatility",
        "Quantity shortage",
        "Option premium increase"
      ],
      correct: [0,1,2],
      explanation: "Bunker risks include contamination, shortages, and volatile prices."
    },
    { id: "log46", question: "What is the purpose of the Sea Protest document?",
      choices: [
        "Record weather damage during voyage",
        "Claim insurance protection",
        "Acknowledge port delays",
        "Reset laytime clock"
      ],
      correct: [0,1],
      explanation: "Sea Protest records voyage incidents for insurance and liability defense."
    },
    { id: "log47", question: "Why do charter parties include pumping warranties?",
      choices: [
        "Ensure efficient discharge",
        "Limit demurrage exposure",
        "Protect cargo temperature",
        "Guarantee freight rate"
      ],
      correct: [0,1],
      explanation: "Pumping warranties assure discharge efficiency and reduce demurrage exposure."
    },
    { id: "log48", question: "Which party typically issues the Certificate of Quantity?",
      choices: ["Independent surveyor", "Buyer", "Seller", "Vessel master"],
      correct: [0],
      explanation: "Independent surveyors issue CQ after measuring loaded/discharged quantities."
    },
    { id: "log49", question: "What are the risks of over-heating cargo during voyage?",
      choices: [
        "Quality degradation",
        "Vapor losses",
        "Increased viscosity",
        "Tank corrosion"
      ],
      correct: [0,1,3],
      explanation: "Excess heat degrades quality, causes vapor loss, and can damage tanks."
    },
    { id: "log50", question: "Why are vessel vetting inspections mandatory for oil majors?",
      choices: [
        "Ensure safety compliance",
        "Reduce environmental risks",
        "Guarantee cheaper freight",
        "Protect corporate reputation"
      ],
      correct: [0,1,3],
      explanation: "Vetting ensures safety, environmental compliance, and reputation protection."
    }
  ]
},
  insurance_risk: { 
    title: "Insurance & Risk Management", 
     questions: [
    {
      id: "ir1",
      question: "Which type of marine insurance covers loss or damage to the ship itself?",
      choices: ["Hull & Machinery (H&M)", "P&I", "Cargo Insurance", "Charterer's Liability"],
      correct: 0,
      explanation: "Hull & Machinery covers the vessel‚Äôs structure and equipment."
    },
    {
      id: "ir2",
      question: "In an oil cargo sale, who usually bears the insurance cost under CIF terms?",
      choices: ["Buyer", "Seller", "Charterer", "Bank"],
      correct: 1,
      explanation: "Under CIF, the seller arranges and pays insurance up to destination."
    },
    {
      id: "ir3",
      question: "Which insurance club typically covers pollution liabilities from oil spills?",
      choices: ["P&I Club", "Hull & Machinery insurer", "Cargo underwriter", "Freight insurer"],
      correct: 0,
      explanation: "Protection & Indemnity (P&I) covers third-party liabilities such as pollution."
    },
    {
      id: "ir4",
      question: "Which risk is best managed through hedging with futures or swaps?",
      choices: ["Flat price risk", "Collision risk", "Demurrage risk", "Cargo contamination"],
      correct: 0,
      explanation: "Futures/swaps mitigate flat price exposure."
    },
    {
      id: "ir5",
      question: "What is the deductible in insurance?",
      choices: ["The maximum payout", "The premium", "The portion of loss borne by insured", "The reinsurance cost"],
      correct: 2,
      explanation: "Deductible is the part of each loss not covered by the insurer."
    },
    {
      id: "ir6",
      question: "Which insurance responds to crew injury claims?",
      choices: ["Hull & Machinery", "P&I", "Cargo Insurance", "Force Majeure clause"],
      correct: 1,
      explanation: "P&I covers crew injury, death, and repatriation costs."
    },
    {
      id: "ir7",
      question: "Credit risk in oil trading refers to:",
      choices: ["Risk of cargo loss", "Risk buyer defaults on payment", "Risk of price volatility", "Risk of late laycan"],
      correct: 1,
      explanation: "Credit risk is counterparty default risk."
    },
    {
      id: "ir8",
      question: "If a refinery fire interrupts supply obligations, this may be claimed under:",
      choices: ["Quality dispute", "Force Majeure", "Payment default", "Demurrage claim"],
      correct: 1,
      explanation: "Force Majeure covers unforeseen events like fires."
    },
    {
      id: "ir9",
      question: "Which clause protects against non-performance due to war or sanctions?",
      choices: ["Force Majeure clause", "Payment clause", "Quantity tolerance", "Ullage clause"],
      correct: 0,
      explanation: "Force Majeure includes war/sanctions exemptions."
    },
    {
      id: "ir10",
      question: "What does 'All Risks' cargo insurance usually exclude?",
      choices: ["Theft", "General Average", "War risks", "Damage during transit"],
      correct: 2,
      explanation: "War and strikes risks are excluded unless separately added."
    },
    {
      id: "ir11",
      question: "Which document is required to claim under cargo insurance?",
      choices: ["Insurance certificate", "Bill of Lading", "Commercial Invoice", "All of the above"],
      correct: 3,
      explanation: "All three documents are typically needed in a claim."
    },
    {
      id: "ir12",
      question: "Market risk is best defined as:",
      choices: ["Risk of vessel collision", "Risk of financial loss due to price changes", "Risk of operational error", "Risk of insurance denial"],
      correct: 1,
      explanation: "Market risk = exposure to commodity price moves."
    },
    {
      id: "ir13",
      question: "Which insurance pays when shipowners declare General Average?",
      choices: ["Cargo insurance", "P&I", "Hull & Machinery", "Demurrage insurance"],
      correct: 0,
      explanation: "Cargo underwriters cover General Average contributions."
    },
    {
      id: "ir14",
      question: "Which risk is NOT insurable?",
      choices: ["Fraud by counterparty", "Storm damage", "Collision", "Piracy"],
      correct: 0,
      explanation: "Fraud is not typically insurable; operational/physical risks are."
    },
    {
      id: "ir15",
      question: "Operational risk in trading includes:",
      choices: ["Human error in nominations", "Price volatility", "Credit default", "Hull damage"],
      correct: 0,
      explanation: "Operational risk = internal process failure, not market/credit/physical."
    },
    {
      id: "ir16",
      question: "Which clause obliges parties to share costs in case of sacrifice for common safety?",
      choices: ["Force Majeure", "General Average", "Laytime clause", "Insurance warranty"],
      correct: 1,
      explanation: "General Average requires ship, cargo, and freight interests to share losses."
    },
    {
      id: "ir17",
      question: "Which policy covers an oil trader against defaults by multiple buyers?",
      choices: ["Trade credit insurance", "Cargo insurance", "H&M", "Freight cover"],
      correct: 0,
      explanation: "Trade credit insurance protects against buyer payment default."
    },
    {
      id: "ir18",
      question: "Which of the following is a key control in Risk Management?",
      choices: ["Segregation of duties", "Late nominations", "Flat price exposure", "Increasing laycan"],
      correct: 0,
      explanation: "Segregation of duties prevents fraud and errors."
    },
    {
      id: "ir19",
      question: "In oil trading, VaR (Value at Risk) measures:",
      choices: ["Operational errors", "Potential loss in portfolio over time horizon", "Insurance deductible", "Maximum credit exposure"],
      correct: 1,
      explanation: "VaR quantifies maximum potential trading loss."
    },
    {
      id: "ir20",
      question: "Which risk arises if the hedge instrument matures before physical pricing?",
      choices: ["Basis risk", "Time mismatch risk", "Liquidity risk", "Force majeure"],
      correct: 1,
      explanation: "Time mismatch = hedge expiry vs pricing exposure."
    },
    {
      id: "ir21",
      question: "Which entity sets international rules for marine insurance?",
      choices: ["Lloyd‚Äôs of London", "IMO", "P&I Clubs", "Charterers"],
      correct: 0,
      explanation: "Lloyd‚Äôs plays central role in marine insurance markets."
    },
    {
      id: "ir22",
      question: "If a vessel is arrested due to unpaid bunkers by owner, which insurance may cover cargo owner‚Äôs loss?",
      choices: ["Cargo insurance", "P&I", "Charterer‚Äôs liability", "No insurance"],
      correct: 3,
      explanation: "Cargo insurance doesn‚Äôt cover such legal arrests."
    },
    {
      id: "ir23",
      question: "Which risk is best mitigated by diversification of counterparties?",
      choices: ["Credit risk", "Operational risk", "Market risk", "Weather risk"],
      correct: 0,
      explanation: "Diversification reduces counterparty credit risk."
    },
    {
      id: "ir24",
      question: "If an oil spill occurs during discharge, which coverage applies?",
      choices: ["P&I", "Cargo Insurance", "H&M", "War risks"],
      correct: 0,
      explanation: "Pollution liability is handled by P&I."
    },
    {
      id: "ir25",
      question: "In risk management, 'stress testing' is used to:",
      choices: ["Evaluate vessel hull integrity", "Assess extreme scenarios on portfolio", "Test insurance certificates", "Audit laytime calculation"],
      correct: 1,
      explanation: "Stress tests simulate worst-case market scenarios."
    },
	
	{
      id: "ir26",
      question: "Which risks are typically covered under P&I insurance?",
      choices: ["Pollution liabilities", "Cargo damage claims", "Hull & Machinery damage", "Crew injury claims"],
      correct: [0,1,3],
      explanation: "P&I covers third-party liabilities: pollution, cargo claims, and crew-related incidents. Hull & Machinery is excluded."
    },
    {
      id: "ir27",
      question: "Which risks are usually excluded from 'All Risks' cargo insurance?",
      choices: ["War risks", "Inherent vice (natural deterioration)", "Theft", "Fire damage"],
      correct: [0,1],
      explanation: "War risks and inherent vice are excluded unless specifically endorsed."
    },
    {
      id: "ir28",
      question: "Which documents are normally required to submit a cargo insurance claim?",
      choices: ["Insurance certificate", "Bill of Lading", "Commercial Invoice", "Survey Report"],
      correct: [0,1,2,3],
      explanation: "All of these documents may be required by underwriters to process a claim."
    },
    {
      id: "ir29",
      question: "Which risk types are part of a trader‚Äôs overall risk exposure?",
      choices: ["Market risk", "Credit risk", "Operational risk", "Political risk"],
      correct: [0,1,2,3],
      explanation: "All four are part of an integrated risk management framework."
    },
    {
      id: "ir30",
      question: "Which actions mitigate credit risk?",
      choices: ["Diversification of buyers", "Using letters of credit", "Ignoring counterparty ratings", "Trade credit insurance"],
      correct: [0,1,3],
      explanation: "Diversification, secure payment methods, and insurance reduce credit exposure."
    },
    {
      id: "ir31",
      question: "What are typical components of operational risk in commodity trading?",
      choices: ["Human error", "System failures", "Price volatility", "Fraud"],
      correct: [0,1,3],
      explanation: "Operational risk arises from processes, systems, and people, not market price moves."
    },
    {
      id: "ir32",
      question: "Which situations may justify a Force Majeure claim?",
      choices: ["War outbreak", "Port closure due to strike", "Buyer payment default", "Natural disasters (earthquake, hurricane)"],
      correct: [0,1,3],
      explanation: "Force Majeure covers external, unforeseeable events ‚Äì not financial defaults."
    },
    {
      id: "ir33",
      question: "Which exposures can be hedged with derivatives?",
      choices: ["Flat price risk", "Basis risk", "FX risk", "Operational error risk"],
      correct: [0,1,2],
      explanation: "Derivatives cover price, basis, and currency risks; not operational mistakes."
    },
    {
      id: "ir34",
      question: "Which tools are used in quantitative risk management?",
      choices: ["VaR (Value at Risk)", "Stress testing", "Scenario analysis", "Letter of Indemnity"],
      correct: [0,1,2],
      explanation: "VaR, stress testing, and scenarios are analytics; LOI is contractual, not risk quantification."
    },
    {
      id: "ir35",
      question: "Which coverages are included in Hull & Machinery insurance?",
      choices: ["Damage to the vessel‚Äôs structure", "Damage to ship engines", "Pollution liability", "Collision damage"],
      correct: [0,1,3],
      explanation: "H&M covers vessel structure, machinery, and collision liability (partially). Pollution falls under P&I."
    },
    {
      id: "ir36",
      question: "What are examples of market risk?",
      choices: ["Oil price drop", "Gasoline crack change", "Counterparty insolvency", "FX USD/EUR movement"],
      correct: [0,1,3],
      explanation: "Market risks relate to commodity and FX prices; insolvency is credit risk."
    },
    {
      id: "ir37",
      question: "Which clauses are typically part of oil trading contracts?",
      choices: ["Force Majeure", "General Average", "Quality & Quantity", "Payment terms"],
      correct: [0,2,3],
      explanation: "FM, Q&Q, and payment are standard. General Average is shipping, not trading contract."
    },
    {
      id: "ir38",
      question: "Which are valid strategies to reduce operational risk?",
      choices: ["Automation of processes", "Segregation of duties", "Overexposure to one counterparty", "Regular audits"],
      correct: [0,1,3],
      explanation: "Automation, segregation, and audits mitigate operational risk. Overexposure increases risk."
    },
    {
      id: "ir39",
      question: "Which events may trigger a General Average declaration?",
      choices: ["Jettisoning cargo to save ship", "Deliberate grounding", "Cargo theft", "Fire-fighting at sea"],
      correct: [0,1,3],
      explanation: "GA applies when extraordinary sacrifice is made for common safety."
    },
    {
      id: "ir40",
      question: "Which insurance products protect a trader against buyer non-payment?",
      choices: ["Trade credit insurance", "Performance bond", "Cargo insurance", "Bank guarantee"],
      correct: [0,1,3],
      explanation: "Credit insurance, bonds, and guarantees mitigate default risk. Cargo insurance is physical, not credit."
    },
    {
      id: "ir41",
      question: "Which controls should a Risk Management team implement?",
      choices: ["Daily exposure reporting", "Position limits", "System access control", "Ignoring VaR breaches"],
      correct: [0,1,2],
      explanation: "Reporting, limits, and access control are best practices. Ignoring breaches undermines control."
    },
    {
      id: "ir42",
      question: "Which losses may be recovered via P&I insurance?",
      choices: ["Pollution clean-up costs", "Crew repatriation", "Loss of freight revenue", "Cargo contamination claims"],
      correct: [0,1,3],
      explanation: "P&I covers pollution, crew, and cargo liability. Loss of freight is owner‚Äôs risk."
    },
    {
      id: "ir43",
      question: "Which exposures are part of a trader‚Äôs daily risk report?",
      choices: ["Flat price exposure", "Credit exposure", "Demurrage cost", "FX exposure"],
      correct: [0,1,3],
      explanation: "Daily risk reports track price, credit, and FX. Demurrage is operational, tracked separately."
    },
    {
      id: "ir44",
      question: "Which risks are reduced by using Letters of Credit?",
      choices: ["Buyer insolvency", "Late delivery", "Non-payment", "Market volatility"],
      correct: [0,2],
      explanation: "LCs mitigate insolvency and non-payment, not delivery or price risks."
    },
    {
      id: "ir45",
      question: "Which factors increase cargo contamination risk?",
      choices: ["Improper tank cleaning", "Incompatible product blending", "Incorrect heating", "Timely ship nomination"],
      correct: [0,1,2],
      explanation: "Cleaning, blending, and heating errors cause contamination. Proper nomination avoids delays, not contamination."
    },
    {
      id: "ir46",
      question: "Which risks are typically assessed in Enterprise Risk Management?",
      choices: ["Strategic risks", "Market risks", "Reputation risks", "Credit risks"],
      correct: [0,1,2,3],
      explanation: "ERM integrates strategic, market, reputational, and credit risks into one framework."
    },
    {
      id: "ir47",
      question: "Which are key benefits of insurance?",
      choices: ["Risk transfer", "Regulatory compliance", "Profit guarantee", "Access to financing"],
      correct: [0,1,3],
      explanation: "Insurance transfers risk, helps compliance, and facilitates financing. It doesn‚Äôt guarantee profit."
    },
    {
      id: "ir48",
      question: "Which risks are generally managed through diversification?",
      choices: ["Counterparty risk", "Portfolio market risk", "Operational system risk", "Geopolitical exposure"],
      correct: [0,1,3],
      explanation: "Diversification reduces counterparty, portfolio, and geopolitical concentration. System failures require controls."
    },
    {
      id: "ir49",
      question: "Which insurance(s) would cover war-related damages at sea?",
      choices: ["War Risk insurance", "Hull & Machinery", "P&I", "Cargo insurance with war extension"],
      correct: [0,3],
      explanation: "War risk and cargo war extension cover these. Standard H&M and P&I exclude war."
    },
    {
      id: "ir50",
      question: "Which steps are part of a proper risk management cycle?",
      choices: ["Risk identification", "Risk assessment", "Risk mitigation", "Risk ignoring"],
      correct: [0,1,2],
      explanation: "Identify, assess, mitigate = cycle. Ignoring risk is not part of risk management."
    }
  ]
},

  refining_blending: { 
    title: "Refining & Blending", 

        questions: [
          // 1
          { id: "rfb1", question: "To raise gasoline octane without adding sulfur, blend with:", choices: ["Alkylate", "Vacuum residue", "Light cycle oil (LCO)", "Heavy fuel oil"], correct: 0, explanation: "Alkylate is high-octane, very low sulfur, and olefin-free‚Äîideal for upgrading octane cleanly." },
    { id: "rfb2", question: "Gasoline RVP increases the most when adding:", choices: ["Reformate", "Kerosene", "Butane", "Diesel"], correct: 2, explanation: "Butane has very high vapor pressure; small additions sharply raise pool RVP." },
    { id: "rfb3", question: "A common gasoline detergent additive is:", choices: ["Polyether amine (PEA)", "Sodium chloride", "Water", "Sulfur"], correct: 0, explanation: "PEA detergents keep injectors/intake valves clean and control deposit formation." },
    { id: "rfb4", question: "Typical cetane improver for diesel blending:", choices: ["MTBE", "Toluene", "2-ethylhexyl nitrate (2-EHN)", "Ethanol"], correct: 2, explanation: "2-EHN shortens ignition delay and effectively increases diesel cetane number." },
    { id: "rfb5", question: "Adding FAME (biodiesel) to diesel mainly:", choices: ["Reduces lubricity", "Improves lubricity", "Eliminates sulfur", "Raises octane"], correct: 1, explanation: "Even small FAME additions improve HFRR lubricity in ultra-low sulfur diesel." },
    { id: "rfb6", question: "Which property is notably non-linear in gasoline blending?", choices: ["Octane number", "Density", "Sulfur content", "Color"], correct: 0, explanation: "Octane blending is strongly non-linear; simple volume averaging fails." },
    { id: "rfb7", question: "Best low-sulfur, high-octane gasoline blendstock:", choices: ["FCC gasoline", "Alkylate", "Reformate", "Straight-run naphtha"], correct: 1, explanation: "Alkylate combines high RON/MON with very low sulfur and zero olefins." },
    { id: "rfb8", question: "Blend component that raises aromatics and octane:", choices: ["Reformate", "Alkylate", "Butane", "Hydrotreated naphtha"], correct: 0, explanation: "Catalytic reformate is aromatic-rich, lifting RON but tightening benzene/aromatics specs." },
    { id: "rfb9", question: "To improve diesel cold flow you would typically add:", choices: ["Kerosene (winterization)", "Heavy cycle oil", "Bitumen", "Water"], correct: 0, explanation: "Kerosene lowers cloud/CFPP quickly; PPDs help too, but kerosene is a fast fix." },
    { id: "rfb10", question: "Final product release is based on meeting:", choices: ["Crude assay data", "Pump performance curves", "Applicable product specification (e.g., ASTM/EN)", "Material safety data sheet"], correct: 2, explanation: "Shipment release depends on certified test results versus the required product specification." },
    { id: "rfb11", question: "Case study: Summer gasoline is over-volatile. What should you trim first?", choices: ["Butane", "Alkylate", "Reformate", "Isomerate"], correct: 0, explanation: "Cutting butane is the fastest way to bring RVP down for summer caps." },
    { id: "rfb12", question: "Case study: Winter startability complaints. First corrective addition?", choices: ["Butane", "Heavy reformate", "Diesel", "Resid"], correct: 0, explanation: "In winter, adding butane boosts volatility to improve cold starts‚Äîwithin seasonal limits." },
    { id: "rfb13", question: "Which component most increases benzene in gasoline?", choices: ["Reformate", "Isomerate", "Alkylate", "Ethanol"], correct: 0, explanation: "Reformate contains benzene; alkylate/isomerate are benzene-lean." },
    { id: "rfb14", question: "To reduce gasoline benzene below 1 vol%, favor:", choices: ["Reformate", "Alkylate", "FCC gasoline", "Coker naphtha"], correct: 1, explanation: "Alkylate has near-zero benzene and helps meet aromatics/benzene constraints." },
    { id: "rfb15", question: "Non-oxygenate octane booster often referenced in racing fuels:", choices: ["Toluene", "Ethanol", "MTBE", "Kerosene"], correct: 0, explanation: "Aromatics like toluene raise octane but also increase aromatics content; use is regulated." },
    { id: "rfb16", question: "Which gasoline property is the most seasonal constraint in trading?", choices: ["RVP (volatility)", "Olefins", "Color", "Sulfur always"], correct: 0, explanation: "RVP limits vary by season/region and often bind summer gasoline trades." },
    { id: "rfb17", question: "Diesel density is too high. Which blendstock helps the most?", choices: ["Kerosene", "LCO", "Vacuum gasoil", "Reformate"], correct: 0, explanation: "Kerosene lowers density and improves cold flow without heavily hurting cetane." },
    { id: "rfb18", question: "Which component most effectively raises diesel cetane?", choices: ["Light cycle oil", "HVO diesel", "Reformate", "Butane"], correct: 1, explanation: "HVO (paraffinic) diesel has very high cetane and very low aromatics." },
    { id: "rfb19", question: "Which diesel component most harms CFPP/cold flow?", choices: ["Light cycle oil (LCO)", "Kerosene", "Hydrotreated diesel", "HVO diesel"], correct: 0, explanation: "Aromatic LCO degrades cold flow and increases smoke." },
    { id: "rfb20", question: "Rising FAME content in diesel increases risk of:", choices: ["Oxidation instability", "Low lubricity", "Higher sulfur", "Lower density"], correct: 0, explanation: "FAME can oxidize; antioxidants and tight storage discipline mitigate the risk." },
    { id: "rfb21", question: "Gasoline MON is low but RON is okay. Best corrective stream:", choices: ["Isomerate", "Alkylate", "Reformate", "Butane"], correct: 1, explanation: "Alkylate has strong MON; isomerate tends to increase sensitivity (RON‚ÄìMON)." },
    { id: "rfb22", question: "Blending margin is best defined as:", choices: ["Crude price minus product price", "Blend value minus component cost", "Spec deviation penalty", "Arbitrage spread only"], correct: 1, explanation: "It‚Äôs the incremental value from turning components into a spec product vs. their costs." },
    { id: "rfb23", question: "Which property is approximately linear in blending calculations?", choices: ["Sulfur content", "RVP", "Octane", "Smoke point"], correct: 0, explanation: "Mass properties like sulfur are near-linear; octane/RVP are notably non-linear." },
    { id: "rfb24", question: "Viscosity blending for fuel oil is commonly handled with:", choices: ["Simple averaging", "Refutas (Viscosity Blending Number)", "Cloud point index", "Cetane index"], correct: 1, explanation: "Refutas VBN converts viscosity to a quasi-linear space for accurate blending math." },
    { id: "rfb25", question: "Key risk when blending HSFO with paraffinic low-S cutter stocks:", choices: ["Low RVP", "Asphaltene precipitation (incompatibility)", "High cetane", "Phase separation"], correct: 1, explanation: "Incompatibility can precipitate asphaltenes‚Äîcheck stability/TSP tests." },
	{ id: "rfb26", question: "Ethanol‚Äôs effect on gasoline volatility at low blends (e.g., E10):", choices: ["Lowers RVP", "No effect", "Raises RVP (uplift)", "Eliminates RVP limits"], correct: 2, explanation: "Ethanol causes a volatility uplift at low concentrations‚Äîkey for summer specs." },
    { id: "rfb27", question: "To reduce gasoline sulfur via blending, favor:", choices: ["Hydrotreated naphtha", "FCC gasoline", "Coker naphtha", "Heavy reformate"], correct: 0, explanation: "Hydrotreated naphtha is very low sulfur and reduces pool sulfur quickly." },
    { id: "rfb28", question: "Jet fuel smoke point is low. First blending move:", choices: ["Add hydrotreated kerosene", "Add reformate", "Add LCO", "Add heavy naphtha"], correct: 0, explanation: "More paraffins/fewer aromatics (hydrotreated kerosene) improve smoke point." },
    { id: "rfb29", question: "Gasoline T90 is too high (too heavy). Best corrective stream:", choices: ["Light isomerate", "Heavy reformate", "LCO", "Heavy naphtha"], correct: 0, explanation: "Light isomerate/light naphtha lowers the back-end of the distillation curve (T90)." },
    { id: "rfb30", question: "Before sailing, the document proving specs at load port is the:", choices: ["Certificate of Quality (CoQ)", "Bill of Lading only", "Commercial invoice", "Timesheet"], correct: 0, explanation: "An independent survey issues the CoQ from sealed load-port samples." },
    { id: "rfb31", question: "Which property is NOT used for diesel release testing?", choices: ["Cetane number/index", "Density", "Cold flow (CFPP/cloud)", "Octane number"], correct: 3, explanation: "Octane is for gasoline; diesel uses cetane, density, sulfur, cold-flow, etc." },
    { id: "rfb32", question: "Which gasoline blendstock is olefin-free and improves stability/gum risk?", choices: ["Alkylate", "FCC gasoline", "Coker naphtha", "Reformate"], correct: 0, explanation: "Alkylate contains virtually no olefins‚Äîexcellent stability and low gum." },
    { id: "rfb33", question: "Market in strong backwardation. Best stance for components:", choices: ["Store for later", "Sell promptly", "Hedge only", "Ignore structure"], correct: 1, explanation: "In backwardation, time erodes value; monetizing quickly maximizes margin." },
    { id: "rfb34", question: "Constraint often limiting profitable butane injection in terminals:", choices: ["Cetane", "CFPP", "RVP and seasonal limits", "Smoke point"], correct: 2, explanation: "Terminal/regional RVP caps limit economical butane injection." },
    { id: "rfb35", question: "To hit low benzene and low aromatics while keeping octane, favor pairing:", choices: ["Reformate + LCO", "Alkylate + Isomerate", "Coker naphtha + Reformate", "FCC gasoline + Reformate"], correct: 1, explanation: "Alkylate + isomerate are paraffinic/clean with good octane and low aromatics." },
    { id: "rfb36", question: "Deep hydrotreating can harm diesel lubricity. Quick corrective action:", choices: ["Add lubricity improver", "Add sulfur", "Blend with LCO", "Raise density"], correct: 0, explanation: "Lubricity additives restore HFRR quickly without violating sulfur limits." },
    { id: "rfb37", question: "Best practice to ensure homogeneous blends before CoQ sampling:", choices: ["Immediate sample after top-loading", "No circulation needed", "In-tank circulation/line blending then settle", "Skip sampling"], correct: 2, explanation: "Proper circulation avoids stratification and biased CoQ results." },
    { id: "rfb38", question: "Gasoline pool has high sulfur and low octane. Best two-stream combo:", choices: ["Alkylate + hydrotreated naphtha", "Reformate + LCO", "Coker naphtha + FCC gasoline", "Butane + heavy reformate"], correct: 0, explanation: "Alkylate boosts octane; hydrotreated naphtha lowers sulfur‚Äîsynergistic." },
    { id: "rfb39", question: "Bunker blend shows high TSP/instability. Likely corrective action:", choices: ["Add heavy reformate", "Dilute with stable, low-asphaltene cutter", "Add water", "Raise temperature only"], correct: 1, explanation: "Use compatible paraffinic cutter and verify with stability tests." },
    { id: "rfb40", question: "Which blendstock tends to raise RON much more than MON (high sensitivity)?", choices: ["Isomerate", "Alkylate", "Reformate", "Kerosene"], correct: 0, explanation: "Isomerate is high-RON but relatively lower MON, increasing sensitivity." },
    { id: "rfb41", question: "When adding ethanol to gasoline, the compliance calculation most impacted is:", choices: ["Cetane", "Oxygen content (wt%)", "Smoke point", "CFPP"], correct: 1, explanation: "Oxygen content and RVP uplift must be checked when blending ethanol." },
    { id: "rfb42", question: "Major operational risk when blending ethanol into moist gasoline:", choices: ["Low octane", "Phase separation with water", "High cetane", "Low density"], correct: 1, explanation: "Water promotes ethanol/water separation (two-phase), making fuel off-spec." },
    { id: "rfb43", question: "Which contamination in jet fuel cannot realistically be solved by simple blending if too high?", choices: ["High aromatics", "High sulfur", "FAME contamination over limit", "Slightly high density"], correct: 2, explanation: "FAME carryover limits are very tight; significant contamination requires reprocessing." },
    { id: "rfb44", question: "Tool most used to screen multi-component blending economics:", choices: ["Simple averages", "Linear programming (pooling LP)", "Manual spreadsheets only", "Monte Carlo only"], correct: 1, explanation: "LP pooling models capture specs, costs, and constraints to optimize margin." },
    { id: "rfb45", question: "Which gasoline component most raises gum formation risk if overused?", choices: ["FCC gasoline (olefinic)", "Alkylate", "Isomerate", "Hydrotreated naphtha"], correct: 0, explanation: "Olefinic FCC gasoline is more prone to oxidation/gum; treat limits carefully." },
    { id: "rfb46", question: "To lower diesel aromatics via blending (not processing), best stream to add:", choices: ["HVO diesel", "LCO", "Reformate", "Vacuum residue"], correct: 0, explanation: "Paraffinic HVO reduces aromatics and smoke while helping cetane." },
    { id: "rfb47", question: "For jet fuel: meeting both freeze point and smoke point at minimal cost is easiest with:", choices: ["Heavy reformate alone", "Hydrotreated kerosene + synthetic paraffinic kerosene (SPK)", "LCO only", "Butane addition"], correct: 1, explanation: "SPK + hydrotreated kerosene are paraffinic/clean, improving both properties." },
    { id: "rfb48", question: "Gasoline oxygen is too high due to ethanol. Quickest corrective move while preserving octane:", choices: ["Increase alkylate and reduce ethanol proportion", "Add water", "Add LCO", "Add heavy reformate"], correct: 0, explanation: "Cut ethanol to reduce oxygen and replace octane with alkylate to keep specs." },
    { id: "rfb49", question: "Case study: A Europe‚ÜíUS gasoline arb opens, but pool aromatics are high. Best quick fix:", choices: ["Add reformate", "Add alkylate/isomerate and cut reformate", "Add diesel", "Do nothing"], correct: 1, explanation: "US specs are tight on benzene/aromatics; paraffinic components help fit the window." },
    { id: "rfb50", question: "Case study: Contango builds on gasoline components. Likely value strategy:", choices: ["Sell prompt regardless", "Store components if carry < contango spread", "Blend immediately into final", "Avoid hedging"], correct: 1, explanation: "In contango, deferred prices exceed prompt; if storage costs (carry) are lower, storing can add value." }
        ]
      },

  specialty_products: { 
    title: "LPG, VGO, Bitumen, and Other Specialty Products", 
    questions: [
	{
  id: "sp1",
  question: "Which specialty products are considered light hydrocarbons?",
  choices: ["LPG", "VGO", "Bitumen", "Naphtha"],
  correct: [0,3],
  explanation: "LPG and naphtha are light hydrocarbons, while VGO and bitumen are heavier fractions."
},
{
  id: "sp2",
  question: "Which products are sensitive to temperature during storage?",
  choices: ["LPG", "Bitumen", "VGO", "Diesel"],
  correct: [0,1,2],
  explanation: "LPG is volatile, bitumen and VGO are viscous; all require temperature control."
},
{
  id: "sp3",
  question: "Which products are commonly used as feedstock for cracking units?",
  choices: ["VGO", "LPG", "Bitumen", "Gasoline"],
  correct: 0,
  explanation: "VGO is a primary feedstock for FCC or hydrocracking units."
},
{
  id: "sp4",
  question: "Which products are typically traded in metric tons?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,1,2],
  explanation: "LPG, VGO, and bitumen are traded in metric tons; gasoline may also be in barrels."
},
{
  id: "sp5",
  question: "Which specialty products require strict sulfur specifications?",
  choices: ["LPG", "VGO", "Bitumen", "Jet A1"],
  correct: [1,2],
  explanation: "VGO and bitumen must meet sulfur limits for processing and environmental reasons."
},
{
  id: "sp6",
  question: "Which products are flammable and require safety monitoring?",
  choices: ["LPG", "Bitumen", "VGO", "Diesel"],
  correct: [0,2],
  explanation: "LPG and VGO are flammable and need proper safety measures."
},
{
  id: "sp7",
  question: "Which specialty products can solidify at ambient temperature?",
  choices: ["LPG", "VGO", "Bitumen", "Naphtha"],
  correct: 2,
  explanation: "Bitumen solidifies at ambient temperature; others remain liquid or gas."
},
{
  id: "sp8",
  question: "Which products are used as industrial fuel or bunker fuel?",
  choices: ["LPG", "VGO", "Bitumen", "Fuel Oil"],
  correct: [1,2,3],
  explanation: "VGO, bitumen, and fuel oil are commonly used as industrial or marine fuel."
},
{
  id: "sp9",
  question: "Which product requires pressurized storage tanks?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: 0,
  explanation: "LPG is gaseous under ambient conditions and needs pressurized tanks."
},
{
  id: "sp10",
  question: "Which products are affected by pour point or viscosity limitations?",
  choices: ["VGO", "Bitumen", "LPG", "Gasoline"],
  correct: [0,1],
  explanation: "VGO and bitumen are viscous; their handling depends on temperature and viscosity."
},
{
  id: "sp11",
  question: "Which products are used as feedstock for petrochemical production?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,1,3],
  explanation: "LPG, VGO, and gasoline can be converted into chemicals in petrochemical plants."
},
{
  id: "sp12",
  question: "Which specialty product is primarily composed of propane and butane?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: 0,
  explanation: "LPG consists mainly of propane and butane."
},
{
  id: "sp13",
  question: "Which products are sensitive to contamination from water or sediments?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [1,2],
  explanation: "VGO and bitumen must be clean; water or sediments affect processing and quality."
},
{
  id: "sp14",
  question: "Which products are traded with flat price or CFR terms?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [0,1,2],
  explanation: "LPG, VGO, and bitumen are traded with flexible pricing terms."
},
{
  id: "sp15",
  question: "Which products are subject to flash point safety regulations?",
  choices: ["LPG", "Bitumen", "VGO", "Gasoline"],
  correct: [0,2,3],
  explanation: "LPG, VGO, and gasoline require minimum flash points for safe handling."
},
{
  id: "sp16",
  question: "Which specialty products require blending before use?",
  choices: ["VGO", "Bitumen", "LPG", "Diesel"],
  correct: [0,1],
  explanation: "VGO and bitumen are often blended to meet fuel or asphalt specifications."
},
{
  id: "sp17",
  question: "Which product is most volatile and requires leak detection?",
  choices: ["LPG", "VGO", "Bitumen", "Fuel Oil"],
  correct: 0,
  explanation: "LPG is highly volatile and must be monitored for leaks."
},
{
  id: "sp18",
  question: "Which products are heavy hydrocarbon fractions?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [1,2],
  explanation: "VGO and bitumen are heavy fractions; LPG and gasoline are lighter."
},
{
  id: "sp19",
  question: "Which products need heated pipelines for transfer?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen are viscous; heating is required for pumping."
},
{
  id: "sp20",
  question: "Which specialty products are affected by density and API gravity limits?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [1,2],
  explanation: "VGO and bitumen have strict density/API limits for blending and usage."
},
{
  id: "sp21",
  question: "Which product is gaseous at normal temperature and pressure?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: 0,
  explanation: "LPG is gaseous under normal conditions."
},
{
  id: "sp22",
  question: "Which products are part of heavy residue streams in refineries?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen are heavy residue fractions."
},
{
  id: "sp23",
  question: "Which products can be used for asphalt production?",
  choices: ["LPG", "VGO", "Bitumen", "Fuel Oil"],
  correct: 2,
  explanation: "Bitumen is the primary product for asphalt."
},
{
  id: "sp24",
  question: "Which products are traded in both bulk and packaged forms?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [0,2],
  explanation: "LPG and bitumen can be shipped in bulk or packaged forms."
},
{
  id: "sp25",
  question: "Which products are sensitive to vapor pressure limits for safety?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,3],
  explanation: "LPG and gasoline have vapor pressure limits to avoid explosion risks."
},

// Bloc 2 : sp26 ‚Üí sp50
{
  id: "sp26",
  question: "Which specialty products are considered flammable liquids?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [0,1,3],
  explanation: "LPG, VGO, and diesel are flammable and require precautions."
},
{
  id: "sp27",
  question: "Which products are traded internationally with CIF/CFR terms?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,1,2],
  explanation: "LPG, VGO, and bitumen are traded under common shipping terms."
},
{
  id: "sp28",
  question: "Which products are affected by temperature during shipping?",
  choices: ["LPG", "Bitumen", "VGO", "Gasoline"],
  correct: [0,1,2],
  explanation: "LPG needs pressure control; VGO and bitumen may require heating."
},
{
  id: "sp29",
  question: "Which specialty products are part of refinery bottoms?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen are heavy residue streams from refining."
},
{
  id: "sp30",
  question: "Which products are monitored for water content before delivery?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2,3],
  explanation: "VGO, bitumen, and diesel must be free of water contamination."
},
{
  id: "sp31",
  question: "Which specialty products are often blended to meet sulfur specs?",
  choices: ["VGO", "Bitumen", "LPG", "Diesel"],
  correct: [0,1],
  explanation: "VGO and bitumen are blended to comply with sulfur regulations."
},
{
  id: "sp32",
  question: "Which products require monitoring of vapor leaks?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,3],
  explanation: "LPG and gasoline are volatile and require leak monitoring."
},
{
  id: "sp33",
  question: "Which products are handled with heated pumps?",
  choices: ["VGO", "Bitumen", "LPG", "Diesel"],
  correct: [0,1],
  explanation: "VGO and bitumen are viscous; heating facilitates pumping."
},
{
  id: "sp34",
  question: "Which products are included in refinery specialty streams?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [0,1,2],
  explanation: "Refinery specialty products include LPG, VGO, and bitumen."
},
{
  id: "sp35",
  question: "Which products can solidify under ambient conditions?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: 2,
  explanation: "Bitumen solidifies and must be heated to remain liquid."
},
{
  id: "sp36",
  question: "Which products have high specific gravity and low API?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [1,2],
  explanation: "VGO and bitumen are heavy hydrocarbons with low API gravity."
},
{
  id: "sp37",
  question: "Which products are shipped under temperature-controlled conditions?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,1,2],
  explanation: "LPG needs pressure/temperature control; VGO and bitumen need heating."
},
{
  id: "sp38",
  question: "Which products are prone to thermal cracking if overheated?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen can crack under excessive heat."
},
{
  id: "sp39",
  question: "Which products are volatile and pose explosion risks?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,3],
  explanation: "LPG and gasoline are highly flammable."
},
{
  id: "sp40",
  question: "Which products are used as raw material for chemical plants?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [0,1],
  explanation: "LPG and VGO are used for petrochemical feedstock."
},
{
  id: "sp41",
  question: "Which products are sensitive to API gravity for trading?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [1,2],
  explanation: "VGO and bitumen specifications rely on API gravity for pricing and blending."
},
{
  id: "sp42",
  question: "Which products are stored in pressurized or heated tanks?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [0,1,2],
  explanation: "LPG tanks are pressurized; VGO and bitumen tanks may be heated."
},
{
  id: "sp43",
  question: "Which products are part of heavy residue blending programs?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen are blended to produce bunker or asphalt products."
},
{
  id: "sp44",
  question: "Which specialty products are sensitive to contamination?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen require clean handling to maintain specifications."
},
{
  id: "sp45",
  question: "Which products are primarily used in petrochemical cracking?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [0,1],
  explanation: "LPG and VGO are key feedstocks for petrochemical units."
},
{
  id: "sp46",
  question: "Which products are volatile liquids?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,3],
  explanation: "LPG and gasoline are volatile at ambient conditions."
},
{
  id: "sp47",
  question: "Which products require heated pipelines or storage for handling?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen are viscous and need heat to flow properly."
},
{
  id: "sp48",
  question: "Which products have flash point limitations for safety compliance?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,1,3],
  explanation: "LPG, VGO, and gasoline must meet flash point regulations for safe handling."
},
{
  id: "sp49",
  question: "Which products are prone to sediment or impurities?",
  choices: ["LPG", "VGO", "Bitumen", "Diesel"],
  correct: [1,2],
  explanation: "VGO and bitumen may contain sediments affecting quality and processing."
},
{
  id: "sp50",
  question: "Which products are considered specialty refinery streams?",
  choices: ["LPG", "VGO", "Bitumen", "Gasoline"],
  correct: [0,1,2],
  explanation: "LPG, VGO, and bitumen are specialty refinery streams traded separately from main fuels."
}
 ]
      },
	  
  regulations_compliance: { 
    title: "Trading Regulations & Compliance", 
    questions: [
    {
      id: "rc1",
      question: "Which organizations regulate international oil trading practices?",
      choices: ["IMO (International Maritime Organization)", "FCA (Financial Conduct Authority)", "CFTC (Commodity Futures Trading Commission)", "Interpol"],
      correct: [0,1,2],
      explanation: "IMO regulates shipping, FCA financial conduct in the UK, and CFTC derivatives markets in the US. Interpol is law enforcement, not trade regulator."
    },
    {
      id: "rc2",
      question: "Which risks are addressed by compliance frameworks?",
      choices: ["Money laundering", "Market manipulation", "Tax evasion", "Operational system failure"],
      correct: [0,1,2],
      explanation: "Compliance focuses on AML, market conduct, and financial crime. Operational failures fall under risk management."
    },
    {
      id: "rc3",
      question: "Which are common KYC (Know Your Customer) requirements?",
      choices: ["Company registration documents", "Beneficial ownership details", "Ship chartering terms", "Proof of identity for directors"],
      correct: [0,1,3],
      explanation: "KYC requires corporate docs, ownership, and ID verification. Chartering terms are commercial, not compliance."
    },
    {
      id: "rc4",
      question: "Which actions may breach market manipulation rules?",
      choices: ["Wash trading", "Spoofing", "Arbitrage", "Insider trading"],
      correct: [0,1,3],
      explanation: "Wash trades, spoofing, and insider trading are manipulative. Arbitrage is legitimate."
    },
    {
      id: "rc5",
      question: "Which are red flags for money laundering in commodity trading?",
      choices: ["Unusual payment routes", "Shell companies", "Cash transactions", "Standard credit terms"],
      correct: [0,1,2],
      explanation: "Unusual payments, shell structures, and cash are red flags. Standard terms are normal."
    },
    {
      id: "rc6",
      question: "Which laws apply to anti-bribery compliance?",
      choices: ["UK Bribery Act", "US FCPA", "SOX (Sarbanes-Oxley)", "EU AML directives"],
      correct: [0,1,3],
      explanation: "UK Bribery Act, US FCPA, and EU AML apply. SOX focuses on accounting standards."
    },
    {
      id: "rc7",
      question: "Which sanctions regimes must global traders typically monitor?",
      choices: ["US OFAC sanctions", "EU sanctions", "UN Security Council sanctions", "OPEC export quotas"],
      correct: [0,1,2],
      explanation: "OFAC, EU, and UN sanctions apply. OPEC quotas are production, not sanctions."
    },
    {
      id: "rc8",
      question: "Which documents are reviewed in a trade compliance audit?",
      choices: ["Bills of Lading", "Charter Party", "KYC documentation", "Payment instructions"],
      correct: [0,2,3],
      explanation: "Audits cover shipping docs, KYC, and payments. Charter Party is operational, not compliance focus."
    },
    {
      id: "rc9",
      question: "Which practices are mandatory under MAR (Market Abuse Regulation) in the EU?",
      choices: ["Insider list maintenance", "Timely disclosure of inside information", "Wash trades to boost liquidity", "Suspicious transaction reporting"],
      correct: [0,1,3],
      explanation: "MAR enforces insider list, disclosure, and suspicious reporting. Wash trades are illegal."
    },
    {
      id: "rc10",
      question: "Which are consequences of breaching sanctions?",
      choices: ["Heavy fines", "Imprisonment of individuals", "Reputational damage", "Exemption from KYC obligations"],
      correct: [0,1,2],
      explanation: "Fines, jail, and reputation damage are real consequences. Sanctions increase, not exempt, KYC requirements."
    },
    {
      id: "rc11",
      question: "Which controls help detect insider trading?",
      choices: ["Monitoring communication channels", "Trading surveillance systems", "Daily reconciliation of bunker consumption", "Restricted lists of securities"],
      correct: [0,1,3],
      explanation: "Monitoring, surveillance, and restricted lists are compliance tools. Bunker reconciliation is operational."
    },
    {
      id: "rc12",
      question: "Which departments are typically involved in compliance?",
      choices: ["Legal", "Risk", "Trading desk", "Operations"],
      correct: [0,1,2,3],
      explanation: "Compliance involves all: legal frameworks, risk controls, trading monitoring, and operational checks."
    },
    {
      id: "rc13",
      question: "Which activities may fall under Anti-Money Laundering (AML) obligations?",
      choices: ["High-value transactions", "Trade with high-risk jurisdictions", "Spot trading with regulated counterparties", "Payments through offshore accounts"],
      correct: [0,1,3],
      explanation: "AML applies to high-value, high-risk, and offshore payments. Normal regulated counterparties are lower risk."
    },
    {
      id: "rc14",
      question: "Which systems support compliance monitoring?",
      choices: ["Transaction monitoring software", "Watchlist screening", "ERP accounting systems", "Sanctions screening tools"],
      correct: [0,1,3],
      explanation: "Transaction monitoring, watchlists, and sanctions checks are compliance tools. ERP is more finance-oriented."
    },
    {
      id: "rc15",
      question: "Which are typical penalties for market abuse?",
      choices: ["Trading ban", "Fines", "Criminal charges", "Automatic trade annulment"],
      correct: [0,1,2],
      explanation: "Market abuse leads to bans, fines, and jail. Trades are not automatically annulled."
    },
    {
      id: "rc16",
      question: "Which principles guide a compliance program?",
      choices: ["Transparency", "Accountability", "Proportionality", "Speculation"],
      correct: [0,1,2],
      explanation: "Compliance is built on transparency, accountability, and proportionality. Speculation is trading."
    },
    {
      id: "rc17",
      question: "Which risks are linked to sanctions breaches?",
      choices: ["Frozen assets", "Loss of trading license", "Counterparty default", "Regulatory investigations"],
      correct: [0,1,3],
      explanation: "Sanctions lead to frozen assets, license withdrawal, and investigations. Default is credit risk, not sanctions."
    },
    {
      id: "rc18",
      question: "Which are forms of market abuse?",
      choices: ["Insider dealing", "Spreading false information", "Cornering the market", "Benchmark manipulation"],
      correct: [0,1,2,3],
      explanation: "All four are recognized forms of market abuse."
    },
    {
      id: "rc19",
      question: "Which checks are part of sanctions screening?",
      choices: ["Counterparty names", "Beneficial owners", "Ship IMO numbers", "Weather patterns"],
      correct: [0,1,2],
      explanation: "Names, owners, and vessel numbers are screened. Weather is irrelevant."
    },
    {
      id: "rc20",
      question: "Which bodies enforce compliance in the US?",
      choices: ["SEC", "CFTC", "OFAC", "IMO"],
      correct: [0,1,2],
      explanation: "SEC (securities), CFTC (commodities), and OFAC (sanctions) enforce compliance. IMO regulates shipping, not financial compliance."
    },
    {
      id: "rc21",
      question: "Which behaviors violate anti-bribery laws?",
      choices: ["Facilitation payments", "Kickbacks", "Entertainment within policy limits", "Improper gifts"],
      correct: [0,1,3],
      explanation: "Facilitation, kickbacks, and improper gifts breach laws. Reasonable entertainment within policy is acceptable."
    },
    {
      id: "rc22",
      question: "Which policies should a compliance manual contain?",
      choices: ["AML policy", "Sanctions policy", "Market conduct policy", "Weather risk policy"],
      correct: [0,1,2],
      explanation: "AML, sanctions, and market conduct are essential. Weather risk is operational."
    },
    {
      id: "rc23",
      question: "Which mechanisms protect whistleblowers?",
      choices: ["Confidential reporting channels", "Anti-retaliation policies", "Financial bonuses for silence", "Anonymous hotlines"],
      correct: [0,1,3],
      explanation: "Whistleblowers are protected by anonymity, anti-retaliation, and reporting systems. Paying for silence is illegal."
    },
    {
      id: "rc24",
      question: "Which elements are part of a compliance culture?",
      choices: ["Tone from the top", "Training & awareness", "Ignoring breaches if profitable", "Clear escalation channels"],
      correct: [0,1,3],
      explanation: "Leadership, training, and escalation build compliance culture. Ignoring breaches undermines it."
    },
    {
      id: "rc25",
      question: "Which trading practices may trigger regulatory scrutiny?",
      choices: ["Unusual trading volumes", "Circular trading patterns", "Transparent reporting", "Large orders with no intent to execute"],
      correct: [0,1,3],
      explanation: "Unusual patterns, circular trades, and spoofing trigger scrutiny. Transparency is good practice."
    },
	
	{
  id: "rc26",
  question: "Which documents are required during a regulatory investigation?",
  choices: ["Trade confirmations", "Emails & communication logs", "Shipping invoices", "Weather routing reports"],
  correct: [0,1,2],
  explanation: "Investigators review confirmations, communications, and invoices. Weather routing is irrelevant."
},
{
  id: "rc27",
  question: "Which methods are used to identify beneficial ownership?",
  choices: ["Corporate registry checks", "Shareholding analysis", "Asking only the trader", "Screening against PEP lists"],
  correct: [0,1,3],
  explanation: "Registry, shareholder analysis, and PEP screening help. Asking only the trader is insufficient."
},
{
  id: "rc28",
  question: "Which scenarios may require an STR (Suspicious Transaction Report)?",
  choices: ["Unusual counterparties", "Complex payment structures", "Market arbitrage", "High-value cash transactions"],
  correct: [0,1,3],
  explanation: "STRs are filed for suspicious payments, structures, and cash. Arbitrage is legitimate."
},
{
  id: "rc29",
  question: "Which principles apply under OECD guidelines for compliance?",
  choices: ["Integrity", "Transparency", "Corruption tolerance", "Accountability"],
  correct: [0,1,3],
  explanation: "OECD promotes integrity, transparency, and accountability. Tolerance of corruption is prohibited."
},
{
  id: "rc30",
  question: "Which are common enforcement actions by regulators?",
  choices: ["Fines", "License suspension", "Mandatory remediation plans", "Automatic forgiveness after 1 year"],
  correct: [0,1,2],
  explanation: "Sanctions include fines, suspensions, and remediation. Forgiveness is not automatic."
},
{
  id: "rc31",
  question: "Which are examples of politically exposed persons (PEPs)?",
  choices: ["Government ministers", "Family of senior politicians", "Local ship agents", "Heads of state-owned enterprises"],
  correct: [0,1,3],
  explanation: "Ministers, families, and SOE heads are PEPs. Ship agents are not."
},
{
  id: "rc32",
  question: "Which training topics are mandatory in compliance programs?",
  choices: ["AML procedures", "Sanctions awareness", "Commodity price forecasting", "Anti-bribery rules"],
  correct: [0,1,3],
  explanation: "AML, sanctions, and anti-bribery training are mandatory. Price forecasting is commercial."
},
{
  id: "rc33",
  question: "Which trades may breach embargoes?",
  choices: ["Direct trade with sanctioned countries", "Indirect trade via intermediaries", "Trade routed through neutral jurisdictions", "Trade of humanitarian goods under license"],
  correct: [0,1,2],
  explanation: "Direct, indirect, and disguised trade breaches embargoes. Licensed humanitarian goods are allowed."
},
{
  id: "rc34",
  question: "Which mechanisms support trade surveillance?",
  choices: ["Pattern recognition algorithms", "Manual exception reviews", "Shipping demurrage logs", "Real-time monitoring tools"],
  correct: [0,1,3],
  explanation: "Surveillance relies on algorithms, reviews, and monitoring. Demurrage logs are operational."
},
{
  id: "rc35",
  question: "Which behaviors may indicate front running?",
  choices: ["Trading ahead of a large client order", "Disclosing client intentions", "Executing hedges after order completion", "Profiting from advance knowledge"],
  correct: [0,1,3],
  explanation: "Trading ahead, disclosure, and profiting from client knowledge are front running. Hedging afterward is normal."
},
{
  id: "rc36",
  question: "Which laws relate to competition compliance?",
  choices: ["Sherman Act", "EU Competition Law", "Basel III", "Cartel prohibition rules"],
  correct: [0,1,3],
  explanation: "Sherman Act, EU law, and cartel prohibitions govern competition. Basel III is banking regulation."
},
{
  id: "rc37",
  question: "Which are signs of potential cartel activity?",
  choices: ["Identical bids", "Market share stability", "Price fixing", "Open market transparency"],
  correct: [0,1,2],
  explanation: "Identical bids, stable shares, and price fixing suggest cartels. Transparency is not a cartel sign."
},
{
  id: "rc38",
  question: "Which elements form part of sanctions due diligence?",
  choices: ["Checking vessel AIS data", "Screening beneficial owners", "Assessing cargo origin", "Optimizing freight rates"],
  correct: [0,1,2],
  explanation: "AIS, ownership, and cargo origin checks are sanctions due diligence. Freight rates are commercial."
},
{
  id: "rc39",
  question: "Which frameworks address financial crime?",
  choices: ["FATF recommendations", "Basel AML principles", "IMO MARPOL rules", "National AML legislation"],
  correct: [0,1,3],
  explanation: "FATF, Basel, and national laws cover AML. MARPOL addresses pollution."
},
{
  id: "rc40",
  question: "Which factors increase compliance risks?",
  choices: ["Trading with new counterparties", "Operating in high-risk jurisdictions", "Complex offshore structures", "Routine hedging transactions"],
  correct: [0,1,2],
  explanation: "New counterparties, risky jurisdictions, and offshore structures increase compliance risk. Routine hedges do not."
},
{
  id: "rc41",
  question: "Which are examples of soft controls in compliance culture?",
  choices: ["Leadership commitment", "Training", "Code of conduct", "Automated sanctions filters"],
  correct: [0,1,2],
  explanation: "Soft controls include leadership, training, and conduct codes. Filters are hard controls."
},
{
  id: "rc42",
  question: "Which are escalation triggers in compliance monitoring?",
  choices: ["Suspicious counterparties", "Failed KYC checks", "Unusual payment terms", "Valid letters of credit"],
  correct: [0,1,2],
  explanation: "Suspicious counterparties, failed KYC, and unusual terms trigger escalation. Valid LCs do not."
},
{
  id: "rc43",
  question: "Which practices enhance compliance training effectiveness?",
  choices: ["Case studies", "Role-based modules", "Gamified learning", "Ignoring performance tracking"],
  correct: [0,1,2],
  explanation: "Case studies, role-based, and gamified learning work. Ignoring tracking weakens training."
},
{
  id: "rc44",
  question: "Which trades are most exposed to sanctions evasion risks?",
  choices: ["Ship-to-ship transfers", "Opaque ownership structures", "Cargoes routed through free zones", "Spot market hedges"],
  correct: [0,1,2],
  explanation: "STS transfers, opaque structures, and free zones are high risk. Spot hedges are low risk."
},
{
  id: "rc45",
  question: "Which agencies enforce AML globally?",
  choices: ["Financial Action Task Force (FATF)", "National financial intelligence units (FIUs)", "World Trade Organization", "Interpol"],
  correct: [0,1,3],
  explanation: "FATF, FIUs, and Interpol enforce AML. WTO regulates trade, not AML."
},
{
  id: "rc46",
  question: "Which behaviors may breach ethical trading codes?",
  choices: ["Conflict of interest", "Bribery", "Insider trading", "Transparent reporting"],
  correct: [0,1,2],
  explanation: "Conflicts, bribery, and insider trading breach ethics. Transparency is positive."
},
{
  id: "rc47",
  question: "Which technologies support regulatory compliance?",
  choices: ["Blockchain for trade traceability", "AI for transaction monitoring", "ERP freight scheduling", "Sanctions list automation"],
  correct: [0,1,3],
  explanation: "Blockchain, AI, and sanctions automation support compliance. ERP scheduling is operational."
},
{
  id: "rc48",
  question: "Which indicators suggest trade-based money laundering?",
  choices: ["Over-invoicing", "Under-invoicing", "Phantom shipments", "Routine hedges with regulated banks"],
  correct: [0,1,2],
  explanation: "Over/under invoicing and phantom trades are TBML red flags. Routine hedges are not."
},
{
  id: "rc49",
  question: "Which measures reduce insider risk?",
  choices: ["Access controls", "Data leakage monitoring", "Segregation of duties", "Excessive disclosure"],
  correct: [0,1,2],
  explanation: "Access, monitoring, and segregation reduce risk. Excessive disclosure increases it."
},
{
  id: "rc50",
  question: "Which reporting duties exist under global compliance laws?",
  choices: ["Suspicious activity reports", "Market abuse notifications", "Annual compliance certifications", "Optional weather forecasts"],
  correct: [0,1,2],
  explanation: "SARs, abuse reports, and certifications are mandatory. Weather forecasts are irrelevant."
}
  ]
      },

  quality_testing: { 
    title: "Quality Control & Testing", 
    questions: [
{
  id: "qt1",
  question: "Which parameter is commonly tested to determine gasoline‚Äôs resistance to knocking?",
  choices: ["Flash Point", "Pour Point", "Octane Number", "Cetane Number"],
  correct: [2],
  explanation: "Octane number measures resistance to knocking in gasoline."
},
{
  id: "qt2",
  question: "Which tests are standard for marine fuel quality?",
  choices: ["Viscosity", "Density", "Sulfur content", "Freezing point"],
  correct: [0,1,2],
  explanation: "Viscosity, density, and sulfur content are tested in marine fuels. Freezing point is aviation."
},
{
  id: "qt3",
  question: "Which standard specifies jet fuel testing procedures?",
  choices: ["ASTM D1655", "ISO 8217", "EN 590", "API RP 500"],
  correct: [0],
  explanation: "ASTM D1655 is the standard for jet fuel quality testing."
},
{
  id: "qt4",
  question: "Which contaminants are critical to monitor in crude oil assays?",
  choices: ["Salt", "Mercury", "Vanadium", "Lead"],
  correct: [0,1,2],
  explanation: "Salt, mercury, and vanadium are critical contaminants. Lead is not usually present in crude assays."
},
{
  id: "qt5",
  question: "Which unit is used for viscosity measurement?",
  choices: ["Seconds", "cSt (centistokes)", "Liters", "Joules"],
  correct: [1],
  explanation: "Viscosity in petroleum testing is expressed in cSt (centistokes)."
},
{
  id: "qt6",
  question: "Which test determines water content in fuels?",
  choices: ["ASTM D86", "Karl Fischer titration", "Bomb calorimeter", "Flash point"],
  correct: [1],
  explanation: "Karl Fischer titration is the standard for water content measurement."
},
{
  id: "qt7",
  question: "Which are common causes of off-spec gasoline?",
  choices: ["Low octane", "Excess sulfur", "Excess aromatics", "Low viscosity"],
  correct: [0,1,2],
  explanation: "Low octane, sulfur, and aromatics cause off-spec. Viscosity is not relevant for gasoline."
},
{
  id: "qt8",
  question: "Which property is measured by ASTM D86?",
  choices: ["Distillation curve", "Density", "Sulfur", "Pour point"],
  correct: [0],
  explanation: "ASTM D86 measures distillation characteristics of fuels."
},
{
  id: "qt9",
  question: "Which parameters define jet fuel freezing behavior?",
  choices: ["Flash point", "Freezing point", "Viscosity", "Distillation range"],
  correct: [1],
  explanation: "Freezing point is a key safety parameter in jet fuels."
},
{
  id: "qt10",
  question: "Which analytical techniques are used in crude assay?",
  choices: ["Gas chromatography", "Mass spectrometry", "Spectroscopy", "Tensile strength testing"],
  correct: [0,1,2],
  explanation: "GC, MS, and spectroscopy are key crude assay tools. Tensile strength is irrelevant."
},
{
  id: "qt11",
  question: "Which metals are critical to monitor in crude oil?",
  choices: ["Nickel", "Vanadium", "Iron", "Copper"],
  correct: [0,1],
  explanation: "Nickel and vanadium are problematic in refining. Iron and copper less so."
},
{
  id: "qt12",
  question: "Which standard defines diesel fuel specifications in Europe?",
  choices: ["ASTM D975", "EN 590", "ISO 8217", "ASTM D1655"],
  correct: [1],
  explanation: "EN 590 sets diesel specifications in Europe."
},
{
  id: "qt13",
  question: "Which are possible reasons for failed jet fuel flash point tests?",
  choices: ["Excess gasoline contamination", "Excess aromatics", "Water contamination", "Additive overdose"],
  correct: [0,3],
  explanation: "Gasoline contamination or additive overdose may lower flash point."
},
{
  id: "qt14",
  question: "Which test measures volatility of gasoline?",
  choices: ["Reid Vapor Pressure (RVP)", "Flash Point", "Freezing Point", "Density"],
  correct: [0],
  explanation: "RVP measures gasoline volatility."
},
{
  id: "qt15",
  question: "Which characteristics are tested in bunker fuels?",
  choices: ["Viscosity", "Density", "Sulfur", "Cetane number"],
  correct: [0,1,2],
  explanation: "Viscosity, density, and sulfur are key bunker tests. Cetane is diesel."
},
{
  id: "qt16",
  question: "Which contaminants can damage refinery catalysts?",
  choices: ["Nickel", "Vanadium", "Sodium", "Calcium"],
  correct: [0,1,2,3],
  explanation: "All listed metals contaminate and deactivate catalysts."
},
{
  id: "qt17",
  question: "Which method is used to determine pour point?",
  choices: ["ASTM D97", "ASTM D86", "Karl Fischer", "Bomb calorimeter"],
  correct: [0],
  explanation: "ASTM D97 defines pour point testing."
},
{
  id: "qt18",
  question: "Which factors affect crude TAN (Total Acid Number)?",
  choices: ["Naphthenic acid content", "Water content", "Salt content", "Mercury content"],
  correct: [0],
  explanation: "TAN depends mainly on naphthenic acids."
},
{
  id: "qt19",
  question: "Which properties are important in jet fuel safety?",
  choices: ["Freezing point", "Flash point", "Sulfur", "Density"],
  correct: [0,1,3],
  explanation: "Freezing, flash, and density are safety parameters. Sulfur is environmental."
},
{
  id: "qt20",
  question: "Which units measure sulfur in fuels?",
  choices: ["ppm", "% weight", "cSt", "MJ/kg"],
  correct: [0,1],
  explanation: "Sulfur is measured in ppm or % weight."
},
{
  id: "qt21",
  question: "Which are consequences of water in jet fuel?",
  choices: ["Ice formation at altitude", "Microbial growth", "Engine knock", "Filter blockage"],
  correct: [0,1,3],
  explanation: "Water causes ice, microbes, and blockages. Engine knock is gasoline-specific."
},
{
  id: "qt22",
  question: "Which crude assay result is critical for refinery planning?",
  choices: ["Distillation yield curves", "Viscosity", "Ash content", "Flash point"],
  correct: [0],
  explanation: "Distillation curves guide refinery processing choices."
},
{
  id: "qt23",
  question: "Which analytical techniques are rapid screening methods?",
  choices: ["Infrared spectroscopy", "NMR", "Gas chromatography", "Titration"],
  correct: [0,1],
  explanation: "IR and NMR give fast screening. GC and titration are slower."
},
{
  id: "qt24",
  question: "Which is the most critical property in marine fuel stability?",
  choices: ["Compatibility", "Flash Point", "TAN", "Density"],
  correct: [0],
  explanation: "Compatibility with other fuels is critical for stability."
},
{
  id: "qt25",
  question: "Which contaminants are tested in biofuels?",
  choices: ["Methanol", "Water", "Glycerol", "Nickel"],
  correct: [0,1,2],
  explanation: "Biofuels are tested for methanol, water, and glycerol. Nickel is not relevant."	
  },
  
  {
  id: "qt26",
  question: "Which methods are commonly used to test sulfur in fuels?",
  choices: ["X-ray fluorescence (XRF)", "UV fluorescence", "Gas chromatography", "Karl Fischer"],
  correct: [0,1],
  explanation: "Sulfur is tested by XRF and UV fluorescence. Karl Fischer is for water."
},
{
  id: "qt27",
  question: "Which contaminants in crude oil can cause corrosion?",
  choices: ["Chlorides", "Hydrogen sulfide", "Mercury", "Vanadium"],
  correct: [0,1,2],
  explanation: "Chlorides, H2S, and mercury are highly corrosive. Vanadium is more catalyst poison."
},
{
  id: "qt28",
  question: "Which standard defines marine fuel quality?",
  choices: ["ISO 8217", "ASTM D975", "EN 590", "ASTM D1655"],
  correct: [0],
  explanation: "ISO 8217 defines marine fuel specifications."
},
{
  id: "qt29",
  question: "Which are critical tests for biofuels?",
  choices: ["Acid number", "Water content", "Flash point", "Sulfur content"],
  correct: [0,1,2],
  explanation: "Acid number, water, and flash point are critical. Sulfur is less relevant."
},
{
  id: "qt30",
  question: "Which method is used to measure octane number?",
  choices: ["CFR engine test", "Gas chromatography", "Bomb calorimeter", "Karl Fischer"],
  correct: [0],
  explanation: "Octane number is determined using the CFR engine method."
},
{
  id: "qt31",
  question: "Which contaminants may be introduced during storage?",
  choices: ["Water", "Rust particles", "Microorganisms", "Nitrogen"],
  correct: [0,1,2],
  explanation: "Water, rust, and microbes can contaminate during storage. Nitrogen is not typical."
},
{
  id: "qt32",
  question: "Which test measures cold flow properties of diesel?",
  choices: ["CFPP (Cold Filter Plugging Point)", "Flash point", "Cetane number", "Pour point"],
  correct: [0,3],
  explanation: "Pour point and CFPP measure cold flow properties of diesel."
},
{
  id: "qt33",
  question: "Which test determines fuel energy content?",
  choices: ["Bomb calorimeter", "Octane number", "Flash point", "RVP"],
  correct: [0],
  explanation: "Energy content is measured by bomb calorimetry."
},
{
  id: "qt34",
  question: "Which of these are ASTM standards?",
  choices: ["ASTM D86", "ASTM D97", "ISO 8217", "ASTM D975"],
  correct: [0,1,3],
  explanation: "ASTM D86, D97, and D975 are ASTM standards. ISO 8217 is ISO."
},
{
  id: "qt35",
  question: "Which tests are critical for aviation fuel safety?",
  choices: ["Flash point", "Freezing point", "Water content", "Cetane number"],
  correct: [0,1,2],
  explanation: "Flash point, freezing point, and water are critical for jet safety. Cetane is diesel."
},
{
  id: "qt36",
  question: "Which methods are used for density measurement?",
  choices: ["Hydrometer", "Oscillating U-tube", "Gas chromatography", "Refractometer"],
  correct: [0,1],
  explanation: "Density is tested by hydrometer and oscillating U-tube."
},
{
  id: "qt37",
  question: "Which contaminants are dangerous for turbines?",
  choices: ["Sodium", "Potassium", "Vanadium", "Lead"],
  correct: [0,1,2],
  explanation: "Na, K, and V can cause turbine corrosion and hot spots."
},
{
  id: "qt38",
  question: "Which property does Cetane number measure?",
  choices: ["Ignition quality of diesel", "Resistance to knocking", "Energy content", "Viscosity"],
  correct: [0],
  explanation: "Cetane measures ignition quality of diesel, opposite of Octane for gasoline."
},
{
  id: "qt39",
  question: "Which contaminants are typical in used lubricating oils?",
  choices: ["Water", "Metals", "Soot", "Sulfur"],
  correct: [0,1,2],
  explanation: "Water, metals, and soot are common in used lubes. Sulfur depends on formulation."
},
{
  id: "qt40",
  question: "Which method measures water in LPG?",
  choices: ["ASTM D2713 (freeze test)", "Karl Fischer", "Distillation", "Bomb calorimeter"],
  correct: [0],
  explanation: "ASTM D2713 freeze test is used for water in LPG."
},
{
  id: "qt41",
  question: "Which are signs of poor gasoline quality?",
  choices: ["Low octane", "High sulfur", "High benzene", "High viscosity"],
  correct: [0,1,2],
  explanation: "Low octane, sulfur, and benzene indicate poor gasoline quality."
},
{
  id: "qt42",
  question: "Which ASTM test determines flash point?",
  choices: ["ASTM D93 (Pensky-Martens)", "ASTM D97", "ASTM D86", "ASTM D445"],
  correct: [0],
  explanation: "ASTM D93 determines flash point using Pensky-Martens method."
},
{
  id: "qt43",
  question: "Which contaminants are linked to microbial growth in fuels?",
  choices: ["Water", "Oxygen", "Sulfur", "Particulates"],
  correct: [0,3],
  explanation: "Water and particulates enable microbial growth."
},
{
  id: "qt44",
  question: "Which tests define crude stability?",
  choices: ["Asphaltene stability", "Viscosity", "Density", "Sulfur"],
  correct: [0,1],
  explanation: "Asphaltene stability and viscosity are key for crude stability."
},
{
  id: "qt45",
  question: "Which standard defines unleaded gasoline specifications in the U.S.?",
  choices: ["ASTM D4814", "EN 590", "ISO 8217", "ASTM D975"],
  correct: [0],
  explanation: "ASTM D4814 specifies gasoline in the U.S."
},
{
  id: "qt46",
  question: "Which contaminants can cause black smoke emissions?",
  choices: ["Unburned carbon", "Asphaltenes", "Sulfur", "Iron"],
  correct: [0,1],
  explanation: "Carbon and asphaltenes lead to black smoke."
},
{
  id: "qt47",
  question: "Which parameters are critical in LPG quality?",
  choices: ["Vapor pressure", "Sulfur", "Water", "Cetane number"],
  correct: [0,1,2],
  explanation: "LPG specs include vapor pressure, sulfur, and water. Cetane is diesel."
},
{
  id: "qt48",
  question: "Which contaminants are monitored in natural gas?",
  choices: ["CO2", "H2S", "Water", "Methanol"],
  correct: [0,1,2],
  explanation: "Natural gas is tested for CO2, H2S, and water. Methanol may be injected, not contaminant."
},
{
  id: "qt49",
  question: "Which ASTM test measures kinematic viscosity?",
  choices: ["ASTM D445", "ASTM D93", "ASTM D86", "ASTM D97"],
  correct: [0],
  explanation: "ASTM D445 measures kinematic viscosity."
},
{
  id: "qt50",
  question: "Which contaminants are critical in aviation fuel?",
  choices: ["Water", "Particulates", "Sulfur", "Ice crystals"],
  correct: [0,1,3],
  explanation: "Water, particulates, and ice crystals must be avoided. Sulfur is less critical."
}
 ]
      },



  operations_coordination: { 
    title: "Operations & Stakeholder Coordination", 
    questions: [] 
  }
};

    // ---------------------------
    // Unlock logic
    // ---------------------------
 function isThemeUnlocked(theme) {
  const order = Object.keys(quizData);
  const N = order.length;
  if (N === 0) return false;
  // le premier th√®me est toujours dispo
  if (theme === order[0]) return true;

  // date de d√©but pour le d√©blocage mensuel (ajuste si tu veux)
  const start = new Date(2026, 0, 1); // 1 Jan 2026
  const now = new Date();
  const monthDiff = (now.getFullYear() - start.getFullYear()) * 12 + (now.getMonth() - start.getMonth());
  // monthlyMaxIndex = index maximum d√©bloquable par la r√®gle "1 th√®me par mois" (0 = only first)
  const monthlyMaxIndex = Math.max(0, Math.min(N - 1, monthDiff));

  // Construire s√©quentiellement l'indice maximal d√©bloqu√© (pr√©fixe contigu)
  // unlockedIndex = index le plus √©lev√© (>=0) qui est d√©verrouill√© (0 = premier)
  let unlockedIndex = 0;
  for (let k = 1; k < N; k++) {
    const prevTheme = order[k - 1];

    const totalPrev = quizData[prevTheme]?.questions?.length || 0;
    const solvedPrev = getSolvedCount(prevTheme) || 0;

    // On consid√®re "compl√©t√©" seulement si il y a des questions ET que toutes sont r√©solues
    const prevCompleted = (totalPrev > 0) && (solvedPrev === totalPrev);

    // D√©blocage par date : si l'index k est <= monthlyMaxIndex
    const allowedByDate = k <= monthlyMaxIndex;

    // Si le th√®me pr√©c√©dent est compl√©t√© OU la date permet d'atteindre cet index,
    // alors k devient d√©verrouill√©. Sinon on stoppe (assure pr√©fixe contigu).
    if (prevCompleted || allowedByDate) {
      unlockedIndex = k;
    } else {
      break;
    }
  }

  const themeIdx = order.indexOf(theme);
  return themeIdx <= unlockedIndex;
}
    // ---------------------------
    // UI / Themes grid
    // ---------------------------
    function renderThemesGrid() {
      const grid = document.querySelector(".themes");
      if (!grid) return;
      grid.innerHTML = "";

      const icons = {
  cargo_docs: "https://img.icons8.com/fluency/96/document.png",
  crude_types_specs: "https://img.icons8.com/?size=96&id=18348&format=png",
  refined_products: "https://img.icons8.com/color/96/gas-station.png",
  trading_market: "https://img.icons8.com/color/96/combo-chart.png",
  pricing_contracts: "https://img.icons8.com/color/96/contract.png",
  logistics_shipping: "https://img.icons8.com/color/96/cargo-ship.png",
  insurance_risk: "https://img.icons8.com/color/96/shield.png",
  refining_blending: "https://img.icons8.com/color/96/factory.png",
  specialty_products: "https://img.icons8.com/color/96/laboratory.png",
  regulations_compliance: "https://img.icons8.com/color/96/law.png",
  quality_testing: "https://img.icons8.com/color/96/test-tube.png",
  operations_coordination: "https://img.icons8.com/color/96/teamwork.png"
};

      Object.keys(quizData).forEach(t => {
        const unlocked = isThemeUnlocked(t);
        const total = quizData[t].questions.length;
        const solved = getSolvedCount(t);
        const pct = total ? Math.round((solved / total) * 100) : 0;
        const icon = unlocked ? (icons[t] || icons['cargo_docs']) : "https://img.icons8.com/ios-filled/96/lock.png";

        const div = document.createElement("div");
        div.className = "theme-button";
        div.innerHTML = `
          <img src="${icon}" alt="${quizData[t].title}"/><br>
          ${quizData[t].title}
          <div class="progress-mini" style="margin-top:10px;width:100%;">
            <div class="progress-mini-fill" style="width:${pct}%"></div>
          </div>
          <div class="mini-row" style="width:100%;">
            <span style="font-size:12px">${solved}/${total || 0} solved</span>
            <span style="font-size:12px">${pct}%</span>
          </div>
        `;

        if (unlocked) div.onclick = () => startQuiz(t);
        else {
          div.style.opacity = "0.55";
          div.style.cursor = "not-allowed";
          // tooltip simple
          div.title = "Th√®me verrouill√© ‚Äî se d√©bloque progressivement √† partir de Jan 2026";
        }
        grid.appendChild(div);
      });
    }

    // ---------------------------
/* ========= State ========= */
  let currentTheme = "";
  let questionIndex = 0;
  let selectedSet = [];
  let score = 0;
  let answersHistory = {}; // { [qIndex]: { selected:number[], isCorrect:boolean, explanation:string, id?:string } }
  let currentUser = null;
let timerInterval = null;
let timeLeft = 25;

  /* ========= Login ========= */
  
async function login() {
    const email = document.getElementById("emailInput").value.trim().toLowerCase();
    const password = document.getElementById("passwordInput").value.trim();

    if (!email || !email.includes("@")) {
        alert("Please enter a valid email");
        return;
    }
    if (!password) {
        alert("Please enter your ID");
        return;
    }

    // === V√©rifier si c'est l'admin ===
    if (email === "admin@quiz.com" && password === "admin123") {
        currentUser = "admin";
        document.getElementById("login-container").style.display = "none";
        document.getElementById("admin-panel").style.display = "block";
        renderUserList();
        return;
    }

    // === V√©rification via Flow Login ===
    try {
        const res = await fetch(flowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, id: password })
        });
        const text = await res.text();
        console.log("Login Flow response:", text);

        if (text.includes("Login r√©ussi")) {
            // ‚úÖ Login ok
            currentUser = email;
            localStorage.setItem("quizUser", currentUser);
            document.getElementById("login-container").style.display = "none";
            document.getElementById("theme-selection").style.display = "block";
			
			    // üîπ Afficher/recharger la barre globale
    const overallContainer = document.getElementById("overallProgressContainer");
    if (overallContainer) overallContainer.style.display = "block";

            renderThemesGrid();
            loadProgressOverview();
			

            document.getElementById("challenge-section").style.display = "block";
            document.getElementById("my-challenges").style.display = "block";
            await loadMyChallenges(email); // <-- passer l'email ici ‚úÖ
			await loadProgressFromCloud();
			updateOverallProgressBar();      // mettre √† jour la barre globale

        } else {
            // ‚ö° Si login √©choue, v√©rifier si on a un user temporaire stock√©
            const tempUser = JSON.parse(localStorage.getItem("tempUser") || "null");
            if (tempUser && tempUser.email === email && tempUser.id === password) {
                currentUser = email;
                localStorage.setItem("quizUser", currentUser);
                document.getElementById("login-container").style.display = "none";
                document.getElementById("theme-selection").style.display = "block";
                renderThemesGrid();
                loadProgressOverview();

                document.getElementById("challenge-section").style.display = "block";
                document.getElementById("my-challenges").style.display = "block";
                await loadMyChallenges(email); // <-- passer l'email ici aussi ‚úÖ
            } else {
                alert("‚ùå Email ou ID incorrect. If first connexion, please subscribe.");
            }
        }
    } catch (err) {
        console.error("‚ùå Login error:", err);
        alert("‚ùå Unable to login. Please check your connection or try later.");
    }
}

function logout() {
  // üî¥ Stop le timer en cours
  stopTimer();

  // üî¥ R√©initialise l'affichage du timer
  const timerEl = document.getElementById("timer");
  if (timerEl) timerEl.textContent = "";

// üî¥ R√©initialiser la barre globale
const overallContainer = document.getElementById("overallProgressContainer");
if (overallContainer) {
    overallContainer.style.display = "none"; // on cache le conteneur complet
    const overallFill = document.getElementById("overallProgressFill");
    if (overallFill) {
        overallFill.style.width = "0%";
        overallFill.textContent = "";
    }
}

  try { localStorage.removeItem("quizUser"); } catch(e) {}
  currentUser = null;
  document.getElementById("theme-selection").style.display = "none";
  document.getElementById("quiz-container").style.display = "none";
  document.getElementById("admin-panel").style.display = "none";
  document.getElementById("challenge-section").style.display = "none";
  document.getElementById("login-container").style.display = "block";
  document.getElementById("my-challenges").style.display = "none";
}

window.addEventListener("DOMContentLoaded", async () => { // <-- rendre async pour pouvoir await
    let saved = null;
    try { saved = localStorage.getItem("quizUser"); } catch(e) {}
    if (saved) {
      currentUser = saved;
      document.getElementById("login-container").style.display = "none";
      document.getElementById("theme-selection").style.display = "block";
      
      renderThemesGrid();
      loadProgressOverview();

      // üîπ Afficher la barre globale
      const overallContainer = document.getElementById("overallProgressContainer");
      if (overallContainer) overallContainer.style.display = "block";

      // üîπ Charger la progression depuis le cloud
      await loadProgressFromCloud();  // ‚úÖ √ßa mettra √† jour la barre et les th√®mes

      updateOverallProgressBar();      // üîπ mettre √† jour la barre globale apr√®s cloud

      document.getElementById("challenge-section").style.display = "block";
      document.getElementById("my-challenges").style.display = "block";
      await loadMyChallenges(currentUser); // <-- passer l'email explicitement
    }
});

  /* ========= Persistent progress (unique solved) ========= */
  function getUserProgress() {
    try {
      return JSON.parse(localStorage.getItem("progress_" + currentUser) || "{}");
    } catch(e) { return {}; }
  }
  function setUserProgress(data) {
    try {
      localStorage.setItem("progress_" + currentUser, JSON.stringify(data));
    } catch(e) {}
  }
  
// üîπ Fonction pour nettoyer et pr√©parer le payload avant envoi
function prepareProgressPayload(progress, email) {
    const cleanedProgress = {};

    for (const [theme, data] of Object.entries(progress)) {
        if (!theme) continue; // Ignorer les cl√©s vides
        cleanedProgress[theme] = {
            solved: data.solved.map(String) // Convertir tous les IDs en string
        };
    }

    return {
        Email: email,
        Progress: cleanedProgress
    };
}

function syncProgressToCloud(progressData, email) {
    if (!progressData || !email) return;

    // üîπ On transforme la progression pour le Flow
    Object.keys(progressData).forEach(theme => {
        if (!theme || !progressData[theme]?.solved) return;

        const payload = {
            Email: email,
            Theme: theme,                     // obligatoire
            SolvedIds: progressData[theme].solved.map(id => id.toString()), // obligatoire
            IP: getUserIP() || "0.0.0.0"      // optionnel
        };

        console.log("üì§ Sync payload:", payload);

        fetch("https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com/powerautomate/automations/direct/workflows/e23e3c436c3145bebd18206e4b7e55eb/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=CffamMjMGSTdVPz_ZJ8QOQOI8W_C0I1lBKutiMjQa84", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        })
        .then(res => {
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            return res.json();
        })
        .then(() => console.log("‚úÖ Donn√©es envoy√©es au Flow avec succ√®s"))
        .catch(err => console.error("‚ùå Error syncing progress:", err));
    });
}

function updateOverallProgressBar() {
  const progress = getUserProgress();
  let totalQuestions = 0;
  let totalSolved = 0;

  for (const theme of Object.keys(quizData)) {
    const themeTotal = quizData[theme].questions.length || 0;
    const themeSolved = progress[theme]?.solved?.length || 0;

    totalQuestions += themeTotal;
    totalSolved += themeSolved;
  }

  const percent = totalQuestions ? Math.round((totalSolved / totalQuestions) * 100) : 0;
  const fill = document.getElementById("overallProgressFill");

  if (fill) {
    fill.style.width = percent + "%";
    fill.textContent = percent + "% overall completed";
  }
}

// üîπ R√©cup√®re la progression stock√©e dans Power Automate
async function loadProgressFromCloud() {
  if (!currentUser) return;

  try {
    const res = await fetch(GET_PROGRESS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ Email: currentUser })
    });

    const data = await res.json();
    console.log("üì¶ R√©ponse compl√®te du Flow :", data);

    // üß© Extraire correctement la partie utile
    const progressBody = data?.progress?.body || [];
    const normalized = {};

    for (const entry of progressBody) {
      // Chaque entr√©e ressemble √† { refined_products: [...] }
      const theme = Object.keys(entry)[0];
      const solvedArray = entry[theme];

      if (theme && Array.isArray(solvedArray)) {
        normalized[theme] = { solved: solvedArray.map(String) };
      }
    }

    console.log("‚òÅÔ∏è Progress loaded from cloud (normalized):", normalized);

    // ‚úÖ Enregistre la progression normalis√©e
    setUserProgress(normalized);

    // üîÑ Met √† jour l‚ÄôUI
    renderThemesGrid();
    loadProgressOverview();
    updateTopProgressBar();
	updateOverallProgressBar();

  } catch (err) {
    console.error("‚ùå Erreur lors du chargement de la progression :", err);
  }
}


 function markQuestionAsSolved(theme, qid) {
    if (!qid || !currentTheme) return;

    const data = getUserProgress();
    if (!data[theme]) data[theme] = { solved: [] };
    if (!Array.isArray(data[theme].solved)) data[theme].solved = [];

    // ‚úÖ Ajouter uniquement si la question n‚Äôest pas d√©j√† pr√©sente
    if (!data[theme].solved.includes(qid)) {
        data[theme].solved.push(qid);

        // ‚úÖ S'assurer de ne pas d√©passer le total de questions du th√®me
        const total = quizData[theme]?.questions.length || 0;
        if (data[theme].solved.length > total) {
            data[theme].solved = data[theme].solved.slice(0, total);
        }

        setUserProgress(data);
    syncProgressToCloud(data, currentUser); // ‚úÖ ajout des bons params
		updateTopProgressBar();  // üîÑ Actualise barre en haut
		loadProgressOverview();  // üîÑ Et met √† jour la liste compl√®te
		updateOverallProgressBar();
    }
}
  function getSolvedCount(theme) {
    const data = getUserProgress();
    return data[theme]?.solved?.length || 0;
  }


  /* ========= Progress overview (cards list) ========= */
  function loadProgressOverview() {
    const overview = document.getElementById("progress-overview");
    if (!overview) return;
    const themes = Object.keys(quizData);

    let html = '<h3 style="text-align:center;margin-top:24px;">Your Progress</h3>';
    html += themes.map(t => {
      const total = quizData[t].questions.length;
      const solved = getSolvedCount(t);
      const pct = total ? Math.round((solved / total) * 100) : 0;
      return `
        <div class="progress-card">
          <div style="font-weight:700;">${quizData[t].title}</div>
          <div class="progress-mini">
            <div class="progress-mini-fill" style="width:${pct}%;"></div>
          </div>
          <div class="mini-row">
            <span>${solved}/${total || 0} solved</span>
            <span>${pct}%</span>
          </div>
        </div>`;
    }).join("");

    overview.innerHTML = html;
  }

  /* ========= Listes of users ========= */
  
function renderUserList() {
  let users = {};
  try { users = JSON.parse(localStorage.getItem("quizUsers") || "{}"); } catch(e) {}

  const userListDiv = document.getElementById("user-list");
  userListDiv.innerHTML = "";

  const emails = Object.keys(users);
  if (emails.length === 0) {
    userListDiv.innerHTML = "<p>No registered users yet.</p>";
    return;
  }

  emails.forEach(email => {
    if (email === "admin@quiz.com") return; // on ne liste pas l‚Äôadmin
    const btn = document.createElement("button");
    btn.textContent = email;
    btn.style.display = "block";
    btn.style.margin = "6px auto";
    btn.style.padding = "8px 12px";
    btn.style.borderRadius = "8px";
    btn.style.border = "1px solid #ccc";
    btn.onclick = () => showUserProgress(email);
    userListDiv.appendChild(btn);
  });
}

function showUserProgress(email) {
  const container = document.getElementById("user-progress");

  let data = {};
  try { data = JSON.parse(localStorage.getItem("progress_" + email) || "{}"); } catch(e) {}

  let html = `<h3>üìä Progress for ${email}</h3>`;

  const themes = Object.keys(quizData);
  if (themes.length === 0) {
    html += "<p>No themes available.</p>";
  } else {
    html += themes.map(t => {
      const total = quizData[t].questions.length;
      const solved = data[t]?.solved?.length || 0;
      const pct = total ? Math.round((solved / total) * 100) : 0;
      return `
        <div class="progress-card">
          <div style="font-weight:700;">${quizData[t].title}</div>
          <div class="progress-mini">
            <div class="progress-mini-fill" style="width:${pct}%;"></div>
          </div>
          <div class="mini-row">
            <span>${solved}/${total || 0} solved</span>
            <span>${pct}%</span>
          </div>
        </div>`;
    }).join("");
  }

  container.innerHTML = html;
}

  /* ========= Email et ID ========= */

async function signup() {
    const email = document.getElementById("signupEmail").value.trim().toLowerCase();
    const id = document.getElementById("signupID").value.trim();

    if (!email || !email.includes("@") || !id) {
        alert("‚ùå Please enter a valid email and ID.");
        return;
    }


try {
        const res = await fetch(flowUrlSignup, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, id })
        });

        const data = await res.json();
        console.log("Signup Flow response:", data);

        if (data?.status === 200 || data?.status === 400) {
            // ‚úÖ Stockage imm√©diat local pour login instantan√©
            localStorage.setItem("tempUser", JSON.stringify({ email, id }));
            alert("‚úÖ " + data.message);
            showLogin();
        } else {
            alert("‚ùå Technical error during signup. Please try again later.");
        }
    } catch (err) {
        console.error("‚ùå Signup error:", err);
        alert("‚ùå Technical error during signup. Please try again later.");
    }
}

// === Mot de passe oubli√© ===

// Afficher/cacher le formulaire "Mot de passe oubli√©"
document.getElementById("forgotID").onclick = () => {
    const form = document.getElementById("forgotIDForm");
    form.style.display = form.style.display === "none" ? "block" : "none";
}

  document.getElementById("sendID").onclick = () => {
    const email = document.getElementById("forgotEmail").value.trim().toLowerCase();
    if(!email || !email.includes("@")) { 
      alert("Enter a valid email"); 
      return; 
    }

    fetch("https://default329e91b0e21f48fba071456717ecc2.8e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/458482932c2546798bc331d62bcd9579/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=OacmhYAvpw_QjrCTJvpr0T-2Rgp2PBbR5HbxS5NVm3c", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    })
    .then(res => {
      if(res.status === 200) alert("‚úÖ Email sent successfully!");
      else if(res.status === 400) alert("‚ùå Email does not exist");
      else alert("‚ùå Error: " + res.status);
    })
    .catch(err => console.error("‚ùå Fetch error:", err));
  }



// üîπ Variable globale pour savoir si on est en mode d√©fi
let isChallengeSession = false;

// =======================
// START QUIZ
// =======================

function smartShuffle(theme) {
    if (!quizData[theme]?.questions) return [];

    const allQuestions = [...quizData[theme].questions];
    const solvedIds = getUserProgress()[theme]?.solved || [];

    // S√©parer questions r√©solues et non r√©solues
    const unsolved = allQuestions.filter(q => !solvedIds.includes(q.id));
    const solved = allQuestions.filter(q => solvedIds.includes(q.id));

    // M√©langer chacune des deux listes
    const shuffledUnsolved = shuffle(unsolved);
    const shuffledSolved = shuffle(solved);

    // Priorit√© aux non-r√©solues
    const combined = [...shuffledUnsolved, ...shuffledSolved];

    // On limite √† 10 questions max
    return combined.slice(0, Math.min(10, combined.length));
}

function startQuiz(input, challengeMode = false, theme = null, challenge = null) {
    isChallengeSession = challengeMode; // ‚úÖ active/d√©sactive mode d√©fi

    let questions;
    if (challengeMode) {
        // input = tableau de questions pour le d√©fi
        questions = input;
        currentTheme = theme;
    } else {
        // quiz normal par th√®me
        currentTheme = input;
        questions = quizData[input]?.questions.slice();
    }

    if (!questions || questions.length === 0) {
        document.getElementById("theme-selection").style.display = "none";
        document.getElementById("quiz-container").style.display = "block";
        document.getElementById("theme-title").textContent = "Theme: " + (challengeMode ? theme : quizData[input].title);
        document.getElementById("question").textContent = "‚ö†Ô∏è No questions available for this theme.";
        document.getElementById("choices").innerHTML = "";
        document.getElementById("result").textContent = "";
        document.getElementById("explanation").textContent = "";
        document.getElementById("prevBtn").style.display = "none";
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("backBtn").style.display = "inline-block";
        if (!challengeMode) document.getElementById("challenge-section").style.display = "block";
        return;
    }

  // Initialisation session
selectedSet = smartShuffle(currentTheme);
questionIndex = 0;
score = 0;
answersHistory = {};

    // Affichage UI
    document.getElementById("theme-selection").style.display = "none";
    document.getElementById("quiz-container").style.display = "block";
    if (challengeMode) document.getElementById("challenge-section").style.display = "none";
    document.getElementById("theme-title").textContent = "Theme: " + (challengeMode ? theme : quizData[input].title);

    updateScoreLine();
    updateTopProgressBar();
    showQuestion();

    // Gestion d√©fi : pr√©paration envoi score √† la fin
    if (challengeMode && challenge) {
window.onChallengeFinished = async function(finalScore) {
    if (currentUser === challenge.opponent) {
        challenge.opponentScore = finalScore;
    } else if (currentUser === challenge.challenger) {
        challenge.challengerScore = finalScore;
    }

    console.log("Envoi score d√©fi au Flow :", challenge);

    // 1Ô∏è‚É£ Envoi du score au Flow principal (inchang√©)
    try {
        const payload = {
            ID: challenge.ID,
            challengerScore: challenge.challengerScore ?? null,
            opponentScore: challenge.opponentScore ?? null,
            status: challenge.status || "accepted"
        };

        console.log("üì§ Envoi score au Flow :", payload);

        const res = await fetch(updateChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
        console.log("‚úÖ Score envoy√© au Flow !");
    } catch (err) {
        console.error("‚ùå Erreur lors de l‚Äôenvoi du score :", err);
    }

    // 2Ô∏è‚É£ Met √† jour la colonne Done correspondante (NOUVEAUT√â)
    try {
      const isChallenger = (currentUser === challenge.challenger);
const donePayload = {
    ID: challenge.ID,
    currentUser: currentUser,
    role: isChallenger ? "challenger" : "opponent"
};

        console.log("‚öôÔ∏è Envoi du Done au Flow :", donePayload);

        const doneRes = await fetch(updateChallengeDoneFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(donePayload)
        });

        if (!doneRes.ok) throw new Error(`Erreur HTTP ${doneRes.status}`);
        console.log("‚úÖ Colonne Done mise √† jour dans Excel !");
    } catch (err) {
        console.error("‚ùå Erreur lors de la mise √† jour du Done :", err);
    }

    // 3Ô∏è‚É£ Si les deux ont jou√© ‚Üí checkWinner
    if (challenge.challengerScore != null && challenge.opponentScore != null) {
        checkWinner(challenge);
    }

    // 4Ô∏è‚É£ Nettoyage pour √©viter doublons
    window.onChallengeFinished = null;
};
    }
}


  function updateScoreLine() {
  const totalQ = selectedSet.length || 1; // √©viter division par 0
  const displayScore = Math.min(score, totalQ); // jamais sup√©rieur au total
  document.getElementById("scoreLine").textContent =
      `Question ${questionIndex + 1} / ${totalQ} ‚Ä¢ Score: ${displayScore}`;
}

// =======================
// UPDATE TOP PROGRESS BAR
// =======================
function updateTopProgressBar() {
    if (!currentTheme || isChallengeSession) return; // ignore si mode d√©fi

    // üîÑ Recharge √† jour
    const freshData = getUserProgress();
	
    const total = quizData[currentTheme].questions.length || 1; // √©viter div/0
    let solved = getSolvedCount(currentTheme);

    if (solved > total) solved = total;

    const percent = Math.round((solved / total) * 100);
    const fill = document.getElementById("progressFill");
    if (fill) {
        fill.style.width = percent + "%";
        fill.textContent = percent + "%";
    }

    if (percent === 100) {
        renderThemesGrid();
        loadProgressOverview();
    }
}

 function showQuestion() {
  const q = selectedSet[questionIndex];
  const choicesDiv = document.getElementById("choices");
  if (!q) {
    document.getElementById("question").textContent = "‚ö†Ô∏è Question not found!";
    choicesDiv.innerHTML = "";
    document.getElementById("result").textContent = "";
    document.getElementById("explanation").textContent = "";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("prevBtn").style.display = "none";
    return;
  }

  document.getElementById("question").textContent = q.question;
  choicesDiv.innerHTML = "";
  document.getElementById("result").textContent = "";
  document.getElementById("explanation").textContent = "";
  document.getElementById("nextBtn").style.display = "none";
  document.getElementById("prevBtn").style.display = questionIndex > 0 ? "inline-block" : "none";
  document.getElementById("backBtn").style.display = "none";

  const multiple = Array.isArray(q.correct);
  q.choices.forEach((choice, idx) => {
    const wrapper = document.createElement("label");
    wrapper.className = "choice";
    const input = document.createElement("input");
    input.type = multiple ? "checkbox" : "radio";
    input.name = "answer";
    input.value = idx;
    const text = document.createElement("span");
    text.textContent = choice;
    wrapper.appendChild(input);
    wrapper.appendChild(text);
    choicesDiv.appendChild(wrapper);
  });

  const checkBtn = document.createElement("button");
  checkBtn.textContent = "Submit Answer";
  checkBtn.className = "submit-btn";
  checkBtn.onclick = () => { stopTimer(); checkAnswer(); };
  choicesDiv.appendChild(checkBtn);

  if (answersHistory[questionIndex]) {
    restoreAnswerState();
    stopTimer();
    document.getElementById("timer").textContent = "";
  } else {
    startTimer();
  }

  updateScoreLine();
  updateTopProgressBar();
}

function startTimer() {
  stopTimer(); // √©viter un double timer
  timeLeft = 25;
  document.getElementById("timer").textContent = `‚è≥ Time left: ${timeLeft}s`;

  timerInterval = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = `‚è≥ Time left: ${timeLeft}s`;

    if (timeLeft <= 0) {
      stopTimer();
      autoFail();
    }
  }, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function autoFail() {
  const q = selectedSet[questionIndex];
  const wrappers = document.querySelectorAll(".choice");
  const inputs = document.querySelectorAll("input[name='answer']");
  inputs.forEach(el => el.disabled = true);

  // marquer la bonne r√©ponse en vert
  if (!Array.isArray(q.correct)) {
    wrappers.forEach((wrapper, i) => {
      if (i === q.correct) wrapper.classList.add("correct");
    });
  } else {
    wrappers.forEach((wrapper, i) => {
      if (q.correct.includes(i)) wrapper.classList.add("correct");
    });
  }

document.getElementById("nextBtn").style.display = "inline-block";

  // afficher mauvais r√©sultat
  const answerTxt = Array.isArray(q.correct)
    ? q.correct.map(i => q.choices[i]).join(", ")
    : q.choices[q.correct];
  document.getElementById("result").textContent = "‚è∞ Time's up! Correct: " + answerTxt;
  document.getElementById("result").style.color = "red";
  document.getElementById("explanation").textContent = q.explanation || "";

  answersHistory[questionIndex] = { selected: [], isCorrect: false, explanation: q.explanation, id: q.id };

  // envoyer comme incorrect
  sendAnswerToFlow(q, [], false);

  // afficher bouton Next
  document.getElementById("nextBtn").style.display = "inline-block";
}

function checkAnswer() {
  const q = selectedSet[questionIndex];
  const wrappers = document.querySelectorAll(".choice");
  const inputs = document.querySelectorAll("input[name='answer']");
  
  // R√©cup√©rer les r√©ponses s√©lectionn√©es
  let selected = Array.from(inputs)
    .filter(el => el.checked)
    .map(el => parseInt(el.value));

  if (selected.length === 0) { 
    alert("Select an answer"); 
    return; 
  }

  // Bloquer les inputs
  inputs.forEach(el => el.disabled = true);

  // V√©rifier la r√©ponse
  let isCorrect = false;
  if (!Array.isArray(q.correct)) {
    wrappers.forEach((wrapper, i) => {
      if (i === q.correct) wrapper.classList.add("correct");
      else if (selected.includes(i)) wrapper.classList.add("wrong");
    });
    if (selected.length === 1 && selected[0] === q.correct) isCorrect = true;
  } else {
    const correctSorted = [...q.correct].sort((a,b)=>a-b);
    const selectedSorted = [...selected].sort((a,b)=>a-b);
    wrappers.forEach((wrapper, i) => {
      if (q.correct.includes(i)) wrapper.classList.add("correct");
      else if (selected.includes(i)) wrapper.classList.add("wrong");
    });
    if (JSON.stringify(selectedSorted) === JSON.stringify(correctSorted)) isCorrect = true;
  }

  // Affichage r√©sultat
  if (isCorrect) {
    score++;
    document.getElementById("result").textContent = "‚úÖ Correct!";
    document.getElementById("result").style.color = "green";
  } else {
    const answerTxt = Array.isArray(q.correct)
      ? q.correct.map(i => q.choices[i]).join(", ")
      : q.choices[q.correct];
    document.getElementById("result").textContent = "‚ùå Wrong. Correct: " + answerTxt;
    document.getElementById("result").style.color = "red";
  }

  document.getElementById("explanation").textContent = q.explanation || "";

  // M√©morise l'√©tat dans la session
  answersHistory[questionIndex] = { selected, isCorrect, explanation: q.explanation, id: q.id };

  // ‚úÖ Envoi imm√©diat au Flow
  sendAnswerToFlow(q, selected, isCorrect);

  // Toujours r√©v√©ler le bouton Next
  const nb = document.getElementById("nextBtn");
  if (nb) nb.style.display = "inline-block";

  // Mettre √† jour le score affich√©
  updateScoreLine();
}

 stopTimer(); // ‚è±Ô∏è stoppe et r√©cup√®re le temps de cette question
 
/* ========= Fonction pour envoyer au Flow avec debug ========= */
function sendAnswerToFlow(q, selected, isCorrect) {
  if (!currentUser || !currentTheme) return;

  const selectedAnswers = Array.isArray(selected)
    ? selected.map(i => q.choices[i]).join(", ")
    : q.choices[selected];

  const payload = {
    email: currentUser,
    IP: getUserIP(),           // tu peux remplacer par navigator.userAgent ou vrai IP si dispo
    Theme: currentTheme,
    question: q.question,
    reponse: selectedAnswers,
    resultat: isCorrect ? "Correct" : "Incorrect"
  };

  console.log("üì§ Payload envoy√© au Flow:", payload); // debug JSON

  fetch(flow, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(res => {
    if (res.status === 202 || res.status === 200) {
      console.log("‚úÖ Donn√©es envoy√©es au Flow avec succ√®s");
    } else {
      console.error("‚ùå Erreur Flow:", res.status, res.statusText);
    }
  })
  .catch(err => console.error("‚ùå Erreur fetch:", err));
}
	

  function restoreAnswerState() {
    const q = selectedSet[questionIndex];
    const saved = answersHistory[questionIndex];
    if (!saved) return;

    const wrappers = document.querySelectorAll(".choice");
    const inputs = document.querySelectorAll("input[name='answer']");
    inputs.forEach(el => {
      if (saved.selected.includes(parseInt(el.value))) el.checked = true;
      el.disabled = true;
    });

    wrappers.forEach((wrapper, i) => {
      if (Array.isArray(q.correct)) {
        if (q.correct.includes(i)) wrapper.classList.add("correct");
        else if (saved.selected.includes(i)) wrapper.classList.add("wrong");
      } else {
        if (i === q.correct) wrapper.classList.add("correct");
        else if (saved.selected.includes(i)) wrapper.classList.add("wrong");
      }
    });

    document.getElementById("result").textContent = saved.isCorrect ? "‚úÖ Correct!" : "‚ùå Wrong.";
    document.getElementById("result").style.color = saved.isCorrect ? "green" : "red";
    document.getElementById("explanation").textContent = saved.explanation || "";

    const nb = document.getElementById("nextBtn");
    if (nb) nb.style.display = "inline-block";
  }

// =======================
// COMMIT SESSION SOLVED + SYNC CLOUD
// =======================
function commitSessionSolved() {
    if (!currentTheme || isChallengeSession) return; // ignore les d√©fis

    const data = getUserProgress();
    if (!data[currentTheme]) data[currentTheme] = { solved: [] };

    const total = quizData[currentTheme]?.questions.length || 0;

    // Ajouter les bonnes r√©ponses √† la progression locale
    Object.keys(answersHistory).forEach(k => {
        const rec = answersHistory[k];
        if (rec?.isCorrect && rec?.id && !data[currentTheme].solved.includes(rec.id)) {
            data[currentTheme].solved.push(rec.id);
        }
    });

    // S'assurer de ne pas d√©passer le total
    if (data[currentTheme].solved.length > total) {
        data[currentTheme].solved = data[currentTheme].solved.slice(0, total);
    }

    // Stockage local
    setUserProgress(data);

    // üîπ Envoi imm√©diat vers Power Automate avec nettoyage
    syncProgressToCloud(data, currentUser);
}


 // =======================
// NEXT QUESTION
// =======================
function nextQuestion() {
    if (questionIndex < selectedSet.length - 1) {
        questionIndex++;
        showQuestion();
    } else {
        // Fin de session
        commitSessionSolved();          // marquer les bonnes r√©ponses (ignore si d√©fi)
        updateTopProgressBar();         // mise √† jour barre de progression (ignore si d√©fi)
        renderThemesGrid();             // mise √† jour grille accueil
        loadProgressOverview();         // mise √† jour cartes progress
		updateOverallProgressBar();
		
        document.getElementById("question").textContent = "üéâ Quiz completed!";
        document.getElementById("choices").innerHTML = "";
        document.getElementById("result").textContent = `Final Score: ${score}/${selectedSet.length}`;
        document.getElementById("explanation").textContent = "";
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("prevBtn").style.display = "inline-block";
        document.getElementById("backBtn").style.display = "inline-block";

        // ‚úÖ Si c‚Äôest un d√©fi, envoyer le score au Flow
        finishChallengeIfNeeded();

        // retour menu automatique apr√®s 1s
        setTimeout(() => { goBack(); }, 1000);
    }
}


  function prevQuestion() {
    if (questionIndex > 0) {
      questionIndex--;
      showQuestion();
    }
  }

  function goBack() {
    document.getElementById("quiz-container").style.display = "none";
    document.getElementById("theme-selection").style.display = "block";
    renderThemesGrid();
    loadProgressOverview();

document.getElementById("challenge-section").style.display = "block";

    // stop timer et reset affichage
    stopTimer();
    const timerEl = document.getElementById("timer");
    if (timerEl) timerEl.textContent = "";

    // reset barre visuelle de l‚ÄôUI du quiz (facultatif)
    const fill = document.getElementById("progressFill");
    if (fill) { fill.style.width = "0%"; fill.textContent = "0%"; }
}
  
 function sendTestRow() {
  fetch(flowUrl, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
  Email: "test@example.com",
  IP: "127.0.0.1",
  Theme: "TestTheme",
  Question: "Test question",
  Reponse: "Test answer",
  Resultat: "Correct"
})
  })
  .then(res => alert("Test row sent! Status " + res.status))
  .catch(err => console.error("‚ùå Flow error", err));
}

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("‚úÖ Service Worker registered"))
    .catch(err => console.error("‚ùå Service Worker error", err));
}

// ‚ö° Remplir la liste d√©roulante des emails depuis Flow
async function loadAllEmails() {
  if (!getAllUsersFlowUrl) {
    console.error("getAllUsersFlowUrl n'est pas d√©fini.");
    return;
  }

  try {
    const res = await fetch(getAllUsersFlowUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    });

    if (!res.ok) throw new Error("Erreur HTTP " + res.status);

    const raw = await res.json();
    console.log("üì• R√©ponse Flow getAllUsers (parsed) :", raw);

    const dataArray = Array.isArray(raw.body) ? raw.body : raw;
    const list = dataArray.map(item => item.email).filter(Boolean);

    const emailSelect = document.getElementById("opponentEmail");
    if (!emailSelect) {
      console.warn("Element #opponentEmail introuvable dans le DOM.");
      return;
    }

    emailSelect.innerHTML = "";

    // placeholder
    const placeholder = document.createElement("option");
    placeholder.value = "";
    placeholder.textContent = "Choisir un joueur...";
    emailSelect.appendChild(placeholder);

    // remplir la liste
    list.forEach(email => {
      if (email.toLowerCase() === (currentUser || "").toLowerCase()) return;
      const option = document.createElement("option");
      option.value = email;
      option.textContent = email;
      emailSelect.appendChild(option);
    });

    console.log(`‚úÖ ${emailSelect.options.length - 1} emails charg√©s dans la liste.`);
  } catch (err) {
    console.error("‚ùå Impossible de charger la liste des emails :", err);
  }
}


// ‚ö° Remplir la liste d√©roulante des th√®mes
function loadAllThemes() {
    const themeSelect = document.getElementById("challengeTheme");
    themeSelect.innerHTML = ""; // reset

    Object.keys(quizData).forEach(t => {
        const option = document.createElement("option");
        option.value = t;
        option.textContent = quizData[t].title || t;
        themeSelect.appendChild(option);
    });
}

// Added for challenge
// === Challenge ===

// Affiche/cacher le formulaire de d√©fi
document.getElementById("showChallengeBtn").onclick = () => {
    const form = document.getElementById("challenge-form");
    form.style.display = form.style.display === "none" ? "block" : "none";

    // üîπ Charger dynamiquement les emails et th√®mes
    loadAllEmails();
    loadAllThemes();
};

// Envoyer un d√©fi
document.getElementById("sendChallengeBtn").onclick = async () => {
    const opponent = document.getElementById("opponentEmail").value.trim().toLowerCase();
    const theme = document.getElementById("challengeTheme").value;

    if (!opponent || !theme) {
        alert("‚ùå Veuillez remplir l'email et s√©lectionner un th√®me !");
        return;
    }

    // R√©cup√©rer toutes les questions du th√®me s'il y en a
    const allQuestions = quizData[theme]?.questions || [];

    // M√™me si aucune question, on cr√©e un tableau vide pour le challenge
    const picked = allQuestions.length > 0
        ? shuffle([...allQuestions])
            .slice(0, Math.min(10, allQuestions.length))
            .map(q => String(q.id)) // üîπ Conversion en string pour Flow
        : [];

    const payload = {
        challenger: currentUser,
        opponent: opponent,
        theme: theme,
        questions: picked,
        status: "pending",
        challengerScore: null,
        opponentScore: null
    };

    console.log("üì§ Challenge envoy√© :", payload);

    try {
        const res = await fetch(createChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (res.ok) {
            alert("‚úÖ D√©fi envoy√© √† " + opponent);
            document.getElementById("challenge-form").style.display = "none";
        } else {
            alert("‚ùå Erreur lors de l'envoi du d√©fi : " + res.status);
        }
    } catch (err) {
        console.error(err);
        alert("‚ùå Impossible d'envoyer le d√©fi. V√©rifiez votre connexion.");
    }
};

// Charger mes d√©fis
// Fonction pour charger les d√©fis re√ßus par l'utilisateur

// Fonction pour accepter ou refuser un d√©fi via Power Automate

function parseExcelBool(value) {
    if (value === true) return true;
    if (typeof value === "string") {
        const normalized = value.trim().toLowerCase();
        return normalized === "true" || normalized === "yes" || normalized === "1";
    }
    if (typeof value === "number") return value === 1;
    return false;
}

// üîπ Charger mes d√©fis re√ßus
async function loadMyChallenges(userEmail) {
    if (!userEmail) return;

    const challengesList = document.getElementById("challenges-list");
    if (!challengesList) {
        console.warn("loadMyChallenges: √©l√©ment #challenges-list introuvable");
        return;
    }
    challengesList.innerHTML = "";

    try {
        const response = await fetch(getChallengesFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ opponent: userEmail })
        });

        if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
        let challenges = await response.json();
	
console.log("üì• Donn√©es brutes re√ßues du Flow (MyChallenges):", challenges);

        // üîπ Conversion et nettoyage
        challenges = (challenges || []).map(c => ({
            ...c,
            challengerScore: c.challengerScore ? Number(c.challengerScore) : null,
            opponentScore: c.opponentScore ? Number(c.opponentScore) : null,
challengerDone: parseExcelBool(c.challengerDone),
opponentDone: parseExcelBool(c.opponentDone),
            status: (c.status || "pending").toLowerCase(),
        }));

        console.log("üìã D√©fis re√ßus apr√®s conversion :", challenges.map(c => ({
            ID: c.ID,
            status: c.status,
            challengerDone: c.challengerDone,
            opponentDone: c.opponentDone
        })));

        // üîπ Filtrage robuste : ne montrer que pending ET non encore jou√©s par l'utilisateur
        const visible = challenges.filter(c =>
            c.status === "pending" &&
            (
                (c.opponent === userEmail && !c.opponentDone) ||
                (c.challenger === userEmail && !c.challengerDone)
            )
        );

        console.log("üîé D√©fis visibles pour l'utilisateur :", visible);

        if (visible.length === 0) {
            challengesList.innerHTML = "<p>Aucun d√©fi re√ßu pour le moment.</p>";
            return;
        }

        visible.forEach(challenge => {
            const div = document.createElement("div");
            div.className = "challenge-item";
            div.style.border = "1px solid #ccc";
            div.style.padding = "10px";
            div.style.marginBottom = "10px";

            const info = document.createElement("p");
            info.textContent = `De: ${challenge.challenger} | Th√®me: ${challenge.theme}`;
            div.appendChild(info);

            const acceptBtn = document.createElement("button");
            acceptBtn.textContent = "Accepter";
            acceptBtn.style.marginRight = "5px";
            acceptBtn.onclick = async () => {
                const qArray = Array.isArray(challenge.questions) ? challenge.questions : JSON.parse(challenge.questions || "[]");
                const success = await respondToChallenge(challenge.ID, "accepted");
                if (success) {
                    div.remove();
                    const qSet = qArray.map(qid => quizData[challenge.theme]?.questions.find(q => q.id === qid)).filter(q => q);
                    if (qSet.length === 0) { alert("‚ö†Ô∏è Aucune question trouv√©e pour ce d√©fi !"); return; }
                    startQuiz(qSet, true, challenge.theme, challenge);
                }
            };

            const rejectBtn = document.createElement("button");
            rejectBtn.textContent = "Refuser";
            rejectBtn.onclick = async () => {
                const success = await respondToChallenge(challenge.ID, "rejected");
                if (success) div.remove();
            };

            div.appendChild(acceptBtn);
            div.appendChild(rejectBtn);
            challengesList.appendChild(div);
        });

    } catch (error) {
        console.error("‚ùå Erreur loadMyChallenges :", error);
        challengesList.innerHTML = "<p>Erreur lors du chargement des d√©fis.</p>";
    }
}

async function loadSentChallenges(userEmail) {
    if (!userEmail) return;

    const sentList = document.getElementById("sent-challenges-list");
    if (!sentList) {
        console.warn("loadSentChallenges: √©l√©ment #sent-challenges-list introuvable");
        return;
    }
    sentList.innerHTML = "";

    try {
        const response = await fetch(getChallengesFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ challenger: userEmail })
        });

        if (!response.ok) throw new Error(`Erreur HTTP ${response.status}`);
        let challenges = await response.json();

console.log("üì• Donn√©es brutes re√ßues du Flow (SentChallenges):", challenges);

        challenges = (challenges || []).map(c => ({
            ...c,
            challengerScore: c.challengerScore ? Number(c.challengerScore) : null,
            opponentScore: c.opponentScore ? Number(c.opponentScore) : null,
challengerDone: parseExcelBool(c.challengerDone),
opponentDone: parseExcelBool(c.opponentDone),
            status: (c.status || "pending").toLowerCase(),
        }));

        console.log("üì§ D√©fis envoy√©s apr√®s conversion :", challenges);

        // üîπ Filtrage : ne montrer que pending et non encore jou√©s par le challenger
        const visible = challenges.filter(c =>
            c.status === "pending" &&
            c.challenger === userEmail &&
            !c.challengerDone
        );

        console.log("üîé D√©fis envoy√©s visibles :", visible);

        if (visible.length === 0) {
            sentList.innerHTML = "<p>Aucun d√©fi envoy√© pour le moment.</p>";
            return;
        }

        visible.forEach(challenge => {
            const div = document.createElement("div");
            div.className = "challenge-item";
            div.style.border = "1px solid #ccc";
            div.style.padding = "10px";
            div.style.marginBottom = "10px";

            const info = document.createElement("p");
            info.textContent = `√Ä: ${challenge.opponent} | Th√®me: ${challenge.theme}`;
            div.appendChild(info);

            const playBtn = document.createElement("button");
            playBtn.textContent = "Faire mon d√©fi";
            playBtn.onclick = () => {
                if (challenge.challengerDone) { alert("‚ö†Ô∏è Tu as d√©j√† termin√© ce d√©fi !"); return; }
                const qArray = Array.isArray(challenge.questions) ? challenge.questions : JSON.parse(challenge.questions || "[]");
                const qSet = qArray.map(qid => quizData[challenge.theme]?.questions.find(q => q.id === qid)).filter(q => q);
                if (qSet.length === 0) { alert("‚ö†Ô∏è Aucune question trouv√©e pour ce d√©fi !"); return; }
                startQuiz(qSet, true, challenge.theme, challenge);
            };

            div.appendChild(playBtn);
            sentList.appendChild(div);
        });

    } catch (error) {
        console.error("‚ùå Erreur loadSentChallenges :", error);
        sentList.innerHTML = "<p>Erreur lors du chargement des d√©fis envoy√©s.</p>";
    }
}

// === üîÅ AUTO-REFRESH DES D√âFIS ===
// Recharge automatiquement les d√©fis toutes les 15 secondes
function startChallengeAutoRefresh() {
    if (!currentUser) return;

    console.log("üîÅ Auto-refresh des d√©fis activ√© pour :", currentUser);

    // Chargement initial
    loadMyChallenges(currentUser);
    loadSentChallenges(currentUser);

    // Intervalle de rafra√Æchissement
    setInterval(() => {
        console.log("üîÑ Rafra√Æchissement automatique des d√©fis...");
        loadMyChallenges(currentUser);
        loadSentChallenges(currentUser);
    }, 30000); // 30000 = 15 secondes
}

// Lancer l'auto-refresh d√®s que la page est charg√©e et l'utilisateur connu
window.addEventListener("DOMContentLoaded", () => {
    if (currentUser) {
        startChallengeAutoRefresh();
    }
});

async function respondToChallenge(ID, status) {
    try {
        const res = await fetch(updateChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ID, status })
        });

        if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);

        console.log(`‚úÖ Donn√©es envoy√©es au Flow avec succ√®s (${status})`);
        return true;
    } catch (error) {
        console.error(`Erreur lors de la r√©ponse au d√©fi (${status}):`, error);
        alert("Une erreur est survenue. Veuillez r√©essayer.");
        return false;
    }
}

// Fonction pour r√©cup√©rer le challenge complet depuis Flow
async function getChallengeFromFlow(challengeID) {
    try {
        const res = await fetch(getChallengeByIdFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ID: challengeID })
        });
        if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
        const data = await res.json();

        // üîπ Conversions num√©riques
        data.challengerScore = data.challengerScore !== null && data.challengerScore !== '' ? Number(data.challengerScore) : null;
        data.opponentScore   = data.opponentScore !== null && data.opponentScore !== '' ? Number(data.opponentScore) : null;

        // üîπ Conversion bool√©ens
        data.challengerDone = data.challengerDone === true || data.challengerDone === "true";
        data.opponentDone = data.opponentDone === true || data.opponentDone === "true";

        return data;
    } catch (err) {
        console.error("‚ùå Impossible de r√©cup√©rer le challenge :", err);
        return null;
    }
}

// Quand un joueur finit son d√©fi

window.onChallengeFinished = async function(finalScore, challenge) {
    if (!challenge || !challenge.ID) {
        console.error("‚ùå Challenge invalide ou ID manquant", challenge);
        return alert("‚ùå Challenge invalide.");
    }

    const isChallenger = (currentUser === challenge.challenger);

    // üîπ Mettre √† jour le score local
    if (isChallenger) challenge.challengerScore = Number(finalScore);
    else challenge.opponentScore = Number(finalScore);

    console.log("üèÅ Fin du d√©fi pour", currentUser, "| Score:", finalScore);

    try {
        // --- 1Ô∏è‚É£ Envoyer le score au Flow ---
        const scorePayload = {
            ID: challenge.ID,
            challengerScore: challenge.challengerScore,
            opponentScore: challenge.opponentScore,
            status: "pending"
        };

        console.log("üì§ Envoi du score au Flow :", scorePayload);

        const scoreRes = await fetch(updateChallengeFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(scorePayload)
        });

        if (!scoreRes.ok) throw new Error(`Erreur HTTP ${scoreRes.status}`);
        console.log("‚úÖ Score envoy√© au Flow !");

        // --- 2Ô∏è‚É£ Mettre √† jour la colonne Done et r√©cup√©rer le JSON du Flow ---
        const donePayload = {
            ID: challenge.ID,
            currentUser: currentUser,
            role: isChallenger ? "challenger" : "opponent"
        };

        console.log("‚öôÔ∏è Envoi du Done au Flow :", donePayload);

        const doneRes = await fetch(updateChallengeDoneFlowUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(donePayload)
        });

        if (!doneRes.ok) throw new Error(`Erreur HTTP ${doneRes.status}`);

        // üîπ R√©cup√©rer la r√©ponse JSON du Flow
        const doneData = await doneRes.json();
        // üîπ Mettre √† jour les propri√©t√©s locales avec les valeurs renvoy√©es
        challenge.challengerDone = !!doneData.challengerDone;
        challenge.opponentDone = !!doneData.opponentDone;

        console.log(`‚úÖ Done mis √† jour depuis Flow :`, challenge);

        // --- 3Ô∏è‚É£ Attendre un court d√©lai pour laisser Excel/Flow propager la MAJ ---
        await new Promise(resolve => setTimeout(resolve, 800));

        // --- 4Ô∏è‚É£ Recharger les listes pour cacher le d√©fi termin√© ---
        if (typeof loadMyChallenges === "function") loadMyChallenges(currentUser);
        if (typeof loadSentChallenges === "function") loadSentChallenges(currentUser);

        console.log("üîÑ Listes de d√©fis recharg√©es apr√®s mise √† jour Done");

    } catch (err) {
        console.error("‚ùå Erreur lors de la finalisation du d√©fi :", err);
        alert("Une erreur est survenue lors de la finalisation du d√©fi. R√©essaie !");
        return;
    }

    // üîπ Recharger le challenge complet
    let freshChallenge;
    try {
        freshChallenge = await getChallengeFromFlow(challenge.ID);
        if (!freshChallenge) throw new Error("Impossible de r√©cup√©rer le d√©fi complet.");
    } catch (err) {
        console.error(err);
        return alert("Impossible de r√©cup√©rer le d√©fi complet apr√®s le score.");
    }

    // üîπ D√©terminer le statut final
    const challengerScore = freshChallenge.challengerScore;
    const opponentScore   = freshChallenge.opponentScore;
    const status = (challengerScore !== null && opponentScore !== null) ? "finished" : "pending";

    challenge.status = status;
    challenge.challengerScore = challengerScore;
    challenge.opponentScore = opponentScore;

    // üîπ Si termin√©, envoyer le statut final
    if (status === "finished") {
        try {
            const finalPayload = {
                ID: challenge.ID,
                challengerScore,
                opponentScore,
                status: "finished"
            };
            await fetch(updateChallengeFlowUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(finalPayload)
            });
            console.log("‚úÖ Statut final 'finished' envoy√© au Flow pour l'ID :", challenge.ID);
        } catch (err) {
            console.error(err);
        }
    }

    // üîπ üîÅ Rafra√Æchir automatiquement la liste des d√©fis pour cacher ceux d√©j√† faits
    loadMyChallenges(currentUser);
    loadSentChallenges(currentUser);
};

// FINISH CHALLENGE IF NEEDED
// =======================
function finishChallengeIfNeeded() {
    console.log("‚ö° finishChallengeIfNeeded appel√© :", isChallengeSession, window.currentChallenge);
    if (isChallengeSession && typeof window.onChallengeFinished === "function") {
        window.onChallengeFinished(score, window.currentChallenge || null);
        isChallengeSession = false;
    }
}

// V√©rifier le gagnant et stopper toute boucle
async function checkWinner(challenge) {
    // V√©rifier que les deux scores sont pr√©sents
    if (
        typeof challenge.challengerScore === 'number' &&
        !isNaN(challenge.challengerScore) &&
        typeof challenge.opponentScore === 'number' &&
        !isNaN(challenge.opponentScore)
    ) {
        let msg;
        if (challenge.challengerScore > challenge.opponentScore) {
            msg = `${challenge.challenger} a gagn√© !`;
        } else if (challenge.opponentScore > challenge.challengerScore) {
            msg = `${challenge.opponent} a gagn√© !`;
        } else {
            msg = "√âgalit√© parfaite !";
        }

        alert("üèÜ R√©sultat du d√©fi : " + msg);

        // Bloquer toute relance du d√©fi
        challenge.status = "finished";
        console.log("‚úÖ D√©fi termin√©, boucle stopp√©e, statut:", challenge.status);

        // üîπ Appel au Flow pour mettre √† jour le statut de cette row
        const payload = {
            ID: challenge.ID,
            challengerScore: challenge.challengerScore,
            opponentScore: challenge.opponentScore,
            status: "finished"
        };

        try {
            const res = await fetch(updateChallengeFlowUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (!res.ok) throw new Error(`Erreur HTTP ${res.status}`);
            console.log("‚úÖ Statut final 'finished' envoy√© au Flow pour l'ID :", challenge.ID);
        } catch (err) {
            console.error("‚ùå Erreur lors de l‚Äôenvoi du statut final au Flow :", err);
            alert("Impossible de mettre √† jour le statut final. R√©essaie !");
        }
    }
}

// Charger les d√©fis √† chaque login
window.addEventListener("DOMContentLoaded", () => {
    if (currentUser) loadMyChallenges(currentUser);
});
  
  </script>
</body>
</html>

